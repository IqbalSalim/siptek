var ph=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function y0(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}var fy={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(v,I){(function(){var E,L="4.17.21",B=200,U="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",q="Expected a function",o="Invalid `variable` option passed into `_.template`",Q="__lodash_hash_undefined__",me=500,Ce="__lodash_placeholder__",ce=1,Ue=2,We=4,ot=1,it=2,Ze=1,Ie=2,je=4,Oe=8,qe=16,Ye=32,ci=64,Pi=128,xt=256,bt=512,At=30,vt="...",Yt=800,ei=16,Ni=1,mr=2,wn=3,Dn=1/0,xr=9007199254740991,ps=17976931348623157e292,pn=0/0,Tn=4294967295,_r=Tn-1,mn=Tn>>>1,Ao=[["ary",Pi],["bind",Ze],["bindKey",Ie],["curry",Oe],["curryRight",qe],["flip",bt],["partial",Ye],["partialRight",ci],["rearg",xt]],Zr="[object Arguments]",Wn="[object Array]",So="[object AsyncFunction]",Pr="[object Boolean]",Ln="[object Date]",zr="[object DOMException]",ms="[object Error]",_n="[object Function]",_o="[object GeneratorFunction]",Kt="[object Map]",Wr="[object Number]",Wo="[object Null]",Xr="[object Object]",Xn="[object Promise]",En="[object Proxy]",Qt="[object RegExp]",kr="[object Set]",Er="[object String]",On="[object Symbol]",Zs="[object Undefined]",Io="[object WeakMap]",Ws="[object WeakSet]",io="[object ArrayBuffer]",Fr="[object DataView]",gn="[object Float32Array]",Xo="[object Float64Array]",Xs="[object Int8Array]",An="[object Int16Array]",Sn="[object Int32Array]",Ur="[object Uint8Array]",Hr="[object Uint8ClampedArray]",Kr="[object Uint16Array]",Dr="[object Uint32Array]",Hs=/\b__p \+= '';/g,_s=/\b(__p \+=) '' \+/g,Ho=/(__e\(.*?\)|\b__t\)) \+\n'';/g,gs=/&(?:amp|lt|gt|quot|#39);/g,Ko=/[&<>"']/g,Mo=RegExp(gs.source),Co=RegExp(Ko.source),zl=/<%-([\s\S]+?)%>/g,In=/<%([\s\S]+?)%>/g,Ks=/<%=([\s\S]+?)%>/g,oe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,N=/^\w*$/,G=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ne=/[\\^$.*+?()[\]{}|]/g,ue=RegExp(ne.source),be=/^\s+/,ze=/\s/,Me=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Te=/\{\n\/\* \[wrapped with (.+)\] \*/,ke=/,? & /,nt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Mt=/[()=,{}\[\]\/\s]/,lt=/\\(\\)?/g,$t=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Vt=/\w*$/,Ut=/^[-+]0x[0-9a-f]+$/i,Wt=/^0b[01]+$/i,oi=/^\[object .+?Constructor\]$/,ji=/^0o[0-7]+$/i,Zi=/^(?:0|[1-9]\d*)$/,xi=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ft=/($^)/,$e=/['\n\r\u2028\u2029\\]/g,sn="\\ud800-\\udfff",ur="\\u0300-\\u036f",ys="\\ufe20-\\ufe2f",kl="\\u20d0-\\u20ff",ro=ur+ys+kl,Ta="\\u2700-\\u27bf",Dc="a-z\\xdf-\\xf6\\xf8-\\xff",Ea="\\xac\\xb1\\xd7\\xf7",Ct="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",di="\\u2000-\\u206f",fi=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",no="A-Z\\xc0-\\xd6\\xd8-\\xde",oo="\\ufe0e\\ufe0f",ti=Ea+Ct+di+fi,Ys="['\u2019]",vs="["+sn+"]",Aa="["+ti+"]",an="["+ro+"]",ir="\\d+",Lc="["+Ta+"]",xs="["+Dc+"]",Js="[^"+sn+ti+ir+Ta+Dc+no+"]",Po="\\ud83c[\\udffb-\\udfff]",Dl="(?:"+an+"|"+Po+")",Yo="[^"+sn+"]",ln="(?:\\ud83c[\\udde6-\\uddff]){2}",Ri="[\\ud800-\\udbff][\\udc00-\\udfff]",Jo="["+no+"]",Qs="\\u200d",Nr="(?:"+xs+"|"+Js+")",Rn="(?:"+Jo+"|"+Js+")",Ll="(?:"+Ys+"(?:d|ll|m|re|s|t|ve))?",Qo="(?:"+Ys+"(?:D|LL|M|RE|S|T|VE))?",gr=Dl+"?",Sa="["+oo+"]?",ea="(?:"+Qs+"(?:"+[Yo,ln,Ri].join("|")+")"+Sa+gr+")*",tl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Yr="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ia=Sa+gr+ea,ac="(?:"+[Lc,ln,Ri].join("|")+")"+Ia,so="(?:"+[Yo+an+"?",an,ln,Ri,vs].join("|")+")",il=RegExp(Ys,"g"),Ol=RegExp(an,"g"),Rl=RegExp(Po+"(?="+Po+")|"+so+Ia,"g"),Bl=RegExp([Jo+"?"+xs+"+"+Ll+"(?="+[Aa,Jo,"$"].join("|")+")",Rn+"+"+Qo+"(?="+[Aa,Jo+Nr,"$"].join("|")+")",Jo+"?"+Nr+"+"+Ll,Jo+"+"+Qo,Yr,tl,ir,ac].join("|"),"g"),Ma=RegExp("["+Qs+sn+ro+oo+"]"),xh=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Oc=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],bs=-1,zi={};zi[gn]=zi[Xo]=zi[Xs]=zi[An]=zi[Sn]=zi[Ur]=zi[Hr]=zi[Kr]=zi[Dr]=!0,zi[Zr]=zi[Wn]=zi[io]=zi[Pr]=zi[Fr]=zi[Ln]=zi[ms]=zi[_n]=zi[Kt]=zi[Wr]=zi[Xr]=zi[Qt]=zi[kr]=zi[Er]=zi[Io]=!1;var Xi={};Xi[Zr]=Xi[Wn]=Xi[io]=Xi[Fr]=Xi[Pr]=Xi[Ln]=Xi[gn]=Xi[Xo]=Xi[Xs]=Xi[An]=Xi[Sn]=Xi[Kt]=Xi[Wr]=Xi[Xr]=Xi[Qt]=Xi[kr]=Xi[Er]=Xi[On]=Xi[Ur]=Xi[Hr]=Xi[Kr]=Xi[Dr]=!0,Xi[ms]=Xi[_n]=Xi[Io]=!1;var ws={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},lc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Fl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},cc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Rc=parseFloat,es=parseInt,rl=typeof ph=="object"&&ph&&ph.Object===Object&&ph,Bc=typeof self=="object"&&self&&self.Object===Object&&self,Jr=rl||Bc||Function("return this")(),Ul=I&&!I.nodeType&&I,Ts=Ul&&!0&&v&&!v.nodeType&&v,Bn=Ts&&Ts.exports===Ul,nl=Bn&&rl.process,Fn=function(){try{var Se=Ts&&Ts.require&&Ts.require("util").types;return Se||nl&&nl.binding&&nl.binding("util")}catch{}}(),Nl=Fn&&Fn.isArrayBuffer,jl=Fn&&Fn.isDate,ta=Fn&&Fn.isMap,ia=Fn&&Fn.isRegExp,ts=Fn&&Fn.isSet,zo=Fn&&Fn.isTypedArray;function cn(Se,Xe,Be){switch(Be.length){case 0:return Se.call(Xe);case 1:return Se.call(Xe,Be[0]);case 2:return Se.call(Xe,Be[0],Be[1]);case 3:return Se.call(Xe,Be[0],Be[1],Be[2])}return Se.apply(Xe,Be)}function Vl(Se,Xe,Be,It){for(var Gt=-1,si=Se==null?0:Se.length;++Gt<si;){var fr=Se[Gt];Xe(It,fr,Be(fr),Se)}return It}function yn(Se,Xe){for(var Be=-1,It=Se==null?0:Se.length;++Be<It&&Xe(Se[Be],Be,Se)!==!1;);return Se}function Gl(Se,Xe){for(var Be=Se==null?0:Se.length;Be--&&Xe(Se[Be],Be,Se)!==!1;);return Se}function is(Se,Xe){for(var Be=-1,It=Se==null?0:Se.length;++Be<It;)if(!Xe(Se[Be],Be,Se))return!1;return!0}function pi(Se,Xe){for(var Be=-1,It=Se==null?0:Se.length,Gt=0,si=[];++Be<It;){var fr=Se[Be];Xe(fr,Be,Se)&&(si[Gt++]=fr)}return si}function Es(Se,Xe){var Be=Se==null?0:Se.length;return!!Be&&Ms(Se,Xe,0)>-1}function As(Se,Xe,Be){for(var It=-1,Gt=Se==null?0:Se.length;++It<Gt;)if(Be(Xe,Se[It]))return!0;return!1}function rr(Se,Xe){for(var Be=-1,It=Se==null?0:Se.length,Gt=Array(It);++Be<It;)Gt[Be]=Xe(Se[Be],Be,Se);return Gt}function ui(Se,Xe){for(var Be=-1,It=Xe.length,Gt=Se.length;++Be<It;)Se[Gt+Be]=Xe[Be];return Se}function Ss(Se,Xe,Be,It){var Gt=-1,si=Se==null?0:Se.length;for(It&&si&&(Be=Se[++Gt]);++Gt<si;)Be=Xe(Be,Se[Gt],Gt,Se);return Be}function ol(Se,Xe,Be,It){var Gt=Se==null?0:Se.length;for(It&&Gt&&(Be=Se[--Gt]);Gt--;)Be=Xe(Be,Se[Gt],Gt,Se);return Be}function ra(Se,Xe){for(var Be=-1,It=Se==null?0:Se.length;++Be<It;)if(Xe(Se[Be],Be,Se))return!0;return!1}var $l=Pa("length");function ql(Se){return Se.split("")}function Is(Se){return Se.match(nt)||[]}function Ca(Se,Xe,Be){var It;return Be(Se,function(Gt,si,fr){if(Xe(Gt,si,fr))return It=si,!1}),It}function sl(Se,Xe,Be,It){for(var Gt=Se.length,si=Be+(It?1:-1);It?si--:++si<Gt;)if(Xe(Se[si],si,Se))return si;return-1}function Ms(Se,Xe,Be){return Xe===Xe?bi(Se,Xe,Be):sl(Se,al,Be)}function Zl(Se,Xe,Be,It){for(var Gt=Be-1,si=Se.length;++Gt<si;)if(It(Se[Gt],Xe))return Gt;return-1}function al(Se){return Se!==Se}function ll(Se,Xe){var Be=Se==null?0:Se.length;return Be?rs(Se,Xe)/Be:pn}function Pa(Se){return function(Xe){return Xe==null?E:Xe[Se]}}function Wl(Se){return function(Xe){return Se==null?E:Se[Xe]}}function Xl(Se,Xe,Be,It,Gt){return Gt(Se,function(si,fr,Di){Be=It?(It=!1,si):Xe(Be,si,fr,Di)}),Be}function Fc(Se,Xe){var Be=Se.length;for(Se.sort(Xe);Be--;)Se[Be]=Se[Be].value;return Se}function rs(Se,Xe){for(var Be,It=-1,Gt=Se.length;++It<Gt;){var si=Xe(Se[It]);si!==E&&(Be=Be===E?si:Be+si)}return Be}function ns(Se,Xe){for(var Be=-1,It=Array(Se);++Be<Se;)It[Be]=Xe(Be);return It}function na(Se,Xe){return rr(Xe,function(Be){return[Be,Se[Be]]})}function za(Se){return Se&&Se.slice(0,hr(Se)+1).replace(be,"")}function vn(Se){return function(Xe){return Se(Xe)}}function Hn(Se,Xe){return rr(Xe,function(Be){return Se[Be]})}function oa(Se,Xe){return Se.has(Xe)}function cl(Se,Xe){for(var Be=-1,It=Se.length;++Be<It&&Ms(Xe,Se[Be],0)>-1;);return Be}function ul(Se,Xe){for(var Be=Se.length;Be--&&Ms(Xe,Se[Be],0)>-1;);return Be}function M(Se,Xe){for(var Be=Se.length,It=0;Be--;)Se[Be]===Xe&&++It;return It}var D=Wl(ws),R=Wl(lc);function W(Se){return"\\"+cc[Se]}function Re(Se,Xe){return Se==null?E:Se[Xe]}function Je(Se){return Ma.test(Se)}function yt(Se){return xh.test(Se)}function _t(Se){for(var Xe,Be=[];!(Xe=Se.next()).done;)Be.push(Xe.value);return Be}function Pt(Se){var Xe=-1,Be=Array(Se.size);return Se.forEach(function(It,Gt){Be[++Xe]=[Gt,It]}),Be}function qt(Se,Xe){return function(Be){return Se(Xe(Be))}}function Lt(Se,Xe){for(var Be=-1,It=Se.length,Gt=0,si=[];++Be<It;){var fr=Se[Be];(fr===Xe||fr===Ce)&&(Se[Be]=Ce,si[Gt++]=Be)}return si}function Vi(Se){var Xe=-1,Be=Array(Se.size);return Se.forEach(function(It){Be[++Xe]=It}),Be}function Ar(Se){var Xe=-1,Be=Array(Se.size);return Se.forEach(function(It){Be[++Xe]=[It,It]}),Be}function bi(Se,Xe,Be){for(var It=Be-1,Gt=Se.length;++It<Gt;)if(Se[It]===Xe)return It;return-1}function Hi(Se,Xe,Be){for(var It=Be+1;It--;)if(Se[It]===Xe)return It;return It}function mi(Se){return Je(Se)?nr(Se):$l(Se)}function Ti(Se){return Je(Se)?ki(Se):ql(Se)}function hr(Se){for(var Xe=Se.length;Xe--&&ze.test(Se.charAt(Xe)););return Xe}var yr=Wl(Fl);function nr(Se){for(var Xe=Rl.lastIndex=0;Rl.test(Se);)++Xe;return Xe}function ki(Se){return Se.match(Rl)||[]}function dr(Se){return Se.match(Bl)||[]}var Ji=function Se(Xe){Xe=Xe==null?Jr:Gi.defaults(Jr.Object(),Xe,Gi.pick(Jr,Oc));var Be=Xe.Array,It=Xe.Date,Gt=Xe.Error,si=Xe.Function,fr=Xe.Math,Di=Xe.Object,Lr=Xe.RegExp,ao=Xe.String,un=Xe.TypeError,_i=Be.prototype,Cs=si.prototype,os=Di.prototype,lo=Xe["__core-js_shared__"],go=Cs.toString,Bi=os.hasOwnProperty,Mn=0,Ps=function(){var c=/[^.]+$/.exec(lo&&lo.keys&&lo.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),co=os.toString,ss=go.call(Di),ka=Jr._,Da=Lr("^"+go.call(Bi).replace(ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zs=Bn?Xe.Buffer:E,uo=Xe.Symbol,sa=Xe.Uint8Array,aa=zs?zs.allocUnsafe:E,as=qt(Di.getPrototypeOf,Di),St=Di.create,Cn=os.propertyIsEnumerable,La=_i.splice,Hl=uo?uo.isConcatSpreadable:E,Pn=uo?uo.iterator:E,Or=uo?uo.toStringTag:E,la=function(){try{var c=bc(Di,"defineProperty");return c({},"",{}),c}catch{}}(),Oa=Xe.clearTimeout!==Jr.clearTimeout&&Xe.clearTimeout,ca=It&&It.now!==Jr.Date.now&&It.now,Ra=Xe.setTimeout!==Jr.setTimeout&&Xe.setTimeout,Ba=fr.ceil,ua=fr.floor,ho=Di.getOwnPropertySymbols,jd=zs?zs.isBuffer:E,bh=Xe.isFinite,wh=_i.join,Uc=qt(Di.keys,Di),jr=fr.max,Qr=fr.min,uc=It.now,Un=Xe.parseInt,hl=fr.random,Th=_i.reverse,Nc=bc(Xe,"DataView"),Kl=bc(Xe,"Map"),jc=bc(Xe,"Promise"),ha=bc(Xe,"Set"),ks=bc(Xe,"WeakMap"),Fa=bc(Di,"create"),hc=ks&&new ks,dl={},Vc=tn(Nc),Eh=tn(Kl),Eu=tn(jc),zn=tn(ha),Vd=tn(ks),fl=uo?uo.prototype:E,Ua=fl?fl.valueOf:E,Au=fl?fl.toString:E;function X(c){if(nn(c)&&!yi(c)&&!(c instanceof Ci)){if(c instanceof Sr)return c;if(Bi.call(c,"__wrapped__"))return Qh(c)}return new Sr(c)}var Na=function(){function c(){}return function(f){if(!Gr(f))return{};if(St)return St(f);c.prototype=f;var b=new c;return c.prototype=E,b}}();function da(){}function Sr(c,f){this.__wrapped__=c,this.__actions__=[],this.__chain__=!!f,this.__index__=0,this.__values__=E}X.templateSettings={escape:zl,evaluate:In,interpolate:Ks,variable:"",imports:{_:X}},X.prototype=da.prototype,X.prototype.constructor=X,Sr.prototype=Na(da.prototype),Sr.prototype.constructor=Sr;function Ci(c){this.__wrapped__=c,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Tn,this.__views__=[]}function kt(){var c=new Ci(this.__wrapped__);return c.__actions__=hn(this.__actions__),c.__dir__=this.__dir__,c.__filtered__=this.__filtered__,c.__iteratees__=hn(this.__iteratees__),c.__takeCount__=this.__takeCount__,c.__views__=hn(this.__views__),c}function Ah(){if(this.__filtered__){var c=new Ci(this);c.__dir__=-1,c.__filtered__=!0}else c=this.clone(),c.__dir__*=-1;return c}function Sh(){var c=this.__wrapped__.value(),f=this.__dir__,b=yi(c),z=f<0,V=b?c.length:0,re=fp(0,V,this.__views__),_e=re.start,Ae=re.end,De=Ae-_e,ct=z?Ae:_e-1,ut=this.__iteratees__,pt=ut.length,Bt=0,jt=Qr(De,this.__takeCount__);if(!b||!z&&V==De&&jt==De)return lp(c,this.__actions__);var ai=[];e:for(;De--&&Bt<jt;){ct+=f;for(var Ai=-1,li=c[ct];++Ai<pt;){var Ii=ut[Ai],Fi=Ii.iteratee,bo=Ii.type,Br=Fi(li);if(bo==mr)li=Br;else if(!Br){if(bo==Ni)continue e;break e}}ai[Bt++]=li}return ai}Ci.prototype=Na(da.prototype),Ci.prototype.constructor=Ci;function ko(c){var f=-1,b=c==null?0:c.length;for(this.clear();++f<b;){var z=c[f];this.set(z[0],z[1])}}function dc(){this.__data__=Fa?Fa(null):{},this.size=0}function Ih(c){var f=this.has(c)&&delete this.__data__[c];return this.size-=f?1:0,f}function Mh(c){var f=this.__data__;if(Fa){var b=f[c];return b===Q?E:b}return Bi.call(f,c)?f[c]:E}function Ch(c){var f=this.__data__;return Fa?f[c]!==E:Bi.call(f,c)}function Ph(c,f){var b=this.__data__;return this.size+=this.has(c)?0:1,b[c]=Fa&&f===E?Q:f,this}ko.prototype.clear=dc,ko.prototype.delete=Ih,ko.prototype.get=Mh,ko.prototype.has=Ch,ko.prototype.set=Ph;function Ds(c){var f=-1,b=c==null?0:c.length;for(this.clear();++f<b;){var z=c[f];this.set(z[0],z[1])}}function zh(){this.__data__=[],this.size=0}function fc(c){var f=this.__data__,b=ml(f,c);if(b<0)return!1;var z=f.length-1;return b==z?f.pop():La.call(f,b,1),--this.size,!0}function Gc(c){var f=this.__data__,b=ml(f,c);return b<0?E:f[b][1]}function Su(c){return ml(this.__data__,c)>-1}function pl(c,f){var b=this.__data__,z=ml(b,c);return z<0?(++this.size,b.push([c,f])):b[z][1]=f,this}Ds.prototype.clear=zh,Ds.prototype.delete=fc,Ds.prototype.get=Gc,Ds.prototype.has=Su,Ds.prototype.set=pl;function Ls(c){var f=-1,b=c==null?0:c.length;for(this.clear();++f<b;){var z=c[f];this.set(z[0],z[1])}}function Iu(){this.size=0,this.__data__={hash:new ko,map:new(Kl||Ds),string:new ko}}function kh(c){var f=qh(this,c).delete(c);return this.size-=f?1:0,f}function Mu(c){return qh(this,c).get(c)}function Cu(c){return qh(this,c).has(c)}function Pu(c,f){var b=qh(this,c),z=b.size;return b.set(c,f),this.size+=b.size==z?0:1,this}Ls.prototype.clear=Iu,Ls.prototype.delete=kh,Ls.prototype.get=Mu,Ls.prototype.has=Cu,Ls.prototype.set=Pu;function fa(c){var f=-1,b=c==null?0:c.length;for(this.__data__=new Ls;++f<b;)this.add(c[f])}function pc(c){return this.__data__.set(c,Q),this}function $c(c){return this.__data__.has(c)}fa.prototype.add=fa.prototype.push=pc,fa.prototype.has=$c;function Do(c){var f=this.__data__=new Ds(c);this.size=f.size}function Dh(){this.__data__=new Ds,this.size=0}function Lh(c){var f=this.__data__,b=f.delete(c);return this.size=f.size,b}function mc(c){return this.__data__.get(c)}function Oh(c){return this.__data__.has(c)}function zu(c,f){var b=this.__data__;if(b instanceof Ds){var z=b.__data__;if(!Kl||z.length<B-1)return z.push([c,f]),this.size=++b.size,this;b=this.__data__=new Ls(z)}return b.set(c,f),this.size=b.size,this}Do.prototype.clear=Dh,Do.prototype.delete=Lh,Do.prototype.get=mc,Do.prototype.has=Oh,Do.prototype.set=zu;function ku(c,f){var b=yi(c),z=!b&&Pc(c),V=!b&&!z&&js(c),re=!b&&!z&&!V&&Xa(c),_e=b||z||V||re,Ae=_e?ns(c.length,ao):[],De=Ae.length;for(var ct in c)(f||Bi.call(c,ct))&&!(_e&&(ct=="length"||V&&(ct=="offset"||ct=="parent")||re&&(ct=="buffer"||ct=="byteLength"||ct=="byteOffset")||Tl(ct,De)))&&Ae.push(ct);return Ae}function qc(c){var f=c.length;return f?c[ma(0,f-1)]:E}function Du(c,f){return iu(hn(c),m(f,0,c.length))}function Zc(c){return iu(hn(c))}function Lu(c,f,b){(b!==E&&!No(c[f],b)||b===E&&!(f in c))&&s(c,f,b)}function _c(c,f,b){var z=c[f];(!(Bi.call(c,f)&&No(z,b))||b===E&&!(f in c))&&s(c,f,b)}function ml(c,f){for(var b=c.length;b--;)if(No(c[b][0],f))return b;return-1}function gc(c,f,b,z){return k(c,function(V,re,_e){f(z,V,b(V),_e)}),z}function l(c,f){return c&&Kn(f,$n(f),c)}function r(c,f){return c&&Kn(f,Go(f),c)}function s(c,f,b){f=="__proto__"&&la?la(c,f,{configurable:!0,enumerable:!0,value:b,writable:!0}):c[f]=b}function h(c,f){for(var b=-1,z=f.length,V=Be(z),re=c==null;++b<z;)V[b]=re?E:hu(c,f[b]);return V}function m(c,f,b){return c===c&&(b!==E&&(c=c<=b?c:b),f!==E&&(c=c>=f?c:f)),c}function _(c,f,b,z,V,re){var _e,Ae=f&ce,De=f&Ue,ct=f&We;if(b&&(_e=V?b(c,z,V,re):b(c)),_e!==E)return _e;if(!Gr(c))return c;var ut=yi(c);if(ut){if(_e=d_(c),!Ae)return hn(c,_e)}else{var pt=Yn(c),Bt=pt==_n||pt==_o;if(js(c))return Wd(c,Ae);if(pt==Xr||pt==Zr||Bt&&!V){if(_e=De||Bt?{}:Tc(c),!Ae)return De?h_(c,r(_e,c)):vc(c,l(_e,c))}else{if(!Xi[pt])return V?c:{};_e=Xh(c,pt,Ae)}}re||(re=new Do);var jt=re.get(c);if(jt)return jt;re.set(c,_e),_d(c)?c.forEach(function(li){_e.add(_(li,f,b,li,c,re))}):Qp(c)&&c.forEach(function(li,Ii){_e.set(Ii,_(li,f,b,Ii,c,re))});var ai=ct?De?wl:ya:De?Go:$n,Ai=ut?E:ai(c);return yn(Ai||c,function(li,Ii){Ai&&(Ii=li,li=c[Ii]),_c(_e,Ii,_(li,f,b,Ii,c,re))}),_e}function x(c){var f=$n(c);return function(b){return w(b,c,f)}}function w(c,f,b){var z=b.length;if(c==null)return!z;for(c=Di(c);z--;){var V=b[z],re=f[V],_e=c[V];if(_e===E&&!(V in c)||!re(_e))return!1}return!0}function A(c,f,b){if(typeof c!="function")throw new un(q);return Fs(function(){c.apply(E,b)},f)}function P(c,f,b,z){var V=-1,re=Es,_e=!0,Ae=c.length,De=[],ct=f.length;if(!Ae)return De;b&&(f=rr(f,vn(b))),z?(re=As,_e=!1):f.length>=B&&(re=oa,_e=!1,f=new fa(f));e:for(;++V<Ae;){var ut=c[V],pt=b==null?ut:b(ut);if(ut=z||ut!==0?ut:0,_e&&pt===pt){for(var Bt=ct;Bt--;)if(f[Bt]===pt)continue e;De.push(ut)}else re(f,pt,z)||De.push(ut)}return De}var k=up(ie),j=up(xe,!0);function Z(c,f){var b=!0;return k(c,function(z,V,re){return b=!!f(z,V,re),b}),b}function te(c,f,b){for(var z=-1,V=c.length;++z<V;){var re=c[z],_e=f(re);if(_e!=null&&(Ae===E?_e===_e&&!Ir(_e):b(_e,Ae)))var Ae=_e,De=re}return De}function ee(c,f,b,z){var V=c.length;for(b=Si(b),b<0&&(b=-b>V?0:V+b),z=z===E||z>V?V:Si(z),z<0&&(z+=V),z=b>z?0:Af(z);b<z;)c[b++]=f;return c}function J(c,f){var b=[];return k(c,function(z,V,re){f(z,V,re)&&b.push(z)}),b}function H(c,f,b,z,V){var re=-1,_e=c.length;for(b||(b=mp),V||(V=[]);++re<_e;){var Ae=c[re];f>0&&b(Ae)?f>1?H(Ae,f-1,b,z,V):ui(V,Ae):z||(V[V.length]=Ae)}return V}var K=Xd(),se=Xd(!0);function ie(c,f){return c&&K(c,f,$n)}function xe(c,f){return c&&se(c,f,$n)}function ye(c,f){return pi(f,function(b){return Sl(c[b])})}function he(c,f){f=Va(f,c);for(var b=0,z=f.length;c!=null&&b<z;)c=c[hs(f[b++])];return b&&b==z?c:E}function ve(c,f,b){var z=f(c);return yi(c)?z:ui(z,b(c))}function fe(c){return c==null?c===E?Zs:Wo:Or&&Or in Di(c)?Qd(c):gp(c)}function Ee(c,f){return c>f}function Le(c,f){return c!=null&&Bi.call(c,f)}function ht(c,f){return c!=null&&f in Di(c)}function Pe(c,f,b){return c>=Qr(f,b)&&c<jr(f,b)}function He(c,f,b){for(var z=b?As:Es,V=c[0].length,re=c.length,_e=re,Ae=Be(re),De=1/0,ct=[];_e--;){var ut=c[_e];_e&&f&&(ut=rr(ut,vn(f))),De=Qr(ut.length,De),Ae[_e]=!b&&(f||V>=120&&ut.length>=120)?new fa(_e&&ut):E}ut=c[0];var pt=-1,Bt=Ae[0];e:for(;++pt<V&&ct.length<De;){var jt=ut[pt],ai=f?f(jt):jt;if(jt=b||jt!==0?jt:0,!(Bt?oa(Bt,ai):z(ct,ai,b))){for(_e=re;--_e;){var Ai=Ae[_e];if(!(Ai?oa(Ai,ai):z(c[_e],ai,b)))continue e}Bt&&Bt.push(ai),ct.push(jt)}}return ct}function rt(c,f,b,z){return ie(c,function(V,re,_e){f(z,b(V),re,_e)}),z}function gt(c,f,b){f=Va(f,c),c=Yh(c,f);var z=c==null?c:c[hs(Fo(f))];return z==null?E:cn(z,c,b)}function Ve(c){return nn(c)&&fe(c)==Zr}function dt(c){return nn(c)&&fe(c)==io}function Qe(c){return nn(c)&&fe(c)==Ln}function Tt(c,f,b,z,V){return c===f?!0:c==null||f==null||!nn(c)&&!nn(f)?c!==c&&f!==f:wt(c,f,b,z,Tt,V)}function wt(c,f,b,z,V,re){var _e=yi(c),Ae=yi(f),De=_e?Wn:Yn(c),ct=Ae?Wn:Yn(f);De=De==Zr?Xr:De,ct=ct==Zr?Xr:ct;var ut=De==Xr,pt=ct==Xr,Bt=De==ct;if(Bt&&js(c)){if(!js(f))return!1;_e=!0,ut=!1}if(Bt&&!ut)return re||(re=new Do),_e||Xa(c)?hp(c,f,b,z,V,re):Jd(c,f,De,b,z,V,re);if(!(b&ot)){var jt=ut&&Bi.call(c,"__wrapped__"),ai=pt&&Bi.call(f,"__wrapped__");if(jt||ai){var Ai=jt?c.value():c,li=ai?f.value():f;return re||(re=new Do),V(Ai,li,b,z,re)}}return Bt?(re||(re=new Do),dp(c,f,b,z,V,re)):!1}function Ot(c){return nn(c)&&Yn(c)==Kt}function Nt(c,f,b,z){var V=b.length,re=V,_e=!z;if(c==null)return!re;for(c=Di(c);V--;){var Ae=b[V];if(_e&&Ae[2]?Ae[1]!==c[Ae[0]]:!(Ae[0]in c))return!1}for(;++V<re;){Ae=b[V];var De=Ae[0],ct=c[De],ut=Ae[1];if(_e&&Ae[2]){if(ct===E&&!(De in c))return!1}else{var pt=new Do;if(z)var Bt=z(ct,ut,De,c,f,pt);if(!(Bt===E?Tt(ut,ct,ot|it,z,pt):Bt))return!1}}return!0}function Ht(c){if(!Gr(c)||qa(c))return!1;var f=Sl(c)?Da:oi;return f.test(tn(c))}function Ei(c){return nn(c)&&fe(c)==Qt}function Rt(c){return nn(c)&&Yn(c)==kr}function ii(c){return nn(c)&&pd(c.length)&&!!zi[fe(c)]}function Li(c){return typeof c=="function"?c:c==null?$o:typeof c=="object"?yi(c)?Os(c[0],c[1]):Lo(c):ch(c)}function Qi(c){if(!Za(c))return Uc(c);var f=[];for(var b in Di(c))Bi.call(c,b)&&b!="constructor"&&f.push(b);return f}function br(c){if(!Gr(c))return _p(c);var f=Za(c),b=[];for(var z in c)z=="constructor"&&(f||!Bi.call(c,z))||b.push(z);return b}function qi(c,f){return c<f}function xn(c,f){var b=-1,z=jo(c)?Be(c.length):[];return k(c,function(V,re,_e){z[++b]=f(V,re,_e)}),z}function Lo(c){var f=Zh(c);return f.length==1&&f[0][2]?Jl(f[0][0],f[0][1]):function(b){return b===c||Nt(b,c,f)}}function Os(c,f){return eu(c)&&tu(f)?Jl(hs(c),f):function(b){var z=hu(b,c);return z===E&&z===f?du(b,c):Tt(f,z,ot|it)}}function Ki(c,f,b,z,V){c!==f&&K(f,function(re,_e){if(V||(V=new Do),Gr(re))pr(c,f,_e,b,Ki,z,V);else{var Ae=z?z(Ec(c,_e),re,_e+"",c,f,V):E;Ae===E&&(Ae=re),Lu(c,_e,Ae)}},Go)}function pr(c,f,b,z,V,re,_e){var Ae=Ec(c,b),De=Ec(f,b),ct=_e.get(De);if(ct){Lu(c,b,ct);return}var ut=re?re(Ae,De,b+"",c,f,_e):E,pt=ut===E;if(pt){var Bt=yi(De),jt=!Bt&&js(De),ai=!Bt&&!jt&&Xa(De);ut=De,Bt||jt||ai?yi(Ae)?ut=Ae:rn(Ae)?ut=hn(Ae):jt?(pt=!1,ut=Wd(De,!0)):ai?(pt=!1,ut=Nh(De,!0)):ut=[]:Qu(De)||Pc(De)?(ut=Ae,Pc(Ae)?ut=yd(Ae):(!Gr(Ae)||Sl(Ae))&&(ut=Tc(De))):pt=!1}pt&&(_e.set(De,ut),V(ut,De,z,re,_e),_e.delete(De)),Lu(c,b,ut)}function gi(c,f){var b=c.length;if(!!b)return f+=f<0?b:0,Tl(f,b)?c[f]:E}function Rr(c,f,b){f.length?f=rr(f,function(re){return yi(re)?function(_e){return he(_e,re.length===1?re[0]:re)}:re}):f=[$o];var z=-1;f=rr(f,vn(ri()));var V=xn(c,function(re,_e,Ae){var De=rr(f,function(ct){return ct(re)});return{criteria:De,index:++z,value:re}});return Fc(V,function(re,_e){return Hc(re,_e,b)})}function Nn(c,f){return Yi(c,f,function(b,z){return du(c,z)})}function Yi(c,f,b){for(var z=-1,V=f.length,re={};++z<V;){var _e=f[z],Ae=he(c,_e);b(Ae,_e)&&ga(re,Va(_e,c),Ae)}return re}function jn(c){return function(f){return he(f,c)}}function pa(c,f,b,z){var V=z?Zl:Ms,re=-1,_e=f.length,Ae=c;for(c===f&&(f=hn(f)),b&&(Ae=rr(c,vn(b)));++re<_e;)for(var De=0,ct=f[re],ut=b?b(ct):ct;(De=V(Ae,ut,De,z))>-1;)Ae!==c&&La.call(Ae,De,1),La.call(c,De,1);return c}function Vn(c,f){for(var b=c?f.length:0,z=b-1;b--;){var V=f[b];if(b==z||V!==re){var re=V;Tl(V)?La.call(c,V,1):Zd(c,V)}}return c}function ma(c,f){return c+ua(hl()*(f-c+1))}function _l(c,f,b,z){for(var V=-1,re=jr(Ba((f-c)/(b||1)),0),_e=Be(re);re--;)_e[z?re:++V]=c,c+=b;return _e}function _a(c,f){var b="";if(!c||f<1||f>xr)return b;do f%2&&(b+=c),f=ua(f/2),f&&(c+=c);while(f);return b}function Jt(c,f){return ju(yp(c,f,$o),c+"")}function gl(c){return qc(Ka(c))}function ja(c,f){var b=Ka(c);return iu(b,m(f,0,b.length))}function ga(c,f,b,z){if(!Gr(c))return c;f=Va(f,c);for(var V=-1,re=f.length,_e=re-1,Ae=c;Ae!=null&&++V<re;){var De=hs(f[V]),ct=b;if(De==="__proto__"||De==="constructor"||De==="prototype")return c;if(V!=_e){var ut=Ae[De];ct=z?z(ut,De,Ae):E,ct===E&&(ct=Gr(ut)?ut:Tl(f[V+1])?[]:{})}_c(Ae,De,ct),Ae=Ae[De]}return c}var Gd=hc?function(c,f){return hc.set(c,f),c}:$o,np=la?function(c,f){return la(c,"toString",{configurable:!0,enumerable:!1,value:Of(f),writable:!0})}:$o;function op(c){return iu(Ka(c))}function ls(c,f,b){var z=-1,V=c.length;f<0&&(f=-f>V?0:V+f),b=b>V?V:b,b<0&&(b+=V),V=f>b?0:b-f>>>0,f>>>=0;for(var re=Be(V);++z<V;)re[z]=c[z+f];return re}function sp(c,f){var b;return k(c,function(z,V,re){return b=f(z,V,re),!b}),!!b}function Ou(c,f,b){var z=0,V=c==null?z:c.length;if(typeof f=="number"&&f===f&&V<=mn){for(;z<V;){var re=z+V>>>1,_e=c[re];_e!==null&&!Ir(_e)&&(b?_e<=f:_e<f)?z=re+1:V=re}return V}return Rh(c,f,$o,b)}function Rh(c,f,b,z){var V=0,re=c==null?0:c.length;if(re===0)return 0;f=b(f);for(var _e=f!==f,Ae=f===null,De=Ir(f),ct=f===E;V<re;){var ut=ua((V+re)/2),pt=b(c[ut]),Bt=pt!==E,jt=pt===null,ai=pt===pt,Ai=Ir(pt);if(_e)var li=z||ai;else ct?li=ai&&(z||Bt):Ae?li=ai&&Bt&&(z||!jt):De?li=ai&&Bt&&!jt&&(z||!Ai):jt||Ai?li=!1:li=z?pt<=f:pt<f;li?V=ut+1:re=ut}return Qr(re,_r)}function $d(c,f){for(var b=-1,z=c.length,V=0,re=[];++b<z;){var _e=c[b],Ae=f?f(_e):_e;if(!b||!No(Ae,De)){var De=Ae;re[V++]=_e===0?0:_e}}return re}function qd(c){return typeof c=="number"?c:Ir(c)?pn:+c}function Oo(c){if(typeof c=="string")return c;if(yi(c))return rr(c,Oo)+"";if(Ir(c))return Au?Au.call(c):"";var f=c+"";return f=="0"&&1/c==-Dn?"-0":f}function yl(c,f,b){var z=-1,V=Es,re=c.length,_e=!0,Ae=[],De=Ae;if(b)_e=!1,V=As;else if(re>=B){var ct=f?null:$a(c);if(ct)return Vi(ct);_e=!1,V=oa,De=new fa}else De=f?[]:Ae;e:for(;++z<re;){var ut=c[z],pt=f?f(ut):ut;if(ut=b||ut!==0?ut:0,_e&&pt===pt){for(var Bt=De.length;Bt--;)if(De[Bt]===pt)continue e;f&&De.push(pt),Ae.push(ut)}else V(De,pt,b)||(De!==Ae&&De.push(pt),Ae.push(ut))}return Ae}function Zd(c,f){return f=Va(f,c),c=Yh(c,f),c==null||delete c[hs(Fo(f))]}function ap(c,f,b,z){return ga(c,f,b(he(c,f)),z)}function Ru(c,f,b,z){for(var V=c.length,re=z?V:-1;(z?re--:++re<V)&&f(c[re],re,c););return b?ls(c,z?0:re,z?re+1:V):ls(c,z?re+1:0,z?V:re)}function lp(c,f){var b=c;return b instanceof Ci&&(b=b.value()),Ss(f,function(z,V){return V.func.apply(V.thisArg,ui([z],V.args))},b)}function yc(c,f,b){var z=c.length;if(z<2)return z?yl(c[0]):[];for(var V=-1,re=Be(z);++V<z;)for(var _e=c[V],Ae=-1;++Ae<z;)Ae!=V&&(re[V]=P(re[V]||_e,c[Ae],f,b));return yl(H(re,1),f,b)}function cp(c,f,b){for(var z=-1,V=c.length,re=f.length,_e={};++z<V;){var Ae=z<re?f[z]:E;b(_e,c[z],Ae)}return _e}function Wc(c){return rn(c)?c:[]}function Bh(c){return typeof c=="function"?c:$o}function Va(c,f){return yi(c)?c:eu(c,f)?[c]:Us(or(c))}var Fh=Jt;function fo(c,f,b){var z=c.length;return b=b===E?z:b,!f&&b>=z?c:ls(c,f,b)}var Bu=Oa||function(c){return Jr.clearTimeout(c)};function Wd(c,f){if(f)return c.slice();var b=c.length,z=aa?aa(b):new c.constructor(b);return c.copy(z),z}function Uh(c){var f=new c.constructor(c.byteLength);return new sa(f).set(new sa(c)),f}function l_(c,f){var b=f?Uh(c.buffer):c.buffer;return new c.constructor(b,c.byteOffset,c.byteLength)}function c_(c){var f=new c.constructor(c.source,Vt.exec(c));return f.lastIndex=c.lastIndex,f}function u_(c){return Ua?Di(Ua.call(c)):{}}function Nh(c,f){var b=f?Uh(c.buffer):c.buffer;return new c.constructor(b,c.byteOffset,c.length)}function Xc(c,f){if(c!==f){var b=c!==E,z=c===null,V=c===c,re=Ir(c),_e=f!==E,Ae=f===null,De=f===f,ct=Ir(f);if(!Ae&&!ct&&!re&&c>f||re&&_e&&De&&!Ae&&!ct||z&&_e&&De||!b&&De||!V)return 1;if(!z&&!re&&!ct&&c<f||ct&&b&&V&&!z&&!re||Ae&&b&&V||!_e&&V||!De)return-1}return 0}function Hc(c,f,b){for(var z=-1,V=c.criteria,re=f.criteria,_e=V.length,Ae=b.length;++z<_e;){var De=Xc(V[z],re[z]);if(De){if(z>=Ae)return De;var ct=b[z];return De*(ct=="desc"?-1:1)}}return c.index-f.index}function Ga(c,f,b,z){for(var V=-1,re=c.length,_e=b.length,Ae=-1,De=f.length,ct=jr(re-_e,0),ut=Be(De+ct),pt=!z;++Ae<De;)ut[Ae]=f[Ae];for(;++V<_e;)(pt||V<re)&&(ut[b[V]]=c[V]);for(;ct--;)ut[Ae++]=c[V++];return ut}function Rs(c,f,b,z){for(var V=-1,re=c.length,_e=-1,Ae=b.length,De=-1,ct=f.length,ut=jr(re-Ae,0),pt=Be(ut+ct),Bt=!z;++V<ut;)pt[V]=c[V];for(var jt=V;++De<ct;)pt[jt+De]=f[De];for(;++_e<Ae;)(Bt||V<re)&&(pt[jt+b[_e]]=c[V++]);return pt}function hn(c,f){var b=-1,z=c.length;for(f||(f=Be(z));++b<z;)f[b]=c[b];return f}function Kn(c,f,b,z){var V=!b;b||(b={});for(var re=-1,_e=f.length;++re<_e;){var Ae=f[re],De=z?z(b[Ae],c[Ae],Ae,b,c):E;De===E&&(De=c[Ae]),V?s(b,Ae,De):_c(b,Ae,De)}return b}function vc(c,f){return Kn(c,ef(c),f)}function h_(c,f){return Kn(c,Wh(c),f)}function jh(c,f){return function(b,z){var V=yi(b)?Vl:gc,re=f?f():{};return V(b,c,ri(z,2),re)}}function Kc(c){return Jt(function(f,b){var z=-1,V=b.length,re=V>1?b[V-1]:E,_e=V>2?b[2]:E;for(re=c.length>3&&typeof re=="function"?(V--,re):E,_e&&vo(b[0],b[1],_e)&&(re=V<3?E:re,V=1),f=Di(f);++z<V;){var Ae=b[z];Ae&&c(f,Ae,z,re)}return f})}function up(c,f){return function(b,z){if(b==null)return b;if(!jo(b))return c(b,z);for(var V=b.length,re=f?V:-1,_e=Di(b);(f?re--:++re<V)&&z(_e[re],re,_e)!==!1;);return b}}function Xd(c){return function(f,b,z){for(var V=-1,re=Di(f),_e=z(f),Ae=_e.length;Ae--;){var De=_e[c?Ae:++V];if(b(re[De],De,re)===!1)break}return f}}function Vh(c,f,b){var z=f&Ze,V=Fu(c);function re(){var _e=this&&this!==Jr&&this instanceof re?V:c;return _e.apply(z?b:this,arguments)}return re}function Bs(c){return function(f){f=or(f);var b=Je(f)?Ti(f):E,z=b?b[0]:f.charAt(0),V=b?fo(b,1).join(""):f.slice(1);return z[c]()+V}}function Yc(c){return function(f){return Ss(_u(Pf(f).replace(il,"")),c,"")}}function Fu(c){return function(){var f=arguments;switch(f.length){case 0:return new c;case 1:return new c(f[0]);case 2:return new c(f[0],f[1]);case 3:return new c(f[0],f[1],f[2]);case 4:return new c(f[0],f[1],f[2],f[3]);case 5:return new c(f[0],f[1],f[2],f[3],f[4]);case 6:return new c(f[0],f[1],f[2],f[3],f[4],f[5]);case 7:return new c(f[0],f[1],f[2],f[3],f[4],f[5],f[6])}var b=Na(c.prototype),z=c.apply(b,f);return Gr(z)?z:b}}function en(c,f,b){var z=Fu(c);function V(){for(var re=arguments.length,_e=Be(re),Ae=re,De=Yl(V);Ae--;)_e[Ae]=arguments[Ae];var ct=re<3&&_e[0]!==De&&_e[re-1]!==De?[]:Lt(_e,De);if(re-=ct.length,re<b)return kn(c,f,Jc,V.placeholder,E,_e,ct,E,E,b-re);var ut=this&&this!==Jr&&this instanceof V?z:c;return cn(ut,this,_e)}return V}function Xt(c){return function(f,b,z){var V=Di(f);if(!jo(f)){var re=ri(b,3);f=$n(f),b=function(Ae){return re(V[Ae],Ae,V)}}var _e=c(f,b,z);return _e>-1?V[re?f[_e]:_e]:E}}function vl(c){return bl(function(f){var b=f.length,z=b,V=Sr.prototype.thru;for(c&&f.reverse();z--;){var re=f[z];if(typeof re!="function")throw new un(q);if(V&&!_e&&xc(re)=="wrapper")var _e=new Sr([],!0)}for(z=_e?z:b;++z<b;){re=f[z];var Ae=xc(re),De=Ae=="wrapper"?Qc(re):E;De&&Hh(De[0])&&De[1]==(Pi|Oe|Ye|xt)&&!De[4].length&&De[9]==1?_e=_e[xc(De[0])].apply(_e,De[3]):_e=re.length==1&&Hh(re)?_e[Ae]():_e.thru(re)}return function(){var ct=arguments,ut=ct[0];if(_e&&ct.length==1&&yi(ut))return _e.plant(ut).value();for(var pt=0,Bt=b?f[pt].apply(this,ct):ut;++pt<b;)Bt=f[pt].call(this,Bt);return Bt}})}function Jc(c,f,b,z,V,re,_e,Ae,De,ct){var ut=f&Pi,pt=f&Ze,Bt=f&Ie,jt=f&(Oe|qe),ai=f&bt,Ai=Bt?E:Fu(c);function li(){for(var Ii=arguments.length,Fi=Be(Ii),bo=Ii;bo--;)Fi[bo]=arguments[bo];if(jt)var Br=Yl(li),wo=M(Fi,Br);if(z&&(Fi=Ga(Fi,z,V,jt)),re&&(Fi=Rs(Fi,re,_e,jt)),Ii-=wo,jt&&Ii<ct){var $r=Lt(Fi,Br);return kn(c,f,Jc,li.placeholder,b,Fi,$r,Ae,De,ct-Ii)}var fn=pt?b:this,To=Bt?fn[c]:c;return Ii=Fi.length,Ae?Fi=vp(Fi,Ae):ai&&Ii>1&&Fi.reverse(),ut&&De<Ii&&(Fi.length=De),this&&this!==Jr&&this instanceof li&&(To=Ai||Fu(To)),To.apply(fn,Fi)}return li}function $i(c,f){return function(b,z){return rt(b,c,f(z),{})}}function Uu(c,f){return function(b,z){var V;if(b===E&&z===E)return f;if(b!==E&&(V=b),z!==E){if(V===E)return z;typeof b=="string"||typeof z=="string"?(b=Oo(b),z=Oo(z)):(b=qd(b),z=qd(z)),V=c(b,z)}return V}}function Nu(c){return bl(function(f){return f=rr(f,vn(ri())),Jt(function(b){var z=this;return c(f,function(V){return cn(V,z,b)})})})}function cs(c,f){f=f===E?" ":Oo(f);var b=f.length;if(b<2)return b?_a(f,c):f;var z=_a(f,Ba(c/mi(f)));return Je(f)?fo(Ti(z),0,c).join(""):z.slice(0,c)}function xl(c,f,b,z){var V=f&Ze,re=Fu(c);function _e(){for(var Ae=-1,De=arguments.length,ct=-1,ut=z.length,pt=Be(ut+De),Bt=this&&this!==Jr&&this instanceof _e?re:c;++ct<ut;)pt[ct]=z[ct];for(;De--;)pt[ct++]=arguments[++Ae];return cn(Bt,V?b:this,pt)}return _e}function us(c){return function(f,b,z){return z&&typeof z!="number"&&vo(f,b,z)&&(b=z=E),f=Il(f),b===E?(b=f,f=0):b=Il(b),z=z===E?f<b?1:-1:Il(z),_l(f,b,z,c)}}function yo(c){return function(f,b){return typeof f=="string"&&typeof b=="string"||(f=Vo(f),b=Vo(b)),c(f,b)}}function kn(c,f,b,z,V,re,_e,Ae,De,ct){var ut=f&Oe,pt=ut?_e:E,Bt=ut?E:_e,jt=ut?re:E,ai=ut?E:re;f|=ut?Ye:ci,f&=~(ut?ci:Ye),f&je||(f&=~(Ze|Ie));var Ai=[c,f,V,jt,pt,ai,Bt,Ae,De,ct],li=b.apply(E,Ai);return Hh(c)&&Ac(li,Ai),li.placeholder=z,of(li,c,f)}function Gh(c){var f=fr[c];return function(b,z){if(b=Vo(b),z=z==null?0:Qr(Si(z),292),z&&bh(b)){var V=(or(b)+"e").split("e"),re=f(V[0]+"e"+(+V[1]+z));return V=(or(re)+"e").split("e"),+(V[0]+"e"+(+V[1]-z))}return f(b)}}var $a=ha&&1/Vi(new ha([,-0]))[1]==Dn?function(c){return new ha(c)}:Md;function Hd(c){return function(f){var b=Yn(f);return b==Kt?Pt(f):b==kr?Ar(f):na(f,c(f))}}function Ro(c,f,b,z,V,re,_e,Ae){var De=f&Ie;if(!De&&typeof c!="function")throw new un(q);var ct=z?z.length:0;if(ct||(f&=~(Ye|ci),z=V=E),_e=_e===E?_e:jr(Si(_e),0),Ae=Ae===E?Ae:Si(Ae),ct-=V?V.length:0,f&ci){var ut=z,pt=V;z=V=E}var Bt=De?E:Qc(c),jt=[c,f,b,z,V,ut,pt,re,_e,Ae];if(Bt&&Kh(jt,Bt),c=jt[0],f=jt[1],b=jt[2],z=jt[3],V=jt[4],Ae=jt[9]=jt[9]===E?De?0:c.length:jr(jt[9]-ct,0),!Ae&&f&(Oe|qe)&&(f&=~(Oe|qe)),!f||f==Ze)var ai=Vh(c,f,b);else f==Oe||f==qe?ai=en(c,f,Ae):(f==Ye||f==(Ze|Ye))&&!V.length?ai=xl(c,f,b,z):ai=Jc.apply(E,jt);var Ai=Bt?Gd:Ac;return of(Ai(ai,jt),c,f)}function $h(c,f,b,z){return c===E||No(c,os[b])&&!Bi.call(z,b)?f:c}function Kd(c,f,b,z,V,re){return Gr(c)&&Gr(f)&&(re.set(f,c),Ki(c,f,E,Kd,re),re.delete(f)),c}function Yd(c){return Qu(c)?E:c}function hp(c,f,b,z,V,re){var _e=b&ot,Ae=c.length,De=f.length;if(Ae!=De&&!(_e&&De>Ae))return!1;var ct=re.get(c),ut=re.get(f);if(ct&&ut)return ct==f&&ut==c;var pt=-1,Bt=!0,jt=b&it?new fa:E;for(re.set(c,f),re.set(f,c);++pt<Ae;){var ai=c[pt],Ai=f[pt];if(z)var li=_e?z(Ai,ai,pt,f,c,re):z(ai,Ai,pt,c,f,re);if(li!==E){if(li)continue;Bt=!1;break}if(jt){if(!ra(f,function(Ii,Fi){if(!oa(jt,Fi)&&(ai===Ii||V(ai,Ii,b,z,re)))return jt.push(Fi)})){Bt=!1;break}}else if(!(ai===Ai||V(ai,Ai,b,z,re))){Bt=!1;break}}return re.delete(c),re.delete(f),Bt}function Jd(c,f,b,z,V,re,_e){switch(b){case Fr:if(c.byteLength!=f.byteLength||c.byteOffset!=f.byteOffset)return!1;c=c.buffer,f=f.buffer;case io:return!(c.byteLength!=f.byteLength||!re(new sa(c),new sa(f)));case Pr:case Ln:case Wr:return No(+c,+f);case ms:return c.name==f.name&&c.message==f.message;case Qt:case Er:return c==f+"";case Kt:var Ae=Pt;case kr:var De=z&ot;if(Ae||(Ae=Vi),c.size!=f.size&&!De)return!1;var ct=_e.get(c);if(ct)return ct==f;z|=it,_e.set(c,f);var ut=hp(Ae(c),Ae(f),z,V,re,_e);return _e.delete(c),ut;case On:if(Ua)return Ua.call(c)==Ua.call(f)}return!1}function dp(c,f,b,z,V,re){var _e=b&ot,Ae=ya(c),De=Ae.length,ct=ya(f),ut=ct.length;if(De!=ut&&!_e)return!1;for(var pt=De;pt--;){var Bt=Ae[pt];if(!(_e?Bt in f:Bi.call(f,Bt)))return!1}var jt=re.get(c),ai=re.get(f);if(jt&&ai)return jt==f&&ai==c;var Ai=!0;re.set(c,f),re.set(f,c);for(var li=_e;++pt<De;){Bt=Ae[pt];var Ii=c[Bt],Fi=f[Bt];if(z)var bo=_e?z(Fi,Ii,Bt,f,c,re):z(Ii,Fi,Bt,c,f,re);if(!(bo===E?Ii===Fi||V(Ii,Fi,b,z,re):bo)){Ai=!1;break}li||(li=Bt=="constructor")}if(Ai&&!li){var Br=c.constructor,wo=f.constructor;Br!=wo&&"constructor"in c&&"constructor"in f&&!(typeof Br=="function"&&Br instanceof Br&&typeof wo=="function"&&wo instanceof wo)&&(Ai=!1)}return re.delete(c),re.delete(f),Ai}function bl(c){return ju(yp(c,E,td),c+"")}function ya(c){return ve(c,$n,ef)}function wl(c){return ve(c,Go,Wh)}var Qc=hc?function(c){return hc.get(c)}:Md;function xc(c){for(var f=c.name+"",b=dl[f],z=Bi.call(dl,f)?b.length:0;z--;){var V=b[z],re=V.func;if(re==null||re==c)return V.name}return f}function Yl(c){var f=Bi.call(X,"placeholder")?X:c;return f.placeholder}function ri(){var c=X.iteratee||Sd;return c=c===Sd?Li:c,arguments.length?c(arguments[0],arguments[1]):c}function qh(c,f){var b=c.__data__;return Bo(f)?b[typeof f=="string"?"string":"hash"]:b.map}function Zh(c){for(var f=$n(c),b=f.length;b--;){var z=f[b],V=c[z];f[b]=[z,V,tu(V)]}return f}function bc(c,f){var b=Re(c,f);return Ht(b)?b:E}function Qd(c){var f=Bi.call(c,Or),b=c[Or];try{c[Or]=E;var z=!0}catch{}var V=co.call(c);return z&&(f?c[Or]=b:delete c[Or]),V}var ef=ho?function(c){return c==null?[]:(c=Di(c),pi(ho(c),function(f){return Cn.call(c,f)}))}:Ja,Wh=ho?function(c){for(var f=[];c;)ui(f,ef(c)),c=as(c);return f}:Ja,Yn=fe;(Nc&&Yn(new Nc(new ArrayBuffer(1)))!=Fr||Kl&&Yn(new Kl)!=Kt||jc&&Yn(jc.resolve())!=Xn||ha&&Yn(new ha)!=kr||ks&&Yn(new ks)!=Io)&&(Yn=function(c){var f=fe(c),b=f==Xr?c.constructor:E,z=b?tn(b):"";if(z)switch(z){case Vc:return Fr;case Eh:return Kt;case Eu:return Xn;case zn:return kr;case Vd:return Io}return f});function fp(c,f,b){for(var z=-1,V=b.length;++z<V;){var re=b[z],_e=re.size;switch(re.type){case"drop":c+=_e;break;case"dropRight":f-=_e;break;case"take":f=Qr(f,c+_e);break;case"takeRight":c=jr(c,f-_e);break}}return{start:c,end:f}}function wc(c){var f=c.match(Te);return f?f[1].split(ke):[]}function tf(c,f,b){f=Va(f,c);for(var z=-1,V=f.length,re=!1;++z<V;){var _e=hs(f[z]);if(!(re=c!=null&&b(c,_e)))break;c=c[_e]}return re||++z!=V?re:(V=c==null?0:c.length,!!V&&pd(V)&&Tl(_e,V)&&(yi(c)||Pc(c)))}function d_(c){var f=c.length,b=new c.constructor(f);return f&&typeof c[0]=="string"&&Bi.call(c,"index")&&(b.index=c.index,b.input=c.input),b}function Tc(c){return typeof c.constructor=="function"&&!Za(c)?Na(as(c)):{}}function Xh(c,f,b){var z=c.constructor;switch(f){case io:return Uh(c);case Pr:case Ln:return new z(+c);case Fr:return l_(c,b);case gn:case Xo:case Xs:case An:case Sn:case Ur:case Hr:case Kr:case Dr:return Nh(c,b);case Kt:return new z;case Wr:case Er:return new z(c);case Qt:return c_(c);case kr:return new z;case On:return u_(c)}}function pp(c,f){var b=f.length;if(!b)return c;var z=b-1;return f[z]=(b>1?"& ":"")+f[z],f=f.join(b>2?", ":" "),c.replace(Me,`{
/* [wrapped with `+f+`] */
`)}function mp(c){return yi(c)||Pc(c)||!!(Hl&&c&&c[Hl])}function Tl(c,f){var b=typeof c;return f=f==null?xr:f,!!f&&(b=="number"||b!="symbol"&&Zi.test(c))&&c>-1&&c%1==0&&c<f}function vo(c,f,b){if(!Gr(b))return!1;var z=typeof f;return(z=="number"?jo(b)&&Tl(f,b.length):z=="string"&&f in b)?No(b[f],c):!1}function eu(c,f){if(yi(c))return!1;var b=typeof c;return b=="number"||b=="symbol"||b=="boolean"||c==null||Ir(c)?!0:N.test(c)||!oe.test(c)||f!=null&&c in Di(f)}function Bo(c){var f=typeof c;return f=="string"||f=="number"||f=="symbol"||f=="boolean"?c!=="__proto__":c===null}function Hh(c){var f=xc(c),b=X[f];if(typeof b!="function"||!(f in Ci.prototype))return!1;if(c===b)return!0;var z=Qc(b);return!!z&&c===z[0]}function qa(c){return!!Ps&&Ps in c}var rf=lo?Sl:Ff;function Za(c){var f=c&&c.constructor,b=typeof f=="function"&&f.prototype||os;return c===b}function tu(c){return c===c&&!Gr(c)}function Jl(c,f){return function(b){return b==null?!1:b[c]===f&&(f!==E||c in Di(b))}}function nf(c){var f=hd(c,function(z){return b.size===me&&b.clear(),z}),b=f.cache;return f}function Kh(c,f){var b=c[1],z=f[1],V=b|z,re=V<(Ze|Ie|Pi),_e=z==Pi&&b==Oe||z==Pi&&b==xt&&c[7].length<=f[8]||z==(Pi|xt)&&f[7].length<=f[8]&&b==Oe;if(!(re||_e))return c;z&Ze&&(c[2]=f[2],V|=b&Ze?0:je);var Ae=f[3];if(Ae){var De=c[3];c[3]=De?Ga(De,Ae,f[4]):Ae,c[4]=De?Lt(c[3],Ce):f[4]}return Ae=f[5],Ae&&(De=c[5],c[5]=De?Rs(De,Ae,f[6]):Ae,c[6]=De?Lt(c[5],Ce):f[6]),Ae=f[7],Ae&&(c[7]=Ae),z&Pi&&(c[8]=c[8]==null?f[8]:Qr(c[8],f[8])),c[9]==null&&(c[9]=f[9]),c[0]=f[0],c[1]=V,c}function _p(c){var f=[];if(c!=null)for(var b in Di(c))f.push(b);return f}function gp(c){return co.call(c)}function yp(c,f,b){return f=jr(f===E?c.length-1:f,0),function(){for(var z=arguments,V=-1,re=jr(z.length-f,0),_e=Be(re);++V<re;)_e[V]=z[f+V];V=-1;for(var Ae=Be(f+1);++V<f;)Ae[V]=z[V];return Ae[f]=b(_e),cn(c,this,Ae)}}function Yh(c,f){return f.length<2?c:he(c,ls(f,0,-1))}function vp(c,f){for(var b=c.length,z=Qr(f.length,b),V=hn(c);z--;){var re=f[z];c[z]=Tl(re,b)?V[re]:E}return c}function Ec(c,f){if(!(f==="constructor"&&typeof c[f]=="function")&&f!="__proto__")return c[f]}var Ac=Jh(Gd),Fs=Ra||function(c,f){return Jr.setTimeout(c,f)},ju=Jh(np);function of(c,f,b){var z=f+"";return ju(c,pp(z,Ns(wc(z),b)))}function Jh(c){var f=0,b=0;return function(){var z=uc(),V=ei-(z-b);if(b=z,V>0){if(++f>=Yt)return arguments[0]}else f=0;return c.apply(E,arguments)}}function iu(c,f){var b=-1,z=c.length,V=z-1;for(f=f===E?z:f;++b<f;){var re=ma(b,V),_e=c[re];c[re]=c[b],c[b]=_e}return c.length=f,c}var Us=nf(function(c){var f=[];return c.charCodeAt(0)===46&&f.push(""),c.replace(G,function(b,z,V,re){f.push(V?re.replace(lt,"$1"):z||b)}),f});function hs(c){if(typeof c=="string"||Ir(c))return c;var f=c+"";return f=="0"&&1/c==-Dn?"-0":f}function tn(c){if(c!=null){try{return go.call(c)}catch{}try{return c+""}catch{}}return""}function Ns(c,f){return yn(Ao,function(b){var z="_."+b[0];f&b[1]&&!Es(c,z)&&c.push(z)}),c.sort()}function Qh(c){if(c instanceof Ci)return c.clone();var f=new Sr(c.__wrapped__,c.__chain__);return f.__actions__=hn(c.__actions__),f.__index__=c.__index__,f.__values__=c.__values__,f}function dn(c,f,b){(b?vo(c,f,b):f===E)?f=1:f=jr(Si(f),0);var z=c==null?0:c.length;if(!z||f<1)return[];for(var V=0,re=0,_e=Be(Ba(z/f));V<z;)_e[re++]=ls(c,V,V+=f);return _e}function xp(c){for(var f=-1,b=c==null?0:c.length,z=0,V=[];++f<b;){var re=c[f];re&&(V[z++]=re)}return V}function Vu(){var c=arguments.length;if(!c)return[];for(var f=Be(c-1),b=arguments[0],z=c;z--;)f[z-1]=arguments[z];return ui(yi(b)?hn(b):[b],H(f,1))}var va=Jt(function(c,f){return rn(c)?P(c,H(f,1,rn,!0)):[]}),f_=Jt(function(c,f){var b=Fo(f);return rn(b)&&(b=E),rn(c)?P(c,H(f,1,rn,!0),ri(b,2)):[]}),p_=Jt(function(c,f){var b=Fo(f);return rn(b)&&(b=E),rn(c)?P(c,H(f,1,rn,!0),E,b):[]});function bp(c,f,b){var z=c==null?0:c.length;return z?(f=b||f===E?1:Si(f),ls(c,f<0?0:f,z)):[]}function Sc(c,f,b){var z=c==null?0:c.length;return z?(f=b||f===E?1:Si(f),f=z-f,ls(c,0,f<0?0:f)):[]}function wp(c,f){return c&&c.length?Ru(c,ri(f,3),!0,!0):[]}function Tp(c,f){return c&&c.length?Ru(c,ri(f,3),!0):[]}function Ep(c,f,b,z){var V=c==null?0:c.length;return V?(b&&typeof b!="number"&&vo(c,f,b)&&(b=0,z=V),ee(c,f,b,z)):[]}function sf(c,f,b){var z=c==null?0:c.length;if(!z)return-1;var V=b==null?0:Si(b);return V<0&&(V=jr(z+V,0)),sl(c,ri(f,3),V)}function ed(c,f,b){var z=c==null?0:c.length;if(!z)return-1;var V=z-1;return b!==E&&(V=Si(b),V=b<0?jr(z+V,0):Qr(V,z-1)),sl(c,ri(f,3),V,!0)}function td(c){var f=c==null?0:c.length;return f?H(c,1):[]}function af(c){var f=c==null?0:c.length;return f?H(c,Dn):[]}function xo(c,f){var b=c==null?0:c.length;return b?(f=f===E?1:Si(f),H(c,f)):[]}function Ap(c){for(var f=-1,b=c==null?0:c.length,z={};++f<b;){var V=c[f];z[V[0]]=V[1]}return z}function Sp(c){return c&&c.length?c[0]:E}function Ip(c,f,b){var z=c==null?0:c.length;if(!z)return-1;var V=b==null?0:Si(b);return V<0&&(V=jr(z+V,0)),Ms(c,f,V)}function m_(c){var f=c==null?0:c.length;return f?ls(c,0,-1):[]}var __=Jt(function(c){var f=rr(c,Wc);return f.length&&f[0]===c[0]?He(f):[]}),Mp=Jt(function(c){var f=Fo(c),b=rr(c,Wc);return f===Fo(b)?f=E:b.pop(),b.length&&b[0]===c[0]?He(b,ri(f,2)):[]}),Cp=Jt(function(c){var f=Fo(c),b=rr(c,Wc);return f=typeof f=="function"?f:E,f&&b.pop(),b.length&&b[0]===c[0]?He(b,E,f):[]});function Pp(c,f){return c==null?"":wh.call(c,f)}function Fo(c){var f=c==null?0:c.length;return f?c[f-1]:E}function El(c,f,b){var z=c==null?0:c.length;if(!z)return-1;var V=z;return b!==E&&(V=Si(b),V=V<0?jr(z+V,0):Qr(V,z-1)),f===f?Hi(c,f,V):sl(c,al,V,!0)}function Uo(c,f){return c&&c.length?gi(c,Si(f)):E}var g_=Jt(id);function id(c,f){return c&&c.length&&f&&f.length?pa(c,f):c}function y_(c,f,b){return c&&c.length&&f&&f.length?pa(c,f,ri(b,2)):c}function v_(c,f,b){return c&&c.length&&f&&f.length?pa(c,f,E,b):c}var x_=bl(function(c,f){var b=c==null?0:c.length,z=h(c,f);return Vn(c,rr(f,function(V){return Tl(V,b)?+V:V}).sort(Xc)),z});function rd(c,f){var b=[];if(!(c&&c.length))return b;var z=-1,V=[],re=c.length;for(f=ri(f,3);++z<re;){var _e=c[z];f(_e,z,c)&&(b.push(_e),V.push(z))}return Vn(c,V),b}function lf(c){return c==null?c:Th.call(c)}function nd(c,f,b){var z=c==null?0:c.length;return z?(b&&typeof b!="number"&&vo(c,f,b)?(f=0,b=z):(f=f==null?0:Si(f),b=b===E?z:Si(b)),ls(c,f,b)):[]}function zp(c,f){return Ou(c,f)}function Ic(c,f,b){return Rh(c,f,ri(b,2))}function Gu(c,f){var b=c==null?0:c.length;if(b){var z=Ou(c,f);if(z<b&&No(c[z],f))return z}return-1}function b_(c,f){return Ou(c,f,!0)}function w_(c,f,b){return Rh(c,f,ri(b,2),!0)}function T_(c,f){var b=c==null?0:c.length;if(b){var z=Ou(c,f,!0)-1;if(No(c[z],f))return z}return-1}function E_(c){return c&&c.length?$d(c):[]}function A_(c,f){return c&&c.length?$d(c,ri(f,2)):[]}function S_(c){var f=c==null?0:c.length;return f?ls(c,1,f):[]}function I_(c,f,b){return c&&c.length?(f=b||f===E?1:Si(f),ls(c,0,f<0?0:f)):[]}function cf(c,f,b){var z=c==null?0:c.length;return z?(f=b||f===E?1:Si(f),f=z-f,ls(c,f<0?0:f,z)):[]}function M_(c,f){return c&&c.length?Ru(c,ri(f,3),!1,!0):[]}function ru(c,f){return c&&c.length?Ru(c,ri(f,3)):[]}var C_=Jt(function(c){return yl(H(c,1,rn,!0))}),Vr=Jt(function(c){var f=Fo(c);return rn(f)&&(f=E),yl(H(c,1,rn,!0),ri(f,2))}),od=Jt(function(c){var f=Fo(c);return f=typeof f=="function"?f:E,yl(H(c,1,rn,!0),E,f)});function kp(c){return c&&c.length?yl(c):[]}function sd(c,f){return c&&c.length?yl(c,ri(f,2)):[]}function ad(c,f){return f=typeof f=="function"?f:E,c&&c.length?yl(c,E,f):[]}function Mc(c){if(!(c&&c.length))return[];var f=0;return c=pi(c,function(b){if(rn(b))return f=jr(b.length,f),!0}),ns(f,function(b){return rr(c,Pa(b))})}function uf(c,f){if(!(c&&c.length))return[];var b=Mc(c);return f==null?b:rr(b,function(z){return cn(f,E,z)})}var Dp=Jt(function(c,f){return rn(c)?P(c,f):[]}),$u=Jt(function(c){return yc(pi(c,rn))}),hf=Jt(function(c){var f=Fo(c);return rn(f)&&(f=E),yc(pi(c,rn),ri(f,2))}),df=Jt(function(c){var f=Fo(c);return f=typeof f=="function"?f:E,yc(pi(c,rn),E,f)}),P_=Jt(Mc);function Lp(c,f){return cp(c||[],f||[],_c)}function qu(c,f){return cp(c||[],f||[],ga)}var z_=Jt(function(c){var f=c.length,b=f>1?c[f-1]:E;return b=typeof b=="function"?(c.pop(),b):E,uf(c,b)});function ld(c){var f=X(c);return f.__chain__=!0,f}function k_(c,f){return f(c),c}function nu(c,f){return f(c)}var ff=bl(function(c){var f=c.length,b=f?c[0]:0,z=this.__wrapped__,V=function(re){return h(re,c)};return f>1||this.__actions__.length||!(z instanceof Ci)||!Tl(b)?this.thru(V):(z=z.slice(b,+b+(f?1:0)),z.__actions__.push({func:nu,args:[V],thisArg:E}),new Sr(z,this.__chain__).thru(function(re){return f&&!re.length&&re.push(E),re}))});function cd(){return ld(this)}function D_(){return new Sr(this.value(),this.__chain__)}function L_(){this.__values__===E&&(this.__values__=Ef(this.value()));var c=this.__index__>=this.__values__.length,f=c?E:this.__values__[this.__index__++];return{done:c,value:f}}function O_(){return this}function R_(c){for(var f,b=this;b instanceof da;){var z=Qh(b);z.__index__=0,z.__values__=E,f?V.__wrapped__=z:f=z;var V=z;b=b.__wrapped__}return V.__wrapped__=c,f}function B_(){var c=this.__wrapped__;if(c instanceof Ci){var f=c;return this.__actions__.length&&(f=new Ci(this)),f=f.reverse(),f.__actions__.push({func:nu,args:[lf],thisArg:E}),new Sr(f,this.__chain__)}return this.thru(lf)}function F_(){return lp(this.__wrapped__,this.__actions__)}var Op=jh(function(c,f,b){Bi.call(c,b)?++c[b]:s(c,b,1)});function ou(c,f,b){var z=yi(c)?is:Z;return b&&vo(c,f,b)&&(f=E),z(c,ri(f,3))}function U_(c,f){var b=yi(c)?pi:J;return b(c,ri(f,3))}var N_=Xt(sf),Rp=Xt(ed);function Bp(c,f){return H(Hu(c,f),1)}function j_(c,f){return H(Hu(c,f),Dn)}function V_(c,f,b){return b=b===E?1:Si(b),H(Hu(c,f),b)}function Ql(c,f){var b=yi(c)?yn:k;return b(c,ri(f,3))}function Zu(c,f){var b=yi(c)?Gl:j;return b(c,ri(f,3))}var G_=jh(function(c,f,b){Bi.call(c,b)?c[b].push(f):s(c,b,[f])});function $_(c,f,b,z){c=jo(c)?c:Ka(c),b=b&&!z?Si(b):0;var V=c.length;return b<0&&(b=jr(V+b,0)),eh(c)?b<=V&&c.indexOf(f,b)>-1:!!V&&Ms(c,f,b)>-1}var Wu=Jt(function(c,f,b){var z=-1,V=typeof f=="function",re=jo(c)?Be(c.length):[];return k(c,function(_e){re[++z]=V?cn(f,_e,b):gt(_e,f,b)}),re}),Xu=jh(function(c,f,b){s(c,b,f)});function Hu(c,f){var b=yi(c)?rr:xn;return b(c,ri(f,3))}function Ku(c,f,b,z){return c==null?[]:(yi(f)||(f=f==null?[]:[f]),b=z?E:b,yi(b)||(b=b==null?[]:[b]),Rr(c,f,b))}var Fp=jh(function(c,f,b){c[b?0:1].push(f)},function(){return[[],[]]});function q_(c,f,b){var z=yi(c)?Ss:Xl,V=arguments.length<3;return z(c,ri(f,4),b,V,k)}function Up(c,f,b){var z=yi(c)?ol:Xl,V=arguments.length<3;return z(c,ri(f,4),b,V,j)}function Np(c,f){var b=yi(c)?pi:J;return b(c,dd(ri(f,3)))}function jp(c){var f=yi(c)?qc:gl;return f(c)}function Vp(c,f,b){(b?vo(c,f,b):f===E)?f=1:f=Si(f);var z=yi(c)?Du:ja;return z(c,f)}function Gp(c){var f=yi(c)?Zc:op;return f(c)}function $p(c){if(c==null)return 0;if(jo(c))return eh(c)?mi(c):c.length;var f=Yn(c);return f==Kt||f==kr?c.size:Qi(c).length}function Z_(c,f,b){var z=yi(c)?ra:sp;return b&&vo(c,f,b)&&(f=E),z(c,ri(f,3))}var W_=Jt(function(c,f){if(c==null)return[];var b=f.length;return b>1&&vo(c,f[0],f[1])?f=[]:b>2&&vo(f[0],f[1],f[2])&&(f=[f[0]]),Rr(c,H(f,1),[])}),Yu=ca||function(){return Jr.Date.now()};function ud(c,f){if(typeof f!="function")throw new un(q);return c=Si(c),function(){if(--c<1)return f.apply(this,arguments)}}function pf(c,f,b){return f=b?E:f,f=c&&f==null?c.length:f,Ro(c,Pi,E,E,E,E,f)}function Jn(c,f){var b;if(typeof f!="function")throw new un(q);return c=Si(c),function(){return--c>0&&(b=f.apply(this,arguments)),c<=1&&(f=E),b}}var Cc=Jt(function(c,f,b){var z=Ze;if(b.length){var V=Lt(b,Yl(Cc));z|=Ye}return Ro(c,z,f,b,V)}),su=Jt(function(c,f,b){var z=Ze|Ie;if(b.length){var V=Lt(b,Yl(su));z|=Ye}return Ro(f,z,c,b,V)});function mf(c,f,b){f=b?E:f;var z=Ro(c,Oe,E,E,E,E,E,f);return z.placeholder=mf.placeholder,z}function Ju(c,f,b){f=b?E:f;var z=Ro(c,qe,E,E,E,E,E,f);return z.placeholder=Ju.placeholder,z}function _f(c,f,b){var z,V,re,_e,Ae,De,ct=0,ut=!1,pt=!1,Bt=!0;if(typeof c!="function")throw new un(q);f=Vo(f)||0,Gr(b)&&(ut=!!b.leading,pt="maxWait"in b,re=pt?jr(Vo(b.maxWait)||0,f):re,Bt="trailing"in b?!!b.trailing:Bt);function jt($r){var fn=z,To=V;return z=V=E,ct=$r,_e=c.apply(To,fn),_e}function ai($r){return ct=$r,Ae=Fs(Ii,f),ut?jt($r):_e}function Ai($r){var fn=$r-De,To=$r-ct,Vf=f-fn;return pt?Qr(Vf,re-To):Vf}function li($r){var fn=$r-De,To=$r-ct;return De===E||fn>=f||fn<0||pt&&To>=re}function Ii(){var $r=Yu();if(li($r))return Fi($r);Ae=Fs(Ii,Ai($r))}function Fi($r){return Ae=E,Bt&&z?jt($r):(z=V=E,_e)}function bo(){Ae!==E&&Bu(Ae),ct=0,z=De=V=Ae=E}function Br(){return Ae===E?_e:Fi(Yu())}function wo(){var $r=Yu(),fn=li($r);if(z=arguments,V=this,De=$r,fn){if(Ae===E)return ai(De);if(pt)return Bu(Ae),Ae=Fs(Ii,f),jt(De)}return Ae===E&&(Ae=Fs(Ii,f)),_e}return wo.cancel=bo,wo.flush=Br,wo}var X_=Jt(function(c,f){return A(c,1,f)}),H_=Jt(function(c,f,b){return A(c,Vo(f)||0,b)});function K_(c){return Ro(c,bt)}function hd(c,f){if(typeof c!="function"||f!=null&&typeof f!="function")throw new un(q);var b=function(){var z=arguments,V=f?f.apply(this,z):z[0],re=b.cache;if(re.has(V))return re.get(V);var _e=c.apply(this,z);return b.cache=re.set(V,_e)||re,_e};return b.cache=new(hd.Cache||Ls),b}hd.Cache=Ls;function dd(c){if(typeof c!="function")throw new un(q);return function(){var f=arguments;switch(f.length){case 0:return!c.call(this);case 1:return!c.call(this,f[0]);case 2:return!c.call(this,f[0],f[1]);case 3:return!c.call(this,f[0],f[1],f[2])}return!c.apply(this,f)}}function Y_(c){return Jn(2,c)}var fd=Fh(function(c,f){f=f.length==1&&yi(f[0])?rr(f[0],vn(ri())):rr(H(f,1),vn(ri()));var b=f.length;return Jt(function(z){for(var V=-1,re=Qr(z.length,b);++V<re;)z[V]=f[V].call(this,z[V]);return cn(c,this,z)})}),gf=Jt(function(c,f){var b=Lt(f,Yl(gf));return Ro(c,Ye,E,f,b)}),yf=Jt(function(c,f){var b=Lt(f,Yl(yf));return Ro(c,ci,E,f,b)}),qp=bl(function(c,f){return Ro(c,xt,E,E,E,f)});function Zp(c,f){if(typeof c!="function")throw new un(q);return f=f===E?f:Si(f),Jt(c,f)}function J_(c,f){if(typeof c!="function")throw new un(q);return f=f==null?0:jr(Si(f),0),Jt(function(b){var z=b[f],V=fo(b,0,f);return z&&ui(V,z),cn(c,this,V)})}function Q_(c,f,b){var z=!0,V=!0;if(typeof c!="function")throw new un(q);return Gr(b)&&(z="leading"in b?!!b.leading:z,V="trailing"in b?!!b.trailing:V),_f(c,f,{leading:z,maxWait:f,trailing:V})}function eg(c){return pf(c,1)}function tg(c,f){return gf(Bh(f),c)}function ig(){if(!arguments.length)return[];var c=arguments[0];return yi(c)?c:[c]}function Wp(c){return _(c,We)}function rg(c,f){return f=typeof f=="function"?f:E,_(c,We,f)}function Gn(c){return _(c,ce|We)}function Wa(c,f){return f=typeof f=="function"?f:E,_(c,ce|We,f)}function vf(c,f){return f==null||w(c,f,$n(f))}function No(c,f){return c===f||c!==c&&f!==f}var au=yo(Ee),ng=yo(function(c,f){return c>=f}),Pc=Ve(function(){return arguments}())?Ve:function(c){return nn(c)&&Bi.call(c,"callee")&&!Cn.call(c,"callee")},yi=Be.isArray,og=Nl?vn(Nl):dt;function jo(c){return c!=null&&pd(c.length)&&!Sl(c)}function rn(c){return nn(c)&&jo(c)}function Xp(c){return c===!0||c===!1||nn(c)&&fe(c)==Pr}var js=jd||Ff,er=jl?vn(jl):Qe;function xf(c){return nn(c)&&c.nodeType===1&&!Qu(c)}function Hp(c){if(c==null)return!0;if(jo(c)&&(yi(c)||typeof c=="string"||typeof c.splice=="function"||js(c)||Xa(c)||Pc(c)))return!c.length;var f=Yn(c);if(f==Kt||f==kr)return!c.size;if(Za(c))return!Qi(c).length;for(var b in c)if(Bi.call(c,b))return!1;return!0}function Kp(c,f){return Tt(c,f)}function Al(c,f,b){b=typeof b=="function"?b:E;var z=b?b(c,f):E;return z===E?Tt(c,f,E,b):!!z}function ec(c){if(!nn(c))return!1;var f=fe(c);return f==ms||f==zr||typeof c.message=="string"&&typeof c.name=="string"&&!Qu(c)}function Yp(c){return typeof c=="number"&&bh(c)}function Sl(c){if(!Gr(c))return!1;var f=fe(c);return f==_n||f==_o||f==So||f==En}function Jp(c){return typeof c=="number"&&c==Si(c)}function pd(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=xr}function Gr(c){var f=typeof c;return c!=null&&(f=="object"||f=="function")}function nn(c){return c!=null&&typeof c=="object"}var Qp=ta?vn(ta):Ot;function sg(c,f){return c===f||Nt(c,f,Zh(f))}function ag(c,f,b){return b=typeof b=="function"?b:E,Nt(c,f,Zh(f),b)}function lg(c){return tm(c)&&c!=+c}function md(c){if(rf(c))throw new Gt(U);return Ht(c)}function lu(c){return c===null}function em(c){return c==null}function tm(c){return typeof c=="number"||nn(c)&&fe(c)==Wr}function Qu(c){if(!nn(c)||fe(c)!=Xr)return!1;var f=as(c);if(f===null)return!0;var b=Bi.call(f,"constructor")&&f.constructor;return typeof b=="function"&&b instanceof b&&go.call(b)==ss}var bf=ia?vn(ia):Ei;function wf(c){return Jp(c)&&c>=-xr&&c<=xr}var _d=ts?vn(ts):Rt;function eh(c){return typeof c=="string"||!yi(c)&&nn(c)&&fe(c)==Er}function Ir(c){return typeof c=="symbol"||nn(c)&&fe(c)==On}var Xa=zo?vn(zo):ii;function cu(c){return c===E}function Tf(c){return nn(c)&&Yn(c)==Io}function gd(c){return nn(c)&&fe(c)==Ws}var cg=yo(qi),im=yo(function(c,f){return c<=f});function Ef(c){if(!c)return[];if(jo(c))return eh(c)?Ti(c):hn(c);if(Pn&&c[Pn])return _t(c[Pn]());var f=Yn(c),b=f==Kt?Pt:f==kr?Vi:Ka;return b(c)}function Il(c){if(!c)return c===0?c:0;if(c=Vo(c),c===Dn||c===-Dn){var f=c<0?-1:1;return f*ps}return c===c?c:0}function Si(c){var f=Il(c),b=f%1;return f===f?b?f-b:f:0}function Af(c){return c?m(Si(c),0,Tn):0}function Vo(c){if(typeof c=="number")return c;if(Ir(c))return pn;if(Gr(c)){var f=typeof c.valueOf=="function"?c.valueOf():c;c=Gr(f)?f+"":f}if(typeof c!="string")return c===0?c:+c;c=za(c);var b=Wt.test(c);return b||ji.test(c)?es(c.slice(2),b?2:8):Ut.test(c)?pn:+c}function yd(c){return Kn(c,Go(c))}function rm(c){return c?m(Si(c),-xr,xr):c===0?c:0}function or(c){return c==null?"":Oo(c)}var nm=Kc(function(c,f){if(Za(f)||jo(f)){Kn(f,$n(f),c);return}for(var b in f)Bi.call(f,b)&&_c(c,b,f[b])}),Ha=Kc(function(c,f){Kn(f,Go(f),c)}),th=Kc(function(c,f,b,z){Kn(f,Go(f),c,z)}),om=Kc(function(c,f,b,z){Kn(f,$n(f),c,z)}),sm=bl(h);function am(c,f){var b=Na(c);return f==null?b:l(b,f)}var ug=Jt(function(c,f){c=Di(c);var b=-1,z=f.length,V=z>2?f[2]:E;for(V&&vo(f[0],f[1],V)&&(z=1);++b<z;)for(var re=f[b],_e=Go(re),Ae=-1,De=_e.length;++Ae<De;){var ct=_e[Ae],ut=c[ct];(ut===E||No(ut,os[ct])&&!Bi.call(c,ct))&&(c[ct]=re[ct])}return c}),hg=Jt(function(c){return c.push(E,Kd),cn(pm,E,c)});function lm(c,f){return Ca(c,ri(f,3),ie)}function cm(c,f){return Ca(c,ri(f,3),xe)}function ih(c,f){return c==null?c:K(c,ri(f,3),Go)}function um(c,f){return c==null?c:se(c,ri(f,3),Go)}function hm(c,f){return c&&ie(c,ri(f,3))}function Sf(c,f){return c&&xe(c,ri(f,3))}function uu(c){return c==null?[]:ye(c,$n(c))}function dm(c){return c==null?[]:ye(c,Go(c))}function hu(c,f,b){var z=c==null?E:he(c,f);return z===E?b:z}function fm(c,f){return c!=null&&tf(c,f,Le)}function du(c,f){return c!=null&&tf(c,f,ht)}var vd=$i(function(c,f,b){f!=null&&typeof f.toString!="function"&&(f=co.call(f)),c[f]=b},Of($o)),dg=$i(function(c,f,b){f!=null&&typeof f.toString!="function"&&(f=co.call(f)),Bi.call(c,f)?c[f].push(b):c[f]=[b]},ri),fg=Jt(gt);function $n(c){return jo(c)?ku(c):Qi(c)}function Go(c){return jo(c)?ku(c,!0):br(c)}function pg(c,f){var b={};return f=ri(f,3),ie(c,function(z,V,re){s(b,f(z,V,re),z)}),b}function fu(c,f){var b={};return f=ri(f,3),ie(c,function(z,V,re){s(b,V,f(z,V,re))}),b}var If=Kc(function(c,f,b){Ki(c,f,b)}),pm=Kc(function(c,f,b,z){Ki(c,f,b,z)}),mm=bl(function(c,f){var b={};if(c==null)return b;var z=!1;f=rr(f,function(re){return re=Va(re,c),z||(z=re.length>1),re}),Kn(c,wl(c),b),z&&(b=_(b,ce|Ue|We,Yd));for(var V=f.length;V--;)Zd(b,f[V]);return b});function mg(c,f){return _m(c,dd(ri(f)))}var Mf=bl(function(c,f){return c==null?{}:Nn(c,f)});function _m(c,f){if(c==null)return{};var b=rr(wl(c),function(z){return[z]});return f=ri(f),Yi(c,b,function(z,V){return f(z,V[0])})}function tc(c,f,b){f=Va(f,c);var z=-1,V=f.length;for(V||(V=1,c=E);++z<V;){var re=c==null?E:c[hs(f[z])];re===E&&(z=V,re=b),c=Sl(re)?re.call(c):re}return c}function gm(c,f,b){return c==null?c:ga(c,f,b)}function ym(c,f,b,z){return z=typeof z=="function"?z:E,c==null?c:ga(c,f,b,z)}var rh=Hd($n),xd=Hd(Go);function _g(c,f,b){var z=yi(c),V=z||js(c)||Xa(c);if(f=ri(f,4),b==null){var re=c&&c.constructor;V?b=z?new re:[]:Gr(c)?b=Sl(re)?Na(as(c)):{}:b={}}return(V?yn:ie)(c,function(_e,Ae,De){return f(b,_e,Ae,De)}),b}function gg(c,f){return c==null?!0:Zd(c,f)}function vm(c,f,b){return c==null?c:ap(c,f,Bh(b))}function xm(c,f,b,z){return z=typeof z=="function"?z:E,c==null?c:ap(c,f,Bh(b),z)}function Ka(c){return c==null?[]:Hn(c,$n(c))}function Ml(c){return c==null?[]:Hn(c,Go(c))}function Cf(c,f,b){return b===E&&(b=f,f=E),b!==E&&(b=Vo(b),b=b===b?b:0),f!==E&&(f=Vo(f),f=f===f?f:0),m(Vo(c),f,b)}function pu(c,f,b){return f=Il(f),b===E?(b=f,f=0):b=Il(b),c=Vo(c),Pe(c,f,b)}function xa(c,f,b){if(b&&typeof b!="boolean"&&vo(c,f,b)&&(f=b=E),b===E&&(typeof f=="boolean"?(b=f,f=E):typeof c=="boolean"&&(b=c,c=E)),c===E&&f===E?(c=0,f=1):(c=Il(c),f===E?(f=c,c=0):f=Il(f)),c>f){var z=c;c=f,f=z}if(b||c%1||f%1){var V=hl();return Qr(c+V*(f-c+Rc("1e-"+((V+"").length-1))),f)}return ma(c,f)}var ba=Yc(function(c,f,b){return f=f.toLowerCase(),c+(b?bm(f):f)});function bm(c){return Lf(or(c).toLowerCase())}function Pf(c){return c=or(c),c&&c.replace(xi,D).replace(Ol,"")}function yg(c,f,b){c=or(c),f=Oo(f);var z=c.length;b=b===E?z:m(Si(b),0,z);var V=b;return b-=f.length,b>=0&&c.slice(b,V)==f}function zf(c){return c=or(c),c&&Co.test(c)?c.replace(Ko,R):c}function Ya(c){return c=or(c),c&&ue.test(c)?c.replace(ne,"\\$&"):c}var wm=Yc(function(c,f,b){return c+(b?"-":"")+f.toLowerCase()}),Tm=Yc(function(c,f,b){return c+(b?" ":"")+f.toLowerCase()}),vg=Bs("toLowerCase");function bd(c,f,b){c=or(c),f=Si(f);var z=f?mi(c):0;if(!f||z>=f)return c;var V=(f-z)/2;return cs(ua(V),b)+c+cs(Ba(V),b)}function kf(c,f,b){c=or(c),f=Si(f);var z=f?mi(c):0;return f&&z<f?c+cs(f-z,b):c}function mu(c,f,b){c=or(c),f=Si(f);var z=f?mi(c):0;return f&&z<f?cs(f-z,b)+c:c}function wd(c,f,b){return b||f==null?f=0:f&&(f=+f),Un(or(c).replace(be,""),f||0)}function nh(c,f,b){return(b?vo(c,f,b):f===E)?f=1:f=Si(f),_a(or(c),f)}function Td(){var c=arguments,f=or(c[0]);return c.length<3?f:f.replace(c[1],c[2])}var Em=Yc(function(c,f,b){return c+(b?"_":"")+f.toLowerCase()});function oh(c,f,b){return b&&typeof b!="number"&&vo(c,f,b)&&(f=b=E),b=b===E?Tn:b>>>0,b?(c=or(c),c&&(typeof f=="string"||f!=null&&!bf(f))&&(f=Oo(f),!f&&Je(c))?fo(Ti(c),0,b):c.split(f,b)):[]}var Df=Yc(function(c,f,b){return c+(b?" ":"")+Lf(f)});function Am(c,f,b){return c=or(c),b=b==null?0:m(Si(b),0,c.length),f=Oo(f),c.slice(b,b+f.length)==f}function sh(c,f,b){var z=X.templateSettings;b&&vo(c,f,b)&&(f=E),c=or(c),f=th({},f,z,$h);var V=th({},f.imports,z.imports,$h),re=$n(V),_e=Hn(V,re),Ae,De,ct=0,ut=f.interpolate||Ft,pt="__p += '",Bt=Lr((f.escape||Ft).source+"|"+ut.source+"|"+(ut===Ks?$t:Ft).source+"|"+(f.evaluate||Ft).source+"|$","g"),jt="//# sourceURL="+(Bi.call(f,"sourceURL")?(f.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++bs+"]")+`
`;c.replace(Bt,function(li,Ii,Fi,bo,Br,wo){return Fi||(Fi=bo),pt+=c.slice(ct,wo).replace($e,W),Ii&&(Ae=!0,pt+=`' +
__e(`+Ii+`) +
'`),Br&&(De=!0,pt+=`';
`+Br+`;
__p += '`),Fi&&(pt+=`' +
((__t = (`+Fi+`)) == null ? '' : __t) +
'`),ct=wo+li.length,li}),pt+=`';
`;var ai=Bi.call(f,"variable")&&f.variable;if(!ai)pt=`with (obj) {
`+pt+`
}
`;else if(Mt.test(ai))throw new Gt(o);pt=(De?pt.replace(Hs,""):pt).replace(_s,"$1").replace(Ho,"$1;"),pt="function("+(ai||"obj")+`) {
`+(ai?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ae?", __e = _.escape":"")+(De?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+pt+`return __p
}`;var Ai=gu(function(){return si(re,jt+"return "+pt).apply(E,_e)});if(Ai.source=pt,ec(Ai))throw Ai;return Ai}function Sm(c){return or(c).toLowerCase()}function Im(c){return or(c).toUpperCase()}function xg(c,f,b){if(c=or(c),c&&(b||f===E))return za(c);if(!c||!(f=Oo(f)))return c;var z=Ti(c),V=Ti(f),re=cl(z,V),_e=ul(z,V)+1;return fo(z,re,_e).join("")}function bg(c,f,b){if(c=or(c),c&&(b||f===E))return c.slice(0,hr(c)+1);if(!c||!(f=Oo(f)))return c;var z=Ti(c),V=ul(z,Ti(f))+1;return fo(z,0,V).join("")}function Mm(c,f,b){if(c=or(c),c&&(b||f===E))return c.replace(be,"");if(!c||!(f=Oo(f)))return c;var z=Ti(c),V=cl(z,Ti(f));return fo(z,V).join("")}function zc(c,f){var b=At,z=vt;if(Gr(f)){var V="separator"in f?f.separator:V;b="length"in f?Si(f.length):b,z="omission"in f?Oo(f.omission):z}c=or(c);var re=c.length;if(Je(c)){var _e=Ti(c);re=_e.length}if(b>=re)return c;var Ae=b-mi(z);if(Ae<1)return z;var De=_e?fo(_e,0,Ae).join(""):c.slice(0,Ae);if(V===E)return De+z;if(_e&&(Ae+=De.length-Ae),bf(V)){if(c.slice(Ae).search(V)){var ct,ut=De;for(V.global||(V=Lr(V.source,or(Vt.exec(V))+"g")),V.lastIndex=0;ct=V.exec(ut);)var pt=ct.index;De=De.slice(0,pt===E?Ae:pt)}}else if(c.indexOf(Oo(V),Ae)!=Ae){var Bt=De.lastIndexOf(V);Bt>-1&&(De=De.slice(0,Bt))}return De+z}function wg(c){return c=or(c),c&&Mo.test(c)?c.replace(gs,yr):c}var ic=Yc(function(c,f,b){return c+(b?" ":"")+f.toUpperCase()}),Lf=Bs("toUpperCase");function _u(c,f,b){return c=or(c),f=b?E:f,f===E?yt(c)?dr(c):Is(c):c.match(f)||[]}var gu=Jt(function(c,f){try{return cn(c,E,f)}catch(b){return ec(b)?b:new Gt(b)}}),ah=bl(function(c,f){return yn(f,function(b){b=hs(b),s(c,b,Cc(c[b],c))}),c});function lh(c){var f=c==null?0:c.length,b=ri();return c=f?rr(c,function(z){if(typeof z[1]!="function")throw new un(q);return[b(z[0]),z[1]]}):[],Jt(function(z){for(var V=-1;++V<f;){var re=c[V];if(cn(re[0],this,z))return cn(re[1],this,z)}})}function Ed(c){return x(_(c,ce))}function Of(c){return function(){return c}}function Tg(c,f){return c==null||c!==c?f:c}var yu=vl(),Ad=vl(!0);function $o(c){return c}function Sd(c){return Li(typeof c=="function"?c:_(c,ce))}function Cm(c){return Lo(_(c,ce))}function Eg(c,f){return Os(c,_(f,ce))}var Pm=Jt(function(c,f){return function(b){return gt(b,c,f)}}),Ag=Jt(function(c,f){return function(b){return gt(c,b,f)}});function Id(c,f,b){var z=$n(f),V=ye(f,z);b==null&&!(Gr(f)&&(V.length||!z.length))&&(b=f,f=c,c=this,V=ye(f,$n(f)));var re=!(Gr(b)&&"chain"in b)||!!b.chain,_e=Sl(c);return yn(V,function(Ae){var De=f[Ae];c[Ae]=De,_e&&(c.prototype[Ae]=function(){var ct=this.__chain__;if(re||ct){var ut=c(this.__wrapped__),pt=ut.__actions__=hn(this.__actions__);return pt.push({func:De,args:arguments,thisArg:c}),ut.__chain__=ct,ut}return De.apply(c,ui([this.value()],arguments))})}),c}function Sg(){return Jr._===this&&(Jr._=ka),this}function Md(){}function Ig(c){return c=Si(c),Jt(function(f){return gi(f,c)})}var Mg=Nu(rr),Cd=Nu(is),Pd=Nu(ra);function ch(c){return eu(c)?Pa(hs(c)):jn(c)}function Cg(c){return function(f){return c==null?E:he(c,f)}}var Rf=us(),Bf=us(!0);function Ja(){return[]}function Ff(){return!1}function Uf(){return{}}function zm(){return""}function zd(){return!0}function Pg(c,f){if(c=Si(c),c<1||c>xr)return[];var b=Tn,z=Qr(c,Tn);f=ri(f),c-=Tn;for(var V=ns(z,f);++b<c;)f(b);return V}function zg(c){return yi(c)?rr(c,hs):Ir(c)?[c]:hn(Us(or(c)))}function kg(c){var f=++Mn;return or(c)+f}var Dg=Uu(function(c,f){return c+f},0),Nf=Gh("ceil"),Lg=Uu(function(c,f){return c/f},1),uh=Gh("floor");function jf(c){return c&&c.length?te(c,$o,Ee):E}function Og(c,f){return c&&c.length?te(c,ri(f,2),Ee):E}function Rg(c){return ll(c,$o)}function km(c,f){return ll(c,ri(f,2))}function Bg(c){return c&&c.length?te(c,$o,qi):E}function Dm(c,f){return c&&c.length?te(c,ri(f,2),qi):E}var Vs=Uu(function(c,f){return c*f},1),Qa=Gh("round"),rc=Uu(function(c,f){return c-f},0);function el(c){return c&&c.length?rs(c,$o):0}function nc(c,f){return c&&c.length?rs(c,ri(f,2)):0}return X.after=ud,X.ary=pf,X.assign=nm,X.assignIn=Ha,X.assignInWith=th,X.assignWith=om,X.at=sm,X.before=Jn,X.bind=Cc,X.bindAll=ah,X.bindKey=su,X.castArray=ig,X.chain=ld,X.chunk=dn,X.compact=xp,X.concat=Vu,X.cond=lh,X.conforms=Ed,X.constant=Of,X.countBy=Op,X.create=am,X.curry=mf,X.curryRight=Ju,X.debounce=_f,X.defaults=ug,X.defaultsDeep=hg,X.defer=X_,X.delay=H_,X.difference=va,X.differenceBy=f_,X.differenceWith=p_,X.drop=bp,X.dropRight=Sc,X.dropRightWhile=wp,X.dropWhile=Tp,X.fill=Ep,X.filter=U_,X.flatMap=Bp,X.flatMapDeep=j_,X.flatMapDepth=V_,X.flatten=td,X.flattenDeep=af,X.flattenDepth=xo,X.flip=K_,X.flow=yu,X.flowRight=Ad,X.fromPairs=Ap,X.functions=uu,X.functionsIn=dm,X.groupBy=G_,X.initial=m_,X.intersection=__,X.intersectionBy=Mp,X.intersectionWith=Cp,X.invert=vd,X.invertBy=dg,X.invokeMap=Wu,X.iteratee=Sd,X.keyBy=Xu,X.keys=$n,X.keysIn=Go,X.map=Hu,X.mapKeys=pg,X.mapValues=fu,X.matches=Cm,X.matchesProperty=Eg,X.memoize=hd,X.merge=If,X.mergeWith=pm,X.method=Pm,X.methodOf=Ag,X.mixin=Id,X.negate=dd,X.nthArg=Ig,X.omit=mm,X.omitBy=mg,X.once=Y_,X.orderBy=Ku,X.over=Mg,X.overArgs=fd,X.overEvery=Cd,X.overSome=Pd,X.partial=gf,X.partialRight=yf,X.partition=Fp,X.pick=Mf,X.pickBy=_m,X.property=ch,X.propertyOf=Cg,X.pull=g_,X.pullAll=id,X.pullAllBy=y_,X.pullAllWith=v_,X.pullAt=x_,X.range=Rf,X.rangeRight=Bf,X.rearg=qp,X.reject=Np,X.remove=rd,X.rest=Zp,X.reverse=lf,X.sampleSize=Vp,X.set=gm,X.setWith=ym,X.shuffle=Gp,X.slice=nd,X.sortBy=W_,X.sortedUniq=E_,X.sortedUniqBy=A_,X.split=oh,X.spread=J_,X.tail=S_,X.take=I_,X.takeRight=cf,X.takeRightWhile=M_,X.takeWhile=ru,X.tap=k_,X.throttle=Q_,X.thru=nu,X.toArray=Ef,X.toPairs=rh,X.toPairsIn=xd,X.toPath=zg,X.toPlainObject=yd,X.transform=_g,X.unary=eg,X.union=C_,X.unionBy=Vr,X.unionWith=od,X.uniq=kp,X.uniqBy=sd,X.uniqWith=ad,X.unset=gg,X.unzip=Mc,X.unzipWith=uf,X.update=vm,X.updateWith=xm,X.values=Ka,X.valuesIn=Ml,X.without=Dp,X.words=_u,X.wrap=tg,X.xor=$u,X.xorBy=hf,X.xorWith=df,X.zip=P_,X.zipObject=Lp,X.zipObjectDeep=qu,X.zipWith=z_,X.entries=rh,X.entriesIn=xd,X.extend=Ha,X.extendWith=th,Id(X,X),X.add=Dg,X.attempt=gu,X.camelCase=ba,X.capitalize=bm,X.ceil=Nf,X.clamp=Cf,X.clone=Wp,X.cloneDeep=Gn,X.cloneDeepWith=Wa,X.cloneWith=rg,X.conformsTo=vf,X.deburr=Pf,X.defaultTo=Tg,X.divide=Lg,X.endsWith=yg,X.eq=No,X.escape=zf,X.escapeRegExp=Ya,X.every=ou,X.find=N_,X.findIndex=sf,X.findKey=lm,X.findLast=Rp,X.findLastIndex=ed,X.findLastKey=cm,X.floor=uh,X.forEach=Ql,X.forEachRight=Zu,X.forIn=ih,X.forInRight=um,X.forOwn=hm,X.forOwnRight=Sf,X.get=hu,X.gt=au,X.gte=ng,X.has=fm,X.hasIn=du,X.head=Sp,X.identity=$o,X.includes=$_,X.indexOf=Ip,X.inRange=pu,X.invoke=fg,X.isArguments=Pc,X.isArray=yi,X.isArrayBuffer=og,X.isArrayLike=jo,X.isArrayLikeObject=rn,X.isBoolean=Xp,X.isBuffer=js,X.isDate=er,X.isElement=xf,X.isEmpty=Hp,X.isEqual=Kp,X.isEqualWith=Al,X.isError=ec,X.isFinite=Yp,X.isFunction=Sl,X.isInteger=Jp,X.isLength=pd,X.isMap=Qp,X.isMatch=sg,X.isMatchWith=ag,X.isNaN=lg,X.isNative=md,X.isNil=em,X.isNull=lu,X.isNumber=tm,X.isObject=Gr,X.isObjectLike=nn,X.isPlainObject=Qu,X.isRegExp=bf,X.isSafeInteger=wf,X.isSet=_d,X.isString=eh,X.isSymbol=Ir,X.isTypedArray=Xa,X.isUndefined=cu,X.isWeakMap=Tf,X.isWeakSet=gd,X.join=Pp,X.kebabCase=wm,X.last=Fo,X.lastIndexOf=El,X.lowerCase=Tm,X.lowerFirst=vg,X.lt=cg,X.lte=im,X.max=jf,X.maxBy=Og,X.mean=Rg,X.meanBy=km,X.min=Bg,X.minBy=Dm,X.stubArray=Ja,X.stubFalse=Ff,X.stubObject=Uf,X.stubString=zm,X.stubTrue=zd,X.multiply=Vs,X.nth=Uo,X.noConflict=Sg,X.noop=Md,X.now=Yu,X.pad=bd,X.padEnd=kf,X.padStart=mu,X.parseInt=wd,X.random=xa,X.reduce=q_,X.reduceRight=Up,X.repeat=nh,X.replace=Td,X.result=tc,X.round=Qa,X.runInContext=Se,X.sample=jp,X.size=$p,X.snakeCase=Em,X.some=Z_,X.sortedIndex=zp,X.sortedIndexBy=Ic,X.sortedIndexOf=Gu,X.sortedLastIndex=b_,X.sortedLastIndexBy=w_,X.sortedLastIndexOf=T_,X.startCase=Df,X.startsWith=Am,X.subtract=rc,X.sum=el,X.sumBy=nc,X.template=sh,X.times=Pg,X.toFinite=Il,X.toInteger=Si,X.toLength=Af,X.toLower=Sm,X.toNumber=Vo,X.toSafeInteger=rm,X.toString=or,X.toUpper=Im,X.trim=xg,X.trimEnd=bg,X.trimStart=Mm,X.truncate=zc,X.unescape=wg,X.uniqueId=kg,X.upperCase=ic,X.upperFirst=Lf,X.each=Ql,X.eachRight=Zu,X.first=Sp,Id(X,function(){var c={};return ie(X,function(f,b){Bi.call(X.prototype,b)||(c[b]=f)}),c}(),{chain:!1}),X.VERSION=L,yn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(c){X[c].placeholder=X}),yn(["drop","take"],function(c,f){Ci.prototype[c]=function(b){b=b===E?1:jr(Si(b),0);var z=this.__filtered__&&!f?new Ci(this):this.clone();return z.__filtered__?z.__takeCount__=Qr(b,z.__takeCount__):z.__views__.push({size:Qr(b,Tn),type:c+(z.__dir__<0?"Right":"")}),z},Ci.prototype[c+"Right"]=function(b){return this.reverse()[c](b).reverse()}}),yn(["filter","map","takeWhile"],function(c,f){var b=f+1,z=b==Ni||b==wn;Ci.prototype[c]=function(V){var re=this.clone();return re.__iteratees__.push({iteratee:ri(V,3),type:b}),re.__filtered__=re.__filtered__||z,re}}),yn(["head","last"],function(c,f){var b="take"+(f?"Right":"");Ci.prototype[c]=function(){return this[b](1).value()[0]}}),yn(["initial","tail"],function(c,f){var b="drop"+(f?"":"Right");Ci.prototype[c]=function(){return this.__filtered__?new Ci(this):this[b](1)}}),Ci.prototype.compact=function(){return this.filter($o)},Ci.prototype.find=function(c){return this.filter(c).head()},Ci.prototype.findLast=function(c){return this.reverse().find(c)},Ci.prototype.invokeMap=Jt(function(c,f){return typeof c=="function"?new Ci(this):this.map(function(b){return gt(b,c,f)})}),Ci.prototype.reject=function(c){return this.filter(dd(ri(c)))},Ci.prototype.slice=function(c,f){c=Si(c);var b=this;return b.__filtered__&&(c>0||f<0)?new Ci(b):(c<0?b=b.takeRight(-c):c&&(b=b.drop(c)),f!==E&&(f=Si(f),b=f<0?b.dropRight(-f):b.take(f-c)),b)},Ci.prototype.takeRightWhile=function(c){return this.reverse().takeWhile(c).reverse()},Ci.prototype.toArray=function(){return this.take(Tn)},ie(Ci.prototype,function(c,f){var b=/^(?:filter|find|map|reject)|While$/.test(f),z=/^(?:head|last)$/.test(f),V=X[z?"take"+(f=="last"?"Right":""):f],re=z||/^find/.test(f);!V||(X.prototype[f]=function(){var _e=this.__wrapped__,Ae=z?[1]:arguments,De=_e instanceof Ci,ct=Ae[0],ut=De||yi(_e),pt=function(Ii){var Fi=V.apply(X,ui([Ii],Ae));return z&&Bt?Fi[0]:Fi};ut&&b&&typeof ct=="function"&&ct.length!=1&&(De=ut=!1);var Bt=this.__chain__,jt=!!this.__actions__.length,ai=re&&!Bt,Ai=De&&!jt;if(!re&&ut){_e=Ai?_e:new Ci(this);var li=c.apply(_e,Ae);return li.__actions__.push({func:nu,args:[pt],thisArg:E}),new Sr(li,Bt)}return ai&&Ai?c.apply(this,Ae):(li=this.thru(pt),ai?z?li.value()[0]:li.value():li)})}),yn(["pop","push","shift","sort","splice","unshift"],function(c){var f=_i[c],b=/^(?:push|sort|unshift)$/.test(c)?"tap":"thru",z=/^(?:pop|shift)$/.test(c);X.prototype[c]=function(){var V=arguments;if(z&&!this.__chain__){var re=this.value();return f.apply(yi(re)?re:[],V)}return this[b](function(_e){return f.apply(yi(_e)?_e:[],V)})}}),ie(Ci.prototype,function(c,f){var b=X[f];if(b){var z=b.name+"";Bi.call(dl,z)||(dl[z]=[]),dl[z].push({name:f,func:b})}}),dl[Jc(E,Ie).name]=[{name:"wrapper",func:E}],Ci.prototype.clone=kt,Ci.prototype.reverse=Ah,Ci.prototype.value=Sh,X.prototype.at=ff,X.prototype.chain=cd,X.prototype.commit=D_,X.prototype.next=L_,X.prototype.plant=R_,X.prototype.reverse=B_,X.prototype.toJSON=X.prototype.valueOf=X.prototype.value=F_,X.prototype.first=X.prototype.head,Pn&&(X.prototype[Pn]=O_),X},Gi=Ji();Ts?((Ts.exports=Gi)._=Gi,Ul._=Gi):Jr._=Gi}).call(ph)})(fy,fy.exports);const v0=fy.exports;var jv={exports:{}},Dy={exports:{}},Vv=function(I,E){return function(){for(var B=new Array(arguments.length),U=0;U<B.length;U++)B[U]=arguments[U];return I.apply(E,B)}},x0=Vv,Tu=Object.prototype.toString;function Ly(v){return Array.isArray(v)}function py(v){return typeof v>"u"}function b0(v){return v!==null&&!py(v)&&v.constructor!==null&&!py(v.constructor)&&typeof v.constructor.isBuffer=="function"&&v.constructor.isBuffer(v)}function Gv(v){return Tu.call(v)==="[object ArrayBuffer]"}function w0(v){return Tu.call(v)==="[object FormData]"}function T0(v){var I;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?I=ArrayBuffer.isView(v):I=v&&v.buffer&&Gv(v.buffer),I}function E0(v){return typeof v=="string"}function A0(v){return typeof v=="number"}function $v(v){return v!==null&&typeof v=="object"}function Bm(v){if(Tu.call(v)!=="[object Object]")return!1;var I=Object.getPrototypeOf(v);return I===null||I===Object.prototype}function S0(v){return Tu.call(v)==="[object Date]"}function I0(v){return Tu.call(v)==="[object File]"}function M0(v){return Tu.call(v)==="[object Blob]"}function qv(v){return Tu.call(v)==="[object Function]"}function C0(v){return $v(v)&&qv(v.pipe)}function P0(v){return Tu.call(v)==="[object URLSearchParams]"}function z0(v){return v.trim?v.trim():v.replace(/^\s+|\s+$/g,"")}function k0(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function Oy(v,I){if(!(v===null||typeof v>"u"))if(typeof v!="object"&&(v=[v]),Ly(v))for(var E=0,L=v.length;E<L;E++)I.call(null,v[E],E,v);else for(var B in v)Object.prototype.hasOwnProperty.call(v,B)&&I.call(null,v[B],B,v)}function my(){var v={};function I(B,U){Bm(v[U])&&Bm(B)?v[U]=my(v[U],B):Bm(B)?v[U]=my({},B):Ly(B)?v[U]=B.slice():v[U]=B}for(var E=0,L=arguments.length;E<L;E++)Oy(arguments[E],I);return v}function D0(v,I,E){return Oy(I,function(B,U){E&&typeof B=="function"?v[U]=x0(B,E):v[U]=B}),v}function L0(v){return v.charCodeAt(0)===65279&&(v=v.slice(1)),v}var qs={isArray:Ly,isArrayBuffer:Gv,isBuffer:b0,isFormData:w0,isArrayBufferView:T0,isString:E0,isNumber:A0,isObject:$v,isPlainObject:Bm,isUndefined:py,isDate:S0,isFile:I0,isBlob:M0,isFunction:qv,isStream:C0,isURLSearchParams:P0,isStandardBrowserEnv:k0,forEach:Oy,merge:my,extend:D0,trim:z0,stripBOM:L0},Dd=qs;function hv(v){return encodeURIComponent(v).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Zv=function(I,E,L){if(!E)return I;var B;if(L)B=L(E);else if(Dd.isURLSearchParams(E))B=E.toString();else{var U=[];Dd.forEach(E,function(Q,me){Q===null||typeof Q>"u"||(Dd.isArray(Q)?me=me+"[]":Q=[Q],Dd.forEach(Q,function(ce){Dd.isDate(ce)?ce=ce.toISOString():Dd.isObject(ce)&&(ce=JSON.stringify(ce)),U.push(hv(me)+"="+hv(ce))}))}),B=U.join("&")}if(B){var q=I.indexOf("#");q!==-1&&(I=I.slice(0,q)),I+=(I.indexOf("?")===-1?"?":"&")+B}return I},O0=qs;function $m(){this.handlers=[]}$m.prototype.use=function(I,E,L){return this.handlers.push({fulfilled:I,rejected:E,synchronous:L?L.synchronous:!1,runWhen:L?L.runWhen:null}),this.handlers.length-1};$m.prototype.eject=function(I){this.handlers[I]&&(this.handlers[I]=null)};$m.prototype.forEach=function(I){O0.forEach(this.handlers,function(L){L!==null&&I(L)})};var R0=$m,B0=qs,F0=function(I,E){B0.forEach(I,function(B,U){U!==E&&U.toUpperCase()===E.toUpperCase()&&(I[E]=B,delete I[U])})},Wv=function(I,E,L,B,U){return I.config=E,L&&(I.code=L),I.request=B,I.response=U,I.isAxiosError=!0,I.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},I},qg,dv;function Xv(){if(dv)return qg;dv=1;var v=Wv;return qg=function(E,L,B,U,q){var o=new Error(E);return v(o,L,B,U,q)},qg}var Zg,fv;function U0(){if(fv)return Zg;fv=1;var v=Xv();return Zg=function(E,L,B){var U=B.config.validateStatus;!B.status||!U||U(B.status)?E(B):L(v("Request failed with status code "+B.status,B.config,null,B.request,B))},Zg}var Wg,pv;function N0(){if(pv)return Wg;pv=1;var v=qs;return Wg=v.isStandardBrowserEnv()?function(){return{write:function(L,B,U,q,o,Q){var me=[];me.push(L+"="+encodeURIComponent(B)),v.isNumber(U)&&me.push("expires="+new Date(U).toGMTString()),v.isString(q)&&me.push("path="+q),v.isString(o)&&me.push("domain="+o),Q===!0&&me.push("secure"),document.cookie=me.join("; ")},read:function(L){var B=document.cookie.match(new RegExp("(^|;\\s*)("+L+")=([^;]*)"));return B?decodeURIComponent(B[3]):null},remove:function(L){this.write(L,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Wg}var Xg,mv;function j0(){return mv||(mv=1,Xg=function(I){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(I)}),Xg}var Hg,_v;function V0(){return _v||(_v=1,Hg=function(I,E){return E?I.replace(/\/+$/,"")+"/"+E.replace(/^\/+/,""):I}),Hg}var Kg,gv;function G0(){if(gv)return Kg;gv=1;var v=j0(),I=V0();return Kg=function(L,B){return L&&!v(B)?I(L,B):B},Kg}var Yg,yv;function $0(){if(yv)return Yg;yv=1;var v=qs,I=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Yg=function(L){var B={},U,q,o;return L&&v.forEach(L.split(`
`),function(me){if(o=me.indexOf(":"),U=v.trim(me.substr(0,o)).toLowerCase(),q=v.trim(me.substr(o+1)),U){if(B[U]&&I.indexOf(U)>=0)return;U==="set-cookie"?B[U]=(B[U]?B[U]:[]).concat([q]):B[U]=B[U]?B[U]+", "+q:q}}),B},Yg}var Jg,vv;function q0(){if(vv)return Jg;vv=1;var v=qs;return Jg=v.isStandardBrowserEnv()?function(){var E=/(msie|trident)/i.test(navigator.userAgent),L=document.createElement("a"),B;function U(q){var o=q;return E&&(L.setAttribute("href",o),o=L.href),L.setAttribute("href",o),{href:L.href,protocol:L.protocol?L.protocol.replace(/:$/,""):"",host:L.host,search:L.search?L.search.replace(/^\?/,""):"",hash:L.hash?L.hash.replace(/^#/,""):"",hostname:L.hostname,port:L.port,pathname:L.pathname.charAt(0)==="/"?L.pathname:"/"+L.pathname}}return B=U(window.location.href),function(o){var Q=v.isString(o)?U(o):o;return Q.protocol===B.protocol&&Q.host===B.host}}():function(){return function(){return!0}}(),Jg}var Qg,xv;function qm(){if(xv)return Qg;xv=1;function v(I){this.message=I}return v.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},v.prototype.__CANCEL__=!0,Qg=v,Qg}var ey,bv;function wv(){if(bv)return ey;bv=1;var v=qs,I=U0(),E=N0(),L=Zv,B=G0(),U=$0(),q=q0(),o=Xv(),Q=Zm(),me=qm();return ey=function(ce){return new Promise(function(We,ot){var it=ce.data,Ze=ce.headers,Ie=ce.responseType,je;function Oe(){ce.cancelToken&&ce.cancelToken.unsubscribe(je),ce.signal&&ce.signal.removeEventListener("abort",je)}v.isFormData(it)&&delete Ze["Content-Type"];var qe=new XMLHttpRequest;if(ce.auth){var Ye=ce.auth.username||"",ci=ce.auth.password?unescape(encodeURIComponent(ce.auth.password)):"";Ze.Authorization="Basic "+btoa(Ye+":"+ci)}var Pi=B(ce.baseURL,ce.url);qe.open(ce.method.toUpperCase(),L(Pi,ce.params,ce.paramsSerializer),!0),qe.timeout=ce.timeout;function xt(){if(!!qe){var At="getAllResponseHeaders"in qe?U(qe.getAllResponseHeaders()):null,vt=!Ie||Ie==="text"||Ie==="json"?qe.responseText:qe.response,Yt={data:vt,status:qe.status,statusText:qe.statusText,headers:At,config:ce,request:qe};I(function(Ni){We(Ni),Oe()},function(Ni){ot(Ni),Oe()},Yt),qe=null}}if("onloadend"in qe?qe.onloadend=xt:qe.onreadystatechange=function(){!qe||qe.readyState!==4||qe.status===0&&!(qe.responseURL&&qe.responseURL.indexOf("file:")===0)||setTimeout(xt)},qe.onabort=function(){!qe||(ot(o("Request aborted",ce,"ECONNABORTED",qe)),qe=null)},qe.onerror=function(){ot(o("Network Error",ce,null,qe)),qe=null},qe.ontimeout=function(){var vt=ce.timeout?"timeout of "+ce.timeout+"ms exceeded":"timeout exceeded",Yt=ce.transitional||Q.transitional;ce.timeoutErrorMessage&&(vt=ce.timeoutErrorMessage),ot(o(vt,ce,Yt.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",qe)),qe=null},v.isStandardBrowserEnv()){var bt=(ce.withCredentials||q(Pi))&&ce.xsrfCookieName?E.read(ce.xsrfCookieName):void 0;bt&&(Ze[ce.xsrfHeaderName]=bt)}"setRequestHeader"in qe&&v.forEach(Ze,function(vt,Yt){typeof it>"u"&&Yt.toLowerCase()==="content-type"?delete Ze[Yt]:qe.setRequestHeader(Yt,vt)}),v.isUndefined(ce.withCredentials)||(qe.withCredentials=!!ce.withCredentials),Ie&&Ie!=="json"&&(qe.responseType=ce.responseType),typeof ce.onDownloadProgress=="function"&&qe.addEventListener("progress",ce.onDownloadProgress),typeof ce.onUploadProgress=="function"&&qe.upload&&qe.upload.addEventListener("progress",ce.onUploadProgress),(ce.cancelToken||ce.signal)&&(je=function(At){!qe||(ot(!At||At&&At.type?new me("canceled"):At),qe.abort(),qe=null)},ce.cancelToken&&ce.cancelToken.subscribe(je),ce.signal&&(ce.signal.aborted?je():ce.signal.addEventListener("abort",je))),it||(it=null),qe.send(it)})},ey}var ty,Tv;function Zm(){if(Tv)return ty;Tv=1;var v=qs,I=F0,E=Wv,L={"Content-Type":"application/x-www-form-urlencoded"};function B(Q,me){!v.isUndefined(Q)&&v.isUndefined(Q["Content-Type"])&&(Q["Content-Type"]=me)}function U(){var Q;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(Q=wv()),Q}function q(Q,me,Ce){if(v.isString(Q))try{return(me||JSON.parse)(Q),v.trim(Q)}catch(ce){if(ce.name!=="SyntaxError")throw ce}return(Ce||JSON.stringify)(Q)}var o={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:U(),transformRequest:[function(me,Ce){return I(Ce,"Accept"),I(Ce,"Content-Type"),v.isFormData(me)||v.isArrayBuffer(me)||v.isBuffer(me)||v.isStream(me)||v.isFile(me)||v.isBlob(me)?me:v.isArrayBufferView(me)?me.buffer:v.isURLSearchParams(me)?(B(Ce,"application/x-www-form-urlencoded;charset=utf-8"),me.toString()):v.isObject(me)||Ce&&Ce["Content-Type"]==="application/json"?(B(Ce,"application/json"),q(me)):me}],transformResponse:[function(me){var Ce=this.transitional||o.transitional,ce=Ce&&Ce.silentJSONParsing,Ue=Ce&&Ce.forcedJSONParsing,We=!ce&&this.responseType==="json";if(We||Ue&&v.isString(me)&&me.length)try{return JSON.parse(me)}catch(ot){if(We)throw ot.name==="SyntaxError"?E(ot,this,"E_JSON_PARSE"):ot}return me}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(me){return me>=200&&me<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};return v.forEach(["delete","get","head"],function(me){o.headers[me]={}}),v.forEach(["post","put","patch"],function(me){o.headers[me]=v.merge(L)}),ty=o,ty}var Z0=qs,W0=Zm(),X0=function(I,E,L){var B=this||W0;return Z0.forEach(L,function(q){I=q.call(B,I,E)}),I},iy,Ev;function Hv(){return Ev||(Ev=1,iy=function(I){return!!(I&&I.__CANCEL__)}),iy}var Av=qs,ry=X0,H0=Hv(),K0=Zm(),Y0=qm();function ny(v){if(v.cancelToken&&v.cancelToken.throwIfRequested(),v.signal&&v.signal.aborted)throw new Y0("canceled")}var J0=function(I){ny(I),I.headers=I.headers||{},I.data=ry.call(I,I.data,I.headers,I.transformRequest),I.headers=Av.merge(I.headers.common||{},I.headers[I.method]||{},I.headers),Av.forEach(["delete","get","head","post","put","patch","common"],function(B){delete I.headers[B]});var E=I.adapter||K0.adapter;return E(I).then(function(B){return ny(I),B.data=ry.call(I,B.data,B.headers,I.transformResponse),B},function(B){return H0(B)||(ny(I),B&&B.response&&(B.response.data=ry.call(I,B.response.data,B.response.headers,I.transformResponse))),Promise.reject(B)})},wa=qs,Kv=function(I,E){E=E||{};var L={};function B(Ce,ce){return wa.isPlainObject(Ce)&&wa.isPlainObject(ce)?wa.merge(Ce,ce):wa.isPlainObject(ce)?wa.merge({},ce):wa.isArray(ce)?ce.slice():ce}function U(Ce){if(wa.isUndefined(E[Ce])){if(!wa.isUndefined(I[Ce]))return B(void 0,I[Ce])}else return B(I[Ce],E[Ce])}function q(Ce){if(!wa.isUndefined(E[Ce]))return B(void 0,E[Ce])}function o(Ce){if(wa.isUndefined(E[Ce])){if(!wa.isUndefined(I[Ce]))return B(void 0,I[Ce])}else return B(void 0,E[Ce])}function Q(Ce){if(Ce in E)return B(I[Ce],E[Ce]);if(Ce in I)return B(void 0,I[Ce])}var me={url:q,method:q,data:q,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:Q};return wa.forEach(Object.keys(I).concat(Object.keys(E)),function(ce){var Ue=me[ce]||U,We=Ue(ce);wa.isUndefined(We)&&Ue!==Q||(L[ce]=We)}),L},oy,Sv;function Yv(){return Sv||(Sv=1,oy={version:"0.25.0"}),oy}var Q0=Yv().version,Ry={};["object","boolean","number","function","string","symbol"].forEach(function(v,I){Ry[v]=function(L){return typeof L===v||"a"+(I<1?"n ":" ")+v}});var Iv={};Ry.transitional=function(I,E,L){function B(U,q){return"[Axios v"+Q0+"] Transitional option '"+U+"'"+q+(L?". "+L:"")}return function(U,q,o){if(I===!1)throw new Error(B(q," has been removed"+(E?" in "+E:"")));return E&&!Iv[q]&&(Iv[q]=!0,console.warn(B(q," has been deprecated since v"+E+" and will be removed in the near future"))),I?I(U,q,o):!0}};function e1(v,I,E){if(typeof v!="object")throw new TypeError("options must be an object");for(var L=Object.keys(v),B=L.length;B-- >0;){var U=L[B],q=I[U];if(q){var o=v[U],Q=o===void 0||q(o,U,v);if(Q!==!0)throw new TypeError("option "+U+" must be "+Q);continue}if(E!==!0)throw Error("Unknown option "+U)}}var t1={assertOptions:e1,validators:Ry},Jv=qs,i1=Zv,Mv=R0,Cv=J0,Wm=Kv,Qv=t1,Ld=Qv.validators;function Qf(v){this.defaults=v,this.interceptors={request:new Mv,response:new Mv}}Qf.prototype.request=function(I,E){if(typeof I=="string"?(E=E||{},E.url=I):E=I||{},!E.url)throw new Error("Provided config url is not valid");E=Wm(this.defaults,E),E.method?E.method=E.method.toLowerCase():this.defaults.method?E.method=this.defaults.method.toLowerCase():E.method="get";var L=E.transitional;L!==void 0&&Qv.assertOptions(L,{silentJSONParsing:Ld.transitional(Ld.boolean),forcedJSONParsing:Ld.transitional(Ld.boolean),clarifyTimeoutError:Ld.transitional(Ld.boolean)},!1);var B=[],U=!0;this.interceptors.request.forEach(function(We){typeof We.runWhen=="function"&&We.runWhen(E)===!1||(U=U&&We.synchronous,B.unshift(We.fulfilled,We.rejected))});var q=[];this.interceptors.response.forEach(function(We){q.push(We.fulfilled,We.rejected)});var o;if(!U){var Q=[Cv,void 0];for(Array.prototype.unshift.apply(Q,B),Q=Q.concat(q),o=Promise.resolve(E);Q.length;)o=o.then(Q.shift(),Q.shift());return o}for(var me=E;B.length;){var Ce=B.shift(),ce=B.shift();try{me=Ce(me)}catch(Ue){ce(Ue);break}}try{o=Cv(me)}catch(Ue){return Promise.reject(Ue)}for(;q.length;)o=o.then(q.shift(),q.shift());return o};Qf.prototype.getUri=function(I){if(!I.url)throw new Error("Provided config url is not valid");return I=Wm(this.defaults,I),i1(I.url,I.params,I.paramsSerializer).replace(/^\?/,"")};Jv.forEach(["delete","get","head","options"],function(I){Qf.prototype[I]=function(E,L){return this.request(Wm(L||{},{method:I,url:E,data:(L||{}).data}))}});Jv.forEach(["post","put","patch"],function(I){Qf.prototype[I]=function(E,L,B){return this.request(Wm(B||{},{method:I,url:E,data:L}))}});var r1=Qf,sy,Pv;function n1(){if(Pv)return sy;Pv=1;var v=qm();function I(E){if(typeof E!="function")throw new TypeError("executor must be a function.");var L;this.promise=new Promise(function(q){L=q});var B=this;this.promise.then(function(U){if(!!B._listeners){var q,o=B._listeners.length;for(q=0;q<o;q++)B._listeners[q](U);B._listeners=null}}),this.promise.then=function(U){var q,o=new Promise(function(Q){B.subscribe(Q),q=Q}).then(U);return o.cancel=function(){B.unsubscribe(q)},o},E(function(q){B.reason||(B.reason=new v(q),L(B.reason))})}return I.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},I.prototype.subscribe=function(L){if(this.reason){L(this.reason);return}this._listeners?this._listeners.push(L):this._listeners=[L]},I.prototype.unsubscribe=function(L){if(!!this._listeners){var B=this._listeners.indexOf(L);B!==-1&&this._listeners.splice(B,1)}},I.source=function(){var L,B=new I(function(q){L=q});return{token:B,cancel:L}},sy=I,sy}var ay,zv;function o1(){return zv||(zv=1,ay=function(I){return function(L){return I.apply(null,L)}}),ay}var ly,kv;function s1(){if(kv)return ly;kv=1;var v=qs;return ly=function(E){return v.isObject(E)&&E.isAxiosError===!0},ly}var Dv=qs,a1=Vv,Fm=r1,l1=Kv,c1=Zm();function ex(v){var I=new Fm(v),E=a1(Fm.prototype.request,I);return Dv.extend(E,Fm.prototype,I),Dv.extend(E,I),E.create=function(B){return ex(l1(v,B))},E}var sc=ex(c1);sc.Axios=Fm;sc.Cancel=qm();sc.CancelToken=n1();sc.isCancel=Hv();sc.VERSION=Yv().version;sc.all=function(I){return Promise.all(I)};sc.spread=o1();sc.isAxiosError=s1();Dy.exports=sc;Dy.exports.default=sc;(function(v){v.exports=Dy.exports})(jv);const u1=y0(jv.exports);window._=v0;window.axios=u1;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";var _y=!1,gy=!1,_h=[];function h1(v){d1(v)}function d1(v){_h.includes(v)||_h.push(v),f1()}function tx(v){let I=_h.indexOf(v);I!==-1&&_h.splice(I,1)}function f1(){!gy&&!_y&&(_y=!0,queueMicrotask(p1))}function p1(){_y=!1,gy=!0;for(let v=0;v<_h.length;v++)_h[v]();_h.length=0,gy=!1}var Ud,ep,Xm,ix,yy=!0;function m1(v){yy=!1,v(),yy=!0}function _1(v){Ud=v.reactive,Xm=v.release,ep=I=>v.effect(I,{scheduler:E=>{yy?h1(E):E()}}),ix=v.raw}function Lv(v){ep=v}function g1(v){let I=()=>{};return[L=>{let B=ep(L);return v._x_effects||(v._x_effects=new Set,v._x_runEffects=()=>{v._x_effects.forEach(U=>U())}),v._x_effects.add(B),I=()=>{B!==void 0&&(v._x_effects.delete(B),Xm(B))},B},()=>{I()}]}var rx=[],nx=[],ox=[];function y1(v){ox.push(v)}function sx(v,I){typeof I=="function"?(v._x_cleanups||(v._x_cleanups=[]),v._x_cleanups.push(I)):(I=v,nx.push(I))}function v1(v){rx.push(v)}function x1(v,I,E){v._x_attributeCleanups||(v._x_attributeCleanups={}),v._x_attributeCleanups[I]||(v._x_attributeCleanups[I]=[]),v._x_attributeCleanups[I].push(E)}function ax(v,I){!v._x_attributeCleanups||Object.entries(v._x_attributeCleanups).forEach(([E,L])=>{(I===void 0||I.includes(E))&&(L.forEach(B=>B()),delete v._x_attributeCleanups[E])})}var By=new MutationObserver(Ny),Fy=!1;function lx(){By.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),Fy=!0}function b1(){w1(),By.disconnect(),Fy=!1}var Kf=[],cy=!1;function w1(){Kf=Kf.concat(By.takeRecords()),Kf.length&&!cy&&(cy=!0,queueMicrotask(()=>{T1(),cy=!1}))}function T1(){Ny(Kf),Kf.length=0}function mo(v){if(!Fy)return v();b1();let I=v();return lx(),I}var Uy=!1,jm=[];function E1(){Uy=!0}function A1(){Uy=!1,Ny(jm),jm=[]}function Ny(v){if(Uy){jm=jm.concat(v);return}let I=[],E=[],L=new Map,B=new Map;for(let U=0;U<v.length;U++)if(!v[U].target._x_ignoreMutationObserver&&(v[U].type==="childList"&&(v[U].addedNodes.forEach(q=>q.nodeType===1&&I.push(q)),v[U].removedNodes.forEach(q=>q.nodeType===1&&E.push(q))),v[U].type==="attributes")){let q=v[U].target,o=v[U].attributeName,Q=v[U].oldValue,me=()=>{L.has(q)||L.set(q,[]),L.get(q).push({name:o,value:q.getAttribute(o)})},Ce=()=>{B.has(q)||B.set(q,[]),B.get(q).push(o)};q.hasAttribute(o)&&Q===null?me():q.hasAttribute(o)?(Ce(),me()):Ce()}B.forEach((U,q)=>{ax(q,U)}),L.forEach((U,q)=>{rx.forEach(o=>o(q,U))});for(let U of E)if(!I.includes(U)&&(nx.forEach(q=>q(U)),U._x_cleanups))for(;U._x_cleanups.length;)U._x_cleanups.pop()();I.forEach(U=>{U._x_ignoreSelf=!0,U._x_ignore=!0});for(let U of I)E.includes(U)||!U.isConnected||(delete U._x_ignoreSelf,delete U._x_ignore,ox.forEach(q=>q(U)),U._x_ignore=!0,U._x_ignoreSelf=!0);I.forEach(U=>{delete U._x_ignoreSelf,delete U._x_ignore}),I=null,E=null,L=null,B=null}function cx(v){return ip(Rd(v))}function tp(v,I,E){return v._x_dataStack=[I,...Rd(E||v)],()=>{v._x_dataStack=v._x_dataStack.filter(L=>L!==I)}}function Ov(v,I){let E=v._x_dataStack[0];Object.entries(I).forEach(([L,B])=>{E[L]=B})}function Rd(v){return v._x_dataStack?v._x_dataStack:typeof ShadowRoot=="function"&&v instanceof ShadowRoot?Rd(v.host):v.parentNode?Rd(v.parentNode):[]}function ip(v){let I=new Proxy({},{ownKeys:()=>Array.from(new Set(v.flatMap(E=>Object.keys(E)))),has:(E,L)=>v.some(B=>B.hasOwnProperty(L)),get:(E,L)=>(v.find(B=>{if(B.hasOwnProperty(L)){let U=Object.getOwnPropertyDescriptor(B,L);if(U.get&&U.get._x_alreadyBound||U.set&&U.set._x_alreadyBound)return!0;if((U.get||U.set)&&U.enumerable){let q=U.get,o=U.set,Q=U;q=q&&q.bind(I),o=o&&o.bind(I),q&&(q._x_alreadyBound=!0),o&&(o._x_alreadyBound=!0),Object.defineProperty(B,L,{...Q,get:q,set:o})}return!0}return!1})||{})[L],set:(E,L,B)=>{let U=v.find(q=>q.hasOwnProperty(L));return U?U[L]=B:v[v.length-1][L]=B,!0}});return I}function ux(v){let I=L=>typeof L=="object"&&!Array.isArray(L)&&L!==null,E=(L,B="")=>{Object.entries(Object.getOwnPropertyDescriptors(L)).forEach(([U,{value:q,enumerable:o}])=>{if(o===!1||q===void 0)return;let Q=B===""?U:`${B}.${U}`;typeof q=="object"&&q!==null&&q._x_interceptor?L[U]=q.initialize(v,Q,U):I(q)&&q!==L&&!(q instanceof Element)&&E(q,Q)})};return E(v)}function hx(v,I=()=>{}){let E={initialValue:void 0,_x_interceptor:!0,initialize(L,B,U){return v(this.initialValue,()=>S1(L,B),q=>vy(L,B,q),B,U)}};return I(E),L=>{if(typeof L=="object"&&L!==null&&L._x_interceptor){let B=E.initialize.bind(E);E.initialize=(U,q,o)=>{let Q=L.initialize(U,q,o);return E.initialValue=Q,B(U,q,o)}}else E.initialValue=L;return E}}function S1(v,I){return I.split(".").reduce((E,L)=>E[L],v)}function vy(v,I,E){if(typeof I=="string"&&(I=I.split(".")),I.length===1)v[I[0]]=E;else{if(I.length===0)throw error;return v[I[0]]||(v[I[0]]={}),vy(v[I[0]],I.slice(1),E)}}var dx={};function Pl(v,I){dx[v]=I}function xy(v,I){return Object.entries(dx).forEach(([E,L])=>{Object.defineProperty(v,`$${E}`,{get(){let[B,U]=gx(I);return B={interceptor:hx,...B},sx(I,U),L(I,B)},enumerable:!1})}),v}function I1(v,I,E,...L){try{return E(...L)}catch(B){Jf(B,v,I)}}function Jf(v,I,E=void 0){Object.assign(v,{el:I,expression:E}),console.warn(`Alpine Expression Error: ${v.message}

${E?'Expression: "'+E+`"

`:""}`,I),setTimeout(()=>{throw v},0)}var Um=!0;function M1(v){let I=Um;Um=!1,v(),Um=I}function Od(v,I,E={}){let L;return fs(v,I)(B=>L=B,E),L}function fs(...v){return fx(...v)}var fx=px;function C1(v){fx=v}function px(v,I){let E={};xy(E,v);let L=[E,...Rd(v)];if(typeof I=="function")return P1(L,I);let B=k1(L,I,v);return I1.bind(null,v,I,B)}function P1(v,I){return(E=()=>{},{scope:L={},params:B=[]}={})=>{let U=I.apply(ip([L,...v]),B);Vm(E,U)}}var uy={};function z1(v,I){if(uy[v])return uy[v];let E=Object.getPrototypeOf(async function(){}).constructor,L=/^[\n\s]*if.*\(.*\)/.test(v)||/^(let|const)\s/.test(v)?`(() => { ${v} })()`:v,U=(()=>{try{return new E(["__self","scope"],`with (scope) { __self.result = ${L} }; __self.finished = true; return __self.result;`)}catch(q){return Jf(q,I,v),Promise.resolve()}})();return uy[v]=U,U}function k1(v,I,E){let L=z1(I,E);return(B=()=>{},{scope:U={},params:q=[]}={})=>{L.result=void 0,L.finished=!1;let o=ip([U,...v]);if(typeof L=="function"){let Q=L(L,o).catch(me=>Jf(me,E,I));L.finished?(Vm(B,L.result,o,q,E),L.result=void 0):Q.then(me=>{Vm(B,me,o,q,E)}).catch(me=>Jf(me,E,I)).finally(()=>L.result=void 0)}}}function Vm(v,I,E,L,B){if(Um&&typeof I=="function"){let U=I.apply(E,L);U instanceof Promise?U.then(q=>Vm(v,q,E,L)).catch(q=>Jf(q,B,I)):v(U)}else v(I)}var jy="x-";function Nd(v=""){return jy+v}function D1(v){jy=v}var mx={};function Zn(v,I){mx[v]=I}function Vy(v,I,E){let L={};return Array.from(I).map(xx((U,q)=>L[U]=q)).filter(wx).map(B1(L,E)).sort(F1).map(U=>R1(v,U))}function L1(v){return Array.from(v).map(xx()).filter(I=>!wx(I))}var by=!1,Hf=new Map,_x=Symbol();function O1(v){by=!0;let I=Symbol();_x=I,Hf.set(I,[]);let E=()=>{for(;Hf.get(I).length;)Hf.get(I).shift()();Hf.delete(I)},L=()=>{by=!1,E()};v(E),L()}function gx(v){let I=[],E=o=>I.push(o),[L,B]=g1(v);return I.push(B),[{Alpine:rp,effect:L,cleanup:E,evaluateLater:fs.bind(fs,v),evaluate:Od.bind(Od,v)},()=>I.forEach(o=>o())]}function R1(v,I){let E=()=>{},L=mx[I.type]||E,[B,U]=gx(v);x1(v,I.original,U);let q=()=>{v._x_ignore||v._x_ignoreSelf||(L.inline&&L.inline(v,I,B),L=L.bind(L,v,I,B),by?Hf.get(_x).push(L):L())};return q.runCleanups=U,q}var yx=(v,I)=>({name:E,value:L})=>(E.startsWith(v)&&(E=E.replace(v,I)),{name:E,value:L}),vx=v=>v;function xx(v=()=>{}){return({name:I,value:E})=>{let{name:L,value:B}=bx.reduce((U,q)=>q(U),{name:I,value:E});return L!==I&&v(L,I),{name:L,value:B}}}var bx=[];function Gy(v){bx.push(v)}function wx({name:v}){return Tx().test(v)}var Tx=()=>new RegExp(`^${jy}([^:^.]+)\\b`);function B1(v,I){return({name:E,value:L})=>{let B=E.match(Tx()),U=E.match(/:([a-zA-Z0-9\-:]+)/),q=E.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],o=I||v[E]||E;return{type:B?B[1]:null,value:U?U[1]:null,modifiers:q.map(Q=>Q.replace(".","")),expression:L,original:o}}}var wy="DEFAULT",Om=["ignore","ref","data","id","bind","init","for","mask","model","modelable","transition","show","if",wy,"teleport","element"];function F1(v,I){let E=Om.indexOf(v.type)===-1?wy:v.type,L=Om.indexOf(I.type)===-1?wy:I.type;return Om.indexOf(E)-Om.indexOf(L)}function Yf(v,I,E={}){v.dispatchEvent(new CustomEvent(I,{detail:E,bubbles:!0,composed:!0,cancelable:!0}))}var Ty=[],$y=!1;function Ex(v=()=>{}){return queueMicrotask(()=>{$y||setTimeout(()=>{Ey()})}),new Promise(I=>{Ty.push(()=>{v(),I()})})}function Ey(){for($y=!1;Ty.length;)Ty.shift()()}function U1(){$y=!0}function vh(v,I){if(typeof ShadowRoot=="function"&&v instanceof ShadowRoot){Array.from(v.children).forEach(B=>vh(B,I));return}let E=!1;if(I(v,()=>E=!0),E)return;let L=v.firstElementChild;for(;L;)vh(L,I),L=L.nextElementSibling}function Bd(v,...I){console.warn(`Alpine Warning: ${v}`,...I)}function N1(){document.body||Bd("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),Yf(document,"alpine:init"),Yf(document,"alpine:initializing"),lx(),y1(I=>bu(I,vh)),sx(I=>V1(I)),v1((I,E)=>{Vy(I,E).forEach(L=>L())});let v=I=>!Hm(I.parentElement,!0);Array.from(document.querySelectorAll(Ix())).filter(v).forEach(I=>{bu(I)}),Yf(document,"alpine:initialized")}var qy=[],Ax=[];function Sx(){return qy.map(v=>v())}function Ix(){return qy.concat(Ax).map(v=>v())}function Mx(v){qy.push(v)}function Cx(v){Ax.push(v)}function Hm(v,I=!1){return Km(v,E=>{if((I?Ix():Sx()).some(B=>E.matches(B)))return!0})}function Km(v,I){if(!!v){if(I(v))return v;if(v._x_teleportBack&&(v=v._x_teleportBack),!!v.parentElement)return Km(v.parentElement,I)}}function j1(v){return Sx().some(I=>v.matches(I))}function bu(v,I=vh){O1(()=>{I(v,(E,L)=>{Vy(E,E.attributes).forEach(B=>B()),E._x_ignore&&L()})})}function V1(v){vh(v,I=>ax(I))}function Zy(v,I){return Array.isArray(I)?Rv(v,I.join(" ")):typeof I=="object"&&I!==null?G1(v,I):typeof I=="function"?Zy(v,I()):Rv(v,I)}function Rv(v,I){let E=B=>B.split(" ").filter(U=>!v.classList.contains(U)).filter(Boolean),L=B=>(v.classList.add(...B),()=>{v.classList.remove(...B)});return I=I===!0?I="":I||"",L(E(I))}function G1(v,I){let E=o=>o.split(" ").filter(Boolean),L=Object.entries(I).flatMap(([o,Q])=>Q?E(o):!1).filter(Boolean),B=Object.entries(I).flatMap(([o,Q])=>Q?!1:E(o)).filter(Boolean),U=[],q=[];return B.forEach(o=>{v.classList.contains(o)&&(v.classList.remove(o),q.push(o))}),L.forEach(o=>{v.classList.contains(o)||(v.classList.add(o),U.push(o))}),()=>{q.forEach(o=>v.classList.add(o)),U.forEach(o=>v.classList.remove(o))}}function Ym(v,I){return typeof I=="object"&&I!==null?$1(v,I):q1(v,I)}function $1(v,I){let E={};return Object.entries(I).forEach(([L,B])=>{E[L]=v.style[L],L.startsWith("--")||(L=Z1(L)),v.style.setProperty(L,B)}),setTimeout(()=>{v.style.length===0&&v.removeAttribute("style")}),()=>{Ym(v,E)}}function q1(v,I){let E=v.getAttribute("style",I);return v.setAttribute("style",I),()=>{v.setAttribute("style",E||"")}}function Z1(v){return v.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Ay(v,I=()=>{}){let E=!1;return function(){E?I.apply(this,arguments):(E=!0,v.apply(this,arguments))}}Zn("transition",(v,{value:I,modifiers:E,expression:L},{evaluate:B})=>{typeof L=="function"&&(L=B(L)),L?W1(v,L,I):X1(v,E,I)});function W1(v,I,E){Px(v,Zy,""),{enter:B=>{v._x_transition.enter.during=B},"enter-start":B=>{v._x_transition.enter.start=B},"enter-end":B=>{v._x_transition.enter.end=B},leave:B=>{v._x_transition.leave.during=B},"leave-start":B=>{v._x_transition.leave.start=B},"leave-end":B=>{v._x_transition.leave.end=B}}[E](I)}function X1(v,I,E){Px(v,Ym);let L=!I.includes("in")&&!I.includes("out")&&!E,B=L||I.includes("in")||["enter"].includes(E),U=L||I.includes("out")||["leave"].includes(E);I.includes("in")&&!L&&(I=I.filter((Ie,je)=>je<I.indexOf("out"))),I.includes("out")&&!L&&(I=I.filter((Ie,je)=>je>I.indexOf("out")));let q=!I.includes("opacity")&&!I.includes("scale"),o=q||I.includes("opacity"),Q=q||I.includes("scale"),me=o?0:1,Ce=Q?Wf(I,"scale",95)/100:1,ce=Wf(I,"delay",0),Ue=Wf(I,"origin","center"),We="opacity, transform",ot=Wf(I,"duration",150)/1e3,it=Wf(I,"duration",75)/1e3,Ze="cubic-bezier(0.4, 0.0, 0.2, 1)";B&&(v._x_transition.enter.during={transformOrigin:Ue,transitionDelay:ce,transitionProperty:We,transitionDuration:`${ot}s`,transitionTimingFunction:Ze},v._x_transition.enter.start={opacity:me,transform:`scale(${Ce})`},v._x_transition.enter.end={opacity:1,transform:"scale(1)"}),U&&(v._x_transition.leave.during={transformOrigin:Ue,transitionDelay:ce,transitionProperty:We,transitionDuration:`${it}s`,transitionTimingFunction:Ze},v._x_transition.leave.start={opacity:1,transform:"scale(1)"},v._x_transition.leave.end={opacity:me,transform:`scale(${Ce})`})}function Px(v,I,E={}){v._x_transition||(v._x_transition={enter:{during:E,start:E,end:E},leave:{during:E,start:E,end:E},in(L=()=>{},B=()=>{}){Sy(v,I,{during:this.enter.during,start:this.enter.start,end:this.enter.end},L,B)},out(L=()=>{},B=()=>{}){Sy(v,I,{during:this.leave.during,start:this.leave.start,end:this.leave.end},L,B)}})}window.Element.prototype._x_toggleAndCascadeWithTransitions=function(v,I,E,L){let B=()=>{document.visibilityState==="visible"?requestAnimationFrame(E):setTimeout(E)};if(I){v._x_transition&&(v._x_transition.enter||v._x_transition.leave)?v._x_transition.enter&&(Object.entries(v._x_transition.enter.during).length||Object.entries(v._x_transition.enter.start).length||Object.entries(v._x_transition.enter.end).length)?v._x_transition.in(E):B():v._x_transition?v._x_transition.in(E):B();return}v._x_hidePromise=v._x_transition?new Promise((U,q)=>{v._x_transition.out(()=>{},()=>U(L)),v._x_transitioning.beforeCancel(()=>q({isFromCancelledTransition:!0}))}):Promise.resolve(L),queueMicrotask(()=>{let U=zx(v);U?(U._x_hideChildren||(U._x_hideChildren=[]),U._x_hideChildren.push(v)):queueMicrotask(()=>{let q=o=>{let Q=Promise.all([o._x_hidePromise,...(o._x_hideChildren||[]).map(q)]).then(([me])=>me());return delete o._x_hidePromise,delete o._x_hideChildren,Q};q(v).catch(o=>{if(!o.isFromCancelledTransition)throw o})})})};function zx(v){let I=v.parentNode;if(!!I)return I._x_hidePromise?I:zx(I)}function Sy(v,I,{during:E,start:L,end:B}={},U=()=>{},q=()=>{}){if(v._x_transitioning&&v._x_transitioning.cancel(),Object.keys(E).length===0&&Object.keys(L).length===0&&Object.keys(B).length===0){U(),q();return}let o,Q,me;H1(v,{start(){o=I(v,L)},during(){Q=I(v,E)},before:U,end(){o(),me=I(v,B)},after:q,cleanup(){Q(),me()}})}function H1(v,I){let E,L,B,U=Ay(()=>{mo(()=>{E=!0,L||I.before(),B||(I.end(),Ey()),I.after(),v.isConnected&&I.cleanup(),delete v._x_transitioning})});v._x_transitioning={beforeCancels:[],beforeCancel(q){this.beforeCancels.push(q)},cancel:Ay(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();U()}),finish:U},mo(()=>{I.start(),I.during()}),U1(),requestAnimationFrame(()=>{if(E)return;let q=Number(getComputedStyle(v).transitionDuration.replace(/,.*/,"").replace("s",""))*1e3,o=Number(getComputedStyle(v).transitionDelay.replace(/,.*/,"").replace("s",""))*1e3;q===0&&(q=Number(getComputedStyle(v).animationDuration.replace("s",""))*1e3),mo(()=>{I.before()}),L=!0,requestAnimationFrame(()=>{E||(mo(()=>{I.end()}),Ey(),setTimeout(v._x_transitioning.finish,q+o),B=!0)})})}function Wf(v,I,E){if(v.indexOf(I)===-1)return E;const L=v[v.indexOf(I)+1];if(!L||I==="scale"&&isNaN(L))return E;if(I==="duration"){let B=L.match(/([0-9]+)ms/);if(B)return B[1]}return I==="origin"&&["top","right","left","center","bottom"].includes(v[v.indexOf(I)+2])?[L,v[v.indexOf(I)+2]].join(" "):L}var Iy=!1;function Jm(v,I=()=>{}){return(...E)=>Iy?I(...E):v(...E)}function K1(v,I){I._x_dataStack||(I._x_dataStack=v._x_dataStack),Iy=!0,J1(()=>{Y1(I)}),Iy=!1}function Y1(v){let I=!1;bu(v,(L,B)=>{vh(L,(U,q)=>{if(I&&j1(U))return q();I=!0,B(U,q)})})}function J1(v){let I=ep;Lv((E,L)=>{let B=I(E);return Xm(B),()=>{}}),v(),Lv(I)}function kx(v,I,E,L=[]){switch(v._x_bindings||(v._x_bindings=Ud({})),v._x_bindings[I]=E,I=L.includes("camel")?ob(I):I,I){case"value":Q1(v,E);break;case"style":tb(v,E);break;case"class":eb(v,E);break;default:ib(v,I,E);break}}function Q1(v,I){if(v.type==="radio")v.attributes.value===void 0&&(v.value=I),window.fromModel&&(v.checked=Bv(v.value,I));else if(v.type==="checkbox")Number.isInteger(I)?v.value=I:!Number.isInteger(I)&&!Array.isArray(I)&&typeof I!="boolean"&&![null,void 0].includes(I)?v.value=String(I):Array.isArray(I)?v.checked=I.some(E=>Bv(E,v.value)):v.checked=!!I;else if(v.tagName==="SELECT")nb(v,I);else{if(v.value===I)return;v.value=I}}function eb(v,I){v._x_undoAddedClasses&&v._x_undoAddedClasses(),v._x_undoAddedClasses=Zy(v,I)}function tb(v,I){v._x_undoAddedStyles&&v._x_undoAddedStyles(),v._x_undoAddedStyles=Ym(v,I)}function ib(v,I,E){[null,void 0,!1].includes(E)&&sb(I)?v.removeAttribute(I):(Dx(I)&&(E=I),rb(v,I,E))}function rb(v,I,E){v.getAttribute(I)!=E&&v.setAttribute(I,E)}function nb(v,I){const E=[].concat(I).map(L=>L+"");Array.from(v.options).forEach(L=>{L.selected=E.includes(L.value)})}function ob(v){return v.toLowerCase().replace(/-(\w)/g,(I,E)=>E.toUpperCase())}function Bv(v,I){return v==I}function Dx(v){return["disabled","checked","required","readonly","hidden","open","selected","autofocus","itemscope","multiple","novalidate","allowfullscreen","allowpaymentrequest","formnovalidate","autoplay","controls","loop","muted","playsinline","default","ismap","reversed","async","defer","nomodule"].includes(v)}function sb(v){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(v)}function ab(v,I,E){if(v._x_bindings&&v._x_bindings[I]!==void 0)return v._x_bindings[I];let L=v.getAttribute(I);return L===null?typeof E=="function"?E():E:Dx(I)?!![I,"true"].includes(L):L===""?!0:L}function Lx(v,I){var E;return function(){var L=this,B=arguments,U=function(){E=null,v.apply(L,B)};clearTimeout(E),E=setTimeout(U,I)}}function Ox(v,I){let E;return function(){let L=this,B=arguments;E||(v.apply(L,B),E=!0,setTimeout(()=>E=!1,I))}}function lb(v){v(rp)}var fh={},Fv=!1;function cb(v,I){if(Fv||(fh=Ud(fh),Fv=!0),I===void 0)return fh[v];fh[v]=I,typeof I=="object"&&I!==null&&I.hasOwnProperty("init")&&typeof I.init=="function"&&fh[v].init(),ux(fh[v])}function ub(){return fh}var Rx={};function hb(v,I){Rx[v]=typeof I!="function"?()=>I:I}function db(v){return Object.entries(Rx).forEach(([I,E])=>{Object.defineProperty(v,I,{get(){return(...L)=>E(...L)}})}),v}var Bx={};function fb(v,I){Bx[v]=I}function pb(v,I){return Object.entries(Bx).forEach(([E,L])=>{Object.defineProperty(v,E,{get(){return(...B)=>L.bind(I)(...B)},enumerable:!1})}),v}var mb={get reactive(){return Ud},get release(){return Xm},get effect(){return ep},get raw(){return ix},version:"3.10.0",flushAndStopDeferringMutations:A1,dontAutoEvaluateFunctions:M1,disableEffectScheduling:m1,setReactivityEngine:_1,closestDataStack:Rd,skipDuringClone:Jm,addRootSelector:Mx,addInitSelector:Cx,addScopeToNode:tp,deferMutations:E1,mapAttributes:Gy,evaluateLater:fs,setEvaluator:C1,mergeProxies:ip,findClosest:Km,closestRoot:Hm,interceptor:hx,transition:Sy,setStyles:Ym,mutateDom:mo,directive:Zn,throttle:Ox,debounce:Lx,evaluate:Od,initTree:bu,nextTick:Ex,prefixed:Nd,prefix:D1,plugin:lb,magic:Pl,store:cb,start:N1,clone:K1,bound:ab,$data:cx,data:fb,bind:hb},rp=mb;function _b(v,I){const E=Object.create(null),L=v.split(",");for(let B=0;B<L.length;B++)E[L[B]]=!0;return I?B=>!!E[B.toLowerCase()]:B=>!!E[B]}var gb={},Fx=Object.assign,yb=Object.prototype.hasOwnProperty,Qm=(v,I)=>yb.call(v,I),gh=Array.isArray,Nm=v=>Ux(v)==="[object Map]",vb=v=>typeof v=="string",Wy=v=>typeof v=="symbol",e_=v=>v!==null&&typeof v=="object",xb=Object.prototype.toString,Ux=v=>xb.call(v),bb=v=>Ux(v).slice(8,-1),Xy=v=>vb(v)&&v!=="NaN"&&v[0]!=="-"&&""+parseInt(v,10)===v,Nx=(v,I)=>v!==I&&(v===v||I===I),My=new WeakMap,Xf=[],mh,yh=Symbol(""),Cy=Symbol("");function wb(v){return v&&v._isEffect===!0}function Tb(v,I=gb){wb(v)&&(v=v.raw);const E=Sb(v,I);return I.lazy||E(),E}function Eb(v){v.active&&(jx(v),v.options.onStop&&v.options.onStop(),v.active=!1)}var Ab=0;function Sb(v,I){const E=function(){if(!E.active)return v();if(!Xf.includes(E)){jx(E);try{return Mb(),Xf.push(E),mh=E,v()}finally{Xf.pop(),Vx(),mh=Xf[Xf.length-1]}}};return E.id=Ab++,E.allowRecurse=!!I.allowRecurse,E._isEffect=!0,E.active=!0,E.raw=v,E.deps=[],E.options=I,E}function jx(v){const{deps:I}=v;if(I.length){for(let E=0;E<I.length;E++)I[E].delete(v);I.length=0}}var Fd=!0,Hy=[];function Ib(){Hy.push(Fd),Fd=!1}function Mb(){Hy.push(Fd),Fd=!0}function Vx(){const v=Hy.pop();Fd=v===void 0?!0:v}function Cl(v,I,E){if(!Fd||mh===void 0)return;let L=My.get(v);L||My.set(v,L=new Map);let B=L.get(E);B||L.set(E,B=new Set),B.has(mh)||(B.add(mh),mh.deps.push(B))}function wu(v,I,E,L,B,U){const q=My.get(v);if(!q)return;const o=new Set,Q=Ce=>{Ce&&Ce.forEach(ce=>{(ce!==mh||ce.allowRecurse)&&o.add(ce)})};if(I==="clear")q.forEach(Q);else if(E==="length"&&gh(v))q.forEach((Ce,ce)=>{(ce==="length"||ce>=L)&&Q(Ce)});else switch(E!==void 0&&Q(q.get(E)),I){case"add":gh(v)?Xy(E)&&Q(q.get("length")):(Q(q.get(yh)),Nm(v)&&Q(q.get(Cy)));break;case"delete":gh(v)||(Q(q.get(yh)),Nm(v)&&Q(q.get(Cy)));break;case"set":Nm(v)&&Q(q.get(yh));break}const me=Ce=>{Ce.options.scheduler?Ce.options.scheduler(Ce):Ce()};o.forEach(me)}var Cb=_b("__proto__,__v_isRef,__isVue"),Gx=new Set(Object.getOwnPropertyNames(Symbol).map(v=>Symbol[v]).filter(Wy)),Pb=t_(),zb=t_(!1,!0),kb=t_(!0),Db=t_(!0,!0),Gm={};["includes","indexOf","lastIndexOf"].forEach(v=>{const I=Array.prototype[v];Gm[v]=function(...E){const L=bn(this);for(let U=0,q=this.length;U<q;U++)Cl(L,"get",U+"");const B=I.apply(L,E);return B===-1||B===!1?I.apply(L,E.map(bn)):B}});["push","pop","shift","unshift","splice"].forEach(v=>{const I=Array.prototype[v];Gm[v]=function(...E){Ib();const L=I.apply(this,E);return Vx(),L}});function t_(v=!1,I=!1){return function(L,B,U){if(B==="__v_isReactive")return!v;if(B==="__v_isReadonly")return v;if(B==="__v_raw"&&U===(v?I?Gb:r0:I?Vb:i0).get(L))return L;const q=gh(L);if(!v&&q&&Qm(Gm,B))return Reflect.get(Gm,B,U);const o=Reflect.get(L,B,U);return(Wy(B)?Gx.has(B):Cb(B))||(v||Cl(L,"get",B),I)?o:Py(o)?!q||!Xy(B)?o.value:o:e_(o)?v?n0(o):Qy(o):o}}var Lb=$x(),Ob=$x(!0);function $x(v=!1){return function(E,L,B,U){let q=E[L];if(!v&&(B=bn(B),q=bn(q),!gh(E)&&Py(q)&&!Py(B)))return q.value=B,!0;const o=gh(E)&&Xy(L)?Number(L)<E.length:Qm(E,L),Q=Reflect.set(E,L,B,U);return E===bn(U)&&(o?Nx(B,q)&&wu(E,"set",L,B):wu(E,"add",L,B)),Q}}function Rb(v,I){const E=Qm(v,I);v[I];const L=Reflect.deleteProperty(v,I);return L&&E&&wu(v,"delete",I,void 0),L}function Bb(v,I){const E=Reflect.has(v,I);return(!Wy(I)||!Gx.has(I))&&Cl(v,"has",I),E}function Fb(v){return Cl(v,"iterate",gh(v)?"length":yh),Reflect.ownKeys(v)}var qx={get:Pb,set:Lb,deleteProperty:Rb,has:Bb,ownKeys:Fb},Zx={get:kb,set(v,I){return!0},deleteProperty(v,I){return!0}};Fx({},qx,{get:zb,set:Ob});Fx({},Zx,{get:Db});var Ky=v=>e_(v)?Qy(v):v,Yy=v=>e_(v)?n0(v):v,Jy=v=>v,i_=v=>Reflect.getPrototypeOf(v);function r_(v,I,E=!1,L=!1){v=v.__v_raw;const B=bn(v),U=bn(I);I!==U&&!E&&Cl(B,"get",I),!E&&Cl(B,"get",U);const{has:q}=i_(B),o=L?Jy:E?Yy:Ky;if(q.call(B,I))return o(v.get(I));if(q.call(B,U))return o(v.get(U));v!==B&&v.get(I)}function n_(v,I=!1){const E=this.__v_raw,L=bn(E),B=bn(v);return v!==B&&!I&&Cl(L,"has",v),!I&&Cl(L,"has",B),v===B?E.has(v):E.has(v)||E.has(B)}function o_(v,I=!1){return v=v.__v_raw,!I&&Cl(bn(v),"iterate",yh),Reflect.get(v,"size",v)}function Wx(v){v=bn(v);const I=bn(this);return i_(I).has.call(I,v)||(I.add(v),wu(I,"add",v,v)),this}function Xx(v,I){I=bn(I);const E=bn(this),{has:L,get:B}=i_(E);let U=L.call(E,v);U||(v=bn(v),U=L.call(E,v));const q=B.call(E,v);return E.set(v,I),U?Nx(I,q)&&wu(E,"set",v,I):wu(E,"add",v,I),this}function Hx(v){const I=bn(this),{has:E,get:L}=i_(I);let B=E.call(I,v);B||(v=bn(v),B=E.call(I,v)),L&&L.call(I,v);const U=I.delete(v);return B&&wu(I,"delete",v,void 0),U}function Kx(){const v=bn(this),I=v.size!==0,E=v.clear();return I&&wu(v,"clear",void 0,void 0),E}function s_(v,I){return function(L,B){const U=this,q=U.__v_raw,o=bn(q),Q=I?Jy:v?Yy:Ky;return!v&&Cl(o,"iterate",yh),q.forEach((me,Ce)=>L.call(B,Q(me),Q(Ce),U))}}function Rm(v,I,E){return function(...L){const B=this.__v_raw,U=bn(B),q=Nm(U),o=v==="entries"||v===Symbol.iterator&&q,Q=v==="keys"&&q,me=B[v](...L),Ce=E?Jy:I?Yy:Ky;return!I&&Cl(U,"iterate",Q?Cy:yh),{next(){const{value:ce,done:Ue}=me.next();return Ue?{value:ce,done:Ue}:{value:o?[Ce(ce[0]),Ce(ce[1])]:Ce(ce),done:Ue}},[Symbol.iterator](){return this}}}}function xu(v){return function(...I){return v==="delete"?!1:this}}var Yx={get(v){return r_(this,v)},get size(){return o_(this)},has:n_,add:Wx,set:Xx,delete:Hx,clear:Kx,forEach:s_(!1,!1)},Jx={get(v){return r_(this,v,!1,!0)},get size(){return o_(this)},has:n_,add:Wx,set:Xx,delete:Hx,clear:Kx,forEach:s_(!1,!0)},Qx={get(v){return r_(this,v,!0)},get size(){return o_(this,!0)},has(v){return n_.call(this,v,!0)},add:xu("add"),set:xu("set"),delete:xu("delete"),clear:xu("clear"),forEach:s_(!0,!1)},e0={get(v){return r_(this,v,!0,!0)},get size(){return o_(this,!0)},has(v){return n_.call(this,v,!0)},add:xu("add"),set:xu("set"),delete:xu("delete"),clear:xu("clear"),forEach:s_(!0,!0)},Ub=["keys","values","entries",Symbol.iterator];Ub.forEach(v=>{Yx[v]=Rm(v,!1,!1),Qx[v]=Rm(v,!0,!1),Jx[v]=Rm(v,!1,!0),e0[v]=Rm(v,!0,!0)});function t0(v,I){const E=I?v?e0:Jx:v?Qx:Yx;return(L,B,U)=>B==="__v_isReactive"?!v:B==="__v_isReadonly"?v:B==="__v_raw"?L:Reflect.get(Qm(E,B)&&B in L?E:L,B,U)}var Nb={get:t0(!1,!1)},jb={get:t0(!0,!1)},i0=new WeakMap,Vb=new WeakMap,r0=new WeakMap,Gb=new WeakMap;function $b(v){switch(v){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function qb(v){return v.__v_skip||!Object.isExtensible(v)?0:$b(bb(v))}function Qy(v){return v&&v.__v_isReadonly?v:o0(v,!1,qx,Nb,i0)}function n0(v){return o0(v,!0,Zx,jb,r0)}function o0(v,I,E,L,B){if(!e_(v)||v.__v_raw&&!(I&&v.__v_isReactive))return v;const U=B.get(v);if(U)return U;const q=qb(v);if(q===0)return v;const o=new Proxy(v,q===2?L:E);return B.set(v,o),o}function bn(v){return v&&bn(v.__v_raw)||v}function Py(v){return Boolean(v&&v.__v_isRef===!0)}Pl("nextTick",()=>Ex);Pl("dispatch",v=>Yf.bind(Yf,v));Pl("watch",(v,{evaluateLater:I,effect:E})=>(L,B)=>{let U=I(L),q=!0,o,Q=E(()=>U(me=>{JSON.stringify(me),q?o=me:queueMicrotask(()=>{B(me,o),o=me}),q=!1}));v._x_effects.delete(Q)});Pl("store",ub);Pl("data",v=>cx(v));Pl("root",v=>Hm(v));Pl("refs",v=>(v._x_refs_proxy||(v._x_refs_proxy=ip(Zb(v))),v._x_refs_proxy));function Zb(v){let I=[],E=v;for(;E;)E._x_refs&&I.push(E._x_refs),E=E.parentNode;return I}var hy={};function s0(v){return hy[v]||(hy[v]=0),++hy[v]}function Wb(v,I){return Km(v,E=>{if(E._x_ids&&E._x_ids[I])return!0})}function Xb(v,I){v._x_ids||(v._x_ids={}),v._x_ids[I]||(v._x_ids[I]=s0(I))}Pl("id",v=>(I,E=null)=>{let L=Wb(v,I),B=L?L._x_ids[I]:s0(I);return E?`${I}-${B}-${E}`:`${I}-${B}`});Pl("el",v=>v);a0("Focus","focus","focus");a0("Persist","persist","persist");function a0(v,I,E){Pl(I,L=>Bd(`You can't use [$${directiveName}] without first installing the "${v}" plugin here: https://alpinejs.dev/plugins/${E}`,L))}Zn("modelable",(v,{expression:I},{effect:E,evaluateLater:L})=>{let B=L(I),U=()=>{let me;return B(Ce=>me=Ce),me},q=L(`${I} = __placeholder`),o=me=>q(()=>{},{scope:{__placeholder:me}}),Q=U();o(Q),queueMicrotask(()=>{if(!v._x_model)return;v._x_removeModelListeners.default();let me=v._x_model.get,Ce=v._x_model.set;E(()=>o(me())),E(()=>Ce(U()))})});Zn("teleport",(v,{expression:I},{cleanup:E})=>{v.tagName.toLowerCase()!=="template"&&Bd("x-teleport can only be used on a <template> tag",v);let L=document.querySelector(I);L||Bd(`Cannot find x-teleport element for selector: "${I}"`);let B=v.content.cloneNode(!0).firstElementChild;v._x_teleport=B,B._x_teleportBack=v,v._x_forwardEvents&&v._x_forwardEvents.forEach(U=>{B.addEventListener(U,q=>{q.stopPropagation(),v.dispatchEvent(new q.constructor(q.type,q))})}),tp(B,{},v),mo(()=>{L.appendChild(B),bu(B),B._x_ignore=!0}),E(()=>B.remove())});var l0=()=>{};l0.inline=(v,{modifiers:I},{cleanup:E})=>{I.includes("self")?v._x_ignoreSelf=!0:v._x_ignore=!0,E(()=>{I.includes("self")?delete v._x_ignoreSelf:delete v._x_ignore})};Zn("ignore",l0);Zn("effect",(v,{expression:I},{effect:E})=>E(fs(v,I)));function c0(v,I,E,L){let B=v,U=Q=>L(Q),q={},o=(Q,me)=>Ce=>me(Q,Ce);if(E.includes("dot")&&(I=Hb(I)),E.includes("camel")&&(I=Kb(I)),E.includes("passive")&&(q.passive=!0),E.includes("capture")&&(q.capture=!0),E.includes("window")&&(B=window),E.includes("document")&&(B=document),E.includes("prevent")&&(U=o(U,(Q,me)=>{me.preventDefault(),Q(me)})),E.includes("stop")&&(U=o(U,(Q,me)=>{me.stopPropagation(),Q(me)})),E.includes("self")&&(U=o(U,(Q,me)=>{me.target===v&&Q(me)})),(E.includes("away")||E.includes("outside"))&&(B=document,U=o(U,(Q,me)=>{v.contains(me.target)||me.target.isConnected!==!1&&(v.offsetWidth<1&&v.offsetHeight<1||v._x_isShown!==!1&&Q(me))})),E.includes("once")&&(U=o(U,(Q,me)=>{Q(me),B.removeEventListener(I,U,q)})),U=o(U,(Q,me)=>{Jb(I)&&Qb(me,E)||Q(me)}),E.includes("debounce")){let Q=E[E.indexOf("debounce")+1]||"invalid-wait",me=zy(Q.split("ms")[0])?Number(Q.split("ms")[0]):250;U=Lx(U,me)}if(E.includes("throttle")){let Q=E[E.indexOf("throttle")+1]||"invalid-wait",me=zy(Q.split("ms")[0])?Number(Q.split("ms")[0]):250;U=Ox(U,me)}return B.addEventListener(I,U,q),()=>{B.removeEventListener(I,U,q)}}function Hb(v){return v.replace(/-/g,".")}function Kb(v){return v.toLowerCase().replace(/-(\w)/g,(I,E)=>E.toUpperCase())}function zy(v){return!Array.isArray(v)&&!isNaN(v)}function Yb(v){return v.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase()}function Jb(v){return["keydown","keyup"].includes(v)}function Qb(v,I){let E=I.filter(U=>!["window","document","prevent","stop","once"].includes(U));if(E.includes("debounce")){let U=E.indexOf("debounce");E.splice(U,zy((E[U+1]||"invalid-wait").split("ms")[0])?2:1)}if(E.length===0||E.length===1&&Uv(v.key).includes(E[0]))return!1;const B=["ctrl","shift","alt","meta","cmd","super"].filter(U=>E.includes(U));return E=E.filter(U=>!B.includes(U)),!(B.length>0&&B.filter(q=>((q==="cmd"||q==="super")&&(q="meta"),v[`${q}Key`])).length===B.length&&Uv(v.key).includes(E[0]))}function Uv(v){if(!v)return[];v=Yb(v);let I={ctrl:"control",slash:"/",space:"-",spacebar:"-",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",equal:"="};return I[v]=v,Object.keys(I).map(E=>{if(I[E]===v)return E}).filter(E=>E)}Zn("model",(v,{modifiers:I,expression:E},{effect:L,cleanup:B})=>{let U=fs(v,E),q=`${E} = rightSideOfExpression($event, ${E})`,o=fs(v,q);var Q=v.tagName.toLowerCase()==="select"||["checkbox","radio"].includes(v.type)||I.includes("lazy")?"change":"input";let me=ew(v,I,E),Ce=c0(v,Q,I,Ue=>{o(()=>{},{scope:{$event:Ue,rightSideOfExpression:me}})});v._x_removeModelListeners||(v._x_removeModelListeners={}),v._x_removeModelListeners.default=Ce,B(()=>v._x_removeModelListeners.default());let ce=fs(v,`${E} = __placeholder`);v._x_model={get(){let Ue;return U(We=>Ue=We),Ue},set(Ue){ce(()=>{},{scope:{__placeholder:Ue}})}},v._x_forceModelUpdate=()=>{U(Ue=>{Ue===void 0&&E.match(/\./)&&(Ue=""),window.fromModel=!0,mo(()=>kx(v,"value",Ue)),delete window.fromModel})},L(()=>{I.includes("unintrusive")&&document.activeElement.isSameNode(v)||v._x_forceModelUpdate()})});function ew(v,I,E){return v.type==="radio"&&mo(()=>{v.hasAttribute("name")||v.setAttribute("name",E)}),(L,B)=>mo(()=>{if(L instanceof CustomEvent&&L.detail!==void 0)return L.detail||L.target.value;if(v.type==="checkbox")if(Array.isArray(B)){let U=I.includes("number")?dy(L.target.value):L.target.value;return L.target.checked?B.concat([U]):B.filter(q=>!tw(q,U))}else return L.target.checked;else{if(v.tagName.toLowerCase()==="select"&&v.multiple)return I.includes("number")?Array.from(L.target.selectedOptions).map(U=>{let q=U.value||U.text;return dy(q)}):Array.from(L.target.selectedOptions).map(U=>U.value||U.text);{let U=L.target.value;return I.includes("number")?dy(U):I.includes("trim")?U.trim():U}}})}function dy(v){let I=v?parseFloat(v):null;return iw(I)?I:v}function tw(v,I){return v==I}function iw(v){return!Array.isArray(v)&&!isNaN(v)}Zn("cloak",v=>queueMicrotask(()=>mo(()=>v.removeAttribute(Nd("cloak")))));Cx(()=>`[${Nd("init")}]`);Zn("init",Jm((v,{expression:I},{evaluate:E})=>typeof I=="string"?!!I.trim()&&E(I,{},!1):E(I,{},!1)));Zn("text",(v,{expression:I},{effect:E,evaluateLater:L})=>{let B=L(I);E(()=>{B(U=>{mo(()=>{v.textContent=U})})})});Zn("html",(v,{expression:I},{effect:E,evaluateLater:L})=>{let B=L(I);E(()=>{B(U=>{mo(()=>{v.innerHTML=U,v._x_ignoreSelf=!0,bu(v),delete v._x_ignoreSelf})})})});Gy(yx(":",vx(Nd("bind:"))));Zn("bind",(v,{value:I,modifiers:E,expression:L,original:B},{effect:U})=>{if(!I)return rw(v,L,B);if(I==="key")return nw(v,L);let q=fs(v,L);U(()=>q(o=>{o===void 0&&L.match(/\./)&&(o=""),mo(()=>kx(v,I,o,E))}))});function rw(v,I,E,L){let B={};db(B);let U=fs(v,I),q=[];for(;q.length;)q.pop()();U(o=>{let Q=Object.entries(o).map(([Ce,ce])=>({name:Ce,value:ce})),me=L1(Q);Q=Q.map(Ce=>me.find(ce=>ce.name===Ce.name)?{name:`x-bind:${Ce.name}`,value:`"${Ce.value}"`}:Ce),Vy(v,Q,E).map(Ce=>{q.push(Ce.runCleanups),Ce()})},{scope:B})}function nw(v,I){v._x_keyExpression=I}Mx(()=>`[${Nd("data")}]`);Zn("data",Jm((v,{expression:I},{cleanup:E})=>{I=I===""?"{}":I;let L={};xy(L,v);let B={};pb(B,L);let U=Od(v,I,{scope:B});U===void 0&&(U={}),xy(U,v);let q=Ud(U);ux(q);let o=tp(v,q);q.init&&Od(v,q.init),E(()=>{q.destroy&&Od(v,q.destroy),o()})}));Zn("show",(v,{modifiers:I,expression:E},{effect:L})=>{let B=fs(v,E);v._x_doHide||(v._x_doHide=()=>{mo(()=>v.style.display="none")}),v._x_doShow||(v._x_doShow=()=>{mo(()=>{v.style.length===1&&v.style.display==="none"?v.removeAttribute("style"):v.style.removeProperty("display")})});let U=()=>{v._x_doHide(),v._x_isShown=!1},q=()=>{v._x_doShow(),v._x_isShown=!0},o=()=>setTimeout(q),Q=Ay(ce=>ce?q():U(),ce=>{typeof v._x_toggleAndCascadeWithTransitions=="function"?v._x_toggleAndCascadeWithTransitions(v,ce,q,U):ce?o():U()}),me,Ce=!0;L(()=>B(ce=>{!Ce&&ce===me||(I.includes("immediate")&&(ce?o():U()),Q(ce),me=ce,Ce=!1)}))});Zn("for",(v,{expression:I},{effect:E,cleanup:L})=>{let B=sw(I),U=fs(v,B.items),q=fs(v,v._x_keyExpression||"index");v._x_prevKeys=[],v._x_lookup={},E(()=>ow(v,B,U,q)),L(()=>{Object.values(v._x_lookup).forEach(o=>o.remove()),delete v._x_prevKeys,delete v._x_lookup})});function ow(v,I,E,L){let B=q=>typeof q=="object"&&!Array.isArray(q),U=v;E(q=>{aw(q)&&q>=0&&(q=Array.from(Array(q).keys(),Ze=>Ze+1)),q===void 0&&(q=[]);let o=v._x_lookup,Q=v._x_prevKeys,me=[],Ce=[];if(B(q))q=Object.entries(q).map(([Ze,Ie])=>{let je=Nv(I,Ie,Ze,q);L(Oe=>Ce.push(Oe),{scope:{index:Ze,...je}}),me.push(je)});else for(let Ze=0;Ze<q.length;Ze++){let Ie=Nv(I,q[Ze],Ze,q);L(je=>Ce.push(je),{scope:{index:Ze,...Ie}}),me.push(Ie)}let ce=[],Ue=[],We=[],ot=[];for(let Ze=0;Ze<Q.length;Ze++){let Ie=Q[Ze];Ce.indexOf(Ie)===-1&&We.push(Ie)}Q=Q.filter(Ze=>!We.includes(Ze));let it="template";for(let Ze=0;Ze<Ce.length;Ze++){let Ie=Ce[Ze],je=Q.indexOf(Ie);if(je===-1)Q.splice(Ze,0,Ie),ce.push([it,Ze]);else if(je!==Ze){let Oe=Q.splice(Ze,1)[0],qe=Q.splice(je-1,1)[0];Q.splice(Ze,0,qe),Q.splice(je,0,Oe),Ue.push([Oe,qe])}else ot.push(Ie);it=Ie}for(let Ze=0;Ze<We.length;Ze++){let Ie=We[Ze];o[Ie]._x_effects&&o[Ie]._x_effects.forEach(tx),o[Ie].remove(),o[Ie]=null,delete o[Ie]}for(let Ze=0;Ze<Ue.length;Ze++){let[Ie,je]=Ue[Ze],Oe=o[Ie],qe=o[je],Ye=document.createElement("div");mo(()=>{qe.after(Ye),Oe.after(qe),qe._x_currentIfEl&&qe.after(qe._x_currentIfEl),Ye.before(Oe),Oe._x_currentIfEl&&Oe.after(Oe._x_currentIfEl),Ye.remove()}),Ov(qe,me[Ce.indexOf(je)])}for(let Ze=0;Ze<ce.length;Ze++){let[Ie,je]=ce[Ze],Oe=Ie==="template"?U:o[Ie];Oe._x_currentIfEl&&(Oe=Oe._x_currentIfEl);let qe=me[je],Ye=Ce[je],ci=document.importNode(U.content,!0).firstElementChild;tp(ci,Ud(qe),U),mo(()=>{Oe.after(ci),bu(ci)}),typeof Ye=="object"&&Bd("x-for key cannot be an object, it must be a string or an integer",U),o[Ye]=ci}for(let Ze=0;Ze<ot.length;Ze++)Ov(o[ot[Ze]],me[Ce.indexOf(ot[Ze])]);U._x_prevKeys=Ce})}function sw(v){let I=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,E=/^\s*\(|\)\s*$/g,L=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,B=v.match(L);if(!B)return;let U={};U.items=B[2].trim();let q=B[1].replace(E,"").trim(),o=q.match(I);return o?(U.item=q.replace(I,"").trim(),U.index=o[1].trim(),o[2]&&(U.collection=o[2].trim())):U.item=q,U}function Nv(v,I,E,L){let B={};return/^\[.*\]$/.test(v.item)&&Array.isArray(I)?v.item.replace("[","").replace("]","").split(",").map(q=>q.trim()).forEach((q,o)=>{B[q]=I[o]}):/^\{.*\}$/.test(v.item)&&!Array.isArray(I)&&typeof I=="object"?v.item.replace("{","").replace("}","").split(",").map(q=>q.trim()).forEach(q=>{B[q]=I[q]}):B[v.item]=I,v.index&&(B[v.index]=E),v.collection&&(B[v.collection]=L),B}function aw(v){return!Array.isArray(v)&&!isNaN(v)}function u0(){}u0.inline=(v,{expression:I},{cleanup:E})=>{let L=Hm(v);L._x_refs||(L._x_refs={}),L._x_refs[I]=v,E(()=>delete L._x_refs[I])};Zn("ref",u0);Zn("if",(v,{expression:I},{effect:E,cleanup:L})=>{let B=fs(v,I),U=()=>{if(v._x_currentIfEl)return v._x_currentIfEl;let o=v.content.cloneNode(!0).firstElementChild;return tp(o,{},v),mo(()=>{v.after(o),bu(o)}),v._x_currentIfEl=o,v._x_undoIf=()=>{vh(o,Q=>{Q._x_effects&&Q._x_effects.forEach(tx)}),o.remove(),delete v._x_currentIfEl},o},q=()=>{!v._x_undoIf||(v._x_undoIf(),delete v._x_undoIf)};E(()=>B(o=>{o?U():q()})),L(()=>v._x_undoIf&&v._x_undoIf())});Zn("id",(v,{expression:I},{evaluate:E})=>{E(I).forEach(B=>Xb(v,B))});Gy(yx("@",vx(Nd("on:"))));Zn("on",Jm((v,{value:I,modifiers:E,expression:L},{cleanup:B})=>{let U=L?fs(v,L):()=>{};v.tagName.toLowerCase()==="template"&&(v._x_forwardEvents||(v._x_forwardEvents=[]),v._x_forwardEvents.includes(I)||v._x_forwardEvents.push(I));let q=c0(v,I,E,o=>{U(()=>{},{scope:{$event:o},params:[o]})});B(()=>q())}));a_("Collapse","collapse","collapse");a_("Intersect","intersect","intersect");a_("Focus","trap","focus");a_("Mask","mask","mask");function a_(v,I,E){Zn(I,L=>Bd(`You can't use [x-${I}] without first installing the "${v}" plugin here: https://alpinejs.dev/plugins/${E}`,L))}rp.setEvaluator(px);rp.setReactivityEngine({reactive:Qy,effect:Tb,release:Eb,raw:bn});var lw=rp,h0=lw;(()=>{function v(M){return B(M)||L(M)||E(M)||I()}function I(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E(M,D){if(!!M){if(typeof M=="string")return U(M,D);var R=Object.prototype.toString.call(M).slice(8,-1);if(R==="Object"&&M.constructor&&(R=M.constructor.name),R==="Map"||R==="Set")return Array.from(M);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return U(M,D)}}function L(M){if(typeof Symbol<"u"&&M[Symbol.iterator]!=null||M["@@iterator"]!=null)return Array.from(M)}function B(M){if(Array.isArray(M))return U(M)}function U(M,D){(D==null||D>M.length)&&(D=M.length);for(var R=0,W=new Array(D);R<D;R++)W[R]=M[R];return W}function q(M,D){var R=Object.keys(M);if(Object.getOwnPropertySymbols){var W=Object.getOwnPropertySymbols(M);D&&(W=W.filter(function(Re){return Object.getOwnPropertyDescriptor(M,Re).enumerable})),R.push.apply(R,W)}return R}function o(M){for(var D=1;D<arguments.length;D++){var R=arguments[D]!=null?arguments[D]:{};D%2?q(Object(R),!0).forEach(function(W){Q(M,W,R[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(R)):q(Object(R)).forEach(function(W){Object.defineProperty(M,W,Object.getOwnPropertyDescriptor(R,W))})}return M}function Q(M,D,R){return D in M?Object.defineProperty(M,D,{value:R,enumerable:!0,configurable:!0,writable:!0}):M[D]=R,M}function me(M,D){if(!(M instanceof D))throw new TypeError("Cannot call a class as a function")}function Ce(M,D){for(var R=0;R<D.length;R++){var W=D[R];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(M,W.key,W)}}function ce(M,D,R){return D&&Ce(M.prototype,D),R&&Ce(M,R),Object.defineProperty(M,"prototype",{writable:!1}),M}var Ue={alwaysOpen:!1,activeClasses:"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white",inactiveClasses:"text-gray-500 dark:text-gray-400",onOpen:function(){},onClose:function(){},onToggle:function(){}},We=function(){function M(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};me(this,M),this._items=D,this._options=o(o({},Ue),R),this._init()}return ce(M,[{key:"_init",value:function(){var R=this;this._items.length&&this._items.map(function(W){W.active&&R.open(W.id),W.triggerEl.addEventListener("click",function(){R.toggle(W.id)})})}},{key:"getItem",value:function(R){return this._items.filter(function(W){return W.id===R})[0]}},{key:"open",value:function(R){var W=this,Re,Je,yt=this.getItem(R);this._options.alwaysOpen||this._items.map(function(_t){if(_t!==yt){var Pt,qt;(Pt=_t.triggerEl.classList).remove.apply(Pt,v(W._options.activeClasses.split(" "))),(qt=_t.triggerEl.classList).add.apply(qt,v(W._options.inactiveClasses.split(" "))),_t.targetEl.classList.add("hidden"),_t.triggerEl.setAttribute("aria-expanded",!1),_t.active=!1,_t.iconEl&&_t.iconEl.classList.remove("rotate-180")}}),(Re=yt.triggerEl.classList).add.apply(Re,v(this._options.activeClasses.split(" "))),(Je=yt.triggerEl.classList).remove.apply(Je,v(this._options.inactiveClasses.split(" "))),yt.triggerEl.setAttribute("aria-expanded",!0),yt.targetEl.classList.remove("hidden"),yt.active=!0,yt.iconEl&&yt.iconEl.classList.add("rotate-180"),this._options.onOpen(this,yt)}},{key:"toggle",value:function(R){var W=this.getItem(R);W.active?this.close(R):this.open(R),this._options.onToggle(this,W)}},{key:"close",value:function(R){var W,Re,Je=this.getItem(R);(W=Je.triggerEl.classList).remove.apply(W,v(this._options.activeClasses.split(" "))),(Re=Je.triggerEl.classList).add.apply(Re,v(this._options.inactiveClasses.split(" "))),Je.targetEl.classList.add("hidden"),Je.triggerEl.setAttribute("aria-expanded",!1),Je.active=!1,Je.iconEl&&Je.iconEl.classList.remove("rotate-180"),this._options.onClose(this,Je)}}]),M}();window.Accordion=We,document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-accordion]").forEach(function(M){var D=M.getAttribute("data-accordion"),R=M.getAttribute("data-active-classes"),W=M.getAttribute("data-inactive-classes"),Re=[];M.querySelectorAll("[data-accordion-target]").forEach(function(Je){var yt={id:Je.getAttribute("data-accordion-target"),triggerEl:Je,targetEl:document.querySelector(Je.getAttribute("data-accordion-target")),iconEl:Je.querySelector("[data-accordion-icon]"),active:Je.getAttribute("aria-expanded")==="true"};Re.push(yt)}),new We(Re,{alwaysOpen:D==="open",activeClasses:R||Ue.activeClasses,inactiveClasses:W||Ue.inactiveClasses})})});function ot(M,D){var R=Object.keys(M);if(Object.getOwnPropertySymbols){var W=Object.getOwnPropertySymbols(M);D&&(W=W.filter(function(Re){return Object.getOwnPropertyDescriptor(M,Re).enumerable})),R.push.apply(R,W)}return R}function it(M){for(var D=1;D<arguments.length;D++){var R=arguments[D]!=null?arguments[D]:{};D%2?ot(Object(R),!0).forEach(function(W){Ze(M,W,R[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(R)):ot(Object(R)).forEach(function(W){Object.defineProperty(M,W,Object.getOwnPropertyDescriptor(R,W))})}return M}function Ze(M,D,R){return D in M?Object.defineProperty(M,D,{value:R,enumerable:!0,configurable:!0,writable:!0}):M[D]=R,M}function Ie(M,D){if(!(M instanceof D))throw new TypeError("Cannot call a class as a function")}function je(M,D){for(var R=0;R<D.length;R++){var W=D[R];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(M,W.key,W)}}function Oe(M,D,R){return D&&je(M.prototype,D),R&&je(M,R),Object.defineProperty(M,"prototype",{writable:!1}),M}var qe={triggerEl:null,onCollapse:function(){},onExpand:function(){},onToggle:function(){}},Ye=function(){function M(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,R=arguments.length>1?arguments[1]:void 0;Ie(this,M),this._targetEl=D,this._triggerEl=R?R.triggerEl:qe.triggerEl,this._options=it(it({},qe),R),this._visible=!1,this._init()}return Oe(M,[{key:"_init",value:function(){var R=this;this._triggerEl&&(this._triggerEl.hasAttribute("aria-expanded")?this._visible=this._triggerEl.getAttribute("aria-expanded")==="true":this._visible=!this._targetEl.classList.contains("hidden"),this._triggerEl.addEventListener("click",function(){R._visible?R.collapse():R.expand()}))}},{key:"collapse",value:function(){this._targetEl.classList.add("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","false"),this._visible=!1,this._options.onCollapse(this)}},{key:"expand",value:function(){this._targetEl.classList.remove("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","true"),this._visible=!0,this._options.onExpand(this)}},{key:"toggle",value:function(){this._visible?this.collapse():this.expand()}}]),M}();window.Collapse=Ye,document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-collapse-toggle]").forEach(function(M){var D=document.getElementById(M.getAttribute("data-collapse-toggle"));new Ye(D,{triggerEl:M})})});function ci(M){return At(M)||bt(M)||xt(M)||Pi()}function Pi(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xt(M,D){if(!!M){if(typeof M=="string")return vt(M,D);var R=Object.prototype.toString.call(M).slice(8,-1);if(R==="Object"&&M.constructor&&(R=M.constructor.name),R==="Map"||R==="Set")return Array.from(M);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return vt(M,D)}}function bt(M){if(typeof Symbol<"u"&&M[Symbol.iterator]!=null||M["@@iterator"]!=null)return Array.from(M)}function At(M){if(Array.isArray(M))return vt(M)}function vt(M,D){(D==null||D>M.length)&&(D=M.length);for(var R=0,W=new Array(D);R<D;R++)W[R]=M[R];return W}function Yt(M,D){var R=Object.keys(M);if(Object.getOwnPropertySymbols){var W=Object.getOwnPropertySymbols(M);D&&(W=W.filter(function(Re){return Object.getOwnPropertyDescriptor(M,Re).enumerable})),R.push.apply(R,W)}return R}function ei(M){for(var D=1;D<arguments.length;D++){var R=arguments[D]!=null?arguments[D]:{};D%2?Yt(Object(R),!0).forEach(function(W){Ni(M,W,R[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(R)):Yt(Object(R)).forEach(function(W){Object.defineProperty(M,W,Object.getOwnPropertyDescriptor(R,W))})}return M}function Ni(M,D,R){return D in M?Object.defineProperty(M,D,{value:R,enumerable:!0,configurable:!0,writable:!0}):M[D]=R,M}function mr(M,D){if(!(M instanceof D))throw new TypeError("Cannot call a class as a function")}function wn(M,D){for(var R=0;R<D.length;R++){var W=D[R];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(M,W.key,W)}}function Dn(M,D,R){return D&&wn(M.prototype,D),R&&wn(M,R),Object.defineProperty(M,"prototype",{writable:!1}),M}var xr={defaultPosition:0,indicators:{items:[],activeClasses:"bg-white dark:bg-gray-800",inactiveClasses:"bg-white/50 dark:bg-gray-800/50 hover:bg-white dark:hover:bg-gray-800"},interval:3e3,onNext:function(){},onPrev:function(){},onChange:function(){}},ps=function(){function M(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};mr(this,M),this._items=D,this._options=ei(ei(ei({},xr),R),{},{indicators:ei(ei({},xr.indicators),R.indicators)}),this._activeItem=this.getItem(this._options.defaultPosition),this._indicators=this._options.indicators.items,this._interval=null,this._init()}return Dn(M,[{key:"_init",value:function(){var R=this;this._items.map(function(W){W.el.classList.add("absolute","inset-0","transition-all","transform")}),this._getActiveItem()?this.slideTo(this._getActiveItem().position):this.slideTo(0),this._indicators.map(function(W,Re){W.el.addEventListener("click",function(){R.slideTo(Re)})})}},{key:"getItem",value:function(R){return this._items[R]}},{key:"slideTo",value:function(R){var W=this._items[R],Re={left:W.position===0?this._items[this._items.length-1]:this._items[W.position-1],middle:W,right:W.position===this._items.length-1?this._items[0]:this._items[W.position+1]};this._rotate(Re),this._setActiveItem(W.position),this._interval&&(this.pause(),this.cycle()),this._options.onChange(this)}},{key:"next",value:function(){var R=this._getActiveItem(),W=null;R.position===this._items.length-1?W=this._items[0]:W=this._items[R.position+1],this.slideTo(W.position),this._options.onNext(this)}},{key:"prev",value:function(){var R=this._getActiveItem(),W=null;R.position===0?W=this._items[this._items.length-1]:W=this._items[R.position-1],this.slideTo(W.position),this._options.onPrev(this)}},{key:"_rotate",value:function(R){this._items.map(function(W){W.el.classList.add("hidden")}),R.left.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-20"),R.left.el.classList.add("-translate-x-full","z-10"),R.middle.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-10"),R.middle.el.classList.add("translate-x-0","z-20"),R.right.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-20"),R.right.el.classList.add("translate-x-full","z-10")}},{key:"cycle",value:function(){var R=this;this._interval=setInterval(function(){R.next()},this._options.interval)}},{key:"pause",value:function(){clearInterval(this._interval)}},{key:"_getActiveItem",value:function(){return this._activeItem}},{key:"_setActiveItem",value:function(R){var W=this;if(this._activeItem=this._items[R],this._indicators.length){var Re,Je;this._indicators.map(function(yt){var _t,Pt;yt.el.setAttribute("aria-current","false"),(_t=yt.el.classList).remove.apply(_t,ci(W._options.indicators.activeClasses.split(" "))),(Pt=yt.el.classList).add.apply(Pt,ci(W._options.indicators.inactiveClasses.split(" ")))}),(Re=this._indicators[R].el.classList).add.apply(Re,ci(this._options.indicators.activeClasses.split(" "))),(Je=this._indicators[R].el.classList).remove.apply(Je,ci(this._options.indicators.inactiveClasses.split(" "))),this._indicators[R].el.setAttribute("aria-current","true")}}}]),M}();window.Carousel=ps,document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-carousel]").forEach(function(M){var D=M.getAttribute("data-carousel-interval"),R=M.getAttribute("data-carousel")==="slide",W=[],Re=0;M.querySelectorAll("[data-carousel-item]").length&&ci(M.querySelectorAll("[data-carousel-item]")).map(function(qt,Lt){W.push({position:Lt,el:qt}),qt.getAttribute("data-carousel-item")==="active"&&(Re=Lt)});var Je=[];M.querySelectorAll("[data-carousel-slide-to]").length&&ci(M.querySelectorAll("[data-carousel-slide-to]")).map(function(qt){Je.push({position:qt.getAttribute("data-carousel-slide-to"),el:qt})});var yt=new ps(W,{defaultPosition:Re,indicators:{items:Je},interval:D||xr.interval});R&&yt.cycle();var _t=M.querySelector("[data-carousel-next]"),Pt=M.querySelector("[data-carousel-prev]");_t&&_t.addEventListener("click",function(){yt.next()}),Pt&&Pt.addEventListener("click",function(){yt.prev()})})});function pn(M,D){var R=Object.keys(M);if(Object.getOwnPropertySymbols){var W=Object.getOwnPropertySymbols(M);D&&(W=W.filter(function(Re){return Object.getOwnPropertyDescriptor(M,Re).enumerable})),R.push.apply(R,W)}return R}function Tn(M){for(var D=1;D<arguments.length;D++){var R=arguments[D]!=null?arguments[D]:{};D%2?pn(Object(R),!0).forEach(function(W){_r(M,W,R[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(R)):pn(Object(R)).forEach(function(W){Object.defineProperty(M,W,Object.getOwnPropertyDescriptor(R,W))})}return M}function _r(M,D,R){return D in M?Object.defineProperty(M,D,{value:R,enumerable:!0,configurable:!0,writable:!0}):M[D]=R,M}function mn(M,D){if(!(M instanceof D))throw new TypeError("Cannot call a class as a function")}function Ao(M,D){for(var R=0;R<D.length;R++){var W=D[R];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(M,W.key,W)}}function Zr(M,D,R){return D&&Ao(M.prototype,D),R&&Ao(M,R),Object.defineProperty(M,"prototype",{writable:!1}),M}var Wn={triggerEl:null,transition:"transition-opacity",duration:300,timing:"ease-out",onHide:function(){}},So=function(){function M(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};mn(this,M),this._targetEl=D,this._triggerEl=R?R.triggerEl:Wn.triggerEl,this._options=Tn(Tn({},Wn),R),this._init()}return Zr(M,[{key:"_init",value:function(){var R=this;this._triggerEl&&this._triggerEl.addEventListener("click",function(){R.hide()})}},{key:"hide",value:function(){var R=this;this._targetEl.classList.add(this._options.transition,"duration-".concat(this._options.duration),this._options.timing,"opacity-0"),setTimeout(function(){R._targetEl.classList.add("hidden")},this._options.duration),this._options.onHide(this,this._targetEl)}}]),M}();window.Dismiss=So,document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-dismiss-target]").forEach(function(M){var D=document.querySelector(M.getAttribute("data-dismiss-target"));new So(D,{triggerEl:M})})});function Pr(M){if(M==null)return window;if(M.toString()!=="[object Window]"){var D=M.ownerDocument;return D&&D.defaultView||window}return M}function Ln(M){var D=Pr(M).Element;return M instanceof D||M instanceof Element}function zr(M){var D=Pr(M).HTMLElement;return M instanceof D||M instanceof HTMLElement}function ms(M){if(typeof ShadowRoot>"u")return!1;var D=Pr(M).ShadowRoot;return M instanceof D||M instanceof ShadowRoot}var _n=Math.max,_o=Math.min,Kt=Math.round;function Wr(M,D){D===void 0&&(D=!1);var R=M.getBoundingClientRect(),W=1,Re=1;if(zr(M)&&D){var Je=M.offsetHeight,yt=M.offsetWidth;yt>0&&(W=Kt(R.width)/yt||1),Je>0&&(Re=Kt(R.height)/Je||1)}return{width:R.width/W,height:R.height/Re,top:R.top/Re,right:R.right/W,bottom:R.bottom/Re,left:R.left/W,x:R.left/W,y:R.top/Re}}function Wo(M){var D=Pr(M),R=D.pageXOffset,W=D.pageYOffset;return{scrollLeft:R,scrollTop:W}}function Xr(M){return{scrollLeft:M.scrollLeft,scrollTop:M.scrollTop}}function Xn(M){return M===Pr(M)||!zr(M)?Wo(M):Xr(M)}function En(M){return M?(M.nodeName||"").toLowerCase():null}function Qt(M){return((Ln(M)?M.ownerDocument:M.document)||window.document).documentElement}function kr(M){return Wr(Qt(M)).left+Wo(M).scrollLeft}function Er(M){return Pr(M).getComputedStyle(M)}function On(M){var D=Er(M),R=D.overflow,W=D.overflowX,Re=D.overflowY;return/auto|scroll|overlay|hidden/.test(R+Re+W)}function Zs(M){var D=M.getBoundingClientRect(),R=Kt(D.width)/M.offsetWidth||1,W=Kt(D.height)/M.offsetHeight||1;return R!==1||W!==1}function Io(M,D,R){R===void 0&&(R=!1);var W=zr(D),Re=zr(D)&&Zs(D),Je=Qt(D),yt=Wr(M,Re),_t={scrollLeft:0,scrollTop:0},Pt={x:0,y:0};return(W||!W&&!R)&&((En(D)!=="body"||On(Je))&&(_t=Xn(D)),zr(D)?(Pt=Wr(D,!0),Pt.x+=D.clientLeft,Pt.y+=D.clientTop):Je&&(Pt.x=kr(Je))),{x:yt.left+_t.scrollLeft-Pt.x,y:yt.top+_t.scrollTop-Pt.y,width:yt.width,height:yt.height}}function Ws(M){var D=Wr(M),R=M.offsetWidth,W=M.offsetHeight;return Math.abs(D.width-R)<=1&&(R=D.width),Math.abs(D.height-W)<=1&&(W=D.height),{x:M.offsetLeft,y:M.offsetTop,width:R,height:W}}function io(M){return En(M)==="html"?M:M.assignedSlot||M.parentNode||(ms(M)?M.host:null)||Qt(M)}function Fr(M){return["html","body","#document"].indexOf(En(M))>=0?M.ownerDocument.body:zr(M)&&On(M)?M:Fr(io(M))}function gn(M,D){var R;D===void 0&&(D=[]);var W=Fr(M),Re=W===((R=M.ownerDocument)==null?void 0:R.body),Je=Pr(W),yt=Re?[Je].concat(Je.visualViewport||[],On(W)?W:[]):W,_t=D.concat(yt);return Re?_t:_t.concat(gn(io(yt)))}function Xo(M){return["table","td","th"].indexOf(En(M))>=0}function Xs(M){return!zr(M)||Er(M).position==="fixed"?null:M.offsetParent}function An(M){var D=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,R=navigator.userAgent.indexOf("Trident")!==-1;if(R&&zr(M)){var W=Er(M);if(W.position==="fixed")return null}for(var Re=io(M);zr(Re)&&["html","body"].indexOf(En(Re))<0;){var Je=Er(Re);if(Je.transform!=="none"||Je.perspective!=="none"||Je.contain==="paint"||["transform","perspective"].indexOf(Je.willChange)!==-1||D&&Je.willChange==="filter"||D&&Je.filter&&Je.filter!=="none")return Re;Re=Re.parentNode}return null}function Sn(M){for(var D=Pr(M),R=Xs(M);R&&Xo(R)&&Er(R).position==="static";)R=Xs(R);return R&&(En(R)==="html"||En(R)==="body"&&Er(R).position==="static")?D:R||An(M)||D}var Ur="top",Hr="bottom",Kr="right",Dr="left",Hs="auto",_s=[Ur,Hr,Kr,Dr],Ho="start",gs="end",Ko="clippingParents",Mo="viewport",Co="popper",zl="reference",In=_s.reduce(function(M,D){return M.concat([D+"-"+Ho,D+"-"+gs])},[]),Ks=[].concat(_s,[Hs]).reduce(function(M,D){return M.concat([D,D+"-"+Ho,D+"-"+gs])},[]),oe="beforeRead",N="read",G="afterRead",ne="beforeMain",ue="main",be="afterMain",ze="beforeWrite",Me="write",Te="afterWrite",ke=[oe,N,G,ne,ue,be,ze,Me,Te];function nt(M){var D=new Map,R=new Set,W=[];M.forEach(function(Je){D.set(Je.name,Je)});function Re(Je){R.add(Je.name);var yt=[].concat(Je.requires||[],Je.requiresIfExists||[]);yt.forEach(function(_t){if(!R.has(_t)){var Pt=D.get(_t);Pt&&Re(Pt)}}),W.push(Je)}return M.forEach(function(Je){R.has(Je.name)||Re(Je)}),W}function Mt(M){var D=nt(M);return ke.reduce(function(R,W){return R.concat(D.filter(function(Re){return Re.phase===W}))},[])}function lt(M){var D;return function(){return D||(D=new Promise(function(R){Promise.resolve().then(function(){D=void 0,R(M())})})),D}}function $t(M){var D=M.reduce(function(R,W){var Re=R[W.name];return R[W.name]=Re?Object.assign({},Re,W,{options:Object.assign({},Re.options,W.options),data:Object.assign({},Re.data,W.data)}):W,R},{});return Object.keys(D).map(function(R){return D[R]})}var Vt={placement:"bottom",modifiers:[],strategy:"absolute"};function Ut(){for(var M=arguments.length,D=new Array(M),R=0;R<M;R++)D[R]=arguments[R];return!D.some(function(W){return!(W&&typeof W.getBoundingClientRect=="function")})}function Wt(M){M===void 0&&(M={});var D=M,R=D.defaultModifiers,W=R===void 0?[]:R,Re=D.defaultOptions,Je=Re===void 0?Vt:Re;return function(_t,Pt,qt){qt===void 0&&(qt=Je);var Lt={placement:"bottom",orderedModifiers:[],options:Object.assign({},Vt,Je),modifiersData:{},elements:{reference:_t,popper:Pt},attributes:{},styles:{}},Vi=[],Ar=!1,bi={state:Lt,setOptions:function(hr){var yr=typeof hr=="function"?hr(Lt.options):hr;mi(),Lt.options=Object.assign({},Je,Lt.options,yr),Lt.scrollParents={reference:Ln(_t)?gn(_t):_t.contextElement?gn(_t.contextElement):[],popper:gn(Pt)};var nr=Mt($t([].concat(W,Lt.options.modifiers)));return Lt.orderedModifiers=nr.filter(function(ki){return ki.enabled}),Hi(),bi.update()},forceUpdate:function(){if(!Ar){var hr=Lt.elements,yr=hr.reference,nr=hr.popper;if(!!Ut(yr,nr)){Lt.rects={reference:Io(yr,Sn(nr),Lt.options.strategy==="fixed"),popper:Ws(nr)},Lt.reset=!1,Lt.placement=Lt.options.placement,Lt.orderedModifiers.forEach(function(Be){return Lt.modifiersData[Be.name]=Object.assign({},Be.data)});for(var ki=0;ki<Lt.orderedModifiers.length;ki++){if(Lt.reset===!0){Lt.reset=!1,ki=-1;continue}var dr=Lt.orderedModifiers[ki],Ji=dr.fn,Gi=dr.options,Se=Gi===void 0?{}:Gi,Xe=dr.name;typeof Ji=="function"&&(Lt=Ji({state:Lt,options:Se,name:Xe,instance:bi})||Lt)}}}},update:lt(function(){return new Promise(function(Ti){bi.forceUpdate(),Ti(Lt)})}),destroy:function(){mi(),Ar=!0}};if(!Ut(_t,Pt))return bi;bi.setOptions(qt).then(function(Ti){!Ar&&qt.onFirstUpdate&&qt.onFirstUpdate(Ti)});function Hi(){Lt.orderedModifiers.forEach(function(Ti){var hr=Ti.name,yr=Ti.options,nr=yr===void 0?{}:yr,ki=Ti.effect;if(typeof ki=="function"){var dr=ki({state:Lt,name:hr,instance:bi,options:nr}),Ji=function(){};Vi.push(dr||Ji)}})}function mi(){Vi.forEach(function(Ti){return Ti()}),Vi=[]}return bi}}var oi={passive:!0};function ji(M){var D=M.state,R=M.instance,W=M.options,Re=W.scroll,Je=Re===void 0?!0:Re,yt=W.resize,_t=yt===void 0?!0:yt,Pt=Pr(D.elements.popper),qt=[].concat(D.scrollParents.reference,D.scrollParents.popper);return Je&&qt.forEach(function(Lt){Lt.addEventListener("scroll",R.update,oi)}),_t&&Pt.addEventListener("resize",R.update,oi),function(){Je&&qt.forEach(function(Lt){Lt.removeEventListener("scroll",R.update,oi)}),_t&&Pt.removeEventListener("resize",R.update,oi)}}const Zi={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:ji,data:{}};function xi(M){return M.split("-")[0]}function Ft(M){return M.split("-")[1]}function $e(M){return["top","bottom"].indexOf(M)>=0?"x":"y"}function sn(M){var D=M.reference,R=M.element,W=M.placement,Re=W?xi(W):null,Je=W?Ft(W):null,yt=D.x+D.width/2-R.width/2,_t=D.y+D.height/2-R.height/2,Pt;switch(Re){case Ur:Pt={x:yt,y:D.y-R.height};break;case Hr:Pt={x:yt,y:D.y+D.height};break;case Kr:Pt={x:D.x+D.width,y:_t};break;case Dr:Pt={x:D.x-R.width,y:_t};break;default:Pt={x:D.x,y:D.y}}var qt=Re?$e(Re):null;if(qt!=null){var Lt=qt==="y"?"height":"width";switch(Je){case Ho:Pt[qt]=Pt[qt]-(D[Lt]/2-R[Lt]/2);break;case gs:Pt[qt]=Pt[qt]+(D[Lt]/2-R[Lt]/2);break}}return Pt}function ur(M){var D=M.state,R=M.name;D.modifiersData[R]=sn({reference:D.rects.reference,element:D.rects.popper,strategy:"absolute",placement:D.placement})}const ys={name:"popperOffsets",enabled:!0,phase:"read",fn:ur,data:{}};var kl={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ro(M){var D=M.x,R=M.y,W=window,Re=W.devicePixelRatio||1;return{x:Kt(D*Re)/Re||0,y:Kt(R*Re)/Re||0}}function Ta(M){var D,R=M.popper,W=M.popperRect,Re=M.placement,Je=M.variation,yt=M.offsets,_t=M.position,Pt=M.gpuAcceleration,qt=M.adaptive,Lt=M.roundOffsets,Vi=M.isFixed,Ar=yt.x,bi=Ar===void 0?0:Ar,Hi=yt.y,mi=Hi===void 0?0:Hi,Ti=typeof Lt=="function"?Lt({x:bi,y:mi}):{x:bi,y:mi};bi=Ti.x,mi=Ti.y;var hr=yt.hasOwnProperty("x"),yr=yt.hasOwnProperty("y"),nr=Dr,ki=Ur,dr=window;if(qt){var Ji=Sn(R),Gi="clientHeight",Se="clientWidth";if(Ji===Pr(R)&&(Ji=Qt(R),Er(Ji).position!=="static"&&_t==="absolute"&&(Gi="scrollHeight",Se="scrollWidth")),Ji=Ji,Re===Ur||(Re===Dr||Re===Kr)&&Je===gs){ki=Hr;var Xe=Vi&&dr.visualViewport?dr.visualViewport.height:Ji[Gi];mi-=Xe-W.height,mi*=Pt?1:-1}if(Re===Dr||(Re===Ur||Re===Hr)&&Je===gs){nr=Kr;var Be=Vi&&dr.visualViewport?dr.visualViewport.width:Ji[Se];bi-=Be-W.width,bi*=Pt?1:-1}}var It=Object.assign({position:_t},qt&&kl),Gt=Lt===!0?ro({x:bi,y:mi}):{x:bi,y:mi};if(bi=Gt.x,mi=Gt.y,Pt){var si;return Object.assign({},It,(si={},si[ki]=yr?"0":"",si[nr]=hr?"0":"",si.transform=(dr.devicePixelRatio||1)<=1?"translate("+bi+"px, "+mi+"px)":"translate3d("+bi+"px, "+mi+"px, 0)",si))}return Object.assign({},It,(D={},D[ki]=yr?mi+"px":"",D[nr]=hr?bi+"px":"",D.transform="",D))}function Dc(M){var D=M.state,R=M.options,W=R.gpuAcceleration,Re=W===void 0?!0:W,Je=R.adaptive,yt=Je===void 0?!0:Je,_t=R.roundOffsets,Pt=_t===void 0?!0:_t,qt={placement:xi(D.placement),variation:Ft(D.placement),popper:D.elements.popper,popperRect:D.rects.popper,gpuAcceleration:Re,isFixed:D.options.strategy==="fixed"};D.modifiersData.popperOffsets!=null&&(D.styles.popper=Object.assign({},D.styles.popper,Ta(Object.assign({},qt,{offsets:D.modifiersData.popperOffsets,position:D.options.strategy,adaptive:yt,roundOffsets:Pt})))),D.modifiersData.arrow!=null&&(D.styles.arrow=Object.assign({},D.styles.arrow,Ta(Object.assign({},qt,{offsets:D.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:Pt})))),D.attributes.popper=Object.assign({},D.attributes.popper,{"data-popper-placement":D.placement})}const Ea={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Dc,data:{}};function Ct(M){var D=M.state;Object.keys(D.elements).forEach(function(R){var W=D.styles[R]||{},Re=D.attributes[R]||{},Je=D.elements[R];!zr(Je)||!En(Je)||(Object.assign(Je.style,W),Object.keys(Re).forEach(function(yt){var _t=Re[yt];_t===!1?Je.removeAttribute(yt):Je.setAttribute(yt,_t===!0?"":_t)}))})}function di(M){var D=M.state,R={popper:{position:D.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(D.elements.popper.style,R.popper),D.styles=R,D.elements.arrow&&Object.assign(D.elements.arrow.style,R.arrow),function(){Object.keys(D.elements).forEach(function(W){var Re=D.elements[W],Je=D.attributes[W]||{},yt=Object.keys(D.styles.hasOwnProperty(W)?D.styles[W]:R[W]),_t=yt.reduce(function(Pt,qt){return Pt[qt]="",Pt},{});!zr(Re)||!En(Re)||(Object.assign(Re.style,_t),Object.keys(Je).forEach(function(Pt){Re.removeAttribute(Pt)}))})}}const fi={name:"applyStyles",enabled:!0,phase:"write",fn:Ct,effect:di,requires:["computeStyles"]};function no(M,D,R){var W=xi(M),Re=[Dr,Ur].indexOf(W)>=0?-1:1,Je=typeof R=="function"?R(Object.assign({},D,{placement:M})):R,yt=Je[0],_t=Je[1];return yt=yt||0,_t=(_t||0)*Re,[Dr,Kr].indexOf(W)>=0?{x:_t,y:yt}:{x:yt,y:_t}}function oo(M){var D=M.state,R=M.options,W=M.name,Re=R.offset,Je=Re===void 0?[0,0]:Re,yt=Ks.reduce(function(Lt,Vi){return Lt[Vi]=no(Vi,D.rects,Je),Lt},{}),_t=yt[D.placement],Pt=_t.x,qt=_t.y;D.modifiersData.popperOffsets!=null&&(D.modifiersData.popperOffsets.x+=Pt,D.modifiersData.popperOffsets.y+=qt),D.modifiersData[W]=yt}const ti={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:oo};var Ys={left:"right",right:"left",bottom:"top",top:"bottom"};function vs(M){return M.replace(/left|right|bottom|top/g,function(D){return Ys[D]})}var Aa={start:"end",end:"start"};function an(M){return M.replace(/start|end/g,function(D){return Aa[D]})}function ir(M){var D=Pr(M),R=Qt(M),W=D.visualViewport,Re=R.clientWidth,Je=R.clientHeight,yt=0,_t=0;return W&&(Re=W.width,Je=W.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(yt=W.offsetLeft,_t=W.offsetTop)),{width:Re,height:Je,x:yt+kr(M),y:_t}}function Lc(M){var D,R=Qt(M),W=Wo(M),Re=(D=M.ownerDocument)==null?void 0:D.body,Je=_n(R.scrollWidth,R.clientWidth,Re?Re.scrollWidth:0,Re?Re.clientWidth:0),yt=_n(R.scrollHeight,R.clientHeight,Re?Re.scrollHeight:0,Re?Re.clientHeight:0),_t=-W.scrollLeft+kr(M),Pt=-W.scrollTop;return Er(Re||R).direction==="rtl"&&(_t+=_n(R.clientWidth,Re?Re.clientWidth:0)-Je),{width:Je,height:yt,x:_t,y:Pt}}function xs(M,D){var R=D.getRootNode&&D.getRootNode();if(M.contains(D))return!0;if(R&&ms(R)){var W=D;do{if(W&&M.isSameNode(W))return!0;W=W.parentNode||W.host}while(W)}return!1}function Js(M){return Object.assign({},M,{left:M.x,top:M.y,right:M.x+M.width,bottom:M.y+M.height})}function Po(M){var D=Wr(M);return D.top=D.top+M.clientTop,D.left=D.left+M.clientLeft,D.bottom=D.top+M.clientHeight,D.right=D.left+M.clientWidth,D.width=M.clientWidth,D.height=M.clientHeight,D.x=D.left,D.y=D.top,D}function Dl(M,D){return D===Mo?Js(ir(M)):Ln(D)?Po(D):Js(Lc(Qt(M)))}function Yo(M){var D=gn(io(M)),R=["absolute","fixed"].indexOf(Er(M).position)>=0,W=R&&zr(M)?Sn(M):M;return Ln(W)?D.filter(function(Re){return Ln(Re)&&xs(Re,W)&&En(Re)!=="body"}):[]}function ln(M,D,R){var W=D==="clippingParents"?Yo(M):[].concat(D),Re=[].concat(W,[R]),Je=Re[0],yt=Re.reduce(function(_t,Pt){var qt=Dl(M,Pt);return _t.top=_n(qt.top,_t.top),_t.right=_o(qt.right,_t.right),_t.bottom=_o(qt.bottom,_t.bottom),_t.left=_n(qt.left,_t.left),_t},Dl(M,Je));return yt.width=yt.right-yt.left,yt.height=yt.bottom-yt.top,yt.x=yt.left,yt.y=yt.top,yt}function Ri(){return{top:0,right:0,bottom:0,left:0}}function Jo(M){return Object.assign({},Ri(),M)}function Qs(M,D){return D.reduce(function(R,W){return R[W]=M,R},{})}function Nr(M,D){D===void 0&&(D={});var R=D,W=R.placement,Re=W===void 0?M.placement:W,Je=R.boundary,yt=Je===void 0?Ko:Je,_t=R.rootBoundary,Pt=_t===void 0?Mo:_t,qt=R.elementContext,Lt=qt===void 0?Co:qt,Vi=R.altBoundary,Ar=Vi===void 0?!1:Vi,bi=R.padding,Hi=bi===void 0?0:bi,mi=Jo(typeof Hi!="number"?Hi:Qs(Hi,_s)),Ti=Lt===Co?zl:Co,hr=M.rects.popper,yr=M.elements[Ar?Ti:Lt],nr=ln(Ln(yr)?yr:yr.contextElement||Qt(M.elements.popper),yt,Pt),ki=Wr(M.elements.reference),dr=sn({reference:ki,element:hr,strategy:"absolute",placement:Re}),Ji=Js(Object.assign({},hr,dr)),Gi=Lt===Co?Ji:ki,Se={top:nr.top-Gi.top+mi.top,bottom:Gi.bottom-nr.bottom+mi.bottom,left:nr.left-Gi.left+mi.left,right:Gi.right-nr.right+mi.right},Xe=M.modifiersData.offset;if(Lt===Co&&Xe){var Be=Xe[Re];Object.keys(Se).forEach(function(It){var Gt=[Kr,Hr].indexOf(It)>=0?1:-1,si=[Ur,Hr].indexOf(It)>=0?"y":"x";Se[It]+=Be[si]*Gt})}return Se}function Rn(M,D){D===void 0&&(D={});var R=D,W=R.placement,Re=R.boundary,Je=R.rootBoundary,yt=R.padding,_t=R.flipVariations,Pt=R.allowedAutoPlacements,qt=Pt===void 0?Ks:Pt,Lt=Ft(W),Vi=Lt?_t?In:In.filter(function(Hi){return Ft(Hi)===Lt}):_s,Ar=Vi.filter(function(Hi){return qt.indexOf(Hi)>=0});Ar.length===0&&(Ar=Vi);var bi=Ar.reduce(function(Hi,mi){return Hi[mi]=Nr(M,{placement:mi,boundary:Re,rootBoundary:Je,padding:yt})[xi(mi)],Hi},{});return Object.keys(bi).sort(function(Hi,mi){return bi[Hi]-bi[mi]})}function Ll(M){if(xi(M)===Hs)return[];var D=vs(M);return[an(M),D,an(D)]}function Qo(M){var D=M.state,R=M.options,W=M.name;if(!D.modifiersData[W]._skip){for(var Re=R.mainAxis,Je=Re===void 0?!0:Re,yt=R.altAxis,_t=yt===void 0?!0:yt,Pt=R.fallbackPlacements,qt=R.padding,Lt=R.boundary,Vi=R.rootBoundary,Ar=R.altBoundary,bi=R.flipVariations,Hi=bi===void 0?!0:bi,mi=R.allowedAutoPlacements,Ti=D.options.placement,hr=xi(Ti),yr=hr===Ti,nr=Pt||(yr||!Hi?[vs(Ti)]:Ll(Ti)),ki=[Ti].concat(nr).reduce(function(Bi,Mn){return Bi.concat(xi(Mn)===Hs?Rn(D,{placement:Mn,boundary:Lt,rootBoundary:Vi,padding:qt,flipVariations:Hi,allowedAutoPlacements:mi}):Mn)},[]),dr=D.rects.reference,Ji=D.rects.popper,Gi=new Map,Se=!0,Xe=ki[0],Be=0;Be<ki.length;Be++){var It=ki[Be],Gt=xi(It),si=Ft(It)===Ho,fr=[Ur,Hr].indexOf(Gt)>=0,Di=fr?"width":"height",Lr=Nr(D,{placement:It,boundary:Lt,rootBoundary:Vi,altBoundary:Ar,padding:qt}),ao=fr?si?Kr:Dr:si?Hr:Ur;dr[Di]>Ji[Di]&&(ao=vs(ao));var un=vs(ao),_i=[];if(Je&&_i.push(Lr[Gt]<=0),_t&&_i.push(Lr[ao]<=0,Lr[un]<=0),_i.every(function(Bi){return Bi})){Xe=It,Se=!1;break}Gi.set(It,_i)}if(Se)for(var Cs=Hi?3:1,os=function(Mn){var Ps=ki.find(function(co){var ss=Gi.get(co);if(ss)return ss.slice(0,Mn).every(function(ka){return ka})});if(Ps)return Xe=Ps,"break"},lo=Cs;lo>0;lo--){var go=os(lo);if(go==="break")break}D.placement!==Xe&&(D.modifiersData[W]._skip=!0,D.placement=Xe,D.reset=!0)}}const gr={name:"flip",enabled:!0,phase:"main",fn:Qo,requiresIfExists:["offset"],data:{_skip:!1}};function Sa(M){return M==="x"?"y":"x"}function ea(M,D,R){return _n(M,_o(D,R))}function tl(M,D,R){var W=ea(M,D,R);return W>R?R:W}function Yr(M){var D=M.state,R=M.options,W=M.name,Re=R.mainAxis,Je=Re===void 0?!0:Re,yt=R.altAxis,_t=yt===void 0?!1:yt,Pt=R.boundary,qt=R.rootBoundary,Lt=R.altBoundary,Vi=R.padding,Ar=R.tether,bi=Ar===void 0?!0:Ar,Hi=R.tetherOffset,mi=Hi===void 0?0:Hi,Ti=Nr(D,{boundary:Pt,rootBoundary:qt,padding:Vi,altBoundary:Lt}),hr=xi(D.placement),yr=Ft(D.placement),nr=!yr,ki=$e(hr),dr=Sa(ki),Ji=D.modifiersData.popperOffsets,Gi=D.rects.reference,Se=D.rects.popper,Xe=typeof mi=="function"?mi(Object.assign({},D.rects,{placement:D.placement})):mi,Be=typeof Xe=="number"?{mainAxis:Xe,altAxis:Xe}:Object.assign({mainAxis:0,altAxis:0},Xe),It=D.modifiersData.offset?D.modifiersData.offset[D.placement]:null,Gt={x:0,y:0};if(!!Ji){if(Je){var si,fr=ki==="y"?Ur:Dr,Di=ki==="y"?Hr:Kr,Lr=ki==="y"?"height":"width",ao=Ji[ki],un=ao+Ti[fr],_i=ao-Ti[Di],Cs=bi?-Se[Lr]/2:0,os=yr===Ho?Gi[Lr]:Se[Lr],lo=yr===Ho?-Se[Lr]:-Gi[Lr],go=D.elements.arrow,Bi=bi&&go?Ws(go):{width:0,height:0},Mn=D.modifiersData["arrow#persistent"]?D.modifiersData["arrow#persistent"].padding:Ri(),Ps=Mn[fr],co=Mn[Di],ss=ea(0,Gi[Lr],Bi[Lr]),ka=nr?Gi[Lr]/2-Cs-ss-Ps-Be.mainAxis:os-ss-Ps-Be.mainAxis,Da=nr?-Gi[Lr]/2+Cs+ss+co+Be.mainAxis:lo+ss+co+Be.mainAxis,zs=D.elements.arrow&&Sn(D.elements.arrow),uo=zs?ki==="y"?zs.clientTop||0:zs.clientLeft||0:0,sa=(si=It==null?void 0:It[ki])!=null?si:0,aa=ao+ka-sa-uo,as=ao+Da-sa,St=ea(bi?_o(un,aa):un,ao,bi?_n(_i,as):_i);Ji[ki]=St,Gt[ki]=St-ao}if(_t){var Cn,La=ki==="x"?Ur:Dr,Hl=ki==="x"?Hr:Kr,Pn=Ji[dr],Or=dr==="y"?"height":"width",la=Pn+Ti[La],Oa=Pn-Ti[Hl],ca=[Ur,Dr].indexOf(hr)!==-1,Ra=(Cn=It==null?void 0:It[dr])!=null?Cn:0,Ba=ca?la:Pn-Gi[Or]-Se[Or]-Ra+Be.altAxis,ua=ca?Pn+Gi[Or]+Se[Or]-Ra-Be.altAxis:Oa,ho=bi&&ca?tl(Ba,Pn,ua):ea(bi?Ba:la,Pn,bi?ua:Oa);Ji[dr]=ho,Gt[dr]=ho-Pn}D.modifiersData[W]=Gt}}const Ia={name:"preventOverflow",enabled:!0,phase:"main",fn:Yr,requiresIfExists:["offset"]};var ac=function(D,R){return D=typeof D=="function"?D(Object.assign({},R.rects,{placement:R.placement})):D,Jo(typeof D!="number"?D:Qs(D,_s))};function so(M){var D,R=M.state,W=M.name,Re=M.options,Je=R.elements.arrow,yt=R.modifiersData.popperOffsets,_t=xi(R.placement),Pt=$e(_t),qt=[Dr,Kr].indexOf(_t)>=0,Lt=qt?"height":"width";if(!(!Je||!yt)){var Vi=ac(Re.padding,R),Ar=Ws(Je),bi=Pt==="y"?Ur:Dr,Hi=Pt==="y"?Hr:Kr,mi=R.rects.reference[Lt]+R.rects.reference[Pt]-yt[Pt]-R.rects.popper[Lt],Ti=yt[Pt]-R.rects.reference[Pt],hr=Sn(Je),yr=hr?Pt==="y"?hr.clientHeight||0:hr.clientWidth||0:0,nr=mi/2-Ti/2,ki=Vi[bi],dr=yr-Ar[Lt]-Vi[Hi],Ji=yr/2-Ar[Lt]/2+nr,Gi=ea(ki,Ji,dr),Se=Pt;R.modifiersData[W]=(D={},D[Se]=Gi,D.centerOffset=Gi-Ji,D)}}function il(M){var D=M.state,R=M.options,W=R.element,Re=W===void 0?"[data-popper-arrow]":W;Re!=null&&(typeof Re=="string"&&(Re=D.elements.popper.querySelector(Re),!Re)||!xs(D.elements.popper,Re)||(D.elements.arrow=Re))}const Ol={name:"arrow",enabled:!0,phase:"main",fn:so,effect:il,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Rl(M,D,R){return R===void 0&&(R={x:0,y:0}),{top:M.top-D.height-R.y,right:M.right-D.width+R.x,bottom:M.bottom-D.height+R.y,left:M.left-D.width-R.x}}function Bl(M){return[Ur,Kr,Hr,Dr].some(function(D){return M[D]>=0})}function Ma(M){var D=M.state,R=M.name,W=D.rects.reference,Re=D.rects.popper,Je=D.modifiersData.preventOverflow,yt=Nr(D,{elementContext:"reference"}),_t=Nr(D,{altBoundary:!0}),Pt=Rl(yt,W),qt=Rl(_t,Re,Je),Lt=Bl(Pt),Vi=Bl(qt);D.modifiersData[R]={referenceClippingOffsets:Pt,popperEscapeOffsets:qt,isReferenceHidden:Lt,hasPopperEscaped:Vi},D.attributes.popper=Object.assign({},D.attributes.popper,{"data-popper-reference-hidden":Lt,"data-popper-escaped":Vi})}var Oc=[Zi,ys,Ea,fi,ti,gr,Ia,Ol,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Ma}],bs=Wt({defaultModifiers:Oc});function zi(M){return Fl(M)||lc(M)||ws(M)||Xi()}function Xi(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ws(M,D){if(!!M){if(typeof M=="string")return cc(M,D);var R=Object.prototype.toString.call(M).slice(8,-1);if(R==="Object"&&M.constructor&&(R=M.constructor.name),R==="Map"||R==="Set")return Array.from(M);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return cc(M,D)}}function lc(M){if(typeof Symbol<"u"&&M[Symbol.iterator]!=null||M["@@iterator"]!=null)return Array.from(M)}function Fl(M){if(Array.isArray(M))return cc(M)}function cc(M,D){(D==null||D>M.length)&&(D=M.length);for(var R=0,W=new Array(D);R<D;R++)W[R]=M[R];return W}function Rc(M,D){var R=Object.keys(M);if(Object.getOwnPropertySymbols){var W=Object.getOwnPropertySymbols(M);D&&(W=W.filter(function(Re){return Object.getOwnPropertyDescriptor(M,Re).enumerable})),R.push.apply(R,W)}return R}function es(M){for(var D=1;D<arguments.length;D++){var R=arguments[D]!=null?arguments[D]:{};D%2?Rc(Object(R),!0).forEach(function(W){rl(M,W,R[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(R)):Rc(Object(R)).forEach(function(W){Object.defineProperty(M,W,Object.getOwnPropertyDescriptor(R,W))})}return M}function rl(M,D,R){return D in M?Object.defineProperty(M,D,{value:R,enumerable:!0,configurable:!0,writable:!0}):M[D]=R,M}function Bc(M,D){if(!(M instanceof D))throw new TypeError("Cannot call a class as a function")}function Jr(M,D){for(var R=0;R<D.length;R++){var W=D[R];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(M,W.key,W)}}function Ul(M,D,R){return D&&Jr(M.prototype,D),R&&Jr(M,R),Object.defineProperty(M,"prototype",{writable:!1}),M}var Ts={placement:"bottom",triggerType:"click",onShow:function(){},onHide:function(){}},Bn=function(){function M(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,W=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Bc(this,M),this._targetEl=D,this._triggerEl=R,this._options=es(es({},Ts),W),this._popperInstance=this._createPopperInstace(),this._visible=!1,this._init()}return Ul(M,[{key:"_init",value:function(){var R=this;this._triggerEl&&this._triggerEl.addEventListener("click",function(){R.toggle()})}},{key:"_createPopperInstace",value:function(){return bs(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[0,10]}}]})}},{key:"_handleClickOutside",value:function(R,W){var Re=R.target;Re!==W&&!W.contains(Re)&&!this._triggerEl.contains(Re)&&this._visible&&this.hide(),document.body.removeEventListener("click",this._handleClickOutside,!0)}},{key:"toggle",value:function(){this._visible?(this.hide(),document.body.removeEventListener("click",this._handleClickOutside,!0)):this.show()}},{key:"show",value:function(){var R=this;this._targetEl.classList.remove("hidden"),this._targetEl.classList.add("block"),this._popperInstance.setOptions(function(W){return es(es({},W),{},{modifiers:[].concat(zi(W.modifiers),[{name:"eventListeners",enabled:!0}])})}),document.body.addEventListener("click",function(W){R._handleClickOutside(W,R._targetEl)},!0),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)}},{key:"hide",value:function(){this._targetEl.classList.remove("block"),this._targetEl.classList.add("hidden"),this._popperInstance.setOptions(function(R){return es(es({},R),{},{modifiers:[].concat(zi(R.modifiers),[{name:"eventListeners",enabled:!1}])})}),this._visible=!1,this._options.onHide(this)}}]),M}();window.Dropdown=Bn,document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-dropdown-toggle]").forEach(function(M){var D=document.getElementById(M.getAttribute("data-dropdown-toggle")),R=M.getAttribute("data-dropdown-placement");new Bn(D,M,{placement:R||Ts.placement})})});function nl(M){return ta(M)||jl(M)||Nl(M)||Fn()}function Fn(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Nl(M,D){if(!!M){if(typeof M=="string")return ia(M,D);var R=Object.prototype.toString.call(M).slice(8,-1);if(R==="Object"&&M.constructor&&(R=M.constructor.name),R==="Map"||R==="Set")return Array.from(M);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return ia(M,D)}}function jl(M){if(typeof Symbol<"u"&&M[Symbol.iterator]!=null||M["@@iterator"]!=null)return Array.from(M)}function ta(M){if(Array.isArray(M))return ia(M)}function ia(M,D){(D==null||D>M.length)&&(D=M.length);for(var R=0,W=new Array(D);R<D;R++)W[R]=M[R];return W}function ts(M,D){var R=Object.keys(M);if(Object.getOwnPropertySymbols){var W=Object.getOwnPropertySymbols(M);D&&(W=W.filter(function(Re){return Object.getOwnPropertyDescriptor(M,Re).enumerable})),R.push.apply(R,W)}return R}function zo(M){for(var D=1;D<arguments.length;D++){var R=arguments[D]!=null?arguments[D]:{};D%2?ts(Object(R),!0).forEach(function(W){cn(M,W,R[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(R)):ts(Object(R)).forEach(function(W){Object.defineProperty(M,W,Object.getOwnPropertyDescriptor(R,W))})}return M}function cn(M,D,R){return D in M?Object.defineProperty(M,D,{value:R,enumerable:!0,configurable:!0,writable:!0}):M[D]=R,M}function Vl(M,D){if(!(M instanceof D))throw new TypeError("Cannot call a class as a function")}function yn(M,D){for(var R=0;R<D.length;R++){var W=D[R];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(M,W.key,W)}}function Gl(M,D,R){return D&&yn(M.prototype,D),R&&yn(M,R),Object.defineProperty(M,"prototype",{writable:!1}),M}var is={placement:"center",backdropClasses:"bg-gray-900 bg-opacity-50 dark:bg-opacity-80 fixed inset-0 z-40",onHide:function(){},onShow:function(){},onToggle:function(){}},pi=function(){function M(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Vl(this,M),this._targetEl=D,this._options=zo(zo({},is),R),this._isHidden=!0,this._init()}return Gl(M,[{key:"_init",value:function(){var R=this;this._getPlacementClasses().map(function(W){R._targetEl.classList.add(W)})}},{key:"_createBackdrop",value:function(){if(this._isHidden){var R,W=document.createElement("div");W.setAttribute("modal-backdrop",""),(R=W.classList).add.apply(R,nl(this._options.backdropClasses.split(" "))),document.querySelector("body").append(W)}}},{key:"_destroyBackdropEl",value:function(){this._isHidden||document.querySelector("[modal-backdrop]").remove()}},{key:"_getPlacementClasses",value:function(){switch(this._options.placement){case"top-left":return["justify-start","items-start"];case"top-center":return["justify-center","items-start"];case"top-right":return["justify-end","items-start"];case"center-left":return["justify-start","items-center"];case"center":return["justify-center","items-center"];case"center-right":return["justify-end","items-center"];case"bottom-left":return["justify-start","items-end"];case"bottom-center":return["justify-center","items-end"];case"bottom-right":return["justify-end","items-end"];default:return["justify-center","items-center"]}}},{key:"toggle",value:function(){this._isHidden?this.show():this.hide(),this._options.onToggle(this)}},{key:"show",value:function(){this._targetEl.classList.add("flex"),this._targetEl.classList.remove("hidden"),this._targetEl.setAttribute("aria-modal","true"),this._targetEl.setAttribute("role","dialog"),this._targetEl.removeAttribute("aria-hidden"),this._createBackdrop(),this._isHidden=!1,this._options.onShow(this)}},{key:"hide",value:function(){this._targetEl.classList.add("hidden"),this._targetEl.classList.remove("flex"),this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.removeAttribute("aria-modal"),this._targetEl.removeAttribute("role"),this._destroyBackdropEl(),this._isHidden=!0,this._options.onHide(this)}}]),M}();window.Modal=pi;var Es=function(D,R){return R.some(function(W){return W.id===D})?R.find(function(W){return W.id===D}):!1};document.addEventListener("DOMContentLoaded",function(){var M=[];document.querySelectorAll("[data-modal-toggle]").forEach(function(D){var R=D.getAttribute("data-modal-toggle"),W=document.getElementById(R),Re=W.getAttribute("data-modal-placement");W&&!W.hasAttribute("aria-hidden")&&!W.hasAttribute("aria-modal")&&W.setAttribute("aria-hidden","true");var Je=null;Es(R,M)?(Je=Es(R,M),Je=Je.object):(Je=new pi(W,{placement:Re||is.placement}),M.push({id:R,object:Je})),W.hasAttribute("data-modal-show")&&W.getAttribute("data-modal-show")==="true"&&Je.show(),D.addEventListener("click",function(){Je.toggle()})})});function As(M){return ol(M)||Ss(M)||ui(M)||rr()}function rr(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ui(M,D){if(!!M){if(typeof M=="string")return ra(M,D);var R=Object.prototype.toString.call(M).slice(8,-1);if(R==="Object"&&M.constructor&&(R=M.constructor.name),R==="Map"||R==="Set")return Array.from(M);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return ra(M,D)}}function Ss(M){if(typeof Symbol<"u"&&M[Symbol.iterator]!=null||M["@@iterator"]!=null)return Array.from(M)}function ol(M){if(Array.isArray(M))return ra(M)}function ra(M,D){(D==null||D>M.length)&&(D=M.length);for(var R=0,W=new Array(D);R<D;R++)W[R]=M[R];return W}function $l(M,D){var R=Object.keys(M);if(Object.getOwnPropertySymbols){var W=Object.getOwnPropertySymbols(M);D&&(W=W.filter(function(Re){return Object.getOwnPropertyDescriptor(M,Re).enumerable})),R.push.apply(R,W)}return R}function ql(M){for(var D=1;D<arguments.length;D++){var R=arguments[D]!=null?arguments[D]:{};D%2?$l(Object(R),!0).forEach(function(W){Is(M,W,R[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(R)):$l(Object(R)).forEach(function(W){Object.defineProperty(M,W,Object.getOwnPropertyDescriptor(R,W))})}return M}function Is(M,D,R){return D in M?Object.defineProperty(M,D,{value:R,enumerable:!0,configurable:!0,writable:!0}):M[D]=R,M}function Ca(M,D){if(!(M instanceof D))throw new TypeError("Cannot call a class as a function")}function sl(M,D){for(var R=0;R<D.length;R++){var W=D[R];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(M,W.key,W)}}function Ms(M,D,R){return D&&sl(M.prototype,D),R&&sl(M,R),Object.defineProperty(M,"prototype",{writable:!1}),M}var Zl={defaultTabId:null,activeClasses:"text-blue-600 hover:text-blue-600 dark:text-blue-500 dark:hover:text-blue-500 border-blue-600 dark:border-blue-500",inactiveClasses:"dark:border-transparent text-gray-500 hover:text-gray-600 dark:text-gray-400 border-gray-100 hover:border-gray-300 dark:border-gray-700 dark:hover:text-gray-300",onShow:function(){}},al=function(){function M(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ca(this,M),this._items=D,this._activeTab=R?this.getTab(R.defaultTabId):null,this._options=ql(ql({},Zl),R),this._init()}return Ms(M,[{key:"_init",value:function(){var R=this;this._items.length&&(this._activeTab||this._setActiveTab(this._items[0]),this.show(this._activeTab.id,!0),this._items.map(function(W){W.triggerEl.addEventListener("click",function(){R.show(W.id)})}))}},{key:"getActiveTab",value:function(){return this._activeTab}},{key:"_setActiveTab",value:function(R){this._activeTab=R}},{key:"getTab",value:function(R){return this._items.filter(function(W){return W.id===R})[0]}},{key:"show",value:function(R){var W=this,Re,Je,yt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,_t=this.getTab(R);_t===this._activeTab&&!yt||(this._items.map(function(Pt){if(Pt!==_t){var qt,Lt;(qt=Pt.triggerEl.classList).remove.apply(qt,As(W._options.activeClasses.split(" "))),(Lt=Pt.triggerEl.classList).add.apply(Lt,As(W._options.inactiveClasses.split(" "))),Pt.targetEl.classList.add("hidden"),Pt.triggerEl.setAttribute("aria-selected",!1)}}),(Re=_t.triggerEl.classList).add.apply(Re,As(this._options.activeClasses.split(" "))),(Je=_t.triggerEl.classList).remove.apply(Je,As(this._options.inactiveClasses.split(" "))),_t.triggerEl.setAttribute("aria-selected",!0),_t.targetEl.classList.remove("hidden"),this._setActiveTab(_t),this._options.onShow(this,_t))}}]),M}();window.Tabs=al,document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-tabs-toggle]").forEach(function(M){var D=[],R=null;M.querySelectorAll('[role="tab"]').forEach(function(W){var Re=W.getAttribute("aria-selected")==="true",Je={id:W.getAttribute("data-tabs-target"),triggerEl:W,targetEl:document.querySelector(W.getAttribute("data-tabs-target"))};D.push(Je),Re&&(R=Je.id)}),new al(D,{defaultTabId:R})})});function ll(M){return Fc(M)||Xl(M)||Wl(M)||Pa()}function Pa(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wl(M,D){if(!!M){if(typeof M=="string")return rs(M,D);var R=Object.prototype.toString.call(M).slice(8,-1);if(R==="Object"&&M.constructor&&(R=M.constructor.name),R==="Map"||R==="Set")return Array.from(M);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return rs(M,D)}}function Xl(M){if(typeof Symbol<"u"&&M[Symbol.iterator]!=null||M["@@iterator"]!=null)return Array.from(M)}function Fc(M){if(Array.isArray(M))return rs(M)}function rs(M,D){(D==null||D>M.length)&&(D=M.length);for(var R=0,W=new Array(D);R<D;R++)W[R]=M[R];return W}function ns(M,D){var R=Object.keys(M);if(Object.getOwnPropertySymbols){var W=Object.getOwnPropertySymbols(M);D&&(W=W.filter(function(Re){return Object.getOwnPropertyDescriptor(M,Re).enumerable})),R.push.apply(R,W)}return R}function na(M){for(var D=1;D<arguments.length;D++){var R=arguments[D]!=null?arguments[D]:{};D%2?ns(Object(R),!0).forEach(function(W){za(M,W,R[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(R)):ns(Object(R)).forEach(function(W){Object.defineProperty(M,W,Object.getOwnPropertyDescriptor(R,W))})}return M}function za(M,D,R){return D in M?Object.defineProperty(M,D,{value:R,enumerable:!0,configurable:!0,writable:!0}):M[D]=R,M}function vn(M,D){if(!(M instanceof D))throw new TypeError("Cannot call a class as a function")}function Hn(M,D){for(var R=0;R<D.length;R++){var W=D[R];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(M,W.key,W)}}function oa(M,D,R){return D&&Hn(M.prototype,D),R&&Hn(M,R),Object.defineProperty(M,"prototype",{writable:!1}),M}var cl={placement:"top",triggerType:"hover",onShow:function(){},onHide:function(){}},ul=function(){function M(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,W=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};vn(this,M),this._targetEl=D,this._triggerEl=R,this._options=na(na({},cl),W),this._popperInstance=this._createPopperInstace(),this._init()}return oa(M,[{key:"_init",value:function(){var R=this;if(this._triggerEl){var W=this._getTriggerEvents();W.showEvents.forEach(function(Re){R._triggerEl.addEventListener(Re,function(){R.show()})}),W.hideEvents.forEach(function(Re){R._triggerEl.addEventListener(Re,function(){R.hide()})})}}},{key:"_createPopperInstace",value:function(){return bs(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[0,8]}}]})}},{key:"_getTriggerEvents",value:function(){switch(this._options.triggerType){case"hover":return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]}}}},{key:"show",value:function(){this._targetEl.classList.remove("opacity-0","invisible"),this._targetEl.classList.add("opacity-100","visible"),this._popperInstance.setOptions(function(R){return na(na({},R),{},{modifiers:[].concat(ll(R.modifiers),[{name:"eventListeners",enabled:!0}])})}),this._popperInstance.update(),this._options.onShow(this)}},{key:"hide",value:function(){this._targetEl.classList.remove("opacity-100","visible"),this._targetEl.classList.add("opacity-0","invisible"),this._popperInstance.setOptions(function(R){return na(na({},R),{},{modifiers:[].concat(ll(R.modifiers),[{name:"eventListeners",enabled:!1}])})}),this._options.onHide(this)}}]),M}();window.Tooltip=ul,document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-tooltip-target]").forEach(function(M){var D=document.getElementById(M.getAttribute("data-tooltip-target")),R=M.getAttribute("data-tooltip-trigger"),W=M.getAttribute("data-tooltip-placement");new ul(D,M,{placement:W||cl.placement,triggerType:R||cl.triggerType})})})})();var cw={exports:{}};(function(v,I){(function(E,L){v.exports=L()})(ph,function(){return function(E){function L(U){if(B[U])return B[U].exports;var q=B[U]={i:U,l:!1,exports:{}};return E[U].call(q.exports,q,q.exports,L),q.l=!0,q.exports}var B={};return L.m=E,L.c=B,L.d=function(U,q,o){L.o(U,q)||Object.defineProperty(U,q,{configurable:!1,enumerable:!0,get:o})},L.n=function(U){var q=U&&U.__esModule?function(){return U.default}:function(){return U};return L.d(q,"a",q),q},L.o=function(U,q){return Object.prototype.hasOwnProperty.call(U,q)},L.p="",L(L.s=8)}([function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U="swal-button";L.CLASS_NAMES={MODAL:"swal-modal",OVERLAY:"swal-overlay",SHOW_MODAL:"swal-overlay--show-modal",MODAL_TITLE:"swal-title",MODAL_TEXT:"swal-text",ICON:"swal-icon",ICON_CUSTOM:"swal-icon--custom",CONTENT:"swal-content",FOOTER:"swal-footer",BUTTON_CONTAINER:"swal-button-container",BUTTON:U,CONFIRM_BUTTON:U+"--confirm",CANCEL_BUTTON:U+"--cancel",DANGER_BUTTON:U+"--danger",BUTTON_LOADING:U+"--loading",BUTTON_LOADER:U+"__loader"},L.default=L.CLASS_NAMES},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0}),L.getNode=function(U){var q="."+U;return document.querySelector(q)},L.stringToNode=function(U){var q=document.createElement("div");return q.innerHTML=U.trim(),q.firstChild},L.insertAfter=function(U,q){var o=q.nextSibling;q.parentNode.insertBefore(U,o)},L.removeNode=function(U){U.parentElement.removeChild(U)},L.throwErr=function(U){throw U=U.replace(/ +(?= )/g,""),"SweetAlert: "+(U=U.trim())},L.isPlainObject=function(U){if(Object.prototype.toString.call(U)!=="[object Object]")return!1;var q=Object.getPrototypeOf(U);return q===null||q===Object.prototype},L.ordinalSuffixOf=function(U){var q=U%10,o=U%100;return q===1&&o!==11?U+"st":q===2&&o!==12?U+"nd":q===3&&o!==13?U+"rd":U+"th"}},function(E,L,B){function U(Ue){for(var We in Ue)L.hasOwnProperty(We)||(L[We]=Ue[We])}Object.defineProperty(L,"__esModule",{value:!0}),U(B(25));var q=B(26);L.overlayMarkup=q.default,U(B(27)),U(B(28)),U(B(29));var o=B(0),Q=o.default.MODAL_TITLE,me=o.default.MODAL_TEXT,Ce=o.default.ICON,ce=o.default.FOOTER;L.iconMarkup=`
  <div class="`+Ce+'"></div>',L.titleMarkup=`
  <div class="`+Q+`"></div>
`,L.textMarkup=`
  <div class="`+me+'"></div>',L.footerMarkup=`
  <div class="`+ce+`"></div>
`},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(1);L.CONFIRM_KEY="confirm",L.CANCEL_KEY="cancel";var q={visible:!0,text:null,value:null,className:"",closeModal:!0},o=Object.assign({},q,{visible:!1,text:"Cancel",value:null}),Q=Object.assign({},q,{text:"OK",value:!0});L.defaultButtonList={cancel:o,confirm:Q};var me=function(We){switch(We){case L.CONFIRM_KEY:return Q;case L.CANCEL_KEY:return o;default:var ot=We.charAt(0).toUpperCase()+We.slice(1);return Object.assign({},q,{text:ot,value:We})}},Ce=function(We,ot){var it=me(We);return ot===!0?Object.assign({},it,{visible:!0}):typeof ot=="string"?Object.assign({},it,{visible:!0,text:ot}):U.isPlainObject(ot)?Object.assign({visible:!0},it,ot):Object.assign({},it,{visible:!1})},ce=function(We){for(var ot={},it=0,Ze=Object.keys(We);it<Ze.length;it++){var Ie=Ze[it],je=We[Ie],Oe=Ce(Ie,je);ot[Ie]=Oe}return ot.cancel||(ot.cancel=o),ot},Ue=function(We){var ot={};switch(We.length){case 1:ot[L.CANCEL_KEY]=Object.assign({},o,{visible:!1});break;case 2:ot[L.CANCEL_KEY]=Ce(L.CANCEL_KEY,We[0]),ot[L.CONFIRM_KEY]=Ce(L.CONFIRM_KEY,We[1]);break;default:U.throwErr("Invalid number of 'buttons' in array ("+We.length+`).
      If you want more than 2 buttons, you need to use an object!`)}return ot};L.getButtonListOpts=function(We){var ot=L.defaultButtonList;return typeof We=="string"?ot[L.CONFIRM_KEY]=Ce(L.CONFIRM_KEY,We):Array.isArray(We)?ot=Ue(We):U.isPlainObject(We)?ot=ce(We):We===!0?ot=Ue([!0,!0]):We===!1?ot=Ue([!1,!1]):We===void 0&&(ot=L.defaultButtonList),ot}},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(1),q=B(2),o=B(0),Q=o.default.MODAL,me=o.default.OVERLAY,Ce=B(30),ce=B(31),Ue=B(32),We=B(33);L.injectElIntoModal=function(Ie){var je=U.getNode(Q),Oe=U.stringToNode(Ie);return je.appendChild(Oe),Oe};var ot=function(Ie){Ie.className=Q,Ie.textContent=""},it=function(Ie,je){ot(Ie);var Oe=je.className;Oe&&Ie.classList.add(Oe)};L.initModalContent=function(Ie){var je=U.getNode(Q);it(je,Ie),Ce.default(Ie.icon),ce.initTitle(Ie.title),ce.initText(Ie.text),We.default(Ie.content),Ue.default(Ie.buttons,Ie.dangerMode)};var Ze=function(){var Ie=U.getNode(me),je=U.stringToNode(q.modalMarkup);Ie.appendChild(je)};L.default=Ze},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(3),q={isOpen:!1,promise:null,actions:{},timer:null},o=Object.assign({},q);L.resetState=function(){o=Object.assign({},q)},L.setActionValue=function(me){if(typeof me=="string")return Q(U.CONFIRM_KEY,me);for(var Ce in me)Q(Ce,me[Ce])};var Q=function(me,Ce){o.actions[me]||(o.actions[me]={}),Object.assign(o.actions[me],{value:Ce})};L.setActionOptionsFor=function(me,Ce){var ce=(Ce===void 0?{}:Ce).closeModal,Ue=ce===void 0||ce;Object.assign(o.actions[me],{closeModal:Ue})},L.default=o},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(1),q=B(3),o=B(0),Q=o.default.OVERLAY,me=o.default.SHOW_MODAL,Ce=o.default.BUTTON,ce=o.default.BUTTON_LOADING,Ue=B(5);L.openModal=function(){U.getNode(Q).classList.add(me),Ue.default.isOpen=!0};var We=function(){U.getNode(Q).classList.remove(me),Ue.default.isOpen=!1};L.onAction=function(ot){ot===void 0&&(ot=q.CANCEL_KEY);var it=Ue.default.actions[ot],Ze=it.value;if(it.closeModal===!1){var Ie=Ce+"--"+ot;U.getNode(Ie).classList.add(ce)}else We();Ue.default.promise.resolve(Ze)},L.getState=function(){var ot=Object.assign({},Ue.default);return delete ot.promise,delete ot.timer,ot},L.stopLoading=function(){for(var ot=document.querySelectorAll("."+Ce),it=0;it<ot.length;it++)ot[it].classList.remove(ce)}},function(E,L){var B;B=function(){return this}();try{B=B||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(B=window)}E.exports=B},function(E,L,B){(function(U){E.exports=U.sweetAlert=B(9)}).call(L,B(7))},function(E,L,B){(function(U){E.exports=U.swal=B(10)}).call(L,B(7))},function(E,L,B){typeof window<"u"&&B(11),B(16);var U=B(23).default;E.exports=U},function(E,L,B){var U=B(12);typeof U=="string"&&(U=[[E.i,U,""]]);var q={insertAt:"top"};q.transform=void 0,B(14)(U,q),U.locals&&(E.exports=U.locals)},function(E,L,B){L=E.exports=B(13)(void 0),L.push([E.i,'.swal-icon--error{border-color:#f27474;-webkit-animation:animateErrorIcon .5s;animation:animateErrorIcon .5s}.swal-icon--error__x-mark{position:relative;display:block;-webkit-animation:animateXMark .5s;animation:animateXMark .5s}.swal-icon--error__line{position:absolute;height:5px;width:47px;background-color:#f27474;display:block;top:37px;border-radius:2px}.swal-icon--error__line--left{-webkit-transform:rotate(45deg);transform:rotate(45deg);left:17px}.swal-icon--error__line--right{-webkit-transform:rotate(-45deg);transform:rotate(-45deg);right:16px}@-webkit-keyframes animateErrorIcon{0%{-webkit-transform:rotateX(100deg);transform:rotateX(100deg);opacity:0}to{-webkit-transform:rotateX(0deg);transform:rotateX(0deg);opacity:1}}@keyframes animateErrorIcon{0%{-webkit-transform:rotateX(100deg);transform:rotateX(100deg);opacity:0}to{-webkit-transform:rotateX(0deg);transform:rotateX(0deg);opacity:1}}@-webkit-keyframes animateXMark{0%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}50%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}80%{-webkit-transform:scale(1.15);transform:scale(1.15);margin-top:-6px}to{-webkit-transform:scale(1);transform:scale(1);margin-top:0;opacity:1}}@keyframes animateXMark{0%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}50%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}80%{-webkit-transform:scale(1.15);transform:scale(1.15);margin-top:-6px}to{-webkit-transform:scale(1);transform:scale(1);margin-top:0;opacity:1}}.swal-icon--warning{border-color:#f8bb86;-webkit-animation:pulseWarning .75s infinite alternate;animation:pulseWarning .75s infinite alternate}.swal-icon--warning__body{width:5px;height:47px;top:10px;border-radius:2px;margin-left:-2px}.swal-icon--warning__body,.swal-icon--warning__dot{position:absolute;left:50%;background-color:#f8bb86}.swal-icon--warning__dot{width:7px;height:7px;border-radius:50%;margin-left:-4px;bottom:-11px}@-webkit-keyframes pulseWarning{0%{border-color:#f8d486}to{border-color:#f8bb86}}@keyframes pulseWarning{0%{border-color:#f8d486}to{border-color:#f8bb86}}.swal-icon--success{border-color:#a5dc86}.swal-icon--success:after,.swal-icon--success:before{content:"";border-radius:50%;position:absolute;width:60px;height:120px;background:#fff;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.swal-icon--success:before{border-radius:120px 0 0 120px;top:-7px;left:-33px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);-webkit-transform-origin:60px 60px;transform-origin:60px 60px}.swal-icon--success:after{border-radius:0 120px 120px 0;top:-11px;left:30px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);-webkit-transform-origin:0 60px;transform-origin:0 60px;-webkit-animation:rotatePlaceholder 4.25s ease-in;animation:rotatePlaceholder 4.25s ease-in}.swal-icon--success__ring{width:80px;height:80px;border:4px solid hsla(98,55%,69%,.2);border-radius:50%;box-sizing:content-box;position:absolute;left:-4px;top:-4px;z-index:2}.swal-icon--success__hide-corners{width:5px;height:90px;background-color:#fff;padding:1px;position:absolute;left:28px;top:8px;z-index:1;-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.swal-icon--success__line{height:5px;background-color:#a5dc86;display:block;border-radius:2px;position:absolute;z-index:2}.swal-icon--success__line--tip{width:25px;left:14px;top:46px;-webkit-transform:rotate(45deg);transform:rotate(45deg);-webkit-animation:animateSuccessTip .75s;animation:animateSuccessTip .75s}.swal-icon--success__line--long{width:47px;right:8px;top:38px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);-webkit-animation:animateSuccessLong .75s;animation:animateSuccessLong .75s}@-webkit-keyframes rotatePlaceholder{0%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}5%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}12%{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}to{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}}@keyframes rotatePlaceholder{0%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}5%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}12%{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}to{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}}@-webkit-keyframes animateSuccessTip{0%{width:0;left:1px;top:19px}54%{width:0;left:1px;top:19px}70%{width:50px;left:-8px;top:37px}84%{width:17px;left:21px;top:48px}to{width:25px;left:14px;top:45px}}@keyframes animateSuccessTip{0%{width:0;left:1px;top:19px}54%{width:0;left:1px;top:19px}70%{width:50px;left:-8px;top:37px}84%{width:17px;left:21px;top:48px}to{width:25px;left:14px;top:45px}}@-webkit-keyframes animateSuccessLong{0%{width:0;right:46px;top:54px}65%{width:0;right:46px;top:54px}84%{width:55px;right:0;top:35px}to{width:47px;right:8px;top:38px}}@keyframes animateSuccessLong{0%{width:0;right:46px;top:54px}65%{width:0;right:46px;top:54px}84%{width:55px;right:0;top:35px}to{width:47px;right:8px;top:38px}}.swal-icon--info{border-color:#c9dae1}.swal-icon--info:before{width:5px;height:29px;bottom:17px;border-radius:2px;margin-left:-2px}.swal-icon--info:after,.swal-icon--info:before{content:"";position:absolute;left:50%;background-color:#c9dae1}.swal-icon--info:after{width:7px;height:7px;border-radius:50%;margin-left:-3px;top:19px}.swal-icon{width:80px;height:80px;border-width:4px;border-style:solid;border-radius:50%;padding:0;position:relative;box-sizing:content-box;margin:20px auto}.swal-icon:first-child{margin-top:32px}.swal-icon--custom{width:auto;height:auto;max-width:100%;border:none;border-radius:0}.swal-icon img{max-width:100%;max-height:100%}.swal-title{color:rgba(0,0,0,.65);font-weight:600;text-transform:none;position:relative;display:block;padding:13px 16px;font-size:27px;line-height:normal;text-align:center;margin-bottom:0}.swal-title:first-child{margin-top:26px}.swal-title:not(:first-child){padding-bottom:0}.swal-title:not(:last-child){margin-bottom:13px}.swal-text{font-size:16px;position:relative;float:none;line-height:normal;vertical-align:top;text-align:left;display:inline-block;margin:0;padding:0 10px;font-weight:400;color:rgba(0,0,0,.64);max-width:calc(100% - 20px);overflow-wrap:break-word;box-sizing:border-box}.swal-text:first-child{margin-top:45px}.swal-text:last-child{margin-bottom:45px}.swal-footer{text-align:right;padding-top:13px;margin-top:13px;padding:13px 16px;border-radius:inherit;border-top-left-radius:0;border-top-right-radius:0}.swal-button-container{margin:5px;display:inline-block;position:relative}.swal-button{background-color:#7cd1f9;color:#fff;border:none;box-shadow:none;border-radius:5px;font-weight:600;font-size:14px;padding:10px 24px;margin:0;cursor:pointer}.swal-button:not([disabled]):hover{background-color:#78cbf2}.swal-button:active{background-color:#70bce0}.swal-button:focus{outline:none;box-shadow:0 0 0 1px #fff,0 0 0 3px rgba(43,114,165,.29)}.swal-button[disabled]{opacity:.5;cursor:default}.swal-button::-moz-focus-inner{border:0}.swal-button--cancel{color:#555;background-color:#efefef}.swal-button--cancel:not([disabled]):hover{background-color:#e8e8e8}.swal-button--cancel:active{background-color:#d7d7d7}.swal-button--cancel:focus{box-shadow:0 0 0 1px #fff,0 0 0 3px rgba(116,136,150,.29)}.swal-button--danger{background-color:#e64942}.swal-button--danger:not([disabled]):hover{background-color:#df4740}.swal-button--danger:active{background-color:#cf423b}.swal-button--danger:focus{box-shadow:0 0 0 1px #fff,0 0 0 3px rgba(165,43,43,.29)}.swal-content{padding:0 20px;margin-top:20px;font-size:medium}.swal-content:last-child{margin-bottom:20px}.swal-content__input,.swal-content__textarea{-webkit-appearance:none;background-color:#fff;border:none;font-size:14px;display:block;box-sizing:border-box;width:100%;border:1px solid rgba(0,0,0,.14);padding:10px 13px;border-radius:2px;transition:border-color .2s}.swal-content__input:focus,.swal-content__textarea:focus{outline:none;border-color:#6db8ff}.swal-content__textarea{resize:vertical}.swal-button--loading{color:transparent}.swal-button--loading~.swal-button__loader{opacity:1}.swal-button__loader{position:absolute;height:auto;width:43px;z-index:2;left:50%;top:50%;-webkit-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);text-align:center;pointer-events:none;opacity:0}.swal-button__loader div{display:inline-block;float:none;vertical-align:baseline;width:9px;height:9px;padding:0;border:none;margin:2px;opacity:.4;border-radius:7px;background-color:hsla(0,0%,100%,.9);transition:background .2s;-webkit-animation:swal-loading-anim 1s infinite;animation:swal-loading-anim 1s infinite}.swal-button__loader div:nth-child(3n+2){-webkit-animation-delay:.15s;animation-delay:.15s}.swal-button__loader div:nth-child(3n+3){-webkit-animation-delay:.3s;animation-delay:.3s}@-webkit-keyframes swal-loading-anim{0%{opacity:.4}20%{opacity:.4}50%{opacity:1}to{opacity:.4}}@keyframes swal-loading-anim{0%{opacity:.4}20%{opacity:.4}50%{opacity:1}to{opacity:.4}}.swal-overlay{position:fixed;top:0;bottom:0;left:0;right:0;text-align:center;font-size:0;overflow-y:auto;background-color:rgba(0,0,0,.4);z-index:10000;pointer-events:none;opacity:0;transition:opacity .3s}.swal-overlay:before{content:" ";display:inline-block;vertical-align:middle;height:100%}.swal-overlay--show-modal{opacity:1;pointer-events:auto}.swal-overlay--show-modal .swal-modal{opacity:1;pointer-events:auto;box-sizing:border-box;-webkit-animation:showSweetAlert .3s;animation:showSweetAlert .3s;will-change:transform}.swal-modal{width:478px;opacity:0;pointer-events:none;background-color:#fff;text-align:center;border-radius:5px;position:static;margin:20px auto;display:inline-block;vertical-align:middle;-webkit-transform:scale(1);transform:scale(1);-webkit-transform-origin:50% 50%;transform-origin:50% 50%;z-index:10001;transition:opacity .2s,-webkit-transform .3s;transition:transform .3s,opacity .2s;transition:transform .3s,opacity .2s,-webkit-transform .3s}@media (max-width:500px){.swal-modal{width:calc(100% - 20px)}}@-webkit-keyframes showSweetAlert{0%{-webkit-transform:scale(1);transform:scale(1)}1%{-webkit-transform:scale(.5);transform:scale(.5)}45%{-webkit-transform:scale(1.05);transform:scale(1.05)}80%{-webkit-transform:scale(.95);transform:scale(.95)}to{-webkit-transform:scale(1);transform:scale(1)}}@keyframes showSweetAlert{0%{-webkit-transform:scale(1);transform:scale(1)}1%{-webkit-transform:scale(.5);transform:scale(.5)}45%{-webkit-transform:scale(1.05);transform:scale(1.05)}80%{-webkit-transform:scale(.95);transform:scale(.95)}to{-webkit-transform:scale(1);transform:scale(1)}}',""])},function(E,L){function B(q,o){var Q=q[1]||"",me=q[3];if(!me)return Q;if(o&&typeof btoa=="function"){var Ce=U(me);return[Q].concat(me.sources.map(function(ce){return"/*# sourceURL="+me.sourceRoot+ce+" */"})).concat([Ce]).join(`
`)}return[Q].join(`
`)}function U(q){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(q))))+" */"}E.exports=function(q){var o=[];return o.toString=function(){return this.map(function(Q){var me=B(Q,q);return Q[2]?"@media "+Q[2]+"{"+me+"}":me}).join("")},o.i=function(Q,me){typeof Q=="string"&&(Q=[[null,Q,""]]);for(var Ce={},ce=0;ce<this.length;ce++){var Ue=this[ce][0];typeof Ue=="number"&&(Ce[Ue]=!0)}for(ce=0;ce<Q.length;ce++){var We=Q[ce];typeof We[0]=="number"&&Ce[We[0]]||(me&&!We[2]?We[2]=me:me&&(We[2]="("+We[2]+") and ("+me+")"),o.push(We))}},o}},function(E,L,B){function U(xt,bt){for(var At=0;At<xt.length;At++){var vt=xt[At],Yt=Ze[vt.id];if(Yt){Yt.refs++;for(var ei=0;ei<Yt.parts.length;ei++)Yt.parts[ei](vt.parts[ei]);for(;ei<vt.parts.length;ei++)Yt.parts.push(Ue(vt.parts[ei],bt))}else{for(var Ni=[],ei=0;ei<vt.parts.length;ei++)Ni.push(Ue(vt.parts[ei],bt));Ze[vt.id]={id:vt.id,refs:1,parts:Ni}}}}function q(xt,bt){for(var At=[],vt={},Yt=0;Yt<xt.length;Yt++){var ei=xt[Yt],Ni=bt.base?ei[0]+bt.base:ei[0],mr=ei[1],wn=ei[2],Dn=ei[3],xr={css:mr,media:wn,sourceMap:Dn};vt[Ni]?vt[Ni].parts.push(xr):At.push(vt[Ni]={id:Ni,parts:[xr]})}return At}function o(xt,bt){var At=je(xt.insertInto);if(!At)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var vt=Ye[Ye.length-1];if(xt.insertAt==="top")vt?vt.nextSibling?At.insertBefore(bt,vt.nextSibling):At.appendChild(bt):At.insertBefore(bt,At.firstChild),Ye.push(bt);else{if(xt.insertAt!=="bottom")throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");At.appendChild(bt)}}function Q(xt){if(xt.parentNode===null)return!1;xt.parentNode.removeChild(xt);var bt=Ye.indexOf(xt);bt>=0&&Ye.splice(bt,1)}function me(xt){var bt=document.createElement("style");return xt.attrs.type="text/css",ce(bt,xt.attrs),o(xt,bt),bt}function Ce(xt){var bt=document.createElement("link");return xt.attrs.type="text/css",xt.attrs.rel="stylesheet",ce(bt,xt.attrs),o(xt,bt),bt}function ce(xt,bt){Object.keys(bt).forEach(function(At){xt.setAttribute(At,bt[At])})}function Ue(xt,bt){var At,vt,Yt,ei;if(bt.transform&&xt.css){if(!(ei=bt.transform(xt.css)))return function(){};xt.css=ei}if(bt.singleton){var Ni=qe++;At=Oe||(Oe=me(bt)),vt=We.bind(null,At,Ni,!1),Yt=We.bind(null,At,Ni,!0)}else xt.sourceMap&&typeof URL=="function"&&typeof URL.createObjectURL=="function"&&typeof URL.revokeObjectURL=="function"&&typeof Blob=="function"&&typeof btoa=="function"?(At=Ce(bt),vt=it.bind(null,At,bt),Yt=function(){Q(At),At.href&&URL.revokeObjectURL(At.href)}):(At=me(bt),vt=ot.bind(null,At),Yt=function(){Q(At)});return vt(xt),function(mr){if(mr){if(mr.css===xt.css&&mr.media===xt.media&&mr.sourceMap===xt.sourceMap)return;vt(xt=mr)}else Yt()}}function We(xt,bt,At,vt){var Yt=At?"":vt.css;if(xt.styleSheet)xt.styleSheet.cssText=Pi(bt,Yt);else{var ei=document.createTextNode(Yt),Ni=xt.childNodes;Ni[bt]&&xt.removeChild(Ni[bt]),Ni.length?xt.insertBefore(ei,Ni[bt]):xt.appendChild(ei)}}function ot(xt,bt){var At=bt.css,vt=bt.media;if(vt&&xt.setAttribute("media",vt),xt.styleSheet)xt.styleSheet.cssText=At;else{for(;xt.firstChild;)xt.removeChild(xt.firstChild);xt.appendChild(document.createTextNode(At))}}function it(xt,bt,At){var vt=At.css,Yt=At.sourceMap,ei=bt.convertToAbsoluteUrls===void 0&&Yt;(bt.convertToAbsoluteUrls||ei)&&(vt=ci(vt)),Yt&&(vt+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(Yt))))+" */");var Ni=new Blob([vt],{type:"text/css"}),mr=xt.href;xt.href=URL.createObjectURL(Ni),mr&&URL.revokeObjectURL(mr)}var Ze={},Ie=function(xt){var bt;return function(){return bt===void 0&&(bt=xt.apply(this,arguments)),bt}}(function(){return window&&document&&document.all&&!window.atob}),je=function(xt){var bt={};return function(At){return bt[At]===void 0&&(bt[At]=xt.call(this,At)),bt[At]}}(function(xt){return document.querySelector(xt)}),Oe=null,qe=0,Ye=[],ci=B(15);E.exports=function(xt,bt){if(typeof DEBUG<"u"&&DEBUG&&typeof document!="object")throw new Error("The style-loader cannot be used in a non-browser environment");bt=bt||{},bt.attrs=typeof bt.attrs=="object"?bt.attrs:{},bt.singleton||(bt.singleton=Ie()),bt.insertInto||(bt.insertInto="head"),bt.insertAt||(bt.insertAt="bottom");var At=q(xt,bt);return U(At,bt),function(vt){for(var Yt=[],ei=0;ei<At.length;ei++){var Ni=At[ei],mr=Ze[Ni.id];mr.refs--,Yt.push(mr)}vt&&U(q(vt,bt),bt);for(var ei=0;ei<Yt.length;ei++){var mr=Yt[ei];if(mr.refs===0){for(var wn=0;wn<mr.parts.length;wn++)mr.parts[wn]();delete Ze[mr.id]}}}};var Pi=function(){var xt=[];return function(bt,At){return xt[bt]=At,xt.filter(Boolean).join(`
`)}}()},function(E,L){E.exports=function(B){var U=typeof window<"u"&&window.location;if(!U)throw new Error("fixUrls requires window.location");if(!B||typeof B!="string")return B;var q=U.protocol+"//"+U.host,o=q+U.pathname.replace(/\/[^\/]*$/,"/");return B.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(Q,me){var Ce=me.trim().replace(/^"(.*)"$/,function(Ue,We){return We}).replace(/^'(.*)'$/,function(Ue,We){return We});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(Ce))return Q;var ce;return ce=Ce.indexOf("//")===0?Ce:Ce.indexOf("/")===0?q+Ce:o+Ce.replace(/^\.\//,""),"url("+JSON.stringify(ce)+")"})}},function(E,L,B){var U=B(17);typeof window>"u"||window.Promise||(window.Promise=U),B(21),String.prototype.includes||(String.prototype.includes=function(q,o){return typeof o!="number"&&(o=0),!(o+q.length>this.length)&&this.indexOf(q,o)!==-1}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(q,o){if(this==null)throw new TypeError('"this" is null or not defined');var Q=Object(this),me=Q.length>>>0;if(me===0)return!1;for(var Ce=0|o,ce=Math.max(Ce>=0?Ce:me-Math.abs(Ce),0);ce<me;){if(function(Ue,We){return Ue===We||typeof Ue=="number"&&typeof We=="number"&&isNaN(Ue)&&isNaN(We)}(Q[ce],q))return!0;ce++}return!1}}),typeof window<"u"&&function(q){q.forEach(function(o){o.hasOwnProperty("remove")||Object.defineProperty(o,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})}([Element.prototype,CharacterData.prototype,DocumentType.prototype])},function(E,L,B){(function(U){(function(q){function o(){}function Q(Ie,je){return function(){Ie.apply(je,arguments)}}function me(Ie){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");if(typeof Ie!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],it(Ie,this)}function Ce(Ie,je){for(;Ie._state===3;)Ie=Ie._value;if(Ie._state===0)return void Ie._deferreds.push(je);Ie._handled=!0,me._immediateFn(function(){var Oe=Ie._state===1?je.onFulfilled:je.onRejected;if(Oe===null)return void(Ie._state===1?ce:Ue)(je.promise,Ie._value);var qe;try{qe=Oe(Ie._value)}catch(Ye){return void Ue(je.promise,Ye)}ce(je.promise,qe)})}function ce(Ie,je){try{if(je===Ie)throw new TypeError("A promise cannot be resolved with itself.");if(je&&(typeof je=="object"||typeof je=="function")){var Oe=je.then;if(je instanceof me)return Ie._state=3,Ie._value=je,void We(Ie);if(typeof Oe=="function")return void it(Q(Oe,je),Ie)}Ie._state=1,Ie._value=je,We(Ie)}catch(qe){Ue(Ie,qe)}}function Ue(Ie,je){Ie._state=2,Ie._value=je,We(Ie)}function We(Ie){Ie._state===2&&Ie._deferreds.length===0&&me._immediateFn(function(){Ie._handled||me._unhandledRejectionFn(Ie._value)});for(var je=0,Oe=Ie._deferreds.length;je<Oe;je++)Ce(Ie,Ie._deferreds[je]);Ie._deferreds=null}function ot(Ie,je,Oe){this.onFulfilled=typeof Ie=="function"?Ie:null,this.onRejected=typeof je=="function"?je:null,this.promise=Oe}function it(Ie,je){var Oe=!1;try{Ie(function(qe){Oe||(Oe=!0,ce(je,qe))},function(qe){Oe||(Oe=!0,Ue(je,qe))})}catch(qe){if(Oe)return;Oe=!0,Ue(je,qe)}}var Ze=setTimeout;me.prototype.catch=function(Ie){return this.then(null,Ie)},me.prototype.then=function(Ie,je){var Oe=new this.constructor(o);return Ce(this,new ot(Ie,je,Oe)),Oe},me.all=function(Ie){var je=Array.prototype.slice.call(Ie);return new me(function(Oe,qe){function Ye(xt,bt){try{if(bt&&(typeof bt=="object"||typeof bt=="function")){var At=bt.then;if(typeof At=="function")return void At.call(bt,function(vt){Ye(xt,vt)},qe)}je[xt]=bt,--ci==0&&Oe(je)}catch(vt){qe(vt)}}if(je.length===0)return Oe([]);for(var ci=je.length,Pi=0;Pi<je.length;Pi++)Ye(Pi,je[Pi])})},me.resolve=function(Ie){return Ie&&typeof Ie=="object"&&Ie.constructor===me?Ie:new me(function(je){je(Ie)})},me.reject=function(Ie){return new me(function(je,Oe){Oe(Ie)})},me.race=function(Ie){return new me(function(je,Oe){for(var qe=0,Ye=Ie.length;qe<Ye;qe++)Ie[qe].then(je,Oe)})},me._immediateFn=typeof U=="function"&&function(Ie){U(Ie)}||function(Ie){Ze(Ie,0)},me._unhandledRejectionFn=function(Ie){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",Ie)},me._setImmediateFn=function(Ie){me._immediateFn=Ie},me._setUnhandledRejectionFn=function(Ie){me._unhandledRejectionFn=Ie},E!==void 0&&E.exports?E.exports=me:q.Promise||(q.Promise=me)})(this)}).call(L,B(18).setImmediate)},function(E,L,B){function U(o,Q){this._id=o,this._clearFn=Q}var q=Function.prototype.apply;L.setTimeout=function(){return new U(q.call(setTimeout,window,arguments),clearTimeout)},L.setInterval=function(){return new U(q.call(setInterval,window,arguments),clearInterval)},L.clearTimeout=L.clearInterval=function(o){o&&o.close()},U.prototype.unref=U.prototype.ref=function(){},U.prototype.close=function(){this._clearFn.call(window,this._id)},L.enroll=function(o,Q){clearTimeout(o._idleTimeoutId),o._idleTimeout=Q},L.unenroll=function(o){clearTimeout(o._idleTimeoutId),o._idleTimeout=-1},L._unrefActive=L.active=function(o){clearTimeout(o._idleTimeoutId);var Q=o._idleTimeout;Q>=0&&(o._idleTimeoutId=setTimeout(function(){o._onTimeout&&o._onTimeout()},Q))},B(19),L.setImmediate=setImmediate,L.clearImmediate=clearImmediate},function(E,L,B){(function(U,q){(function(o,Q){function me(Oe){typeof Oe!="function"&&(Oe=new Function(""+Oe));for(var qe=new Array(arguments.length-1),Ye=0;Ye<qe.length;Ye++)qe[Ye]=arguments[Ye+1];var ci={callback:Oe,args:qe};return it[ot]=ci,We(ot),ot++}function Ce(Oe){delete it[Oe]}function ce(Oe){var qe=Oe.callback,Ye=Oe.args;switch(Ye.length){case 0:qe();break;case 1:qe(Ye[0]);break;case 2:qe(Ye[0],Ye[1]);break;case 3:qe(Ye[0],Ye[1],Ye[2]);break;default:qe.apply(Q,Ye)}}function Ue(Oe){if(Ze)setTimeout(Ue,0,Oe);else{var qe=it[Oe];if(qe){Ze=!0;try{ce(qe)}finally{Ce(Oe),Ze=!1}}}}if(!o.setImmediate){var We,ot=1,it={},Ze=!1,Ie=o.document,je=Object.getPrototypeOf&&Object.getPrototypeOf(o);je=je&&je.setTimeout?je:o,{}.toString.call(o.process)==="[object process]"?function(){We=function(Oe){q.nextTick(function(){Ue(Oe)})}}():function(){if(o.postMessage&&!o.importScripts){var Oe=!0,qe=o.onmessage;return o.onmessage=function(){Oe=!1},o.postMessage("","*"),o.onmessage=qe,Oe}}()?function(){var Oe="setImmediate$"+Math.random()+"$",qe=function(Ye){Ye.source===o&&typeof Ye.data=="string"&&Ye.data.indexOf(Oe)===0&&Ue(+Ye.data.slice(Oe.length))};o.addEventListener?o.addEventListener("message",qe,!1):o.attachEvent("onmessage",qe),We=function(Ye){o.postMessage(Oe+Ye,"*")}}():o.MessageChannel?function(){var Oe=new MessageChannel;Oe.port1.onmessage=function(qe){Ue(qe.data)},We=function(qe){Oe.port2.postMessage(qe)}}():Ie&&"onreadystatechange"in Ie.createElement("script")?function(){var Oe=Ie.documentElement;We=function(qe){var Ye=Ie.createElement("script");Ye.onreadystatechange=function(){Ue(qe),Ye.onreadystatechange=null,Oe.removeChild(Ye),Ye=null},Oe.appendChild(Ye)}}():function(){We=function(Oe){setTimeout(Ue,0,Oe)}}(),je.setImmediate=me,je.clearImmediate=Ce}})(typeof self>"u"?U===void 0?this:U:self)}).call(L,B(7),B(20))},function(E,L){function B(){throw new Error("setTimeout has not been defined")}function U(){throw new Error("clearTimeout has not been defined")}function q(Oe){if(Ue===setTimeout)return setTimeout(Oe,0);if((Ue===B||!Ue)&&setTimeout)return Ue=setTimeout,setTimeout(Oe,0);try{return Ue(Oe,0)}catch{try{return Ue.call(null,Oe,0)}catch{return Ue.call(this,Oe,0)}}}function o(Oe){if(We===clearTimeout)return clearTimeout(Oe);if((We===U||!We)&&clearTimeout)return We=clearTimeout,clearTimeout(Oe);try{return We(Oe)}catch{try{return We.call(null,Oe)}catch{return We.call(this,Oe)}}}function Q(){Ie&&it&&(Ie=!1,it.length?Ze=it.concat(Ze):je=-1,Ze.length&&me())}function me(){if(!Ie){var Oe=q(Q);Ie=!0;for(var qe=Ze.length;qe;){for(it=Ze,Ze=[];++je<qe;)it&&it[je].run();je=-1,qe=Ze.length}it=null,Ie=!1,o(Oe)}}function Ce(Oe,qe){this.fun=Oe,this.array=qe}function ce(){}var Ue,We,ot=E.exports={};(function(){try{Ue=typeof setTimeout=="function"?setTimeout:B}catch{Ue=B}try{We=typeof clearTimeout=="function"?clearTimeout:U}catch{We=U}})();var it,Ze=[],Ie=!1,je=-1;ot.nextTick=function(Oe){var qe=new Array(arguments.length-1);if(arguments.length>1)for(var Ye=1;Ye<arguments.length;Ye++)qe[Ye-1]=arguments[Ye];Ze.push(new Ce(Oe,qe)),Ze.length!==1||Ie||q(me)},Ce.prototype.run=function(){this.fun.apply(null,this.array)},ot.title="browser",ot.browser=!0,ot.env={},ot.argv=[],ot.version="",ot.versions={},ot.on=ce,ot.addListener=ce,ot.once=ce,ot.off=ce,ot.removeListener=ce,ot.removeAllListeners=ce,ot.emit=ce,ot.prependListener=ce,ot.prependOnceListener=ce,ot.listeners=function(Oe){return[]},ot.binding=function(Oe){throw new Error("process.binding is not supported")},ot.cwd=function(){return"/"},ot.chdir=function(Oe){throw new Error("process.chdir is not supported")},ot.umask=function(){return 0}},function(E,L,B){B(22).polyfill()},function(E,L,B){function U(o,Q){if(o==null)throw new TypeError("Cannot convert first argument to object");for(var me=Object(o),Ce=1;Ce<arguments.length;Ce++){var ce=arguments[Ce];if(ce!=null)for(var Ue=Object.keys(Object(ce)),We=0,ot=Ue.length;We<ot;We++){var it=Ue[We],Ze=Object.getOwnPropertyDescriptor(ce,it);Ze!==void 0&&Ze.enumerable&&(me[it]=ce[it])}}return me}function q(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:U})}E.exports={assign:U,polyfill:q}},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(24),q=B(6),o=B(5),Q=B(36),me=function(){for(var Ce=[],ce=0;ce<arguments.length;ce++)Ce[ce]=arguments[ce];if(typeof window<"u"){var Ue=Q.getOpts.apply(void 0,Ce);return new Promise(function(We,ot){o.default.promise={resolve:We,reject:ot},U.default(Ue),setTimeout(function(){q.openModal()})})}};me.close=q.onAction,me.getState=q.getState,me.setActionValue=o.setActionValue,me.stopLoading=q.stopLoading,me.setDefaults=Q.setDefaults,L.default=me},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(1),q=B(0),o=q.default.MODAL,Q=B(4),me=B(34),Ce=B(35),ce=B(1);L.init=function(Ue){U.getNode(o)||(document.body||ce.throwErr("You can only use SweetAlert AFTER the DOM has loaded!"),me.default(),Q.default()),Q.initModalContent(Ue),Ce.default(Ue)},L.default=L.init},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(0),q=U.default.MODAL;L.modalMarkup=`
  <div class="`+q+'" role="dialog" aria-modal="true"></div>',L.default=L.modalMarkup},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(0),q=U.default.OVERLAY,o=`<div 
    class="`+q+`"
    tabIndex="-1">
  </div>`;L.default=o},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(0),q=U.default.ICON;L.errorIconMarkup=function(){var o=q+"--error",Q=o+"__line";return`
    <div class="`+o+`__x-mark">
      <span class="`+Q+" "+Q+`--left"></span>
      <span class="`+Q+" "+Q+`--right"></span>
    </div>
  `},L.warningIconMarkup=function(){var o=q+"--warning";return`
    <span class="`+o+`__body">
      <span class="`+o+`__dot"></span>
    </span>
  `},L.successIconMarkup=function(){var o=q+"--success";return`
    <span class="`+o+"__line "+o+`__line--long"></span>
    <span class="`+o+"__line "+o+`__line--tip"></span>

    <div class="`+o+`__ring"></div>
    <div class="`+o+`__hide-corners"></div>
  `}},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(0),q=U.default.CONTENT;L.contentMarkup=`
  <div class="`+q+`">

  </div>
`},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(0),q=U.default.BUTTON_CONTAINER,o=U.default.BUTTON,Q=U.default.BUTTON_LOADER;L.buttonMarkup=`
  <div class="`+q+`">

    <button
      class="`+o+`"
    ></button>

    <div class="`+Q+`">
      <div></div>
      <div></div>
      <div></div>
    </div>

  </div>
`},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(4),q=B(2),o=B(0),Q=o.default.ICON,me=o.default.ICON_CUSTOM,Ce=["error","warning","success","info"],ce={error:q.errorIconMarkup(),warning:q.warningIconMarkup(),success:q.successIconMarkup()},Ue=function(it,Ze){var Ie=Q+"--"+it;Ze.classList.add(Ie);var je=ce[it];je&&(Ze.innerHTML=je)},We=function(it,Ze){Ze.classList.add(me);var Ie=document.createElement("img");Ie.src=it,Ze.appendChild(Ie)},ot=function(it){if(it){var Ze=U.injectElIntoModal(q.iconMarkup);Ce.includes(it)?Ue(it,Ze):We(it,Ze)}};L.default=ot},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(2),q=B(4),o=function(Q){navigator.userAgent.includes("AppleWebKit")&&(Q.style.display="none",Q.offsetHeight,Q.style.display="")};L.initTitle=function(Q){if(Q){var me=q.injectElIntoModal(U.titleMarkup);me.textContent=Q,o(me)}},L.initText=function(Q){if(Q){var me=document.createDocumentFragment();Q.split(`
`).forEach(function(ce,Ue,We){me.appendChild(document.createTextNode(ce)),Ue<We.length-1&&me.appendChild(document.createElement("br"))});var Ce=q.injectElIntoModal(U.textMarkup);Ce.appendChild(me),o(Ce)}}},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(1),q=B(4),o=B(0),Q=o.default.BUTTON,me=o.default.DANGER_BUTTON,Ce=B(3),ce=B(2),Ue=B(6),We=B(5),ot=function(Ze,Ie,je){var Oe=Ie.text,qe=Ie.value,Ye=Ie.className,ci=Ie.closeModal,Pi=U.stringToNode(ce.buttonMarkup),xt=Pi.querySelector("."+Q),bt=Q+"--"+Ze;xt.classList.add(bt),Ye&&(Array.isArray(Ye)?Ye:Ye.split(" ")).filter(function(vt){return vt.length>0}).forEach(function(vt){xt.classList.add(vt)}),je&&Ze===Ce.CONFIRM_KEY&&xt.classList.add(me),xt.textContent=Oe;var At={};return At[Ze]=qe,We.setActionValue(At),We.setActionOptionsFor(Ze,{closeModal:ci}),xt.addEventListener("click",function(){return Ue.onAction(Ze)}),Pi},it=function(Ze,Ie){var je=q.injectElIntoModal(ce.footerMarkup);for(var Oe in Ze){var qe=Ze[Oe],Ye=ot(Oe,qe,Ie);qe.visible&&je.appendChild(Ye)}je.children.length===0&&je.remove()};L.default=it},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(3),q=B(4),o=B(2),Q=B(5),me=B(6),Ce=B(0),ce=Ce.default.CONTENT,Ue=function(it){it.addEventListener("input",function(Ze){var Ie=Ze.target,je=Ie.value;Q.setActionValue(je)}),it.addEventListener("keyup",function(Ze){if(Ze.key==="Enter")return me.onAction(U.CONFIRM_KEY)}),setTimeout(function(){it.focus(),Q.setActionValue("")},0)},We=function(it,Ze,Ie){var je=document.createElement(Ze),Oe=ce+"__"+Ze;je.classList.add(Oe);for(var qe in Ie){var Ye=Ie[qe];je[qe]=Ye}Ze==="input"&&Ue(je),it.appendChild(je)},ot=function(it){if(it){var Ze=q.injectElIntoModal(o.contentMarkup),Ie=it.element,je=it.attributes;typeof Ie=="string"?We(Ze,Ie,je):Ze.appendChild(Ie)}};L.default=ot},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(1),q=B(2),o=function(){var Q=U.stringToNode(q.overlayMarkup);document.body.appendChild(Q)};L.default=o},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(5),q=B(6),o=B(1),Q=B(3),me=B(0),Ce=me.default.MODAL,ce=me.default.BUTTON,Ue=me.default.OVERLAY,We=function(vt){vt.preventDefault(),je()},ot=function(vt){vt.preventDefault(),Oe()},it=function(vt){if(U.default.isOpen)switch(vt.key){case"Escape":return q.onAction(Q.CANCEL_KEY)}},Ze=function(vt){if(U.default.isOpen)switch(vt.key){case"Tab":return We(vt)}},Ie=function(vt){if(U.default.isOpen)return vt.key==="Tab"&&vt.shiftKey?ot(vt):void 0},je=function(){var vt=o.getNode(ce);vt&&(vt.tabIndex=0,vt.focus())},Oe=function(){var vt=o.getNode(Ce),Yt=vt.querySelectorAll("."+ce),ei=Yt.length-1,Ni=Yt[ei];Ni&&Ni.focus()},qe=function(vt){vt[vt.length-1].addEventListener("keydown",Ze)},Ye=function(vt){vt[0].addEventListener("keydown",Ie)},ci=function(){var vt=o.getNode(Ce),Yt=vt.querySelectorAll("."+ce);Yt.length&&(qe(Yt),Ye(Yt))},Pi=function(vt){if(o.getNode(Ue)===vt.target)return q.onAction(Q.CANCEL_KEY)},xt=function(vt){var Yt=o.getNode(Ue);Yt.removeEventListener("click",Pi),vt&&Yt.addEventListener("click",Pi)},bt=function(vt){U.default.timer&&clearTimeout(U.default.timer),vt&&(U.default.timer=window.setTimeout(function(){return q.onAction(Q.CANCEL_KEY)},vt))},At=function(vt){vt.closeOnEsc?document.addEventListener("keyup",it):document.removeEventListener("keyup",it),vt.dangerMode?je():Oe(),ci(),xt(vt.closeOnClickOutside),bt(vt.timer)};L.default=At},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(1),q=B(3),o=B(37),Q=B(38),me={title:null,text:null,icon:null,buttons:q.defaultButtonList,content:null,className:null,closeOnClickOutside:!0,closeOnEsc:!0,dangerMode:!1,timer:null},Ce=Object.assign({},me);L.setDefaults=function(Ie){Ce=Object.assign({},me,Ie)};var ce=function(Ie){var je=Ie&&Ie.button,Oe=Ie&&Ie.buttons;return je!==void 0&&Oe!==void 0&&U.throwErr("Cannot set both 'button' and 'buttons' options!"),je!==void 0?{confirm:je}:Oe},Ue=function(Ie){return U.ordinalSuffixOf(Ie+1)},We=function(Ie,je){U.throwErr(Ue(je)+" argument ('"+Ie+"') is invalid")},ot=function(Ie,je){var Oe=Ie+1,qe=je[Oe];U.isPlainObject(qe)||qe===void 0||U.throwErr("Expected "+Ue(Oe)+" argument ('"+qe+"') to be a plain object")},it=function(Ie,je){var Oe=Ie+1,qe=je[Oe];qe!==void 0&&U.throwErr("Unexpected "+Ue(Oe)+" argument ("+qe+")")},Ze=function(Ie,je,Oe,qe){var Ye=typeof je,ci=Ye==="string",Pi=je instanceof Element;if(ci){if(Oe===0)return{text:je};if(Oe===1)return{text:je,title:qe[0]};if(Oe===2)return ot(Oe,qe),{icon:je};We(je,Oe)}else{if(Pi&&Oe===0)return ot(Oe,qe),{content:je};if(U.isPlainObject(je))return it(Oe,qe),je;We(je,Oe)}};L.getOpts=function(){for(var Ie=[],je=0;je<arguments.length;je++)Ie[je]=arguments[je];var Oe={};Ie.forEach(function(ci,Pi){var xt=Ze(0,ci,Pi,Ie);Object.assign(Oe,xt)});var qe=ce(Oe);Oe.buttons=q.getButtonListOpts(qe),delete Oe.button,Oe.content=o.getContentOpts(Oe.content);var Ye=Object.assign({},me,Ce,Oe);return Object.keys(Ye).forEach(function(ci){Q.DEPRECATED_OPTS[ci]&&Q.logDeprecation(ci)}),Ye}},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0});var U=B(1),q={element:"input",attributes:{placeholder:""}};L.getContentOpts=function(o){var Q={};return U.isPlainObject(o)?Object.assign(Q,o):o instanceof Element?{element:o}:o==="input"?q:null}},function(E,L,B){Object.defineProperty(L,"__esModule",{value:!0}),L.logDeprecation=function(U){var q=L.DEPRECATED_OPTS[U],o=q.onlyRename,Q=q.replacement,me=q.subOption,Ce=q.link,ce=o?"renamed":"deprecated",Ue='SweetAlert warning: "'+U+'" option has been '+ce+".";Q&&(Ue+=" Please use"+(me?' "'+me+'" in ':" ")+'"'+Q+'" instead.');var We="https://sweetalert.js.org";Ue+=Ce?" More details: "+We+Ce:" More details: "+We+"/guides/#upgrading-from-1x",console.warn(Ue)},L.DEPRECATED_OPTS={type:{replacement:"icon",link:"/docs/#icon"},imageUrl:{replacement:"icon",link:"/docs/#icon"},customClass:{replacement:"className",onlyRename:!0,link:"/docs/#classname"},imageSize:{},showCancelButton:{replacement:"buttons",link:"/docs/#buttons"},showConfirmButton:{replacement:"button",link:"/docs/#button"},confirmButtonText:{replacement:"button",link:"/docs/#button"},confirmButtonColor:{},cancelButtonText:{replacement:"buttons",link:"/docs/#buttons"},closeOnConfirm:{replacement:"button",subOption:"closeModal",link:"/docs/#button"},closeOnCancel:{replacement:"buttons",subOption:"closeModal",link:"/docs/#buttons"},showLoaderOnConfirm:{replacement:"buttons"},animation:{},inputType:{replacement:"content",link:"/docs/#content"},inputValue:{replacement:"content",link:"/docs/#content"},inputPlaceholder:{replacement:"content",link:"/docs/#content"},html:{replacement:"content",link:"/docs/#content"},allowEscapeKey:{replacement:"closeOnEsc",onlyRename:!0,link:"/docs/#closeonesc"},allowClickOutside:{replacement:"closeOnClickOutside",onlyRename:!0,link:"/docs/#closeonclickoutside"}}}])})})(cw);var d0={exports:{}};(function(v,I){(function(E,L){v.exports=L()})(ph,function(){var E,L,B;function U(o,Q){if(!E)E=Q;else if(!L)L=Q;else{var me="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+E+")(sharedChunk); ("+L+")(sharedChunk); self.onerror = null;",Ce={};E(Ce),B=Q(Ce),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(B.workerUrl=window.URL.createObjectURL(new Blob([me],{type:"text/javascript"})))}}U(["exports"],function(o){var Q=typeof self<"u"?self:{},me=Ce;function Ce(i,e,t,n){this.cx=3*i,this.bx=3*(t-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=t,this.p2y=n}Ce.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},Ce.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},Ce.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},Ce.prototype.solveCurveX=function(i,e){var t,n,a,u,d;for(e===void 0&&(e=1e-6),a=i,d=0;d<8;d++){if(u=this.sampleCurveX(a)-i,Math.abs(u)<e)return a;var p=this.sampleCurveDerivativeX(a);if(Math.abs(p)<1e-6)break;a-=u/p}if((a=i)<(t=0))return t;if(a>(n=1))return n;for(;t<n;){if(u=this.sampleCurveX(a),Math.abs(u-i)<e)return a;i>u?t=a:n=a,a=.5*(n-t)+t}return a},Ce.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var ce=Ue;function Ue(i,e){this.x=i,this.y=e}Ue.prototype={clone:function(){return new Ue(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,t=i.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),t=Math.sin(i),n=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=n,this},_rotateAround:function(i,e){var t=Math.cos(i),n=Math.sin(i),a=e.y+n*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-n*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ue.convert=function(i){return i instanceof Ue?i:Array.isArray(i)?new Ue(i[0],i[1]):i};const We=Math.PI/180,ot=180/Math.PI;function it(i){return i*We}function Ze(i){return i*ot}const Ie=[[0,0],[1,0],[1,1],[0,1]];function je(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,t=e*i;return 4*(i<.5?t:3*(i-e)+t-.75)}function Oe(i,e,t,n){const a=new me(i,e,t,n);return function(u){return a.solve(u)}}const qe=Oe(.25,.1,.25,1);function Ye(i,e,t){return Math.min(t,Math.max(e,i))}function ci(i,e,t){return(t=Ye((t-i)/(e-i),0,1))*t*(3-2*t)}function Pi(i,e,t){const n=t-e,a=((i-e)%n+n)%n+e;return a===e?t:a}function xt(i,e,t){if(!i.length)return t(null,[]);let n=i.length;const a=new Array(i.length);let u=null;i.forEach((d,p)=>{e(d,(g,y)=>{g&&(u=g),a[p]=y,--n==0&&t(u,a)})})}function bt(i){const e=[];for(const t in i)e.push(i[t]);return e}function At(i,...e){for(const t of e)for(const n in t)i[n]=t[n];return i}let vt=1;function Yt(){return vt++}function ei(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Ni(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function mr(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function wn(i,e){i.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function Dn(i,e){return i.indexOf(e,i.length-e.length)!==-1}function xr(i,e,t){const n={};for(const a in i)n[a]=e.call(t||this,i[a],a,i);return n}function ps(i,e,t){const n={};for(const a in i)e.call(t||this,i[a],a,i)&&(n[a]=i[a]);return n}function pn(i){return Array.isArray(i)?i.map(pn):typeof i=="object"&&i?xr(i,pn):i}const Tn={};function _r(i){Tn[i]||(typeof console<"u"&&console.warn(i),Tn[i]=!0)}function mn(i,e,t){return(t.y-i.y)*(e.x-i.x)>(e.y-i.y)*(t.x-i.x)}function Ao(i){let e=0;for(let t,n,a=0,u=i.length,d=u-1;a<u;d=a++)t=i[a],n=i[d],e+=(n.x-t.x)*(t.y+n.y);return e}function Zr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Wn(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,n,a,u)=>{const d=a||u;return e[n]=!d||d.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let So=null;function Pr(i){if(So==null){const e=i.navigator?i.navigator.userAgent:null;So=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return So}function Ln(i){try{const e=Q[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function zr(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}const ms=Q.performance;function _n(i){const e=i?i.url.toString():void 0;return ms.getEntriesByName(e)}var _o="2.10.0";let Kt,Wr,Wo,Xr;const Xn={now:()=>Wo!==void 0?Wo:Q.performance.now(),setNow(i){Wo=i},restoreNow(){Wo=void 0},frame(i){const e=Q.requestAnimationFrame(i);return{cancel:()=>Q.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:t,height:n}=i;Xr||(Xr=Q.document.createElement("canvas"));const a=Xr.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return(t>Xr.width||n>Xr.height)&&(Xr.width=t,Xr.height=n),a.clearRect(-e,-e,t+2*e,n+2*e),a.drawImage(i,0,0,t,n),a.getImageData(-e,-e,t+2*e,n+2*e)},resolveURL:i=>(Kt||(Kt=Q.document.createElement("a")),Kt.href=i,Kt.href),get devicePixelRatio(){return Q.devicePixelRatio},get prefersReducedMotion(){return!!Q.matchMedia&&(Wr==null&&(Wr=Q.matchMedia("(prefers-reduced-motion: reduce)")),Wr.matches)}};let En;const Qt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(En==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{En=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):i}catch{En=i}}return En},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},kr={supported:!1,testSupport:function(i){!Zs&&On&&(Io?Ws(i):Er=i)}};let Er,On,Zs=!1,Io=!1;function Ws(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,On),i.isContextLost())return;kr.supported=!0}catch{}i.deleteTexture(e),Zs=!0}Q.document&&(On=Q.document.createElement("img"),On.onload=function(){Er&&Ws(Er),Er=null,Io=!0},On.onerror=function(){Zs=!0,Er=null},On.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const io="01",Fr="NO_ACCESS_TOKEN";function gn(i){return i.indexOf("mapbox:")===0}function Xo(i){return Qt.API_URL_REGEX.test(i)}const Xs=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function An(i){const e=i.match(Xs);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Sn(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function Ur(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(Q.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Hr{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=Ur(Qt.ACCESS_TOKEN);let n="";return n=t&&t.u?Q.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(a,u)=>String.fromCharCode(Number("0x"+u)))):Qt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=Ln("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const a=Q.localStorage.getItem(t);a&&(this.eventData=JSON.parse(a));const u=Q.localStorage.getItem(n);u&&(this.anonId=u)}catch{_r("Unable to read from LocalStorage")}}saveEventData(){const e=Ln("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{Q.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&Q.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{_r("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,n,a){if(!Qt.EVENTS_URL)return;const u=An(Qt.EVENTS_URL);u.params.push(`access_token=${a||Qt.ACCESS_TOKEN||""}`);const d={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:_o,skuId:io,userId:this.anonId},p=t?At(d,t):d,g={url:Sn(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([p])};this.pendingRequest=nt(g,y=>{this.pendingRequest=null,n(y),this.saveEventData(),this.processRequests(a)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const Kr=new class extends Hr{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){Qt.EVENTS_URL&&Qt.ACCESS_TOKEN&&Array.isArray(i)&&i.some(t=>gn(t)||Xo(t))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ur(Qt.ACCESS_TOKEN),t=e?e.u:Qt.ACCESS_TOKEN;let n=t!==this.eventData.tokenU;mr(this.anonId)||(this.anonId=ei(),n=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),d=new Date(a),p=(a-this.eventData.lastSuccess)/864e5;n=n||p>=1||p<-1||u.getDate()!==d.getDate()}else n=!0;n?this.postEvent(a,{"enabled.telemetry":!1},u=>{u||(this.eventData.lastSuccess=a,this.eventData.tokenU=t)},i):this.processRequests()}},Dr=Kr.postTurnstileEvent.bind(Kr),Hs=new class extends Hr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,t,n){this.skuToken=e,this.errorCb=n,Qt.EVENTS_URL&&(t||Qt.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(Fr)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),mr(this.anonId)||(this.anonId=ei()),this.postEvent(t,{skuToken:this.skuToken},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i))}},_s=Hs.postMapLoadEvent.bind(Hs),Ho=new class extends Hr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,t,n){if(!Qt.API_URL||!Qt.SESSION_PATH)return;const a=An(Qt.API_URL+Qt.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${n||Qt.ACCESS_TOKEN||""}`);const u={url:Sn(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Mt(u,d=>{this.pendingRequest=null,t(d),this.saveEventData(),this.processRequests(n)})}getSessionAPI(i,e,t,n){this.skuToken=e,this.errorCb=n,Qt.SESSION_PATH&&Qt.API_URL&&(t||Qt.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(Fr)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||this.getSession(t,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i)}},gs=Ho.getSessionAPI.bind(Ho),Ko=new Set;let Mo,Co=500,zl=50,In={};function Ks(i){const e=G(i);let t,n;e&&e.forEach(u=>{const d=u.split("=");d[0]==="language"?t=d[1]:d[0]==="worldview"&&(n=d[1])});let a="mapbox-tiles";return t&&(a+=`-${t}`),n&&(a+=`-${n}`),a}function oe(){try{return Q.caches}catch{}}function N(i){const e=oe();e&&!In[i]&&(In[i]=e.open(i))}function G(i){const e=i.indexOf("?");return e>0?i.slice(e+1).split("&"):[]}function ne(i){const e=i.indexOf("?");if(e<0)return i;const t=G(i).filter(n=>{const a=n.split("=");return a[0]==="language"||a[0]==="worldview"});return t.length?`${i.slice(0,e)}?${t.join("&")}`:i.slice(0,e)}let ue=1/0;const be={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(be);class ze extends Error{constructor(e,t,n){t===401&&Xo(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Me=Zr()?()=>self.worker&&self.worker.referrer:()=>(Q.location.protocol==="blob:"?Q.parent:Q).location.href,Te=function(i,e){if(!(/^file:/.test(t=i.url)||/^file:/.test(Me())&&!/^\w+:/.test(t))){if(Q.fetch&&Q.Request&&Q.AbortController&&Q.Request.prototype.hasOwnProperty("signal"))return function(n,a){const u=new Q.AbortController,d=new Q.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:Me(),signal:u.signal});let p=!1,g=!1;const y=(T=d.url).indexOf("sku=")>0&&Xo(T);var T;n.type==="json"&&d.headers.set("Accept","application/json");const S=(O,F,$)=>{if(g)return;if(O&&O.message!=="SecurityError"&&_r(O),F&&$)return C(F);const Y=Date.now();Q.fetch(d).then(ae=>{if(ae.ok){const pe=y?ae.clone():null;return C(ae,pe,Y)}return a(new ze(ae.statusText,ae.status,n.url))}).catch(ae=>{ae.code!==20&&a(new Error(ae.message))})},C=(O,F,$)=>{(n.type==="arrayBuffer"?O.arrayBuffer():n.type==="json"?O.json():O.text()).then(Y=>{g||(F&&$&&function(ae,pe,le){const de=Ks(ae.url);if(N(de),!In[de])return;const we={status:pe.status,statusText:pe.statusText,headers:new Q.Headers};pe.headers.forEach((Fe,Ke)=>we.headers.set(Ke,Fe));const ge=Wn(pe.headers.get("Cache-Control")||"");if(ge["no-store"])return;ge["max-age"]&&we.headers.set("Expires",new Date(le+1e3*ge["max-age"]).toUTCString());const Ne=we.headers.get("Expires");Ne&&(new Date(Ne).getTime()-le<42e4||function(Fe,Ke){if(Mo===void 0)try{new Response(new ReadableStream),Mo=!0}catch{Mo=!1}Mo?Ke(Fe.body):Fe.blob().then(Ke)}(pe,Fe=>{const Ke=new Q.Response(Fe,we);N(de),In[de]&&In[de].then(mt=>mt.put(ne(ae.url),Ke)).catch(mt=>_r(mt.message))}))}(d,F,$),p=!0,a(null,Y,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(Y=>{g||a(new Error(Y.message))})};return y?function(O,F){const $=Ks(O.url);if(N($),!In[$])return F(null);const Y=ne(O.url);In[$].then(ae=>{ae.match(Y).then(pe=>{const le=function(de){if(!de)return!1;const we=new Date(de.headers.get("Expires")||0),ge=Wn(de.headers.get("Cache-Control")||"");return we>Date.now()&&!ge["no-cache"]}(pe);ae.delete(Y),le&&ae.put(Y,pe.clone()),F(null,pe,le)}).catch(F)}).catch(F)}(d,S):S(null,null),{cancel:()=>{g=!0,p||u.abort()}}}(i,e);if(Zr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var t;return function(n,a){const u=new Q.XMLHttpRequest;u.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const d in n.headers)u.setRequestHeader(d,n.headers[d]);return n.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=n.credentials==="include",u.onerror=()=>{a(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let d=u.response;if(n.type==="json")try{d=JSON.parse(u.response)}catch(p){return a(p)}a(null,d,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else a(new ze(u.statusText,u.status,n.url))},u.send(n.body),{cancel:()=>u.abort()}}(i,e)},ke=function(i,e){return Te(At(i,{type:"arrayBuffer"}),e)},nt=function(i,e){return Te(At(i,{method:"POST"}),e)},Mt=function(i,e){return Te(At(i,{method:"GET"}),e)};function lt(i){const e=Q.document.createElement("a");return e.href=i,e.protocol===Q.document.location.protocol&&e.host===Q.document.location.host}const $t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Vt,Ut;Vt=[],Ut=0;const Wt=function(i,e){if(kr.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Ut>=Qt.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Vt.push(u),u}Ut++;let t=!1;const n=()=>{if(!t)for(t=!0,Ut--;Vt.length&&Ut<Qt.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Vt.shift(),{requestParameters:d,callback:p,cancelled:g}=u;g||(u.cancel=Wt(d,p).cancel)}},a=ke(i,(u,d,p,g)=>{n(),u?e(u):d&&(Q.createImageBitmap?function(y,T){const S=new Q.Blob([new Uint8Array(y)],{type:"image/png"});Q.createImageBitmap(S).then(C=>{T(null,C)}).catch(C=>{T(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(y,T)=>e(y,T,p,g)):function(y,T){const S=new Q.Image,C=Q.URL;S.onload=()=>{T(null,S),C.revokeObjectURL(S.src),S.onload=null,Q.requestAnimationFrame(()=>{S.src=$t})},S.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new Q.Blob([new Uint8Array(y)],{type:"image/png"});S.src=y.byteLength?C.createObjectURL(O):$t}(d,(y,T)=>e(y,T,p,g)))});return{cancel:()=>{a.cancel(),n()}}};function oi(i,e,t){t[i]&&t[i].indexOf(e)!==-1||(t[i]=t[i]||[],t[i].push(e))}function ji(i,e,t){if(t&&t[i]){const n=t[i].indexOf(e);n!==-1&&t[i].splice(n,1)}}class Zi{constructor(e,t={}){At(this,t),this.type=e}}class xi extends Zi{constructor(e,t={}){super("error",At({error:e},t))}}class Ft{on(e,t){return this._listeners=this._listeners||{},oi(e,t,this._listeners),this}off(e,t){return ji(e,t,this._listeners),ji(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},oi(e,t,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,t){typeof e=="string"&&(e=new Zi(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const a=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const p of a)p.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const p of u)ji(n,p,this._oneTimeListeners),p.call(this,e);const d=this._eventedParent;d&&(At(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof xi&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var $e=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function sn(i,...e){for(const t of e)for(const n in t)i[n]=t[n];return i}function ur(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ys(i){if(Array.isArray(i))return i.map(ys);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const t in i)e[t]=ys(i[t]);return e}return ur(i)}class kl extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var ro=kl;class Ta{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[n,a]of t)this.bindings[n]=a}concat(e){return new Ta(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Dc=Ta;const Ea={kind:"null"},Ct={kind:"number"},di={kind:"string"},fi={kind:"boolean"},no={kind:"color"},oo={kind:"object"},ti={kind:"value"},Ys={kind:"collator"},vs={kind:"formatted"},Aa={kind:"resolvedImage"};function an(i,e){return{kind:"array",itemType:i,N:e}}function ir(i){if(i.kind==="array"){const e=ir(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Lc=[Ea,Ct,di,fi,no,vs,oo,an(ti),Aa];function xs(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!xs(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const t of Lc)if(!xs(t,e))return null}}return`Expected ${ir(i)} but found ${ir(e)} instead.`}function Js(i,e){return e.some(t=>t.kind===i.kind)}function Po(i,e){return e.some(t=>t==="null"?i===null:t==="array"?Array.isArray(i):t==="object"?i&&!Array.isArray(i)&&typeof i=="object":t===typeof i)}function Dl(i){var e={exports:{}};return i(e,e.exports),e.exports}var Yo=Dl(function(i,e){var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(p){return(p=Math.round(p))<0?0:p>255?255:p}function a(p){return n(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function u(p){return(g=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:g>1?1:g;var g}function d(p,g,y){return y<0?y+=1:y>1&&(y-=1),6*y<1?p+(g-p)*y*6:2*y<1?g:3*y<2?p+(g-p)*(2/3-y)*6:p}try{e.parseCSSColor=function(p){var g,y=p.replace(/ /g,"").toLowerCase();if(y in t)return t[y].slice();if(y[0]==="#")return y.length===4?(g=parseInt(y.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:y.length===7&&(g=parseInt(y.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var T=y.indexOf("("),S=y.indexOf(")");if(T!==-1&&S+1===y.length){var C=y.substr(0,T),O=y.substr(T+1,S-(T+1)).split(","),F=1;switch(C){case"rgba":if(O.length!==4)return null;F=u(O.pop());case"rgb":return O.length!==3?null:[a(O[0]),a(O[1]),a(O[2]),F];case"hsla":if(O.length!==4)return null;F=u(O.pop());case"hsl":if(O.length!==3)return null;var $=(parseFloat(O[0])%360+360)%360/360,Y=u(O[1]),ae=u(O[2]),pe=ae<=.5?ae*(Y+1):ae+Y-ae*Y,le=2*ae-pe;return[n(255*d(le,pe,$+1/3)),n(255*d(le,pe,$)),n(255*d(le,pe,$-1/3)),F];default:return null}}return null}}catch{}});class ln{constructor(e,t,n,a=1){this.r=e,this.g=t,this.b=n,this.a=a}static parse(e){if(!e)return;if(e instanceof ln)return e;if(typeof e!="string")return;const t=Yo.parseCSSColor(e);return t?new ln(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,n,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(n)},${a})`}toArray(){const{r:e,g:t,b:n,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*t/a,255*n/a,a]}toArray01(){const{r:e,g:t,b:n,a}=this;return a===0?[0,0,0,0]:[e/a,t/a,n/a,a]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:n,a}=this;return[e,t,n,a]}}ln.black=new ln(0,0,0,1),ln.white=new ln(1,1,1,1),ln.transparent=new ln(0,0,0,0),ln.red=new ln(1,0,0,1),ln.blue=new ln(0,0,1,1);var Ri=ln;class Jo{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qs{constructor(e,t,n,a,u){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=a,this.textColor=u}}class Nr{constructor(e){this.sections=e}static fromString(e){return new Nr([new Qs(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Nr?e:Nr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(n)}return e}}class Rn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Rn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ll(i,e,t,n){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,e,t,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,e,t,n]:[i,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qo(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ri||i instanceof Jo||i instanceof Nr||i instanceof Rn)return!0;if(Array.isArray(i)){for(const e of i)if(!Qo(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Qo(i[e]))return!1;return!0}return!1}function gr(i){if(i===null)return Ea;if(typeof i=="string")return di;if(typeof i=="boolean")return fi;if(typeof i=="number")return Ct;if(i instanceof Ri)return no;if(i instanceof Jo)return Ys;if(i instanceof Nr)return vs;if(i instanceof Rn)return Aa;if(Array.isArray(i)){const e=i.length;let t;for(const n of i){const a=gr(n);if(t){if(t===a)continue;t=ti;break}t=a}return an(t||ti,e)}return oo}function Sa(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Ri||i instanceof Nr||i instanceof Rn?i.toString():JSON.stringify(i)}class ea{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Qo(e[1]))return t.error("invalid value");const n=e[1];let a=gr(n);const u=t.expectedType;return a.kind!=="array"||a.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(a=u),new ea(a,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ri?["rgba"].concat(this.value.toArray()):this.value instanceof Nr?this.value.serialize():this.value}}var tl=ea,Yr=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const Ia={string:di,number:Ct,boolean:fi,object:oo};class ac{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,a=1;const u=e[0];if(u==="array"){let p,g;if(e.length>2){const y=e[1];if(typeof y!="string"||!(y in Ia)||y==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);p=Ia[y],a++}else p=ti;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);g=e[2],a++}n=an(p,g)}else n=Ia[u];const d=[];for(;a<e.length;a++){const p=t.parse(e[a],a,ti);if(!p)return null;d.push(p)}return new ac(n,d)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!xs(this.type,gr(n)))return n;if(t===this.args.length-1)throw new Yr(`Expected value to be of type ${ir(this.type)}, but found ${ir(gr(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){t.push(n.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&t.push(a)}}return t.concat(this.args.map(n=>n.serialize()))}}var so=ac;class il{constructor(e){this.type=vs,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return t.error("First argument must be an image or text section.");const a=[];let u=!1;for(let d=1;d<=e.length-1;++d){const p=e[d];if(u&&typeof p=="object"&&!Array.isArray(p)){u=!1;let g=null;if(p["font-scale"]&&(g=t.parse(p["font-scale"],1,Ct),!g))return null;let y=null;if(p["text-font"]&&(y=t.parse(p["text-font"],1,an(di)),!y))return null;let T=null;if(p["text-color"]&&(T=t.parse(p["text-color"],1,no),!T))return null;const S=a[a.length-1];S.scale=g,S.font=y,S.textColor=T}else{const g=t.parse(e[d],1,ti);if(!g)return null;const y=g.type.kind;if(y!=="string"&&y!=="value"&&y!=="null"&&y!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,a.push({content:g,scale:null,font:null,textColor:null})}}return new il(a)}evaluate(e){return new Nr(this.sections.map(t=>{const n=t.content.evaluate(e);return gr(n)===Aa?new Qs("",n,null,null,null):new Qs(Sa(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class Ol{constructor(e){this.type=Aa,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const n=t.parse(e[1],1,di);return n?new Ol(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=Rn.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Rl={"to-boolean":fi,"to-color":no,"to-number":Ct,"to-string":di};class Bl{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return t.error("Expected one argument.");const a=Rl[n],u=[];for(let d=1;d<e.length;d++){const p=t.parse(e[d],d,ti);if(!p)return null;u.push(p)}return new Bl(a,u)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let t,n;for(const a of this.args){if(t=a.evaluate(e),n=null,t instanceof Ri)return t;if(typeof t=="string"){const u=e.parseColor(t);if(u)return u}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Ll(t[0],t[1],t[2],t[3]),!n))return new Ri(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Yr(n||`Could not parse color from value '${typeof t=="string"?t:String(JSON.stringify(t))}'`)}if(this.type.kind==="number"){let t=null;for(const n of this.args){if(t=n.evaluate(e),t===null)return 0;const a=Number(t);if(!isNaN(a))return a}throw new Yr(`Could not convert ${JSON.stringify(t)} to number.`)}return this.type.kind==="formatted"?Nr.fromString(Sa(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Rn.fromString(Sa(this.args[0].evaluate(e))):Sa(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new il([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ol(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Ma=Bl;const xh=["Unknown","Point","LineString","Polygon"];var Oc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?xh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:t,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(t*e-i[0])+this.featureDistanceData.bearing[1]*(n*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=Ri.parse(i)),e}};class bs{constructor(e,t,n,a){this.name=e,this.type=t,this._evaluate=n,this.args=a}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const n=e[0],a=bs.definitions[n];if(!a)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(a)?a[0]:a.type,d=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,p=d.filter(([y])=>!Array.isArray(y)||y.length===e.length-1);let g=null;for(const[y,T]of p){g=new is(t.registry,t.path,null,t.scope);const S=[];let C=!1;for(let O=1;O<e.length;O++){const F=e[O],$=Array.isArray(y)?y[O-1]:y.type,Y=g.parse(F,1+S.length,$);if(!Y){C=!0;break}S.push(Y)}if(!C)if(Array.isArray(y)&&y.length!==S.length)g.error(`Expected ${y.length} arguments, but found ${S.length} instead.`);else{for(let O=0;O<S.length;O++){const F=Array.isArray(y)?y[O]:y.type,$=S[O];g.concat(O+1).checkSubtype(F,$.type)}if(g.errors.length===0)return new bs(n,u,T,S)}}if(p.length===1)t.errors.push(...g.errors);else{const y=(p.length?p:d).map(([S])=>{return C=S,Array.isArray(C)?`(${C.map(ir).join(", ")})`:`(${ir(C.type)}...)`;var C}).join(" | "),T=[];for(let S=1;S<e.length;S++){const C=t.parse(e[S],1+T.length);if(!C)return null;T.push(ir(C.type))}t.error(`Expected arguments of type ${y}, but found (${T.join(", ")}) instead.`)}return null}static register(e,t){bs.definitions=t;for(const n in t)e[n]=bs}}var zi=bs;class Xi{constructor(e,t,n){this.type=Ys,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return t.error("Collator options argument must be an object.");const a=t.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,fi);if(!a)return null;const u=t.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,fi);if(!u)return null;let d=null;return n.locale&&(d=t.parse(n.locale,1,di),!d)?null:new Xi(a,u,d)}evaluate(e){return new Jo(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ws=8192;function lc(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Fl(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function cc(i,e){const t=(180+i[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(t*a*ws),Math.round(n*a*ws)]}function Rc(i,e,t){const n=i[0]-e[0],a=i[1]-e[1],u=i[0]-t[0],d=i[1]-t[1];return n*d-u*a==0&&n*u<=0&&a*d<=0}function es(i,e){let t=!1;for(let d=0,p=e.length;d<p;d++){const g=e[d];for(let y=0,T=g.length;y<T-1;y++){if(Rc(i,g[y],g[y+1]))return!1;(a=g[y])[1]>(n=i)[1]!=(u=g[y+1])[1]>n[1]&&n[0]<(u[0]-a[0])*(n[1]-a[1])/(u[1]-a[1])+a[0]&&(t=!t)}}var n,a,u;return t}function rl(i,e){for(let t=0;t<e.length;t++)if(es(i,e[t]))return!0;return!1}function Bc(i,e,t,n){const a=n[0]-t[0],u=n[1]-t[1],d=(i[0]-t[0])*u-a*(i[1]-t[1]),p=(e[0]-t[0])*u-a*(e[1]-t[1]);return d>0&&p<0||d<0&&p>0}function Jr(i,e,t){for(const y of t)for(let T=0;T<y.length-1;++T)if((p=[(d=y[T+1])[0]-(u=y[T])[0],d[1]-u[1]])[0]*(g=[(a=e)[0]-(n=i)[0],a[1]-n[1]])[1]-p[1]*g[0]!=0&&Bc(n,a,u,d)&&Bc(u,d,n,a))return!0;var n,a,u,d,p,g;return!1}function Ul(i,e){for(let t=0;t<i.length;++t)if(!es(i[t],e))return!1;for(let t=0;t<i.length-1;++t)if(Jr(i[t],i[t+1],e))return!1;return!0}function Ts(i,e){for(let t=0;t<e.length;t++)if(Ul(i,e[t]))return!0;return!1}function Bn(i,e,t){const n=[];for(let a=0;a<i.length;a++){const u=[];for(let d=0;d<i[a].length;d++){const p=cc(i[a][d],t);lc(e,p),u.push(p)}n.push(u)}return n}function nl(i,e,t){const n=[];for(let a=0;a<i.length;a++){const u=Bn(i[a],e,t);n.push(u)}return n}function Fn(i,e,t,n){if(i[0]<t[0]||i[0]>t[2]){const a=.5*n;let u=i[0]-t[0]>a?-n:t[0]-i[0]>a?n:0;u===0&&(u=i[0]-t[2]>a?-n:t[2]-i[0]>a?n:0),i[0]+=u}lc(e,i)}function Nl(i,e,t,n){const a=Math.pow(2,n.z)*ws,u=[n.x*ws,n.y*ws],d=[];if(!i)return d;for(const p of i)for(const g of p){const y=[g.x+u[0],g.y+u[1]];Fn(y,e,t,a),d.push(y)}return d}function jl(i,e,t,n){const a=Math.pow(2,n.z)*ws,u=[n.x*ws,n.y*ws],d=[];if(!i)return d;for(const g of i){const y=[];for(const T of g){const S=[T.x+u[0],T.y+u[1]];lc(e,S),y.push(S)}d.push(y)}if(e[2]-e[0]<=a/2){(p=e)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(const g of d)for(const y of g)Fn(y,e,t,a)}var p;return d}class ta{constructor(e,t){this.type=fi,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Qo(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let a=0;a<n.features.length;++a){const u=n.features[a].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new ta(n,n.features[a].geometry)}else if(n.type==="Feature"){const a=n.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new ta(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new ta(n,n)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,n){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],d=t.canonicalID();if(!d)return!1;if(n.type==="Polygon"){const p=Bn(n.coordinates,u,d),g=Nl(t.geometry(),a,u,d);if(!Fl(a,u))return!1;for(const y of g)if(!es(y,p))return!1}if(n.type==="MultiPolygon"){const p=nl(n.coordinates,u,d),g=Nl(t.geometry(),a,u,d);if(!Fl(a,u))return!1;for(const y of g)if(!rl(y,p))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,n){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],d=t.canonicalID();if(!d)return!1;if(n.type==="Polygon"){const p=Bn(n.coordinates,u,d),g=jl(t.geometry(),a,u,d);if(!Fl(a,u))return!1;for(const y of g)if(!Ul(y,p))return!1}if(n.type==="MultiPolygon"){const p=nl(n.coordinates,u,d),g=jl(t.geometry(),a,u,d);if(!Fl(a,u))return!1;for(const y of g)if(!Ts(y,p))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ia=ta;function ts(i){if(i instanceof zi&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof ia)return!1;let e=!0;return i.eachChild(t=>{e&&!ts(t)&&(e=!1)}),e}function zo(i){if(i instanceof zi&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(t=>{e&&!zo(t)&&(e=!1)}),e}function cn(i,e){if(i instanceof zi&&e.indexOf(i.name)>=0)return!1;let t=!0;return i.eachChild(n=>{t&&!cn(n,e)&&(t=!1)}),t}class Vl{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new Vl(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var yn=Vl;class Gl{constructor(e,t=[],n,a=new Dc,u=[]){this.registry=e,this.path=t,this.key=t.map(d=>`[${d}]`).join(""),this.scope=a,this.errors=u,this.expectedType=n}parse(e,t,n,a,u={}){return t?this.concat(t,n,a)._parse(e,u):this._parse(e,u)}_parse(e,t){function n(a,u,d){return d==="assert"?new so(u,[a]):d==="coerce"?new Ma(u,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=e[0];if(typeof a!="string")return this.error(`Expression name must be a string, but found ${typeof a} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[a];if(u){let d=u.parse(e,this);if(!d)return null;if(this.expectedType){const p=this.expectedType,g=d.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||g.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(p,g))return null}else d=n(d,p,t.typeAnnotation||"coerce");else d=n(d,p,t.typeAnnotation||"assert")}if(!(d instanceof tl)&&d.type.kind!=="resolvedImage"&&pi(d)){const p=new Oc;try{d=new tl(d.type,d.evaluate(p))}catch(g){return this.error(g.message),null}}return d}return this.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const a=typeof e=="number"?this.path.concat(e):this.path,u=n?this.scope.concat(n):this.scope;return new Gl(this.registry,a,t||null,u,this.errors)}error(e,...t){const n=`${this.key}${t.map(a=>`[${a}]`).join("")}`;this.errors.push(new ro(n,e))}checkSubtype(e,t){const n=xs(e,t);return n&&this.error(n),n}}var is=Gl;function pi(i){if(i instanceof yn)return pi(i.boundExpression);if(i instanceof zi&&i.name==="error"||i instanceof Xi||i instanceof ia)return!1;const e=i instanceof Ma||i instanceof so;let t=!0;return i.eachChild(n=>{t=e?t&&pi(n):t&&n instanceof tl}),!!t&&ts(i)&&cn(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Es(i,e){const t=i.length-1;let n,a,u=0,d=t,p=0;for(;u<=d;)if(p=Math.floor((u+d)/2),n=i[p],a=i[p+1],n<=e){if(p===t||e<a)return p;u=p+1}else{if(!(n>e))throw new Yr("Input is not a number.");d=p-1}return 0}class As{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[a,u]of n)this.labels.push(a),this.outputs.push(u)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,Ct);if(!n)return null;const a=[];let u=null;t.expectedType&&t.expectedType.kind!=="value"&&(u=t.expectedType);for(let d=1;d<e.length;d+=2){const p=d===1?-1/0:e[d],g=e[d+1],y=d,T=d+1;if(typeof p!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',y);if(a.length&&a[a.length-1][0]>=p)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',y);const S=t.parse(g,T,u);if(!S)return null;u=u||S.type,a.push([p,S])}return new As(u,n,a)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=t[0])return n[0].evaluate(e);const u=t.length;return a>=t[u-1]?n[u-1].evaluate(e):n[Es(t,a)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var rr=As;function ui(i,e,t){return i*(1-t)+e*t}function Ss(i,e,t){return i.map((n,a)=>ui(n,e[a],t))}var ol=Object.freeze({__proto__:null,number:ui,color:function(i,e,t){return new Ri(ui(i.r,e.r,t),ui(i.g,e.g,t),ui(i.b,e.b,t),ui(i.a,e.a,t))},array:Ss});const ra=.95047,$l=1.08883,ql=4/29,Is=6/29,Ca=3*Is*Is,sl=Math.PI/180,Ms=180/Math.PI;function Zl(i){return i>.008856451679035631?Math.pow(i,1/3):i/Ca+ql}function al(i){return i>Is?i*i*i:Ca*(i-ql)}function ll(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Pa(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Wl(i){const e=Pa(i.r),t=Pa(i.g),n=Pa(i.b),a=Zl((.4124564*e+.3575761*t+.1804375*n)/ra),u=Zl((.2126729*e+.7151522*t+.072175*n)/1);return{l:116*u-16,a:500*(a-u),b:200*(u-Zl((.0193339*e+.119192*t+.9503041*n)/$l)),alpha:i.a}}function Xl(i){let e=(i.l+16)/116,t=isNaN(i.a)?e:e+i.a/500,n=isNaN(i.b)?e:e-i.b/200;return e=1*al(e),t=ra*al(t),n=$l*al(n),new Ri(ll(3.2404542*t-1.5371385*e-.4985314*n),ll(-.969266*t+1.8760108*e+.041556*n),ll(.0556434*t-.2040259*e+1.0572252*n),i.alpha)}function Fc(i,e,t){const n=e-i;return i+t*(n>180||n<-180?n-360*Math.round(n/360):n)}const rs={forward:Wl,reverse:Xl,interpolate:function(i,e,t){return{l:ui(i.l,e.l,t),a:ui(i.a,e.a,t),b:ui(i.b,e.b,t),alpha:ui(i.alpha,e.alpha,t)}}},ns={forward:function(i){const{l:e,a:t,b:n}=Wl(i),a=Math.atan2(n,t)*Ms;return{h:a<0?a+360:a,c:Math.sqrt(t*t+n*n),l:e,alpha:i.a}},reverse:function(i){const e=i.h*sl,t=i.c;return Xl({l:i.l,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:i.alpha})},interpolate:function(i,e,t){return{h:Fc(i.h,e.h,t),c:ui(i.c,e.c,t),l:ui(i.l,e.l,t),alpha:ui(i.alpha,e.alpha,t)}}};var na=Object.freeze({__proto__:null,lab:rs,hcl:ns});class za{constructor(e,t,n,a,u){this.type=e,this.operator=t,this.interpolation=n,this.input=a,this.labels=[],this.outputs=[];for(const[d,p]of u)this.labels.push(d),this.outputs.push(p)}static interpolationFactor(e,t,n,a){let u=0;if(e.name==="exponential")u=vn(t,e.base,n,a);else if(e.name==="linear")u=vn(t,1,n,a);else if(e.name==="cubic-bezier"){const d=e.controlPoints;u=new me(d[0],d[1],d[2],d[3]).solve(vn(t,1,n,a))}return u}static parse(e,t){let[n,a,u,...d]=e;if(!Array.isArray(a)||a.length===0)return t.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const y=a[1];if(typeof y!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:y}}else{if(a[0]!=="cubic-bezier")return t.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const y=a.slice(1);if(y.length!==4||y.some(T=>typeof T!="number"||T<0||T>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:y}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(u=t.parse(u,2,Ct),!u)return null;const p=[];let g=null;n==="interpolate-hcl"||n==="interpolate-lab"?g=no:t.expectedType&&t.expectedType.kind!=="value"&&(g=t.expectedType);for(let y=0;y<d.length;y+=2){const T=d[y],S=d[y+1],C=y+3,O=y+4;if(typeof T!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(p.length&&p[p.length-1][0]>=T)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const F=t.parse(S,O,g);if(!F)return null;g=g||F.type,p.push([T,F])}return g.kind==="number"||g.kind==="color"||g.kind==="array"&&g.itemType.kind==="number"&&typeof g.N=="number"?new za(g,n,a,u,p):t.error(`Type ${ir(g)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=t[0])return n[0].evaluate(e);const u=t.length;if(a>=t[u-1])return n[u-1].evaluate(e);const d=Es(t,a),p=za.interpolationFactor(this.interpolation,a,t[d],t[d+1]),g=n[d].evaluate(e),y=n[d+1].evaluate(e);return this.operator==="interpolate"?ol[this.type.kind.toLowerCase()](g,y,p):this.operator==="interpolate-hcl"?ns.reverse(ns.interpolate(ns.forward(g),ns.forward(y),p)):rs.reverse(rs.interpolate(rs.forward(g),rs.forward(y),p))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function vn(i,e,t,n){const a=n-t,u=i-t;return a===0?0:e===1?u/a:(Math.pow(e,u)-1)/(Math.pow(e,a)-1)}var Hn=za;class oa{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const a=t.expectedType;a&&a.kind!=="value"&&(n=a);const u=[];for(const p of e.slice(1)){const g=t.parse(p,1+u.length,n,void 0,{typeAnnotation:"omit"});if(!g)return null;n=n||g.type,u.push(g)}const d=a&&u.some(p=>xs(a,p.type));return new oa(d?ti:n,u)}evaluate(e){let t,n=null,a=0;for(const u of this.args){if(a++,n=u.evaluate(e),n&&n instanceof Rn&&!n.available&&(t||(t=n),n=null,a===this.args.length))return t;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var cl=oa;class ul{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let u=1;u<e.length-1;u+=2){const d=e[u];if(typeof d!="string")return t.error(`Expected string, but found ${typeof d} instead.`,u);if(/[^a-zA-Z0-9_]/.test(d))return t.error("Variable names must contain only alphanumeric characters or '_'.",u);const p=t.parse(e[u+1],u+1);if(!p)return null;n.push([d,p])}const a=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return a?new ul(n,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}var M=ul;class D{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ct),a=t.parse(e[2],2,an(t.expectedType||ti));return n&&a?new D(a.type.itemType,n,a):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Yr(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new Yr(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new Yr(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var R=D;class W{constructor(e,t){this.type=fi,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,ti),a=t.parse(e[2],2,ti);return n&&a?Js(n.type,[fi,di,Ct,Ea,ti])?new W(n,a):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${ir(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!Po(t,["boolean","string","number","null"]))throw new Yr(`Expected first argument to be of type boolean, string, number or null, but found ${ir(gr(t))} instead.`);if(!Po(n,["string","array"]))throw new Yr(`Expected second argument to be of type array or string, but found ${ir(gr(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Re=W;class Je{constructor(e,t,n){this.type=Ct,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,ti),a=t.parse(e[2],2,ti);if(!n||!a)return null;if(!Js(n.type,[fi,di,Ct,Ea,ti]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${ir(n.type)} instead`);if(e.length===4){const u=t.parse(e[3],3,Ct);return u?new Je(n,a,u):null}return new Je(n,a)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Po(t,["boolean","string","number","null"]))throw new Yr(`Expected first argument to be of type boolean, string, number or null, but found ${ir(gr(t))} instead.`);if(!Po(n,["string","array"]))throw new Yr(`Expected second argument to be of type array or string, but found ${ir(gr(n))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return n.indexOf(t,a)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var yt=Je;class _t{constructor(e,t,n,a,u,d){this.inputType=e,this.type=t,this.input=n,this.cases=a,this.outputs=u,this.otherwise=d}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,a;t.expectedType&&t.expectedType.kind!=="value"&&(a=t.expectedType);const u={},d=[];for(let y=2;y<e.length-1;y+=2){let T=e[y];const S=e[y+1];Array.isArray(T)||(T=[T]);const C=t.concat(y);if(T.length===0)return C.error("Expected at least one branch label.");for(const F of T){if(typeof F!="number"&&typeof F!="string")return C.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return C.error("Numeric branch labels must be integer values.");if(n){if(C.checkSubtype(n,gr(F)))return null}else n=gr(F);if(u[String(F)]!==void 0)return C.error("Branch labels must be unique.");u[String(F)]=d.length}const O=t.parse(S,y,a);if(!O)return null;a=a||O.type,d.push(O)}const p=t.parse(e[1],1,ti);if(!p)return null;const g=t.parse(e[e.length-1],e.length-1,a);return g?p.type.kind!=="value"&&t.concat(1).checkSubtype(n,p.type)?null:new _t(n,a,p,u,d,g):null}evaluate(e){const t=this.input.evaluate(e);return(gr(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],a={};for(const d of t){const p=a[this.cases[d]];p===void 0?(a[this.cases[d]]=n.length,n.push([this.cases[d],[d]])):n[p][1].push(d)}const u=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,p]of n)e.push(p.length===1?u(p[0]):p.map(u)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}var Pt=_t;class qt{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&t.expectedType.kind!=="value"&&(n=t.expectedType);const a=[];for(let d=1;d<e.length-1;d+=2){const p=t.parse(e[d],d,fi);if(!p)return null;const g=t.parse(e[d+1],d+1,n);if(!g)return null;a.push([p,g]),n=n||g.type}const u=t.parse(e[e.length-1],e.length-1,n);return u?new qt(n,a,u):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Lt=qt;class Vi{constructor(e,t,n,a){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=a}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,ti),a=t.parse(e[2],2,Ct);if(!n||!a)return null;if(!Js(n.type,[an(ti),di,ti]))return t.error(`Expected first argument to be of type array or string, but found ${ir(n.type)} instead`);if(e.length===4){const u=t.parse(e[3],3,Ct);return u?new Vi(n.type,n,a,u):null}return new Vi(n.type,n,a)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Po(t,["string","array"]))throw new Yr(`Expected first argument to be of type array or string, but found ${ir(gr(t))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return t.slice(n,a)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ar=Vi;function bi(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Hi(i,e,t,n){return n.compare(e,t)===0}function mi(i,e,t){const n=i!=="=="&&i!=="!=";return class f0{constructor(u,d,p){this.type=fi,this.lhs=u,this.rhs=d,this.collator=p,this.hasUntypedArgument=u.type.kind==="value"||d.type.kind==="value"}static parse(u,d){if(u.length!==3&&u.length!==4)return d.error("Expected two or three arguments.");const p=u[0];let g=d.parse(u[1],1,ti);if(!g)return null;if(!bi(p,g.type))return d.concat(1).error(`"${p}" comparisons are not supported for type '${ir(g.type)}'.`);let y=d.parse(u[2],2,ti);if(!y)return null;if(!bi(p,y.type))return d.concat(2).error(`"${p}" comparisons are not supported for type '${ir(y.type)}'.`);if(g.type.kind!==y.type.kind&&g.type.kind!=="value"&&y.type.kind!=="value")return d.error(`Cannot compare types '${ir(g.type)}' and '${ir(y.type)}'.`);n&&(g.type.kind==="value"&&y.type.kind!=="value"?g=new so(y.type,[g]):g.type.kind!=="value"&&y.type.kind==="value"&&(y=new so(g.type,[y])));let T=null;if(u.length===4){if(g.type.kind!=="string"&&y.type.kind!=="string"&&g.type.kind!=="value"&&y.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(T=d.parse(u[3],3,Ys),!T)return null}return new f0(g,y,T)}evaluate(u){const d=this.lhs.evaluate(u),p=this.rhs.evaluate(u);if(n&&this.hasUntypedArgument){const g=gr(d),y=gr(p);if(g.kind!==y.kind||g.kind!=="string"&&g.kind!=="number")throw new Yr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${g.kind}, ${y.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const g=gr(d),y=gr(p);if(g.kind!=="string"||y.kind!=="string")return e(u,d,p)}return this.collator?t(u,d,p,this.collator.evaluate(u)):e(u,d,p)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[i];return this.eachChild(d=>{u.push(d.serialize())}),u}}}const Ti=mi("==",function(i,e,t){return e===t},Hi),hr=mi("!=",function(i,e,t){return e!==t},function(i,e,t,n){return!Hi(0,e,t,n)}),yr=mi("<",function(i,e,t){return e<t},function(i,e,t,n){return n.compare(e,t)<0}),nr=mi(">",function(i,e,t){return e>t},function(i,e,t,n){return n.compare(e,t)>0}),ki=mi("<=",function(i,e,t){return e<=t},function(i,e,t,n){return n.compare(e,t)<=0}),dr=mi(">=",function(i,e,t){return e>=t},function(i,e,t,n){return n.compare(e,t)>=0});class Ji{constructor(e,t,n,a,u,d){this.type=di,this.number=e,this.locale=t,this.currency=n,this.unit=a,this.minFractionDigits=u,this.maxFractionDigits=d}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const n=t.parse(e[1],1,Ct);if(!n)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return t.error("NumberFormat options argument must be an object.");let u=null;if(a.locale&&(u=t.parse(a.locale,1,di),!u))return null;let d=null;if(a.currency&&(d=t.parse(a.currency,1,di),!d))return null;let p=null;if(a.unit&&(p=t.parse(a.unit,1,di),!p))return null;let g=null;if(a["min-fraction-digits"]&&(g=t.parse(a["min-fraction-digits"],1,Ct),!g))return null;let y=null;return a["max-fraction-digits"]&&(y=t.parse(a["max-fraction-digits"],1,Ct),!y)?null:new Ji(n,u,d,p,g,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Gi{constructor(e){this.type=Ct,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${ir(n.type)} instead.`):new Gi(n):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Yr(`Expected value to be of type string or array, but found ${ir(gr(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}const Se={"==":Ti,"!=":hr,">":nr,"<":yr,">=":dr,"<=":ki,array:so,at:R,boolean:so,case:Lt,coalesce:cl,collator:Xi,format:il,image:Ol,in:Re,"index-of":yt,interpolate:Hn,"interpolate-hcl":Hn,"interpolate-lab":Hn,length:Gi,let:M,literal:tl,match:Pt,number:so,"number-format":Ji,object:so,slice:Ar,step:rr,string:so,"to-boolean":Ma,"to-color":Ma,"to-number":Ma,"to-string":Ma,var:yn,within:ia};function Xe(i,[e,t,n,a]){e=e.evaluate(i),t=t.evaluate(i),n=n.evaluate(i);const u=a?a.evaluate(i):1,d=Ll(e,t,n,u);if(d)throw new Yr(d);return new Ri(e/255*u,t/255*u,n/255*u,u)}function Be(i,e){return i in e}function It(i,e){const t=e[i];return t===void 0?null:t}function Gt(i){return{type:i}}zi.register(Se,{error:[{kind:"error"},[di],(i,[e])=>{throw new Yr(e.evaluate(i))}],typeof:[di,[ti],(i,[e])=>ir(gr(e.evaluate(i)))],"to-rgba":[an(Ct,4),[no],(i,[e])=>e.evaluate(i).toArray()],rgb:[no,[Ct,Ct,Ct],Xe],rgba:[no,[Ct,Ct,Ct,Ct],Xe],has:{type:fi,overloads:[[[di],(i,[e])=>Be(e.evaluate(i),i.properties())],[[di,oo],(i,[e,t])=>Be(e.evaluate(i),t.evaluate(i))]]},get:{type:ti,overloads:[[[di],(i,[e])=>It(e.evaluate(i),i.properties())],[[di,oo],(i,[e,t])=>It(e.evaluate(i),t.evaluate(i))]]},"feature-state":[ti,[di],(i,[e])=>It(e.evaluate(i),i.featureState||{})],properties:[oo,[],i=>i.properties()],"geometry-type":[di,[],i=>i.geometryType()],id:[ti,[],i=>i.id()],zoom:[Ct,[],i=>i.globals.zoom],pitch:[Ct,[],i=>i.globals.pitch||0],"distance-from-center":[Ct,[],i=>i.distanceFromCenter()],"heatmap-density":[Ct,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ct,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Ct,[],i=>i.globals.skyRadialProgress||0],accumulated:[ti,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ct,Gt(Ct),(i,e)=>{let t=0;for(const n of e)t+=n.evaluate(i);return t}],"*":[Ct,Gt(Ct),(i,e)=>{let t=1;for(const n of e)t*=n.evaluate(i);return t}],"-":{type:Ct,overloads:[[[Ct,Ct],(i,[e,t])=>e.evaluate(i)-t.evaluate(i)],[[Ct],(i,[e])=>-e.evaluate(i)]]},"/":[Ct,[Ct,Ct],(i,[e,t])=>e.evaluate(i)/t.evaluate(i)],"%":[Ct,[Ct,Ct],(i,[e,t])=>e.evaluate(i)%t.evaluate(i)],ln2:[Ct,[],()=>Math.LN2],pi:[Ct,[],()=>Math.PI],e:[Ct,[],()=>Math.E],"^":[Ct,[Ct,Ct],(i,[e,t])=>Math.pow(e.evaluate(i),t.evaluate(i))],sqrt:[Ct,[Ct],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ct,[Ct],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ct,[Ct],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ct,[Ct],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ct,[Ct],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ct,[Ct],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ct,[Ct],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ct,[Ct],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ct,[Ct],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ct,[Ct],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ct,Gt(Ct),(i,e)=>Math.min(...e.map(t=>t.evaluate(i)))],max:[Ct,Gt(Ct),(i,e)=>Math.max(...e.map(t=>t.evaluate(i)))],abs:[Ct,[Ct],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ct,[Ct],(i,[e])=>{const t=e.evaluate(i);return t<0?-Math.round(-t):Math.round(t)}],floor:[Ct,[Ct],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ct,[Ct],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[fi,[di,ti],(i,[e,t])=>i.properties()[e.value]===t.value],"filter-id-==":[fi,[ti],(i,[e])=>i.id()===e.value],"filter-type-==":[fi,[di],(i,[e])=>i.geometryType()===e.value],"filter-<":[fi,[di,ti],(i,[e,t])=>{const n=i.properties()[e.value],a=t.value;return typeof n==typeof a&&n<a}],"filter-id-<":[fi,[ti],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t<n}],"filter->":[fi,[di,ti],(i,[e,t])=>{const n=i.properties()[e.value],a=t.value;return typeof n==typeof a&&n>a}],"filter-id->":[fi,[ti],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t>n}],"filter-<=":[fi,[di,ti],(i,[e,t])=>{const n=i.properties()[e.value],a=t.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[fi,[ti],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t<=n}],"filter->=":[fi,[di,ti],(i,[e,t])=>{const n=i.properties()[e.value],a=t.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[fi,[ti],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t>=n}],"filter-has":[fi,[ti],(i,[e])=>e.value in i.properties()],"filter-has-id":[fi,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[fi,[an(di)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[fi,[an(ti)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[fi,[di,an(ti)],(i,[e,t])=>t.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[fi,[di,an(ti)],(i,[e,t])=>function(n,a,u,d){for(;u<=d;){const p=u+d>>1;if(a[p]===n)return!0;a[p]>n?d=p-1:u=p+1}return!1}(i.properties()[e.value],t.value,0,t.value.length-1)],all:{type:fi,overloads:[[[fi,fi],(i,[e,t])=>e.evaluate(i)&&t.evaluate(i)],[Gt(fi),(i,e)=>{for(const t of e)if(!t.evaluate(i))return!1;return!0}]]},any:{type:fi,overloads:[[[fi,fi],(i,[e,t])=>e.evaluate(i)||t.evaluate(i)],[Gt(fi),(i,e)=>{for(const t of e)if(t.evaluate(i))return!0;return!1}]]},"!":[fi,[fi],(i,[e])=>!e.evaluate(i)],"is-supported-script":[fi,[di],(i,[e])=>{const t=i.globals&&i.globals.isSupportedScript;return!t||t(e.evaluate(i))}],upcase:[di,[di],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[di,[di],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[di,Gt(ti),(i,e)=>e.map(t=>Sa(t.evaluate(i))).join("")],"resolved-locale":[di,[Ys],(i,[e])=>e.evaluate(i).resolvedLocale()]});var si=Se;function fr(i){return{result:"success",value:i}}function Di(i){return{result:"error",value:i}}function Lr(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ao(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function un(i){return!!i.expression&&i.expression.interpolated}function _i(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Cs(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function os(i){return i}function lo(i,e){const t=e.type==="color",n=i.stops&&typeof i.stops[0][0]=="object",a=n||!(n||i.property!==void 0),u=i.type||(un(e)?"exponential":"interval");if(t&&((i=sn({},i)).stops&&(i.stops=i.stops.map(y=>[y[0],Ri.parse(y[1])])),i.default=Ri.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!na[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let d,p,g;if(u==="exponential")d=Ps;else if(u==="interval")d=Mn;else if(u==="categorical"){d=Bi,p=Object.create(null);for(const y of i.stops)p[y[0]]=y[1];g=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);d=co}if(n){const y={},T=[];for(let O=0;O<i.stops.length;O++){const F=i.stops[O],$=F[0].zoom;y[$]===void 0&&(y[$]={zoom:$,type:i.type,property:i.property,default:i.default,stops:[]},T.push($)),y[$].stops.push([F[0].value,F[1]])}const S=[];for(const O of T)S.push([y[O].zoom,lo(y[O],e)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:Hn.interpolationFactor.bind(void 0,C),zoomStops:S.map(O=>O[0]),evaluate:({zoom:O},F)=>Ps({stops:S,base:i.base},e,O).evaluate(O,F)}}if(a){const y=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:y,interpolationFactor:Hn.interpolationFactor.bind(void 0,y),zoomStops:i.stops.map(T=>T[0]),evaluate:({zoom:T})=>d(i,e,T,p,g)}}return{kind:"source",evaluate(y,T){const S=T&&T.properties?T.properties[i.property]:void 0;return S===void 0?go(i.default,e.default):d(i,e,S,p,g)}}}function go(i,e,t){return i!==void 0?i:e!==void 0?e:t!==void 0?t:void 0}function Bi(i,e,t,n,a){return go(typeof t===a?n[t]:void 0,i.default,e.default)}function Mn(i,e,t){if(_i(t)!=="number")return go(i.default,e.default);const n=i.stops.length;if(n===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[n-1][0])return i.stops[n-1][1];const a=Es(i.stops.map(u=>u[0]),t);return i.stops[a][1]}function Ps(i,e,t){const n=i.base!==void 0?i.base:1;if(_i(t)!=="number")return go(i.default,e.default);const a=i.stops.length;if(a===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[a-1][0])return i.stops[a-1][1];const u=Es(i.stops.map(T=>T[0]),t),d=function(T,S,C,O){const F=O-C,$=T-C;return F===0?0:S===1?$/F:(Math.pow(S,$)-1)/(Math.pow(S,F)-1)}(t,n,i.stops[u][0],i.stops[u+1][0]),p=i.stops[u][1],g=i.stops[u+1][1];let y=ol[e.type]||os;if(i.colorSpace&&i.colorSpace!=="rgb"){const T=na[i.colorSpace];y=(S,C)=>T.reverse(T.interpolate(T.forward(S),T.forward(C),d))}return typeof p.evaluate=="function"?{evaluate(...T){const S=p.evaluate.apply(void 0,T),C=g.evaluate.apply(void 0,T);if(S!==void 0&&C!==void 0)return y(S,C,d)}}:y(p,g,d)}function co(i,e,t){return e.type==="color"?t=Ri.parse(t):e.type==="formatted"?t=Nr.fromString(t.toString()):e.type==="resolvedImage"?t=Rn.fromString(t.toString()):_i(t)===e.type||e.type==="enum"&&e.values[t]||(t=void 0),go(t,i.default,e.default)}class ss{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Oc,this._defaultValue=t?function(n){return n.type==="color"&&(Cs(n.default)||Array.isArray(n.default))?new Ri(0,0,0,0):n.type==="color"?Ri.parse(n.default)||null:n.default===void 0?null:n.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,n,a,u,d,p,g){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=g||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,a,u,d,p,g){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=g||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Yr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function ka(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in si}function Da(i,e){const t=new is(si,[],e?function(a){const u={color:no,string:di,number:Ct,enum:di,boolean:fi,formatted:vs,resolvedImage:Aa};return a.type==="array"?an(u[a.value]||ti,a.length):u[a.type]}(e):void 0),n=t.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?fr(new ss(n,e)):Di(t.errors)}class zs{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!zo(t.expression)}evaluateWithoutErrorHandling(e,t,n,a,u,d){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,a,u,d)}evaluate(e,t,n,a,u,d){return this._styleExpression.evaluate(e,t,n,a,u,d)}}class uo{constructor(e,t,n,a){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!zo(t.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,t,n,a,u,d){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,a,u,d)}evaluate(e,t,n,a,u,d){return this._styleExpression.evaluate(e,t,n,a,u,d)}interpolationFactor(e,t,n){return this.interpolationType?Hn.interpolationFactor(this.interpolationType,e,t,n):0}}function sa(i,e){if((i=Da(i,e)).result==="error")return i;const t=i.value.expression,n=ts(t);if(!n&&!Lr(e))return Di([new ro("","data expressions not supported")]);const a=cn(t,["zoom","pitch","distance-from-center"]);if(!a&&!ao(e))return Di([new ro("","zoom expressions not supported")]);const u=as(t);return u||a?u instanceof ro?Di([u]):u instanceof Hn&&!un(e)?Di([new ro("",'"interpolate" expressions cannot be used with this property')]):fr(u?new uo(n?"camera":"composite",i.value,u.labels,u instanceof Hn?u.interpolation:void 0):new zs(n?"constant":"source",i.value)):Di([new ro("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class aa{constructor(e,t){this._parameters=e,this._specification=t,sn(this,lo(this._parameters,this._specification))}static deserialize(e){return new aa(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function as(i){let e=null;if(i instanceof M)e=as(i.result);else if(i instanceof cl){for(const t of i.args)if(e=as(t),e)break}else(i instanceof rr||i instanceof Hn)&&i.input instanceof zi&&i.input.name==="zoom"&&(e=i);return e instanceof ro||i.eachChild(t=>{const n=as(t);n instanceof ro?e=n:!e&&n?e=new ro("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new ro("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class St{constructor(e,t,n,a){this.message=(e?`${e}: `:"")+n,a&&(this.identifier=a),t!=null&&t.__line__&&(this.line=t.__line__)}}function Cn(i){const e=i.key,t=i.value,n=i.valueSpec||{},a=i.objectElementValidators||{},u=i.style,d=i.styleSpec;let p=[];const g=_i(t);if(g!=="object")return[new St(e,t,`object expected, ${g} found`)];for(const y in t){const T=y.split(".")[0],S=n[T]||n["*"];let C;a[T]?C=a[T]:n[T]?C=zn:a["*"]?C=a["*"]:n["*"]&&(C=zn),C?p=p.concat(C({key:(e&&`${e}.`)+y,value:t[y],valueSpec:S,style:u,styleSpec:d,object:t,objectKey:y},t)):p.push(new St(e,t[y],`unknown property "${y}"`))}for(const y in n)a[y]||n[y].required&&n[y].default===void 0&&t[y]===void 0&&p.push(new St(e,t,`missing required property "${y}"`));return p}function La(i){const e=i.value,t=i.valueSpec,n=i.style,a=i.styleSpec,u=i.key,d=i.arrayElementValidator||zn;if(_i(e)!=="array")return[new St(u,e,`array expected, ${_i(e)} found`)];if(t.length&&e.length!==t.length)return[new St(u,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new St(u,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let p={type:t.value,values:t.values,minimum:t.minimum,maximum:t.maximum,function:void 0};a.$version<7&&(p.function=t.function),_i(t.value)==="object"&&(p=t.value);let g=[];for(let y=0;y<e.length;y++)g=g.concat(d({array:e,arrayIndex:y,value:e[y],valueSpec:p,style:n,styleSpec:a,key:`${u}[${y}]`}));return g}function Hl(i){const e=i.key,t=i.value,n=i.valueSpec;let a=_i(t);if(a==="number"&&t!=t&&(a="NaN"),a!=="number")return[new St(e,t,`number expected, ${a} found`)];if("minimum"in n){let u=n.minimum;if(_i(n.minimum)==="array"&&(u=n.minimum[i.arrayIndex]),t<u)return[new St(e,t,`${t} is less than the minimum value ${u}`)]}if("maximum"in n){let u=n.maximum;if(_i(n.maximum)==="array"&&(u=n.maximum[i.arrayIndex]),t>u)return[new St(e,t,`${t} is greater than the maximum value ${u}`)]}return[]}function Pn(i){const e=i.valueSpec,t=ur(i.value.type);let n,a,u,d={};const p=t!=="categorical"&&i.value.property===void 0,g=!p,y=_i(i.value.stops)==="array"&&_i(i.value.stops[0])==="array"&&_i(i.value.stops[0][0])==="object",T=Cn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(O){if(t==="identity")return[new St(O.key,O.value,'identity function may not have a "stops" property')];let F=[];const $=O.value;return F=F.concat(La({key:O.key,value:$,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:S})),_i($)==="array"&&$.length===0&&F.push(new St(O.key,$,"array must have at least one stop")),F},default:function(O){return zn({key:O.key,value:O.value,valueSpec:e,style:O.style,styleSpec:O.styleSpec})}}});return t==="identity"&&p&&T.push(new St(i.key,i.value,'missing required property "property"')),t==="identity"||i.value.stops||T.push(new St(i.key,i.value,'missing required property "stops"')),t==="exponential"&&i.valueSpec.expression&&!un(i.valueSpec)&&T.push(new St(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(g&&!Lr(i.valueSpec)?T.push(new St(i.key,i.value,"property functions not supported")):p&&!ao(i.valueSpec)&&T.push(new St(i.key,i.value,"zoom functions not supported"))),t!=="categorical"&&!y||i.value.property!==void 0||T.push(new St(i.key,i.value,'"property" property is required')),T;function S(O){let F=[];const $=O.value,Y=O.key;if(_i($)!=="array")return[new St(Y,$,`array expected, ${_i($)} found`)];if($.length!==2)return[new St(Y,$,`array length 2 expected, length ${$.length} found`)];if(y){if(_i($[0])!=="object")return[new St(Y,$,`object expected, ${_i($[0])} found`)];if($[0].zoom===void 0)return[new St(Y,$,"object stop key must have zoom")];if($[0].value===void 0)return[new St(Y,$,"object stop key must have value")];const ae=ur($[0].zoom);if(typeof ae!="number")return[new St(Y,$[0].zoom,"stop zoom values must be numbers")];if(u&&u>ae)return[new St(Y,$[0].zoom,"stop zoom values must appear in ascending order")];ae!==u&&(u=ae,a=void 0,d={}),F=F.concat(Cn({key:`${Y}[0]`,value:$[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:Hl,value:C}}))}else F=F.concat(C({key:`${Y}[0]`,value:$[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},$));return ka(ys($[1]))?F.concat([new St(`${Y}[1]`,$[1],"expressions are not allowed in function stops.")]):F.concat(zn({key:`${Y}[1]`,value:$[1],valueSpec:e,style:O.style,styleSpec:O.styleSpec}))}function C(O,F){const $=_i(O.value),Y=ur(O.value),ae=O.value!==null?O.value:F;if(n){if($!==n)return[new St(O.key,ae,`${$} stop domain type must match previous stop domain type ${n}`)]}else n=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof Y!="number"&&typeof Y!="string"&&typeof Y!="boolean")return[new St(O.key,ae,"stop domain value must be a number, string, or boolean")];if($!=="number"&&t!=="categorical"){let pe=`number expected, ${$} found`;return Lr(e)&&t===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new St(O.key,ae,pe)]}return t!=="categorical"||$!=="number"||typeof Y=="number"&&isFinite(Y)&&Math.floor(Y)===Y?t!=="categorical"&&$==="number"&&typeof Y=="number"&&typeof a=="number"&&a!==void 0&&Y<a?[new St(O.key,ae,"stop domain values must appear in ascending order")]:(a=Y,t==="categorical"&&Y in d?[new St(O.key,ae,"stop domain values must be unique")]:(d[Y]=!0,[])):[new St(O.key,ae,`integer expected, found ${String(Y)}`)]}}function Or(i){const e=(i.expressionContext==="property"?sa:Da)(ys(i.value),i.valueSpec);if(e.result==="error")return e.value.map(n=>new St(`${i.key}${n.key}`,i.value,n.message));const t=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!t.outputDefined())return[new St(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!zo(t))return[new St(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return la(t,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!cn(t,["zoom","feature-state"]))return[new St(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ts(t))return[new St(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function la(i,e){const t=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const a of e.valueSpec.expression.parameters)t.delete(a);if(t.size===0)return[];const n=[];return i instanceof zi&&t.has(i.name)?[new St(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(a=>{n.push(...la(a,e))}),n)}function Oa(i){const e=i.key,t=i.value,n=i.valueSpec,a=[];return Array.isArray(n.values)?n.values.indexOf(ur(t))===-1&&a.push(new St(e,t,`expected one of [${n.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(n.values).indexOf(ur(t))===-1&&a.push(new St(e,t,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(t)} found`)),a}function ca(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ca(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ra(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ca(i)||(i=Uc(i));const t=i;let n=!0;try{n=function(y){if(!ho(y))return y;let T=ys(y);return ua(T),T=Ba(T),T}(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(t,null,2)}
        `)}const a=$e[`filter_${e}`],u=Da(n,a);let d=null;if(u.result==="error")throw new Error(u.value.map(y=>`${y.key}: ${y.message}`).join(", "));d=(y,T,S)=>u.value.evaluate(y,T,{},S);let p=null,g=null;if(n!==t){const y=Da(t,a);if(y.result==="error")throw new Error(y.value.map(T=>`${T.key}: ${T.message}`).join(", "));p=(T,S,C,O,F)=>y.value.evaluate(T,S,{},C,void 0,void 0,O,F),g=!ts(y.value.expression)}return d=d,{filter:d,dynamicFilter:p||void 0,needGeometry:wh(n),needFeature:!!g}}function Ba(i){if(!Array.isArray(i))return i;const e=function(t){if(jd.has(t[0])){for(let n=1;n<t.length;n++)if(ho(t[n]))return!0}return t}(i);return e===!0?e:e.map(t=>Ba(t))}function ua(i){let e=!1;const t=[];if(i[0]==="case"){for(let n=1;n<i.length-1;n+=2)e=e||ho(i[n]),t.push(i[n+1]);t.push(i[i.length-1])}else if(i[0]==="match"){e=e||ho(i[1]);for(let n=2;n<i.length-1;n+=2)t.push(i[n+1]);t.push(i[i.length-1])}else if(i[0]==="step"){e=e||ho(i[1]);for(let n=1;n<i.length-1;n+=2)t.push(i[n+1])}e&&(i.length=0,i.push("any",...t));for(let n=1;n<i.length;n++)ua(i[n])}function ho(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let t=1;t<i.length;t++)if(ho(i[t]))return!0;return!1}const jd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function bh(i,e){return i<e?-1:i>e?1:0}function wh(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(wh(i[e]))return!0;return!1}function Uc(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?jr(i[1],i[2],"=="):e==="!="?Un(jr(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?jr(i[1],i[2],e):e==="any"?(t=i.slice(1),["any"].concat(t.map(Uc))):e==="all"?["all"].concat(i.slice(1).map(Uc)):e==="none"?["all"].concat(i.slice(1).map(Uc).map(Un)):e==="in"?Qr(i[1],i.slice(2)):e==="!in"?Un(Qr(i[1],i.slice(2))):e==="has"?uc(i[1]):e==="!has"?Un(uc(i[1])):e!=="within"||i;var t}function jr(i,e,t){switch(i){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,i,e]}}function Qr(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",i,["literal",e.sort(bh)]]:["filter-in-small",i,["literal",e]]}}function uc(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Un(i){return["!",i]}function hl(i){return ca(ys(i.value))?Or(sn({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):Th(i)}function Th(i){const e=i.value,t=i.key;if(_i(e)!=="array")return[new St(t,e,`array expected, ${_i(e)} found`)];const n=i.styleSpec;let a,u=[];if(e.length<1)return[new St(t,e,"filter array must have at least 1 element")];switch(u=u.concat(Oa({key:`${t}[0]`,value:e[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),ur(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ur(e[1])==="$type"&&u.push(new St(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new St(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(a=_i(e[1]),a!=="string"&&u.push(new St(`${t}[1]`,e[1],`string expected, ${a} found`)));for(let d=2;d<e.length;d++)a=_i(e[d]),ur(e[1])==="$type"?u=u.concat(Oa({key:`${t}[${d}]`,value:e[d],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):a!=="string"&&a!=="number"&&a!=="boolean"&&u.push(new St(`${t}[${d}]`,e[d],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let d=1;d<e.length;d++)u=u.concat(Th({key:`${t}[${d}]`,value:e[d],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":a=_i(e[1]),e.length!==2?u.push(new St(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="string"&&u.push(new St(`${t}[1]`,e[1],`string expected, ${a} found`));break;case"within":a=_i(e[1]),e.length!==2?u.push(new St(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="object"&&u.push(new St(`${t}[1]`,e[1],`object expected, ${a} found`))}return u}function Nc(i,e){const t=i.key,n=i.style,a=i.styleSpec,u=i.value,d=i.objectKey,p=a[`${e}_${i.layerType}`];if(!p)return[];const g=d.match(/^(.*)-transition$/);if(e==="paint"&&g&&p[g[1]]&&p[g[1]].transition)return zn({key:t,value:u,valueSpec:a.transition,style:n,styleSpec:a});const y=i.valueSpec||p[d];if(!y)return[new St(t,u,`unknown property "${d}"`)];let T;if(_i(u)==="string"&&Lr(y)&&!y.tokens&&(T=/^{([^}]+)}$/.exec(u)))return[new St(t,u,`"${d}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const S=[];return i.layerType==="symbol"&&(d==="text-field"&&n&&!n.glyphs&&S.push(new St(t,u,'use of "text-field" requires a style "glyphs" property')),d==="text-font"&&Cs(ys(u))&&ur(u.type)==="identity"&&S.push(new St(t,u,'"text-font" does not support identity functions'))),S.concat(zn({key:i.key,value:u,valueSpec:y,style:n,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:d}))}function Kl(i){return Nc(i,"paint")}function jc(i){return Nc(i,"layout")}function ha(i){let e=[];const t=i.value,n=i.key,a=i.style,u=i.styleSpec;t.type||t.ref||e.push(new St(n,t,'either "type" or "ref" is required'));let d=ur(t.type);const p=ur(t.ref);if(t.id){const g=ur(t.id);for(let y=0;y<i.arrayIndex;y++){const T=a.layers[y];ur(T.id)===g&&e.push(new St(n,t.id,`duplicate layer id "${t.id}", previously used at line ${T.id.__line__}`))}}if("ref"in t){let g;["type","source","source-layer","filter","layout"].forEach(y=>{y in t&&e.push(new St(n,t[y],`"${y}" is prohibited for ref layers`))}),a.layers.forEach(y=>{ur(y.id)===p&&(g=y)}),g?g.ref?e.push(new St(n,t.ref,"ref cannot reference another ref layer")):d=ur(g.type):typeof p=="string"&&e.push(new St(n,t.ref,`ref layer "${p}" not found`))}else if(d!=="background"&&d!=="sky")if(t.source){const g=a.sources&&a.sources[t.source],y=g&&ur(g.type);g?y==="vector"&&d==="raster"?e.push(new St(n,t.source,`layer "${t.id}" requires a raster source`)):y==="raster"&&d!=="raster"?e.push(new St(n,t.source,`layer "${t.id}" requires a vector source`)):y!=="vector"||t["source-layer"]?y==="raster-dem"&&d!=="hillshade"?e.push(new St(n,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!t.paint||!t.paint["line-gradient"]&&!t.paint["line-trim-offset"]||y==="geojson"&&g.lineMetrics||e.push(new St(n,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new St(n,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new St(n,t.source,`source "${t.source}" not found`))}else e.push(new St(n,t,'missing required property "source"'));return e=e.concat(Cn({key:n,value:t,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zn({key:`${n}.type`,value:t.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,object:t,objectKey:"type"}),filter:g=>hl(sn({layerType:d},g)),layout:g=>Cn({layer:t,key:g.key,value:g.value,valueSpec:{},style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":y=>jc(sn({layerType:d},y))}}),paint:g=>Cn({layer:t,key:g.key,value:g.value,valueSpec:{},style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":y=>Kl(sn({layerType:d},y))}})}})),e}function ks(i){const e=i.value,t=i.key,n=_i(e);return n!=="string"?[new St(t,e,`string expected, ${n} found`)]:[]}const Fa={promoteId:function({key:i,value:e}){if(_i(e)==="string")return ks({key:i,value:e});{const t=[];for(const n in e)t.push(...ks({key:`${i}.${n}`,value:e[n]}));return t}}};function hc(i){const e=i.value,t=i.key,n=i.styleSpec,a=i.style;if(!e.type)return[new St(t,e,'"type" is required')];const u=ur(e.type);let d;switch(u){case"vector":case"raster":case"raster-dem":return d=Cn({key:t,value:e,valueSpec:n[`source_${u.replace("-","_")}`],style:i.style,styleSpec:n,objectElementValidators:Fa}),d;case"geojson":if(d=Cn({key:t,value:e,valueSpec:n.source_geojson,style:a,styleSpec:n,objectElementValidators:Fa}),e.cluster)for(const p in e.clusterProperties){const[g,y]=e.clusterProperties[p],T=typeof g=="string"?[g,["accumulated"],["get",p]]:g;d.push(...Or({key:`${t}.${p}.map`,value:y,expressionContext:"cluster-map"})),d.push(...Or({key:`${t}.${p}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return d;case"video":return Cn({key:t,value:e,valueSpec:n.source_video,style:a,styleSpec:n});case"image":return Cn({key:t,value:e,valueSpec:n.source_image,style:a,styleSpec:n});case"canvas":return[new St(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Oa({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:a,styleSpec:n})}}function dl(i){const e=i.value,t=i.styleSpec,n=t.light,a=i.style;let u=[];const d=_i(e);if(e===void 0)return u;if(d!=="object")return u=u.concat([new St("light",e,`object expected, ${d} found`)]),u;for(const p in e){const g=p.match(/^(.*)-transition$/);u=u.concat(g&&n[g[1]]&&n[g[1]].transition?zn({key:p,value:e[p],valueSpec:t.transition,style:a,styleSpec:t}):n[p]?zn({key:p,value:e[p],valueSpec:n[p],style:a,styleSpec:t}):[new St(p,e[p],`unknown property "${p}"`)])}return u}function Vc(i){const e=i.value,t=i.key,n=i.style,a=i.styleSpec,u=a.terrain;let d=[];const p=_i(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new St("terrain",e,`object expected, ${p} found`)]),d;for(const g in e){const y=g.match(/^(.*)-transition$/);d=d.concat(y&&u[y[1]]&&u[y[1]].transition?zn({key:g,value:e[g],valueSpec:a.transition,style:n,styleSpec:a}):u[g]?zn({key:g,value:e[g],valueSpec:u[g],style:n,styleSpec:a}):[new St(g,e[g],`unknown property "${g}"`)])}if(e.source){const g=n.sources&&n.sources[e.source],y=g&&ur(g.type);g?y!=="raster-dem"&&d.push(new St(t,e.source,`terrain cannot be used with a source of type ${String(y)}, it only be used with a "raster-dem" source type`)):d.push(new St(t,e.source,`source "${e.source}" not found`))}else d.push(new St(t,e,'terrain is missing required property "source"'));return d}function Eh(i){const e=i.value,t=i.style,n=i.styleSpec,a=n.fog;let u=[];const d=_i(e);if(e===void 0)return u;if(d!=="object")return u=u.concat([new St("fog",e,`object expected, ${d} found`)]),u;for(const p in e){const g=p.match(/^(.*)-transition$/);u=u.concat(g&&a[g[1]]&&a[g[1]].transition?zn({key:p,value:e[p],valueSpec:n.transition,style:t,styleSpec:n}):a[p]?zn({key:p,value:e[p],valueSpec:a[p],style:t,styleSpec:n}):[new St(p,e[p],`unknown property "${p}"`)])}return u}const Eu={"*":()=>[],array:La,boolean:function(i){const e=i.value,t=i.key,n=_i(e);return n!=="boolean"?[new St(t,e,`boolean expected, ${n} found`)]:[]},number:Hl,color:function(i){const e=i.key,t=i.value,n=_i(t);return n!=="string"?[new St(e,t,`color expected, ${n} found`)]:Yo.parseCSSColor(t)===null?[new St(e,t,`color expected, "${t}" found`)]:[]},enum:Oa,filter:hl,function:Pn,layer:ha,object:Cn,source:hc,light:dl,terrain:Vc,fog:Eh,string:ks,formatted:function(i){return ks(i).length===0?[]:Or(i)},resolvedImage:function(i){return ks(i).length===0?[]:Or(i)},projection:function(i){const e=i.value,t=i.styleSpec,n=t.projection,a=i.style;let u=[];const d=_i(e);if(d==="object")for(const p in e)u=u.concat(zn({key:p,value:e[p],valueSpec:n[p],style:a,styleSpec:t}));else d!=="string"&&(u=u.concat([new St("projection",e,`object or string expected, ${d} found`)]));return u}};function zn(i){const e=i.value,t=i.valueSpec,n=i.styleSpec;return t.expression&&Cs(ur(e))?Pn(i):t.expression&&ka(ys(e))?Or(i):t.type&&Eu[t.type]?Eu[t.type](i):Cn(sn({},i,{valueSpec:t.type?n[t.type]:t}))}function Vd(i){const e=i.value,t=i.key,n=ks(i);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new St(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new St(t,e,'"glyphs" url must include a "{range}" token'))),n}function fl(i,e=$e){return X(zn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Vd,"*":()=>[]}}))}const Ua=i=>X(Kl(i)),Au=i=>X(jc(i));function X(i){return i.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function Na(i,e){let t=!1;if(e&&e.length)for(const n of e)i.fire(new xi(new Error(n.message))),t=!0;return t}var da=Sr;function Sr(i,e,t){var n=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var a=new Int32Array(this.arrayBuffer);i=a[0],this.d=(e=a[1])+2*(t=a[2]);for(var u=0;u<this.d*this.d;u++){var d=a[3+u],p=a[3+u+1];n.push(d===p?null:a.subarray(d,p))}var g=a[3+n.length+1];this.keys=a.subarray(a[3+n.length],g),this.bboxes=a.subarray(g),this.insert=this._insertReadonly}else{this.d=e+2*t;for(var y=0;y<this.d*this.d;y++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=t,this.scale=e/i,this.uid=0;var T=t/e*i;this.min=-T,this.max=i+T}Sr.prototype.insert=function(i,e,t,n,a){this._forEachCell(e,t,n,a,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(a)},Sr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Sr.prototype._insertCell=function(i,e,t,n,a,u){this.cells[a].push(u)},Sr.prototype.query=function(i,e,t,n,a){var u=this.min,d=this.max;if(i<=u&&e<=u&&d<=t&&d<=n&&!a)return Array.prototype.slice.call(this.keys);var p=[];return this._forEachCell(i,e,t,n,this._queryCell,p,{},a),p},Sr.prototype._queryCell=function(i,e,t,n,a,u,d,p){var g=this.cells[a];if(g!==null)for(var y=this.keys,T=this.bboxes,S=0;S<g.length;S++){var C=g[S];if(d[C]===void 0){var O=4*C;(p?p(T[O+0],T[O+1],T[O+2],T[O+3]):i<=T[O+2]&&e<=T[O+3]&&t>=T[O+0]&&n>=T[O+1])?(d[C]=!0,u.push(y[C])):d[C]=!1}}},Sr.prototype._forEachCell=function(i,e,t,n,a,u,d,p){for(var g=this._convertToCellCoord(i),y=this._convertToCellCoord(e),T=this._convertToCellCoord(t),S=this._convertToCellCoord(n),C=g;C<=T;C++)for(var O=y;O<=S;O++){var F=this.d*O+C;if((!p||p(this._convertFromCellCoord(C),this._convertFromCellCoord(O),this._convertFromCellCoord(C+1),this._convertFromCellCoord(O+1)))&&a.call(this,i,e,t,n,F,u,d,p))return}},Sr.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Sr.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Sr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,t=0,n=0;n<this.cells.length;n++)t+=this.cells[n].length;var a=new Int32Array(e+t+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var u=e,d=0;d<i.length;d++){var p=i[d];a[3+d]=u,a.set(p,u),u+=p.length}return a[3+i.length]=u,a.set(this.keys,u),a[3+i.length+1]=u+=this.keys.length,a.set(this.bboxes,u),u+=this.bboxes.length,a.buffer};const Ci={};function kt(i,e,t={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),Ci[e]={klass:i,omit:t.omit||[]}}kt(Object,"Object"),da.serialize=function(i,e){const t=i.toArrayBuffer();return e&&e.push(t),{buffer:t}},da.deserialize=function(i){return new da(i.buffer)},Object.defineProperty(da,"name",{value:"Grid"}),kt(da,"Grid"),kt(Ri,"Color"),kt(Error,"Error"),kt(ze,"AJAXError"),kt(Rn,"ResolvedImage"),kt(aa,"StylePropertyFunction"),kt(ss,"StyleExpression",{omit:["_evaluator"]}),kt(uo,"ZoomDependentExpression"),kt(zs,"ZoomConstantExpression"),kt(zi,"CompoundExpression",{omit:["_evaluate"]});for(const i in si)Ci[si[i]._classRegistryKey]||kt(si[i],`Expression${i}`);function Ah(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Sh(i){return Q.ImageBitmap&&i instanceof Q.ImageBitmap}function ko(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Ah(i)||Sh(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const t=i;return e&&e.push(t.buffer),t}if(i instanceof Q.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const t=[];for(const n of i)t.push(ko(n,e));return t}if(typeof i=="object"){const t=i.constructor,n=t._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const a=t.serialize?t.serialize(i,e):{};if(!t.serialize){for(const u in i)i.hasOwnProperty(u)&&(Ci[n].omit.indexOf(u)>=0||(a[u]=ko(i[u],e)));i instanceof Error&&(a.message=i.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(a.$name=n),a}throw new Error("can't serialize object of type "+typeof i)}function dc(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Ah(i)||Sh(i)||ArrayBuffer.isView(i)||i instanceof Q.ImageData)return i;if(Array.isArray(i))return i.map(dc);if(typeof i=="object"){const e=i.$name||"Object",{klass:t}=Ci[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(i);const n=Object.create(t.prototype);for(const a of Object.keys(i))a!=="$name"&&(n[a]=dc(i[a]));return n}throw new Error("can't deserialize object of type "+typeof i)}class Ih{constructor(){this.first=!0}update(e,t){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const Mh=i=>i>=1536&&i<=1791,Ch=i=>i>=1872&&i<=1919,Ph=i=>i>=2208&&i<=2303,Ds=i=>i>=11904&&i<=12031,zh=i=>i>=12032&&i<=12255,fc=i=>i>=12272&&i<=12287,Gc=i=>i>=12288&&i<=12351,Su=i=>i>=12352&&i<=12447,pl=i=>i>=12448&&i<=12543,Ls=i=>i>=12544&&i<=12591,Iu=i=>i>=12704&&i<=12735,kh=i=>i>=12736&&i<=12783,Mu=i=>i>=12784&&i<=12799,Cu=i=>i>=12800&&i<=13055,Pu=i=>i>=13056&&i<=13311,fa=i=>i>=13312&&i<=19903,pc=i=>i>=19968&&i<=40959,$c=i=>i>=40960&&i<=42127,Do=i=>i>=42128&&i<=42191,Dh=i=>i>=44032&&i<=55215,Lh=i=>i>=63744&&i<=64255,mc=i=>i>=64336&&i<=65023,Oh=i=>i>=65040&&i<=65055,zu=i=>i>=65072&&i<=65103,ku=i=>i>=65104&&i<=65135,qc=i=>i>=65136&&i<=65279,Du=i=>i>=65280&&i<=65519;function Zc(i){for(const e of i)if(ml(e.charCodeAt(0)))return!0;return!1}function Lu(i){for(const e of i)if(!_c(e.charCodeAt(0)))return!1;return!0}function _c(i){return!(Mh(i)||Ch(i)||Ph(i)||mc(i)||qc(i))}function ml(i){return!(i!==746&&i!==747&&(i<4352||!(Iu(i)||Ls(i)||zu(i)&&!(i>=65097&&i<=65103)||Lh(i)||Pu(i)||Ds(i)||kh(i)||!(!Gc(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||fa(i)||pc(i)||Cu(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||Dh(i)||Su(i)||fc(i)||(e=>e>=12688&&e<=12703)(i)||zh(i)||Mu(i)||pl(i)&&i!==12540||!(!Du(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!ku(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||Oh(i)||(e=>e>=19904&&e<=19967)(i)||$c(i)||Do(i))))}function gc(i){return!(ml(i)||function(e){return!!((t=>t>=128&&t<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(t=>t>=8192&&t<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&e!==9251||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Gc(e)||pl(e)||(t=>t>=57344&&t<=63743)(e)||zu(e)||ku(e)||Du(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function l(i){return i>=1424&&i<=2303||mc(i)||qc(i)}function r(i,e){return!(!e&&l(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(t=>t>=6016&&t<=6143)(i))}function s(i){for(const e of i)if(l(e.charCodeAt(0)))return!0;return!1}const h="deferred",m="loading",_="loaded";let x=null,w="unavailable",A=null;const P=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(w="error"),x&&x(i)};function k(){j.fire(new Zi("pluginStateChange",{pluginStatus:w,pluginURL:A}))}const j=new Ft,Z=function(){return w},te=function(){if(w!==h||!A)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");w=m,k(),A&&ke({url:A},i=>{i?P(i):(w=_,k())})},ee={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>w===_||ee.applyArabicShaping!=null,isLoading:()=>w===m,setState(i){w=i.pluginStatus,A=i.pluginURL},isParsed:()=>ee.applyArabicShaping!=null&&ee.processBidirectionalText!=null&&ee.processStyledBidirectionalText!=null,getPluginURL:()=>A};class J{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ih,this.transition={},this.pitch=0)}isSupportedScript(e){return function(t,n){for(const a of t)if(!r(a.charCodeAt(0),n))return!1;return!0}(e,ee.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}}}class H{constructor(e,t){this.property=e,this.value=t,this.expression=function(n,a){if(Cs(n))return new aa(n,a);if(ka(n)){const u=sa(n,a);if(u.result==="error")throw new Error(u.value.map(d=>`${d.key}: ${d.message}`).join(", "));return u.value}{let u=n;return typeof n=="string"&&a.type==="color"&&(u=Ri.parse(n)),{kind:"constant",evaluate:()=>u}}}(t===void 0?e.specification.default:t,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class K{constructor(e){this.property=e,this.value=new H(e,void 0)}transitioned(e,t){return new ie(this.property,this.value,t,At({},e.transition,this.transition),e.now)}untransitioned(){return new ie(this.property,this.value,null,{},0)}}class se{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return pn(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new K(this._values[e].property)),this._values[e].value=new H(this._values[e].property,t===null?void 0:pn(t))}getTransition(e){return pn(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new K(this._values[e].property)),this._values[e].transition=pn(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);n!==void 0&&(e[t]=n);const a=this.getTransition(t);a!==void 0&&(e[`${t}-transition`]=a)}return e}transitioned(e,t){const n=new xe(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].transitioned(e,t._values[a]);return n}untransitioned(){const e=new xe(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class ie{constructor(e,t,n,a,u){const d=a.delay||0,p=a.duration||0;u=u||0,this.property=e,this.value=t,this.begin=u+d,this.end=this.begin+p,e.specification.transition&&(a.delay||a.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const a=e.now||0,u=this.value.possiblyEvaluate(e,t,n),d=this.prior;if(d){if(a>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(a<this.begin)return d.possiblyEvaluate(e,t,n);{const p=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,t,n),u,je(p))}}return u}}class xe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const a=new ve(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(e,t,n);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ye{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return pn(this._values[e].value)}setValue(e,t){this._values[e]=new H(this._values[e].property,t===null?void 0:pn(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);n!==void 0&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const a=new ve(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(e,t,n);return a}}class he{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,t,n,a){return this.property.evaluate(this.value,this.parameters,e,t,n,a)}}class ve{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class fe{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const a=ol[this.specification.type];return a?a(e,t,n):e}}class Ee{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,a){return new he(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},n,a)}:e.expression,t)}interpolate(e,t,n){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new he(this,{kind:"constant",value:void 0},e.parameters);const a=ol[this.specification.type];return a?new he(this,{kind:"constant",value:a(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,a,u,d){return e.kind==="constant"?e.value:e.evaluate(t,n,a,u,d)}}class Le extends Ee{possiblyEvaluate(e,t,n,a){if(e.value===void 0)return new he(this,{kind:"constant",value:void 0},t);if(e.expression.kind==="constant"){const u=e.expression.evaluate(t,null,{},n,a),d=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,p=this._calculate(d,d,d,t);return new he(this,{kind:"constant",value:p},t)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new he(this,{kind:"constant",value:u},t)}return new he(this,e.expression,t)}evaluate(e,t,n,a,u,d){if(e.kind==="source"){const p=e.evaluate(t,n,a,u,d);return this._calculate(p,p,p,t)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,a),e.evaluate({zoom:Math.floor(t.zoom)},n,a),e.evaluate({zoom:Math.floor(t.zoom)+1},n,a),t):e.value}_calculate(e,t,n,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:t,other:n}:{from:n,to:t,other:e}}interpolate(e){return e}}class ht{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,a){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(t,null,{},n,a);return this._calculate(u,u,u,t)}return this._calculate(e.expression.evaluate(new J(Math.floor(t.zoom-1),t)),e.expression.evaluate(new J(Math.floor(t.zoom),t)),e.expression.evaluate(new J(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,n,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class Pe{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,a){return!!e.expression.evaluate(t,null,{},n,a)}interpolate(){return!1}}class He{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new J(0,{});for(const n in e){const a=e[n];a.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new H(a,void 0),d=this.defaultTransitionablePropertyValues[n]=new K(a);this.defaultTransitioningPropertyValues[n]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate(t)}}}function rt(i,e){return 256*(i=Ye(Math.floor(i),0,255))+Ye(Math.floor(e),0,255)}kt(Ee,"DataDrivenProperty"),kt(fe,"DataConstantProperty"),kt(Le,"CrossFadedDataDrivenProperty"),kt(ht,"CrossFadedProperty"),kt(Pe,"ColorRampProperty");const gt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ve{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Qe(i,e=1){let t=0,n=0;return{members:i.map(a=>{const u=gt[a.type].BYTES_PER_ELEMENT,d=t=Tt(t,Math.max(e,u)),p=a.components||1;return n=Math.max(n,u),t+=u*p,{name:a.name,type:a.type,components:p,offset:d}}),size:Tt(t,Math.max(n,e)),alignment:e}}function Tt(i,e){return Math.ceil(i/e)*e}class wt extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const a=2*e;return this.int16[a+0]=t,this.int16[a+1]=n,e}}wt.prototype.bytesPerElement=4,kt(wt,"StructArrayLayout2i4");class Ot extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n)}emplace(e,t,n,a){const u=3*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.int16[u+2]=a,e}}Ot.prototype.bytesPerElement=6,kt(Ot,"StructArrayLayout3i6");class Nt extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,a)}emplace(e,t,n,a,u){const d=4*e;return this.int16[d+0]=t,this.int16[d+1]=n,this.int16[d+2]=a,this.int16[d+3]=u,e}}Nt.prototype.bytesPerElement=8,kt(Nt,"StructArrayLayout4i8");class Ht extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,a,u,d,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,n,a,u,d,p)}emplace(e,t,n,a,u,d,p,g){const y=6*e,T=12*e,S=3*e;return this.int16[y+0]=t,this.int16[y+1]=n,this.uint8[T+4]=a,this.uint8[T+5]=u,this.uint8[T+6]=d,this.uint8[T+7]=p,this.float32[S+2]=g,e}}Ht.prototype.bytesPerElement=12,kt(Ht,"StructArrayLayout2i4ub1f12");class Ei extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,a)}emplace(e,t,n,a,u){const d=4*e;return this.float32[d+0]=t,this.float32[d+1]=n,this.float32[d+2]=a,this.float32[d+3]=u,e}}Ei.prototype.bytesPerElement=16,kt(Ei,"StructArrayLayout4f16");class Rt extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,a,u,d,p,g,y,T){const S=this.length;return this.resize(S+1),this.emplace(S,e,t,n,a,u,d,p,g,y,T)}emplace(e,t,n,a,u,d,p,g,y,T,S){const C=10*e;return this.uint16[C+0]=t,this.uint16[C+1]=n,this.uint16[C+2]=a,this.uint16[C+3]=u,this.uint16[C+4]=d,this.uint16[C+5]=p,this.uint16[C+6]=g,this.uint16[C+7]=y,this.uint16[C+8]=T,this.uint16[C+9]=S,e}}Rt.prototype.bytesPerElement=20,kt(Rt,"StructArrayLayout10ui20");class ii extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,a,u,d,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,t,n,a,u,d,p,g)}emplace(e,t,n,a,u,d,p,g,y){const T=8*e;return this.uint16[T+0]=t,this.uint16[T+1]=n,this.uint16[T+2]=a,this.uint16[T+3]=u,this.uint16[T+4]=d,this.uint16[T+5]=p,this.uint16[T+6]=g,this.uint16[T+7]=y,e}}ii.prototype.bytesPerElement=16,kt(ii,"StructArrayLayout8ui16");class Li extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,a,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,n,a,u,d)}emplace(e,t,n,a,u,d,p){const g=6*e;return this.int16[g+0]=t,this.int16[g+1]=n,this.int16[g+2]=a,this.int16[g+3]=u,this.int16[g+4]=d,this.int16[g+5]=p,e}}Li.prototype.bytesPerElement=12,kt(Li,"StructArrayLayout6i12");class Qi extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,a,u,d,p,g,y,T,S,C){const O=this.length;return this.resize(O+1),this.emplace(O,e,t,n,a,u,d,p,g,y,T,S,C)}emplace(e,t,n,a,u,d,p,g,y,T,S,C,O){const F=12*e;return this.int16[F+0]=t,this.int16[F+1]=n,this.int16[F+2]=a,this.int16[F+3]=u,this.uint16[F+4]=d,this.uint16[F+5]=p,this.uint16[F+6]=g,this.uint16[F+7]=y,this.int16[F+8]=T,this.int16[F+9]=S,this.int16[F+10]=C,this.int16[F+11]=O,e}}Qi.prototype.bytesPerElement=24,kt(Qi,"StructArrayLayout4i4ui4i24");class br extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,a,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,n,a,u,d)}emplace(e,t,n,a,u,d,p){const g=10*e,y=5*e;return this.int16[g+0]=t,this.int16[g+1]=n,this.int16[g+2]=a,this.float32[y+2]=u,this.float32[y+3]=d,this.float32[y+4]=p,e}}br.prototype.bytesPerElement=20,kt(br,"StructArrayLayout3i3f20");class qi extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}qi.prototype.bytesPerElement=4,kt(qi,"StructArrayLayout1ul4");class xn extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,a,u,d,p,g,y,T,S,C,O){const F=this.length;return this.resize(F+1),this.emplace(F,e,t,n,a,u,d,p,g,y,T,S,C,O)}emplace(e,t,n,a,u,d,p,g,y,T,S,C,O,F){const $=20*e,Y=10*e;return this.int16[$+0]=t,this.int16[$+1]=n,this.int16[$+2]=a,this.int16[$+3]=u,this.int16[$+4]=d,this.float32[Y+3]=p,this.float32[Y+4]=g,this.float32[Y+5]=y,this.float32[Y+6]=T,this.int16[$+14]=S,this.uint32[Y+8]=C,this.uint16[$+18]=O,this.uint16[$+19]=F,e}}xn.prototype.bytesPerElement=40,kt(xn,"StructArrayLayout5i4f1i1ul2ui40");class Lo extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,a,u,d,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,n,a,u,d,p)}emplace(e,t,n,a,u,d,p,g){const y=8*e;return this.int16[y+0]=t,this.int16[y+1]=n,this.int16[y+2]=a,this.int16[y+4]=u,this.int16[y+5]=d,this.int16[y+6]=p,this.int16[y+7]=g,e}}Lo.prototype.bytesPerElement=16,kt(Lo,"StructArrayLayout3i2i2i16");class Os extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,a,u)}emplace(e,t,n,a,u,d){const p=4*e,g=8*e;return this.float32[p+0]=t,this.float32[p+1]=n,this.float32[p+2]=a,this.int16[g+6]=u,this.int16[g+7]=d,e}}Os.prototype.bytesPerElement=16,kt(Os,"StructArrayLayout2f1f2i16");class Ki extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,a)}emplace(e,t,n,a,u){const d=12*e,p=3*e;return this.uint8[d+0]=t,this.uint8[d+1]=n,this.float32[p+1]=a,this.float32[p+2]=u,e}}Ki.prototype.bytesPerElement=12,kt(Ki,"StructArrayLayout2ub2f12");class pr extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n)}emplace(e,t,n,a){const u=3*e;return this.float32[u+0]=t,this.float32[u+1]=n,this.float32[u+2]=a,e}}pr.prototype.bytesPerElement=12,kt(pr,"StructArrayLayout3f12");class gi extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n)}emplace(e,t,n,a){const u=3*e;return this.uint16[u+0]=t,this.uint16[u+1]=n,this.uint16[u+2]=a,e}}gi.prototype.bytesPerElement=6,kt(gi,"StructArrayLayout3ui6");class Rr extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,a,u,d,p,g,y,T,S,C,O,F,$,Y,ae,pe,le,de,we){const ge=this.length;return this.resize(ge+1),this.emplace(ge,e,t,n,a,u,d,p,g,y,T,S,C,O,F,$,Y,ae,pe,le,de,we)}emplace(e,t,n,a,u,d,p,g,y,T,S,C,O,F,$,Y,ae,pe,le,de,we,ge){const Ne=30*e,Fe=15*e,Ke=60*e;return this.int16[Ne+0]=t,this.int16[Ne+1]=n,this.int16[Ne+2]=a,this.float32[Fe+2]=u,this.float32[Fe+3]=d,this.uint16[Ne+8]=p,this.uint16[Ne+9]=g,this.uint32[Fe+5]=y,this.uint32[Fe+6]=T,this.uint32[Fe+7]=S,this.uint16[Ne+16]=C,this.uint16[Ne+17]=O,this.uint16[Ne+18]=F,this.float32[Fe+10]=$,this.float32[Fe+11]=Y,this.uint8[Ke+48]=ae,this.uint8[Ke+49]=pe,this.uint8[Ke+50]=le,this.uint32[Fe+13]=de,this.int16[Ne+28]=we,this.uint8[Ke+58]=ge,e}}Rr.prototype.bytesPerElement=60,kt(Rr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Nn extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,a,u,d,p,g,y,T,S,C,O,F,$,Y,ae,pe,le,de,we,ge,Ne,Fe,Ke,mt,Ge,et,st,tt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,e,t,n,a,u,d,p,g,y,T,S,C,O,F,$,Y,ae,pe,le,de,we,ge,Ne,Fe,Ke,mt,Ge,et,st,tt)}emplace(e,t,n,a,u,d,p,g,y,T,S,C,O,F,$,Y,ae,pe,le,de,we,ge,Ne,Fe,Ke,mt,Ge,et,st,tt,ft){const at=38*e,zt=19*e;return this.int16[at+0]=t,this.int16[at+1]=n,this.int16[at+2]=a,this.float32[zt+2]=u,this.float32[zt+3]=d,this.int16[at+8]=p,this.int16[at+9]=g,this.int16[at+10]=y,this.int16[at+11]=T,this.int16[at+12]=S,this.int16[at+13]=C,this.uint16[at+14]=O,this.uint16[at+15]=F,this.uint16[at+16]=$,this.uint16[at+17]=Y,this.uint16[at+18]=ae,this.uint16[at+19]=pe,this.uint16[at+20]=le,this.uint16[at+21]=de,this.uint16[at+22]=we,this.uint16[at+23]=ge,this.uint16[at+24]=Ne,this.uint16[at+25]=Fe,this.uint16[at+26]=Ke,this.uint16[at+27]=mt,this.uint16[at+28]=Ge,this.uint32[zt+15]=et,this.float32[zt+16]=st,this.float32[zt+17]=tt,this.float32[zt+18]=ft,e}}Nn.prototype.bytesPerElement=76,kt(Nn,"StructArrayLayout3i2f6i15ui1ul3f76");class Yi extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Yi.prototype.bytesPerElement=4,kt(Yi,"StructArrayLayout1f4");class jn extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,a,u)}emplace(e,t,n,a,u,d){const p=5*e;return this.float32[p+0]=t,this.float32[p+1]=n,this.float32[p+2]=a,this.float32[p+3]=u,this.float32[p+4]=d,e}}jn.prototype.bytesPerElement=20,kt(jn,"StructArrayLayout5f20");class pa extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,a)}emplace(e,t,n,a,u){const d=6*e;return this.uint32[3*e+0]=t,this.uint16[d+2]=n,this.uint16[d+3]=a,this.uint16[d+4]=u,e}}pa.prototype.bytesPerElement=12,kt(pa,"StructArrayLayout1ul3ui12");class Vn extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const a=2*e;return this.uint16[a+0]=t,this.uint16[a+1]=n,e}}Vn.prototype.bytesPerElement=4,kt(Vn,"StructArrayLayout2ui4");class ma extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}ma.prototype.bytesPerElement=2,kt(ma,"StructArrayLayout1ui2");class _l extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const a=2*e;return this.float32[a+0]=t,this.float32[a+1]=n,e}}_l.prototype.bytesPerElement=8,kt(_l,"StructArrayLayout2f8");class _a extends Ve{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}_a.prototype.size=12;class Jt extends Li{get(e){return new _a(this,e)}}kt(Jt,"FillExtrusionExtArray");class gl extends Ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}gl.prototype.size=40;class ja extends xn{get(e){return new gl(this,e)}}kt(ja,"CollisionBoxArray");class ga extends Ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}ga.prototype.size=60;class Gd extends Rr{get(e){return new ga(this,e)}}kt(Gd,"PlacedSymbolArray");class np extends Ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}np.prototype.size=76;class op extends Nn{get(e){return new np(this,e)}}kt(op,"SymbolInstanceArray");class ls extends Yi{getoffsetX(e){return this.float32[1*e+0]}}kt(ls,"GlyphOffsetArray");class sp extends Ot{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}kt(sp,"SymbolLineVertexArray");class Ou extends Ve{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ou.prototype.size=12;class Rh extends pa{get(e){return new Ou(this,e)}}kt(Rh,"FeatureIndexArray");class $d extends Ve{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}$d.prototype.size=4;class qd extends Vn{get(e){return new $d(this,e)}}kt(qd,"FillExtrusionCentroidArray");class Oo extends Ve{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Oo.prototype.size=12;class yl extends Li{get(e){return new Oo(this,e)}}kt(yl,"CircleGlobeExtArray");const Zd=Qe([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),ap=Qe([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Ru=Dl(function(i){i.exports=function(e,t){var n,a,u,d,p,g,y,T;for(a=e.length-(n=3&e.length),u=t,p=3432918353,g=461845907,T=0;T<a;)y=255&e.charCodeAt(T)|(255&e.charCodeAt(++T))<<8|(255&e.charCodeAt(++T))<<16|(255&e.charCodeAt(++T))<<24,++T,u=27492+(65535&(d=5*(65535&(u=(u^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*g+(((y>>>16)*g&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&e.charCodeAt(T+2))<<16;case 2:y^=(255&e.charCodeAt(T+1))<<8;case 1:u^=y=(65535&(y=(y=(65535&(y^=255&e.charCodeAt(T)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*g+(((y>>>16)*g&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}),lp=Dl(function(i){i.exports=function(e,t){for(var n,a=e.length,u=t^a,d=0;a>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++d;switch(a){case 3:u^=(255&e.charCodeAt(d+2))<<16;case 2:u^=(255&e.charCodeAt(d+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(d)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}}),yc=Ru,cp=lp;yc.murmur3=Ru,yc.murmur2=cp;class Wc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,a){this.ids.push(Bh(e)),this.positions.push(t,n,a)}getPositions(e){const t=Bh(e);let n=0,a=this.ids.length-1;for(;n<a;){const d=n+a>>1;this.ids[d]>=t?a=d:n=d+1}const u=[];for(;this.ids[n]===t;)u.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return u}static serialize(e,t){const n=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Va(n,a,0,n.length-1),t&&t.push(n.buffer,a.buffer),{ids:n,positions:a}}static deserialize(e){const t=new Wc;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Bh(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:yc(String(i))}function Va(i,e,t,n){for(;t<n;){const a=i[t+n>>1];let u=t-1,d=n+1;for(;;){do u++;while(i[u]<a);do d--;while(i[d]>a);if(u>=d)break;Fh(i,u,d),Fh(e,3*u,3*d),Fh(e,3*u+1,3*d+1),Fh(e,3*u+2,3*d+2)}d-t<n-d?(Va(i,e,t,d),t=d+1):(Va(i,e,d+1,n),n=d)}}function Fh(i,e,t){const n=i[e];i[e]=i[t],i[t]=n}kt(Wc,"FeaturePositionMap");class fo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Bu extends fo{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Wd extends fo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class Uh extends fo{constructor(e){super(e),this.current=Ri.transparent}set(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const l_=new Float32Array(16),c_=new Float32Array(9),u_=new Float32Array(4);function Nh(i){return[rt(255*i.r,255*i.g),rt(255*i.b,255*i.a)]}class Xc{constructor(e,t,n){this.value=e,this.uniformNames=t.map(a=>`u_${a}`),this.type=n}setUniform(e,t,n,a,u){t.set(e,u,a.constantOr(this.value))}getBinding(e,t){return this.type==="color"?new Uh(e):new Bu(e)}}class Hc{constructor(e,t){this.uniformNames=t.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,n,a,u){const d=u==="u_pattern_to"||u==="u_dash_to"?this.patternTo:u==="u_pattern_from"||u==="u_dash_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&t.set(e,u,d)}getBinding(e,t){return t==="u_pattern_from"||t==="u_pattern_to"||t==="u_dash_from"||t==="u_dash_to"?new Wd(e):new Bu(e)}}class Ga{constructor(e,t,n,a){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map(u=>({name:`a_${u}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,t,n,a,u,d){const p=this.paintVertexArray.length,g=this.expression.evaluate(new J(0),t,{},u,a,d);this.paintVertexArray.resize(e),this._setPaintValue(p,e,g)}updatePaintArray(e,t,n,a,u){const d=this.expression.evaluate({zoom:0},n,a,void 0,u);this._setPaintValue(e,t,d)}_setPaintValue(e,t,n){if(this.type==="color"){const a=Nh(n);for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,a[0],a[1])}else{for(let a=e;a<t;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Rs{constructor(e,t,n,a,u,d){this.expression=e,this.uniformNames=t.map(p=>`u_${p}_t`),this.type=n,this.useIntegerZoom=a,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=t.map(p=>({name:`a_${p}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,t,n,a,u,d){const p=this.expression.evaluate(new J(this.zoom),t,{},u,a,d),g=this.expression.evaluate(new J(this.zoom+1),t,{},u,a,d),y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,p,g)}updatePaintArray(e,t,n,a,u){const d=this.expression.evaluate({zoom:this.zoom},n,a,void 0,u),p=this.expression.evaluate({zoom:this.zoom+1},n,a,void 0,u);this._setPaintValue(e,t,d,p)}_setPaintValue(e,t,n,a){if(this.type==="color"){const u=Nh(n),d=Nh(a);for(let p=e;p<t;p++)this.paintVertexArray.emplace(p,u[0],u[1],d[0],d[1])}else{for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,n,a);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,n,a,u){const d=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,p=Ye(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);t.set(e,u,p)}getBinding(e,t){return new Bu(e)}}class hn{constructor(e,t,n,a,u,d,p){this.expression=e,this.type=n,this.useIntegerZoom=a,this.zoom=u,this.layerId=p,this.paintVertexAttributes=(n==="array"?ap:Zd).members;for(let g=0;g<t.length;++g);this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(e,t,n){const a=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(a,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,a,u,d){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],d)}_setPaintValues(e,t,n,a){if(!a||!n)return;const{min:u,mid:d,max:p}=n,g=a[u],y=a[d],T=a[p];if(g&&y&&T)for(let S=e;S<t;S++)this._setPaintValue(this.zoomInPaintVertexArray,S,y,g),this._setPaintValue(this.zoomOutPaintVertexArray,S,y,T)}_setPaintValue(e,t,n,a){e.emplace(t,n.tl[0],n.tl[1],n.br[0],n.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],n.pixelRatio,a.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Kn{constructor(e,t,n=()=>!0){this.binders={},this._buffers=[];const a=[];for(const u in e.paint._values){if(!n(u))continue;const d=e.paint.get(u);if(!(d instanceof he&&Lr(d.property.specification)))continue;const p=jh(u,e.type),g=d.value,y=d.property.specification.type,T=d.property.useIntegerZoom,S=d.property.specification["property-type"],C=S==="cross-faded"||S==="cross-faded-data-driven",O=String(u)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(g.kind!=="constant"||O)if(g.kind==="source"||O||C){const F=Xd(u,y,"source");this.binders[u]=C?new hn(g,p,y,T,t,F,e.id):new Ga(g,p,y,F),a.push(`/a_${u}`)}else{const F=Xd(u,y,"composite");this.binders[u]=new Rs(g,p,y,T,t,F),a.push(`/z_${u}`)}else this.binders[u]=C?new Hc(g.value,p):new Xc(g.value,p,y),a.push(`/u_${u}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Ga||t instanceof Rs?t.maxValue:0}populatePaintArrays(e,t,n,a,u,d){for(const p in this.binders){const g=this.binders[p];(g instanceof Ga||g instanceof Rs||g instanceof hn)&&g.populatePaintArray(e,t,n,a,u,d)}}setConstantPatternPositions(e,t){for(const n in this.binders){const a=this.binders[n];a instanceof Hc&&a.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,n,a,u,d){let p=!1;for(const g in e){const y=t.getPositions(g);for(const T of y){const S=n.feature(T.index);for(const C in this.binders){const O=this.binders[C];if((O instanceof Ga||O instanceof Rs||O instanceof hn)&&O.expression.isStateDependent===!0){const F=a.paint.get(C);O.expression=F.value,O.updatePaintArray(T.start,T.end,S,e[g],u,d),p=!0}}}}return p}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Xc||n instanceof Hc)&&e.push(...n.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Ga||n instanceof Rs||n instanceof hn)for(let a=0;a<n.paintVertexAttributes.length;a++)e.push(n.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Xc||n instanceof Hc||n instanceof Rs)for(const a of n.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Xc||a instanceof Hc||a instanceof Rs)for(const u of a.uniformNames)t.push({name:u,property:n,binding:a.getBinding(e,u)})}return t}setUniforms(e,t,n,a,u){for(const{name:d,property:p,binding:g}of n)this.binders[p].setUniform(e,g,u,a.get(p),d)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const n=this.binders[t];if(e&&n instanceof hn){const a=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;a&&this._buffers.push(a)}else(n instanceof Ga||n instanceof Rs)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Ga||n instanceof Rs||n instanceof hn)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Ga||t instanceof Rs||t instanceof hn)&&t.destroy()}}}class vc{constructor(e,t,n=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new Kn(a,t,n);this.needsUpload=!1,this._featureMap=new Wc,this._bufferOffset=0}populatePaintArrays(e,t,n,a,u,d,p){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(e,t,a,u,d,p);t.id!==void 0&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,a,u){for(const d of n)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,t,d,a,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const h_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function jh(i,e){return h_[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const Kc={"line-pattern":{source:Rt,composite:Rt},"fill-pattern":{source:Rt,composite:Rt},"fill-extrusion-pattern":{source:Rt,composite:Rt},"line-dasharray":{source:ii,composite:ii}},up={color:{source:_l,composite:Ei},number:{source:Yi,composite:_l}};function Xd(i,e,t){const n=Kc[i];return n&&n[t]||up[e][t]}kt(Xc,"ConstantBinder"),kt(Hc,"CrossFadedConstantBinder"),kt(Ga,"SourceExpressionBinder"),kt(hn,"CrossFadedCompositeBinder"),kt(Rs,"CompositeExpressionBinder"),kt(Kn,"ProgramConfiguration",{omit:["_buffers"]}),kt(vc,"ProgramConfigurationSet");const Vh="-transition";class Bs extends Ft{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new ye(t.layout)),t.paint)){this._transitionablePaint=new se(t.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ve(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,n={}){t!=null&&this._validate(Au,`layers.${this.id}.layout.${e}`,e,t,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return Dn(e,Vh)?this._transitionablePaint.getTransition(e.slice(0,-Vh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(t!=null&&this._validate(Ua,`layers.${this.id}.paint.${e}`,e,t,n))return!1;if(Dn(e,Vh))return this._transitionablePaint.setTransition(e.slice(0,-Vh.length),t||void 0),!1;{const a=this._transitionablePaint._values[e],u=a.property.specification["property-type"]==="cross-faded-data-driven",d=a.value.isDataDriven(),p=a.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const g=this._transitionablePaint._values[e].value;return g.isDataDriven()||d||u||this._handleOverridablePaintPropertyUpdate(e,p,g)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ps(e,(t,n)=>!(t===void 0||n==="layout"&&!Object.keys(t).length||n==="paint"&&!Object.keys(t).length))}_validate(e,t,n,a,u={}){return(!u||u.validate!==!1)&&Na(this,e.call(fl,{key:t,layerType:this.type,objectKey:n,value:a,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof he&&Lr(t.property.specification)&&(t.value.kind==="source"||t.value.kind==="composite")&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ra(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Yc=Qe([{name:"a_pos",components:2,type:"Int16"}],4),Fu=Qe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class en{constructor(e=[]){this.segments=e}prepareSegment(e,t,n,a){let u=this.segments[this.segments.length-1];return e>en.MAX_VERTEX_ARRAY_LENGTH&&_r(`Max vertices per segment is ${en.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>en.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==a)&&(u={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},a!==void 0&&(u.sortKey=a),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,a){return new en([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:a,vaos:{},sortKey:0}])}}en.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,kt(en,"SegmentVector");var Xt=8192;class vl{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof $i?new $i(e.lng,e.lat):$i.convert(e),this}setSouthWest(e){return this._sw=e instanceof $i?new $i(e.lng,e.lat):$i.convert(e),this}extend(e){const t=this._sw,n=this._ne;let a,u;if(e instanceof $i)a=e,u=e;else{if(!(e instanceof vl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(vl.convert(e)):this.extend($i.convert(e)):this;if(a=e._sw,u=e._ne,!a||!u)return this}return t||n?(t.lng=Math.min(a.lng,t.lng),t.lat=Math.min(a.lat,t.lat),n.lng=Math.max(u.lng,n.lng),n.lat=Math.max(u.lat,n.lat)):(this._sw=new $i(a.lng,a.lat),this._ne=new $i(u.lng,u.lat)),this}getCenter(){return new $i((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new $i(this.getWest(),this.getNorth())}getSouthEast(){return new $i(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=$i.convert(e);let a=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&a}static convert(e){return!e||e instanceof vl?e:new vl(e)}}const Jc=63710088e-1;class $i{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $i(Pi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,a=e.lat*t,u=Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos((e.lng-this.lng)*t);return Jc*Math.acos(Math.min(u,1))}toBounds(e=0){const t=360*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new vl(new $i(this.lng-n,this.lat-t),new $i(this.lng+n,this.lat+t))}static convert(e){if(e instanceof $i)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new $i(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new $i(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Uu=2*Math.PI*Jc;function Nu(i){return Uu*Math.cos(i*Math.PI/180)}function cs(i){return(180+i)/360}function xl(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function us(i,e){return i/Nu(e)}function yo(i){return 360*i-180}function kn(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Gh(i,e){return i*Nu(kn(e))}const $a=85.051129;function Hd(i){return 1/Math.cos(i*Math.PI/180)}class Ro{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){const n=$i.convert(e);return new Ro(cs(n.lng),xl(n.lat),us(t,n.lat))}toLngLat(){return new $i(yo(this.x),kn(this.y))}toAltitude(){return Gh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Uu*Hd(kn(this.y))}}function $h(i,e,t,n,a,u,d,p,g){const y=(e+n)/2,T=(t+a)/2,S=new ce(y,T);p(S),function(C,O,F,$,Y,ae){const pe=F-Y,le=$-ae;return Math.abs(($-O)*pe-(F-C)*le)/Math.hypot(pe,le)}(S.x,S.y,u.x,u.y,d.x,d.y)>=g?($h(i,e,t,y,T,u,S,p,g),$h(i,y,T,n,a,S,d,p,g)):i.push(d)}function Kd(i,e,t){let n=i[0],a=n.x,u=n.y;e(n);const d=[n];for(let p=1;p<i.length;p++){const g=i[p],{x:y,y:T}=g;e(g),$h(d,a,u,y,T,n,g,e,t),a=y,u=T,n=g}return d}function Yd(i,e,t,n,a){if(a(e,t)){const u=e.add(t).mult(.5);n(u),Yd(i,e,u,n,a),Yd(i,u,t,n,a)}else i.push(t)}function hp(i,e,t){let n=i[0];e(n);const a=[n];for(let u=1;u<i.length;u++){const d=i[u];e(d),Yd(a,n,d,e,t),n=d}return a}const Jd=Math.pow(2,14)-1,dp=-Jd-1;function bl(i,e){const t=Math.round(i.x*e),n=Math.round(i.y*e);return i.x=Ye(t,dp,Jd),i.y=Ye(n,dp,Jd),(t<i.x||t>i.x+1||n<i.y||n>i.y+1)&&_r("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function ya(i,e,t){const n=i.loadGeometry(),a=i.extent,u=Xt/a;if(e&&t&&t.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:p,x:g,y,projection:T}=t,S=C=>{const O=yo((e.x+C.x/a)/d),F=kn((e.y+C.y/a)/d),$=T.project(O,F);C.x=($.x*p-g)*a,C.y=($.y*p-y)*a};for(let C=0;C<n.length;C++)if(i.type!==1)n[C]=Kd(n[C],S,1);else{const O=[];for(const F of n[C])F.x<0||F.x>=a||F.y<0||F.y>=a||(S(F),O.push(F));n[C]=O}}for(const d of n)for(const p of d)bl(p,u);return n}function wl(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ya(i):[]}}function Qc(i,e,t,n,a){i.emplaceBack(2*e+(n+1)/2,2*t+(a+1)/2)}function xc(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class Yl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new wt,this.indexArray=new gi,this.segments=new en,this.programConfigurations=new vc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,n,a){const u=this.layers[0],d=[];let p=null;u.type==="circle"&&(p=u.layout.get("circle-sort-key"));for(const{feature:y,id:T,index:S,sourceLayerIndex:C}of e){const O=this.layers[0]._featureFilter.needGeometry,F=wl(y,O);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),F,n))continue;const $=p?p.evaluate(F,{},n):void 0,Y={id:T,properties:y.properties,type:y.type,sourceLayerIndex:C,index:S,geometry:O?F.geometry:ya(y,n,a),patterns:{},sortKey:$};d.push(Y)}p&&d.sort((y,T)=>y.sortKey-T.sortKey);let g=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new yl,g=a.projection);for(const y of d){const{geometry:T,index:S,sourceLayerIndex:C}=y,O=e[S].feature;this.addFeature(y,T,S,t.availableImages,n,g),t.featureIndex.insert(O,T,S,C,this.index)}}update(e,t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Fu.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,n,a,u,d){for(const p of t)for(const g of p){const y=g.x,T=g.y;if(y<0||y>=Xt||T<0||T>=Xt)continue;if(d){const O=d.projectTilePoint(y,T,u),F=d.upVector(u,y,T),$=this.globeExtVertexArray;xc($,O,F),xc($,O,F),xc($,O,F),xc($,O,F)}const S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=S.vertexLength;Qc(this.layoutVertexArray,y,T,-1,-1),Qc(this.layoutVertexArray,y,T,1,-1),Qc(this.layoutVertexArray,y,T,1,1),Qc(this.layoutVertexArray,y,T,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+2,C+3),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},a,u)}}function ri(i,e){for(let t=0;t<i.length;t++)if(wc(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(wc(i,e[t]))return!0;return!!Qd(i,e)}function qh(i,e,t){return!!wc(i,e)||!!Wh(e,i,t)}function Zh(i,e){if(i.length===1)return fp(e,i[0]);for(let t=0;t<e.length;t++){const n=e[t];for(let a=0;a<n.length;a++)if(wc(i,n[a]))return!0}for(let t=0;t<i.length;t++)if(fp(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(Qd(i,e[t]))return!0;return!1}function bc(i,e,t){if(i.length>1){if(Qd(i,e))return!0;for(let n=0;n<e.length;n++)if(Wh(e[n],i,t))return!0}for(let n=0;n<i.length;n++)if(Wh(i[n],e,t))return!0;return!1}function Qd(i,e){if(i.length===0||e.length===0)return!1;for(let t=0;t<i.length-1;t++){const n=i[t],a=i[t+1];for(let u=0;u<e.length-1;u++)if(ef(n,a,e[u],e[u+1]))return!0}return!1}function ef(i,e,t,n){return mn(i,t,n)!==mn(e,t,n)&&mn(i,e,t)!==mn(i,e,n)}function Wh(i,e,t){const n=t*t;if(e.length===1)return i.distSqr(e[0])<n;for(let a=1;a<e.length;a++)if(Yn(i,e[a-1],e[a])<n)return!0;return!1}function Yn(i,e,t){const n=e.distSqr(t);if(n===0)return i.distSqr(e);const a=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/n;return i.distSqr(a<0?e:a>1?t:t.sub(e)._mult(a)._add(e))}function fp(i,e){let t,n,a,u=!1;for(let d=0;d<i.length;d++){t=i[d];for(let p=0,g=t.length-1;p<t.length;g=p++)n=t[p],a=t[g],n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(u=!u)}return u}function wc(i,e){let t=!1;for(let n=0,a=i.length-1;n<i.length;a=n++){const u=i[n],d=i[a];u.y>e.y!=d.y>e.y&&e.x<(d.x-u.x)*(e.y-u.y)/(d.y-u.y)+u.x&&(t=!t)}return t}function tf(i,e,t,n,a){for(const d of i)if(e<=d.x&&t<=d.y&&n>=d.x&&a>=d.y)return!0;const u=[new ce(e,t),new ce(e,a),new ce(n,a),new ce(n,t)];if(i.length>2){for(const d of u)if(wc(i,d))return!0}for(let d=0;d<i.length-1;d++)if(d_(i[d],i[d+1],u))return!0;return!1}function d_(i,e,t){const n=t[0],a=t[2];if(i.x<n.x&&e.x<n.x||i.x>a.x&&e.x>a.x||i.y<n.y&&e.y<n.y||i.y>a.y&&e.y>a.y)return!1;const u=mn(i,e,t[0]);return u!==mn(i,e,t[1])||u!==mn(i,e,t[2])||u!==mn(i,e,t[3])}function Tc(i,e,t){const n=e.paint.get(i).value;return n.kind==="constant"?n.value:t.programConfigurations.get(e.id).getMaxValue(i)}function Xh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function pp(i,e,t,n,a){if(!e[0]&&!e[1])return i;const u=ce.convert(e)._mult(a);t==="viewport"&&u._rotate(-n);const d=[];for(let p=0;p<i.length;p++)d.push(i[p].sub(u));return d}function mp(i,e,t,n){const a=ce.convert(i)._mult(n);return e==="viewport"&&a._rotate(-t),a}kt(Yl,"CircleBucket",{omit:["layers"]});const Tl=new He({"circle-sort-key":new Ee($e.layout_circle["circle-sort-key"])});var vo={paint:new He({"circle-radius":new Ee($e.paint_circle["circle-radius"]),"circle-color":new Ee($e.paint_circle["circle-color"]),"circle-blur":new Ee($e.paint_circle["circle-blur"]),"circle-opacity":new Ee($e.paint_circle["circle-opacity"]),"circle-translate":new fe($e.paint_circle["circle-translate"]),"circle-translate-anchor":new fe($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new fe($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new fe($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ee($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ee($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ee($e.paint_circle["circle-stroke-opacity"])}),layout:Tl},eu=1e-6,Bo=typeof Float32Array<"u"?Float32Array:Array;function Hh(){var i=new Bo(9);return Bo!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function qa(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function rf(i,e){var t=e[0],n=e[1],a=e[2],u=e[3],d=e[4],p=e[5],g=e[6],y=e[7],T=e[8],S=e[9],C=e[10],O=e[11],F=e[12],$=e[13],Y=e[14],ae=e[15],pe=t*p-n*d,le=t*g-a*d,de=t*y-u*d,we=n*g-a*p,ge=n*y-u*p,Ne=a*y-u*g,Fe=T*$-S*F,Ke=T*Y-C*F,mt=T*ae-O*F,Ge=S*Y-C*$,et=S*ae-O*$,st=C*ae-O*Y,tt=pe*st-le*et+de*Ge+we*mt-ge*Ke+Ne*Fe;return tt?(i[0]=(p*st-g*et+y*Ge)*(tt=1/tt),i[1]=(a*et-n*st-u*Ge)*tt,i[2]=($*Ne-Y*ge+ae*we)*tt,i[3]=(C*ge-S*Ne-O*we)*tt,i[4]=(g*mt-d*st-y*Ke)*tt,i[5]=(t*st-a*mt+u*Ke)*tt,i[6]=(Y*de-F*Ne-ae*le)*tt,i[7]=(T*Ne-C*de+O*le)*tt,i[8]=(d*et-p*mt+y*Fe)*tt,i[9]=(n*mt-t*et-u*Fe)*tt,i[10]=(F*ge-$*de+ae*pe)*tt,i[11]=(S*de-T*ge-O*pe)*tt,i[12]=(p*Ke-d*Ge-g*Fe)*tt,i[13]=(t*Ge-n*Ke+a*Fe)*tt,i[14]=($*le-F*we-Y*pe)*tt,i[15]=(T*we-S*le+C*pe)*tt,i):null}function Za(i,e,t){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],g=e[5],y=e[6],T=e[7],S=e[8],C=e[9],O=e[10],F=e[11],$=e[12],Y=e[13],ae=e[14],pe=e[15],le=t[0],de=t[1],we=t[2],ge=t[3];return i[0]=le*n+de*p+we*S+ge*$,i[1]=le*a+de*g+we*C+ge*Y,i[2]=le*u+de*y+we*O+ge*ae,i[3]=le*d+de*T+we*F+ge*pe,i[4]=(le=t[4])*n+(de=t[5])*p+(we=t[6])*S+(ge=t[7])*$,i[5]=le*a+de*g+we*C+ge*Y,i[6]=le*u+de*y+we*O+ge*ae,i[7]=le*d+de*T+we*F+ge*pe,i[8]=(le=t[8])*n+(de=t[9])*p+(we=t[10])*S+(ge=t[11])*$,i[9]=le*a+de*g+we*C+ge*Y,i[10]=le*u+de*y+we*O+ge*ae,i[11]=le*d+de*T+we*F+ge*pe,i[12]=(le=t[12])*n+(de=t[13])*p+(we=t[14])*S+(ge=t[15])*$,i[13]=le*a+de*g+we*C+ge*Y,i[14]=le*u+de*y+we*O+ge*ae,i[15]=le*d+de*T+we*F+ge*pe,i}function tu(i,e,t){var n,a,u,d,p,g,y,T,S,C,O,F,$=t[0],Y=t[1],ae=t[2];return e===i?(i[12]=e[0]*$+e[4]*Y+e[8]*ae+e[12],i[13]=e[1]*$+e[5]*Y+e[9]*ae+e[13],i[14]=e[2]*$+e[6]*Y+e[10]*ae+e[14],i[15]=e[3]*$+e[7]*Y+e[11]*ae+e[15]):(a=e[1],u=e[2],d=e[3],p=e[4],g=e[5],y=e[6],T=e[7],S=e[8],C=e[9],O=e[10],F=e[11],i[0]=n=e[0],i[1]=a,i[2]=u,i[3]=d,i[4]=p,i[5]=g,i[6]=y,i[7]=T,i[8]=S,i[9]=C,i[10]=O,i[11]=F,i[12]=n*$+p*Y+S*ae+e[12],i[13]=a*$+g*Y+C*ae+e[13],i[14]=u*$+y*Y+O*ae+e[14],i[15]=d*$+T*Y+F*ae+e[15]),i}function Jl(i,e,t){var n=t[0],a=t[1],u=t[2];return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*a,i[5]=e[5]*a,i[6]=e[6]*a,i[7]=e[7]*a,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function nf(i,e,t){var n=Math.sin(t),a=Math.cos(t),u=e[4],d=e[5],p=e[6],g=e[7],y=e[8],T=e[9],S=e[10],C=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*a+y*n,i[5]=d*a+T*n,i[6]=p*a+S*n,i[7]=g*a+C*n,i[8]=y*a-u*n,i[9]=T*a-d*n,i[10]=S*a-p*n,i[11]=C*a-g*n,i}function Kh(i,e,t){var n=Math.sin(t),a=Math.cos(t),u=e[0],d=e[1],p=e[2],g=e[3],y=e[8],T=e[9],S=e[10],C=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*a-y*n,i[1]=d*a-T*n,i[2]=p*a-S*n,i[3]=g*a-C*n,i[8]=u*n+y*a,i[9]=d*n+T*a,i[10]=p*n+S*a,i[11]=g*n+C*a,i}function _p(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function gp(i,e,t){var n,a,u,d=t[0],p=t[1],g=t[2],y=Math.hypot(d,p,g);return y<eu?null:(d*=y=1/y,p*=y,g*=y,n=Math.sin(e),a=Math.cos(e),i[0]=d*d*(u=1-a)+a,i[1]=p*d*u+g*n,i[2]=g*d*u-p*n,i[3]=0,i[4]=d*p*u-g*n,i[5]=p*p*u+a,i[6]=g*p*u+d*n,i[7]=0,i[8]=d*g*u+p*n,i[9]=p*g*u-d*n,i[10]=g*g*u+a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var yp=Za;function Yh(){var i=new Bo(3);return Bo!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function vp(i){var e=new Bo(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Ec(i){return Math.hypot(i[0],i[1],i[2])}function Ac(i,e,t){var n=new Bo(3);return n[0]=i,n[1]=e,n[2]=t,n}function Fs(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function ju(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function of(i,e,t){return i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i}function Jh(i,e,t){return i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.min(e[2],t[2]),i}function iu(i,e,t){return i[0]=Math.max(e[0],t[0]),i[1]=Math.max(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i}function Us(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function hs(i,e,t,n){return i[0]=e[0]+t[0]*n,i[1]=e[1]+t[1]*n,i[2]=e[2]+t[2]*n,i}function tn(i,e){var t=e[0],n=e[1],a=e[2],u=t*t+n*n+a*a;return u>0&&(u=1/Math.sqrt(u)),i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i}function Ns(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function Qh(i,e,t){var n=e[0],a=e[1],u=e[2],d=t[0],p=t[1],g=t[2];return i[0]=a*g-u*p,i[1]=u*d-n*g,i[2]=n*p-a*d,i}function dn(i,e,t){var n=e[0],a=e[1],u=e[2],d=t[3]*n+t[7]*a+t[11]*u+t[15];return i[0]=(t[0]*n+t[4]*a+t[8]*u+t[12])/(d=d||1),i[1]=(t[1]*n+t[5]*a+t[9]*u+t[13])/d,i[2]=(t[2]*n+t[6]*a+t[10]*u+t[14])/d,i}function xp(i,e,t){var n=t[0],a=t[1],u=t[2],d=e[0],p=e[1],g=e[2],y=a*g-u*p,T=u*d-n*g,S=n*p-a*d,C=a*S-u*T,O=u*y-n*S,F=n*T-a*y,$=2*t[3];return T*=$,S*=$,O*=2,F*=2,i[0]=d+(y*=$)+(C*=2),i[1]=p+T+O,i[2]=g+S+F,i}var Vu,va=ju,f_=of,p_=Ec;function bp(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function Sc(i,e,t){var n=e[0],a=e[1],u=e[2],d=e[3];return i[0]=t[0]*n+t[4]*a+t[8]*u+t[12]*d,i[1]=t[1]*n+t[5]*a+t[9]*u+t[13]*d,i[2]=t[2]*n+t[6]*a+t[10]*u+t[14]*d,i[3]=t[3]*n+t[7]*a+t[11]*u+t[15]*d,i}function wp(){var i=new Bo(4);return Bo!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Tp(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Ep(i,e,t){t*=.5;var n=e[0],a=e[1],u=e[2],d=e[3],p=Math.sin(t),g=Math.cos(t);return i[0]=n*g+d*p,i[1]=a*g+u*p,i[2]=u*g-a*p,i[3]=d*g-n*p,i}function sf(i,e,t){t*=.5;var n=e[0],a=e[1],u=e[2],d=e[3],p=Math.sin(t),g=Math.cos(t);return i[0]=n*g-u*p,i[1]=a*g+d*p,i[2]=u*g+n*p,i[3]=d*g-a*p,i}Yh(),Vu=new Bo(4),Bo!=Float32Array&&(Vu[0]=0,Vu[1]=0,Vu[2]=0,Vu[3]=0),Yh(),Ac(1,0,0),Ac(0,1,0),wp(),wp(),Hh();class ed{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const a=Ns(t,this.dir);if(Math.abs(a)<1e-6)return!1;const u=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/a;return n[0]=this.pos[0]+this.dir[0]*u,n[1]=this.pos[1]+this.dir[1]*u,n[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,t,n){if(function(O,F){var $=O[0],Y=O[1],ae=O[2],pe=F[0],le=F[1],de=F[2];return Math.abs($-pe)<=eu*Math.max(1,Math.abs($),Math.abs(pe))&&Math.abs(Y-le)<=eu*Math.max(1,Math.abs(Y),Math.abs(le))&&Math.abs(ae-de)<=eu*Math.max(1,Math.abs(ae),Math.abs(de))}(this.pos,e)||t===0)return n[0]=n[1]=n[2]=0,!1;const[a,u,d]=this.dir,p=this.pos[0]-e[0],g=this.pos[1]-e[1],y=this.pos[2]-e[2],T=a*a+u*u+d*d,S=2*(p*a+g*u+y*d),C=S*S-4*T*(p*p+g*g+y*y-t*t);if(C<0){const O=Math.max(-S/2,0),F=p+a*O,$=g+u*O,Y=y+d*O,ae=Math.hypot(F,$,Y);return n[0]=F*t/ae,n[1]=$*t/ae,n[2]=Y*t/ae,!1}{const O=(-S-Math.sqrt(C))/(2*T);if(O<0){const F=Math.hypot(p,g,y);return n[0]=p*t/F,n[1]=g*t/F,n[2]=y*t/F,!1}return n[0]=p+a*O,n[1]=g+u*O,n[2]=y+d*O,!0}}}class td{constructor(e,t,n,a,u){this.TL=e,this.TR=t,this.BR=n,this.BL=a,this.horizon=u}static fromInvProjectionMatrix(e,t,n){const a=[-1,1,1],u=[1,1,1],d=[1,-1,1],p=[-1,-1,1],g=dn(a,a,e),y=dn(u,u,e),T=dn(d,d,e),S=dn(p,p,e);return new td(g,y,T,S,t/n)}}class af{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,n,a){const u=Math.pow(2,n),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(g=>{const y=Sc([],g,e),T=1/y[3]/t*u;return function(S,C,O){return S[0]=C[0]*O[0],S[1]=C[1]*O[1],S[2]=C[2]*O[2],S[3]=C[3]*O[3],S}(y,y,[T,T,a?1/y[3]:T,T])}),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(g=>{const y=tn([],Qh([],va([],d[g[0]],d[g[1]]),va([],d[g[2]],d[g[1]]))),T=-Ns(y,d[g[1]]);return y.concat(T)});return new af(d,p)}}class xo{static fromPoints(e){const t=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],n=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const a of e)t[0]=Math.min(t[0],a[0]),t[1]=Math.min(t[1],a[1]),t[2]=Math.min(t[2],a[2]),n[0]=Math.max(n[0],a[0]),n[1]=Math.max(n[1],a[1]),n[2]=Math.max(n[2],a[2]);return new xo(t,n)}constructor(e,t){this.min=e,this.max=t,this.center=Us([],Fs([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],n=vp(this.min),a=vp(this.max);for(let u=0;u<t.length;u++)n[u]=t[u]?this.min[u]:this.center[u],a[u]=t[u]?this.center[u]:this.max[u];return a[2]=this.max[2],new xo(n,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let n=!0;for(let a=0;a<e.planes.length;a++){const u=e.planes[a];let d=0;for(let p=0;p<t.length;p++)d+=Ns(u,t[p])+u[3]>=0;if(d===0)return 0;d!==t.length&&(n=!1)}if(n)return 2;for(let a=0;a<3;a++){let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let p=0;p<e.points.length;p++){const g=e.points[p][a]-this.min[a];u=Math.min(u,g),d=Math.max(d,g)}if(d<0||u>this.max[a]-this.min[a])return 0}return 1}}function Ap(i,e,t,n,a,u,d,p,g){if(u&&i.queryGeometry.isAboveHorizon)return!1;u&&(g*=i.pixelToTileUnitsFactor);const y=i.tileID.canonical,T=t.projection.upVectorScale(y,t.center.lat,t.worldSize).metersToTile;for(const S of e)for(const C of S){const O=C.add(p),F=a&&t.elevation?t.elevation.exaggeration()*a.getElevationAt(O.x,O.y,!0):0,$=t.projection.projectTilePoint(O.x,O.y,y);if(F>0){const le=t.projection.upVector(y,O.x,O.y);$.x+=le[0]*T*F,$.y+=le[1]*T*F,$.z+=le[2]*T*F}const Y=u?O:Sp($.x,$.y,$.z,n),ae=u?i.tilespaceRays.map(le=>__(le,F)):i.queryGeometry.screenGeometry,pe=Sc([],[$.x,$.y,$.z,1],n);if(!d&&u?g*=pe[3]/t.cameraToCenterDistance:d&&!u&&(g*=t.cameraToCenterDistance/pe[3]),u){const le=kn((C.y/Xt+y.y)/(1<<y.z));g/=t.projection.pixelsPerMeter(le,1)/us(1,le)}if(qh(ae,Y,g))return!0}return!1}function Sp(i,e,t,n){const a=Sc([],[i,e,t,1],n);return new ce(a[0]/a[3],a[1]/a[3])}const Ip=Ac(0,0,0),m_=Ac(0,0,1);function __(i,e){const t=Yh();return Ip[2]=e,i.intersectsPlane(Ip,m_,t),new ce(t[0],t[1])}class Mp extends Yl{}function Cp(i,{width:e,height:t},n,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*t*n)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*t*n);return i.width=e,i.height=t,i.data=a,i}function Pp(i,e,t){const{width:n,height:a}=e;n===i.width&&a===i.height||(Fo(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,n),height:Math.min(i.height,a)},t),i.width=n,i.height=a,i.data=e.data)}function Fo(i,e,t,n,a,u){if(a.width===0||a.height===0)return e;if(a.width>i.width||a.height>i.height||t.x>i.width-a.width||t.y>i.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||n.x>e.width-a.width||n.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const d=i.data,p=e.data;for(let g=0;g<a.height;g++){const y=((t.y+g)*i.width+t.x)*u,T=((n.y+g)*e.width+n.x)*u;for(let S=0;S<a.width*u;S++)p[T+S]=d[y+S]}return e}kt(Mp,"HeatmapBucket",{omit:["layers"]});class El{constructor(e,t){Cp(this,e,1,t)}resize(e){Pp(this,new El(e),1)}clone(){return new El({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,a,u){Fo(e,t,n,a,u,1)}}class Uo{constructor(e,t){Cp(this,e,4,t)}resize(e){Pp(this,new Uo(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,a,u){Fo(e,t,n,a,u,4)}}kt(El,"AlphaImage"),kt(Uo,"RGBAImage");var g_={paint:new He({"heatmap-radius":new Ee($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ee($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new fe($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pe($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new fe($e.paint_heatmap["heatmap-opacity"])})};function id(i){const e={},t=i.resolution||256,n=i.clips?i.clips.length:1,a=i.image||new Uo({width:t,height:n}),u=(d,p,g)=>{e[i.evaluationKey]=g;const y=i.expression.evaluate(e);a.data[d+p+0]=Math.floor(255*y.r/y.a),a.data[d+p+1]=Math.floor(255*y.g/y.a),a.data[d+p+2]=Math.floor(255*y.b/y.a),a.data[d+p+3]=Math.floor(255*y.a)};if(i.clips)for(let d=0,p=0;d<n;++d,p+=4*t)for(let g=0,y=0;g<t;g++,y+=4){const T=g/(t-1),{start:S,end:C}=i.clips[d];u(p,y,S*(1-T)+C*T)}else for(let d=0,p=0;d<t;d++,p+=4)u(0,p,d/(t-1));return a}var y_={paint:new He({"hillshade-illumination-direction":new fe($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new fe($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new fe($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new fe($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new fe($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new fe($e.paint_hillshade["hillshade-accent-color"])})};const v_=Qe([{name:"a_pos",components:2,type:"Int16"}],4),{members:x_}=v_;var rd=nd,lf=nd;function nd(i,e,t){t=t||2;var n,a,u,d,p,g,y,T=e&&e.length,S=T?e[0]*t:i.length,C=zp(i,0,S,t,!0),O=[];if(!C||C.next===C.prev)return O;if(T&&(C=function($,Y,ae,pe){var le,de,we,ge=[];for(le=0,de=Y.length;le<de;le++)(we=zp($,Y[le]*pe,le<de-1?Y[le+1]*pe:$.length,pe,!1))===we.next&&(we.steiner=!0),ge.push(M_(we));for(ge.sort(A_),le=0;le<ge.length;le++)ae=S_(ge[le],ae);return ae}(i,e,C,t)),i.length>80*t){n=u=i[0],a=d=i[1];for(var F=t;F<S;F+=t)(p=i[F])<n&&(n=p),(g=i[F+1])<a&&(a=g),p>u&&(u=p),g>d&&(d=g);y=(y=Math.max(u-n,d-a))!==0?32767/y:0}return Gu(C,O,t,n,a,y,0),O}function zp(i,e,t,n,a){var u,d;if(a===df(i,e,t,n)>0)for(u=e;u<t;u+=n)d=Dp(u,i[u],i[u+1],d);else for(u=t-n;u>=e;u-=n)d=Dp(u,i[u],i[u+1],d);return d&&od(d,d.next)&&($u(d),d=d.next),d}function Ic(i,e){if(!i)return i;e||(e=i);var t,n=i;do if(t=!1,n.steiner||!od(n,n.next)&&Vr(n.prev,n,n.next)!==0)n=n.next;else{if($u(n),(n=e=n.prev)===n.next)break;t=!0}while(t||n!==e);return e}function Gu(i,e,t,n,a,u,d){if(i){!d&&u&&function(T,S,C,O){var F=T;do F.z===0&&(F.z=cf(F.x,F.y,S,C,O)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==T);F.prevZ.nextZ=null,F.prevZ=null,function($){var Y,ae,pe,le,de,we,ge,Ne,Fe=1;do{for(ae=$,$=null,de=null,we=0;ae;){for(we++,pe=ae,ge=0,Y=0;Y<Fe&&(ge++,pe=pe.nextZ);Y++);for(Ne=Fe;ge>0||Ne>0&&pe;)ge!==0&&(Ne===0||!pe||ae.z<=pe.z)?(le=ae,ae=ae.nextZ,ge--):(le=pe,pe=pe.nextZ,Ne--),de?de.nextZ=le:$=le,le.prevZ=de,de=le;ae=pe}de.nextZ=null,Fe*=2}while(we>1)}(F)}(i,n,a,u);for(var p,g,y=i;i.prev!==i.next;)if(p=i.prev,g=i.next,u?w_(i,n,a,u):b_(i))e.push(p.i/t|0),e.push(i.i/t|0),e.push(g.i/t|0),$u(i),i=g.next,y=g.next;else if((i=g)===y){d?d===1?Gu(i=T_(Ic(i),e,t),e,t,n,a,u,2):d===2&&E_(i,e,t,n,a,u):Gu(Ic(i),e,t,n,a,u,1);break}}}function b_(i){var e=i.prev,t=i,n=i.next;if(Vr(e,t,n)>=0)return!1;for(var a=e.x,u=t.x,d=n.x,p=e.y,g=t.y,y=n.y,T=a<u?a<d?a:d:u<d?u:d,S=p<g?p<y?p:y:g<y?g:y,C=a>u?a>d?a:d:u>d?u:d,O=p>g?p>y?p:y:g>y?g:y,F=n.next;F!==e;){if(F.x>=T&&F.x<=C&&F.y>=S&&F.y<=O&&ru(a,p,u,g,d,y,F.x,F.y)&&Vr(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function w_(i,e,t,n){var a=i.prev,u=i,d=i.next;if(Vr(a,u,d)>=0)return!1;for(var p=a.x,g=u.x,y=d.x,T=a.y,S=u.y,C=d.y,O=p<g?p<y?p:y:g<y?g:y,F=T<S?T<C?T:C:S<C?S:C,$=p>g?p>y?p:y:g>y?g:y,Y=T>S?T>C?T:C:S>C?S:C,ae=cf(O,F,e,t,n),pe=cf($,Y,e,t,n),le=i.prevZ,de=i.nextZ;le&&le.z>=ae&&de&&de.z<=pe;){if(le.x>=O&&le.x<=$&&le.y>=F&&le.y<=Y&&le!==a&&le!==d&&ru(p,T,g,S,y,C,le.x,le.y)&&Vr(le.prev,le,le.next)>=0||(le=le.prevZ,de.x>=O&&de.x<=$&&de.y>=F&&de.y<=Y&&de!==a&&de!==d&&ru(p,T,g,S,y,C,de.x,de.y)&&Vr(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;le&&le.z>=ae;){if(le.x>=O&&le.x<=$&&le.y>=F&&le.y<=Y&&le!==a&&le!==d&&ru(p,T,g,S,y,C,le.x,le.y)&&Vr(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;de&&de.z<=pe;){if(de.x>=O&&de.x<=$&&de.y>=F&&de.y<=Y&&de!==a&&de!==d&&ru(p,T,g,S,y,C,de.x,de.y)&&Vr(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function T_(i,e,t){var n=i;do{var a=n.prev,u=n.next.next;!od(a,u)&&kp(a,n,n.next,u)&&Mc(a,u)&&Mc(u,a)&&(e.push(a.i/t|0),e.push(n.i/t|0),e.push(u.i/t|0),$u(n),$u(n.next),n=i=u),n=n.next}while(n!==i);return Ic(n)}function E_(i,e,t,n,a,u){var d=i;do{for(var p=d.next.next;p!==d.prev;){if(d.i!==p.i&&C_(d,p)){var g=uf(d,p);return d=Ic(d,d.next),g=Ic(g,g.next),Gu(d,e,t,n,a,u,0),void Gu(g,e,t,n,a,u,0)}p=p.next}d=d.next}while(d!==i)}function A_(i,e){return i.x-e.x}function S_(i,e){var t=function(a,u){var d,p=u,g=a.x,y=a.y,T=-1/0;do{if(y<=p.y&&y>=p.next.y&&p.next.y!==p.y){var S=p.x+(y-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(S<=g&&S>T&&(T=S,d=p.x<p.next.x?p:p.next,S===g))return d}p=p.next}while(p!==u);if(!d)return null;var C,O=d,F=d.x,$=d.y,Y=1/0;p=d;do g>=p.x&&p.x>=F&&g!==p.x&&ru(y<$?g:T,y,F,$,y<$?T:g,y,p.x,p.y)&&(C=Math.abs(y-p.y)/(g-p.x),Mc(p,a)&&(C<Y||C===Y&&(p.x>d.x||p.x===d.x&&I_(d,p)))&&(d=p,Y=C)),p=p.next;while(p!==O);return d}(i,e);if(!t)return e;var n=uf(t,i);return Ic(n,n.next),Ic(t,t.next)}function I_(i,e){return Vr(i.prev,i,e.prev)<0&&Vr(e.next,i,i.next)<0}function cf(i,e,t,n,a){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-t)*a|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function M_(i){var e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function ru(i,e,t,n,a,u,d,p){return(a-d)*(e-p)>=(i-d)*(u-p)&&(i-d)*(n-p)>=(t-d)*(e-p)&&(t-d)*(u-p)>=(a-d)*(n-p)}function C_(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(t,n){var a=t;do{if(a.i!==t.i&&a.next.i!==t.i&&a.i!==n.i&&a.next.i!==n.i&&kp(a,a.next,t,n))return!0;a=a.next}while(a!==t);return!1}(i,e)&&(Mc(i,e)&&Mc(e,i)&&function(t,n){var a=t,u=!1,d=(t.x+n.x)/2,p=(t.y+n.y)/2;do a.y>p!=a.next.y>p&&a.next.y!==a.y&&d<(a.next.x-a.x)*(p-a.y)/(a.next.y-a.y)+a.x&&(u=!u),a=a.next;while(a!==t);return u}(i,e)&&(Vr(i.prev,i,e.prev)||Vr(i,e.prev,e))||od(i,e)&&Vr(i.prev,i,i.next)>0&&Vr(e.prev,e,e.next)>0)}function Vr(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function od(i,e){return i.x===e.x&&i.y===e.y}function kp(i,e,t,n){var a=ad(Vr(i,e,t)),u=ad(Vr(i,e,n)),d=ad(Vr(t,n,i)),p=ad(Vr(t,n,e));return a!==u&&d!==p||!(a!==0||!sd(i,t,e))||!(u!==0||!sd(i,n,e))||!(d!==0||!sd(t,i,n))||!(p!==0||!sd(t,e,n))}function sd(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function ad(i){return i>0?1:i<0?-1:0}function Mc(i,e){return Vr(i.prev,i,i.next)<0?Vr(i,e,i.next)>=0&&Vr(i,i.prev,e)>=0:Vr(i,e,i.prev)<0||Vr(i,i.next,e)<0}function uf(i,e){var t=new hf(i.i,i.x,i.y),n=new hf(e.i,e.x,e.y),a=i.next,u=e.prev;return i.next=e,e.prev=i,t.next=a,a.prev=t,n.next=t,t.prev=n,u.next=n,n.prev=u,n}function Dp(i,e,t,n){var a=new hf(i,e,t);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function $u(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function hf(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function df(i,e,t,n){for(var a=0,u=e,d=t-n;u<t;u+=n)a+=(i[d]-i[u])*(i[u+1]+i[d+1]),d=u;return a}function P_(i,e,t,n,a){Lp(i,e,t||0,n||i.length-1,a||z_)}function Lp(i,e,t,n,a){for(;n>t;){if(n-t>600){var u=n-t+1,d=e-t+1,p=Math.log(u),g=.5*Math.exp(2*p/3),y=.5*Math.sqrt(p*g*(u-g)/u)*(d-u/2<0?-1:1);Lp(i,e,Math.max(t,Math.floor(e-d*g/u+y)),Math.min(n,Math.floor(e+(u-d)*g/u+y)),a)}var T=i[e],S=t,C=n;for(qu(i,t,e),a(i[n],T)>0&&qu(i,t,n);S<C;){for(qu(i,S,C),S++,C--;a(i[S],T)<0;)S++;for(;a(i[C],T)>0;)C--}a(i[t],T)===0?qu(i,t,C):qu(i,++C,n),C<=e&&(t=C+1),e<=C&&(n=C-1)}}function qu(i,e,t){var n=i[e];i[e]=i[t],i[t]=n}function z_(i,e){return i<e?-1:i>e?1:0}function ld(i,e){const t=i.length;if(t<=1)return[i];const n=[];let a,u;for(let d=0;d<t;d++){const p=Ao(i[d]);p!==0&&(i[d].area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(a&&n.push(a),a=[i[d]]):a.push(i[d]))}if(a&&n.push(a),e>1)for(let d=0;d<n.length;d++)n[d].length<=e||(P_(n[d],e,1,n[d].length-1,k_),n[d]=n[d].slice(0,e));return n}function k_(i,e){return e.area-i.area}function nu(i,e,t){const n=t.patternDependencies;let a=!1;for(const u of e){const d=u.paint.get(`${i}-pattern`);d.isConstant()||(a=!0);const p=d.constantOr(null);p&&(a=!0,n[p.to]=!0,n[p.from]=!0)}return a}function ff(i,e,t,n,a){const u=a.patternDependencies;for(const d of e){const p=d.paint.get(`${i}-pattern`).value;if(p.kind!=="constant"){let g=p.evaluate({zoom:n-1},t,{},a.availableImages),y=p.evaluate({zoom:n},t,{},a.availableImages),T=p.evaluate({zoom:n+1},t,{},a.availableImages);g=g&&g.name?g.name:g,y=y&&y.name?y.name:y,T=T&&T.name?T.name:T,u[g]=!0,u[y]=!0,u[T]=!0,t.patterns[d.id]={min:g,mid:y,max:T}}}return t}nd.deviation=function(i,e,t,n){var a=e&&e.length,u=Math.abs(df(i,0,a?e[0]*t:i.length,t));if(a)for(var d=0,p=e.length;d<p;d++)u-=Math.abs(df(i,e[d]*t,d<p-1?e[d+1]*t:i.length,t));var g=0;for(d=0;d<n.length;d+=3){var y=n[d]*t,T=n[d+1]*t,S=n[d+2]*t;g+=Math.abs((i[y]-i[S])*(i[T+1]-i[y+1])-(i[y]-i[T])*(i[S+1]-i[y+1]))}return u===0&&g===0?0:Math.abs((g-u)/u)},nd.flatten=function(i){for(var e=i[0][0].length,t={vertices:[],holes:[],dimensions:e},n=0,a=0;a<i.length;a++){for(var u=0;u<i[a].length;u++)for(var d=0;d<e;d++)t.vertices.push(i[a][u][d]);a>0&&t.holes.push(n+=i[a-1].length)}return t},rd.default=lf;class cd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new wt,this.indexArray=new gi,this.indexArray2=new Vn,this.programConfigurations=new vc(e.layers,e.zoom),this.segments=new en,this.segments2=new en,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=e.projection}populate(e,t,n,a){this.hasPattern=nu("fill",this.layers,t);const u=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:p,id:g,index:y,sourceLayerIndex:T}of e){const S=this.layers[0]._featureFilter.needGeometry,C=wl(p,S);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),C,n))continue;const O=u?u.evaluate(C,{},n,t.availableImages):void 0,F={id:g,properties:p.properties,type:p.type,sourceLayerIndex:T,index:y,geometry:S?C.geometry:ya(p,n,a),patterns:{},sortKey:O};d.push(F)}u&&d.sort((p,g)=>p.sortKey-g.sortKey);for(const p of d){const{geometry:g,index:y,sourceLayerIndex:T}=p;if(this.hasPattern){const S=ff("fill",this.layers,p,this.zoom,t);this.patternFeatures.push(S)}else this.addFeature(p,g,y,n,{},t.availableImages);t.featureIndex.insert(e[y].feature,g,y,T,this.index)}}update(e,t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,a)}addFeatures(e,t,n,a,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,t,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,x_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,a,u,d=[]){for(const p of ld(t,500)){let g=0;for(const F of p)g+=F.length;const y=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),T=y.vertexLength,S=[],C=[];for(const F of p){if(F.length===0)continue;F!==p[0]&&C.push(S.length/2);const $=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),Y=$.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(Y+F.length-1,Y),S.push(F[0].x),S.push(F[0].y);for(let ae=1;ae<F.length;ae++)this.layoutVertexArray.emplaceBack(F[ae].x,F[ae].y),this.indexArray2.emplaceBack(Y+ae-1,Y+ae),S.push(F[ae].x),S.push(F[ae].y);$.vertexLength+=F.length,$.primitiveLength+=F.length}const O=rd(S,C);for(let F=0;F<O.length;F+=3)this.indexArray.emplaceBack(T+O[F],T+O[F+1],T+O[F+2]);y.vertexLength+=g,y.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,d,a)}}kt(cd,"FillBucket",{omit:["layers","patternFeatures"]});const D_=new He({"fill-sort-key":new Ee($e.layout_fill["fill-sort-key"])});var L_={paint:new He({"fill-antialias":new fe($e.paint_fill["fill-antialias"]),"fill-opacity":new Ee($e.paint_fill["fill-opacity"]),"fill-color":new Ee($e.paint_fill["fill-color"]),"fill-outline-color":new Ee($e.paint_fill["fill-outline-color"]),"fill-translate":new fe($e.paint_fill["fill-translate"]),"fill-translate-anchor":new fe($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Le($e.paint_fill["fill-pattern"])}),layout:D_};const O_=Qe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),R_=Qe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),B_=Qe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:F_}=O_;var Op=ou;function ou(i,e,t,n,a){this.properties={},this.extent=t,this.type=0,this._pbf=i,this._geometry=-1,this._keys=n,this._values=a,i.readFields(U_,this,e)}function U_(i,e,t){i==1?e.id=t.readVarint():i==2?function(n,a){for(var u=n.readVarint()+n.pos;n.pos<u;){var d=a._keys[n.readVarint()],p=a._values[n.readVarint()];a.properties[d]=p}}(t,e):i==3?e.type=t.readVarint():i==4&&(e._geometry=t.pos)}function N_(i){for(var e,t,n=0,a=0,u=i.length,d=u-1;a<u;d=a++)n+=((t=i[d]).x-(e=i[a]).x)*(e.y+t.y);return n}ou.types=["Unknown","Point","LineString","Polygon"],ou.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,t=i.readVarint()+i.pos,n=1,a=0,u=0,d=0,p=[];i.pos<t;){if(a<=0){var g=i.readVarint();n=7&g,a=g>>3}if(a--,n===1||n===2)u+=i.readSVarint(),d+=i.readSVarint(),n===1&&(e&&p.push(e),e=[]),e.push(new ce(u,d));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&p.push(e),p},ou.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,t=1,n=0,a=0,u=0,d=1/0,p=-1/0,g=1/0,y=-1/0;i.pos<e;){if(n<=0){var T=i.readVarint();t=7&T,n=T>>3}if(n--,t===1||t===2)(a+=i.readSVarint())<d&&(d=a),a>p&&(p=a),(u+=i.readSVarint())<g&&(g=u),u>y&&(y=u);else if(t!==7)throw new Error("unknown command "+t)}return[d,g,p,y]},ou.prototype.toGeoJSON=function(i,e,t){var n,a,u=this.extent*Math.pow(2,t),d=this.extent*i,p=this.extent*e,g=this.loadGeometry(),y=ou.types[this.type];function T(O){for(var F=0;F<O.length;F++){var $=O[F];O[F]=[360*($.x+d)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+p)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(n=0;n<g.length;n++)S[n]=g[n][0];T(g=S);break;case 2:for(n=0;n<g.length;n++)T(g[n]);break;case 3:for(g=function(O){var F=O.length;if(F<=1)return[O];for(var $,Y,ae=[],pe=0;pe<F;pe++){var le=N_(O[pe]);le!==0&&(Y===void 0&&(Y=le<0),Y===le<0?($&&ae.push($),$=[O[pe]]):$.push(O[pe]))}return $&&ae.push($),ae}(g),n=0;n<g.length;n++)for(a=0;a<g[n].length;a++)T(g[n][a])}g.length===1?g=g[0]:y="Multi"+y;var C={type:"Feature",geometry:{type:y,coordinates:g},properties:this.properties};return"id"in this&&(C.id=this.id),C};var Rp=Bp;function Bp(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(j_,this,e),this.length=this._features.length}function j_(i,e,t){i===15?e.version=t.readVarint():i===1?e.name=t.readString():i===5?e.extent=t.readVarint():i===2?e._features.push(t.pos):i===3?e._keys.push(t.readString()):i===4&&e._values.push(function(n){for(var a=null,u=n.readVarint()+n.pos;n.pos<u;){var d=n.readVarint()>>3;a=d===1?n.readString():d===2?n.readFloat():d===3?n.readDouble():d===4?n.readVarint64():d===5?n.readVarint():d===6?n.readSVarint():d===7?n.readBoolean():null}return a}(t))}function V_(i,e,t){if(i===3){var n=new Rp(t,t.readVarint()+t.pos);n.length&&(e[n.name]=n)}}Bp.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Op(this._pbf,e,this.extent,this._keys,this._values)};var Ql={VectorTile:function(i,e){this.layers=i.readFields(V_,{},e)},VectorTileFeature:Op,VectorTileLayer:Rp};function Zu(i,e,t,n){const a=[],u=n===0?(d,p,g,y,T,S)=>{d.push(new ce(S,g+(S-p)/(y-p)*(T-g)))}:(d,p,g,y,T,S)=>{d.push(new ce(p+(S-g)/(T-g)*(y-p),S))};for(const d of i){const p=[];for(const g of d){if(g.length<=2)continue;const y=[];for(let C=0;C<g.length-1;C++){const O=g[C].x,F=g[C].y,$=g[C+1].x,Y=g[C+1].y,ae=n===0?O:F,pe=n===0?$:Y;ae<e?pe>e&&u(y,O,F,$,Y,e):ae>t?pe<t&&u(y,O,F,$,Y,t):y.push(g[C]),pe<e&&ae>=e&&u(y,O,F,$,Y,e),pe>t&&ae<=t&&u(y,O,F,$,Y,t)}let T=g[g.length-1];const S=n===0?T.x:T.y;S>=e&&S<=t&&y.push(T),y.length&&(T=y[y.length-1],y[0].x===T.x&&y[0].y===T.y||y.push(y[0]),p.push(y))}p.length&&a.push(p)}return a}const G_=Ql.VectorTileFeature.types,$_=Math.pow(2,13);function Wu(i,e,t,n,a,u,d,p){i.emplaceBack((e<<1)+d,(t<<1)+u,(Math.floor(n*$_)<<1)+a,Math.round(p))}function Xu(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class Hu{constructor(){this.acc=new ce(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ce(e.x,e.y),this.max=new ce(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const n=this.min,a=this.max;e.x<n.x?n.x=e.x:e.x>a.x&&(a.x=e.x),e.y<n.y?n.y=e.y:e.y>a.y&&(a.y=e.y),((e.x===0||e.x===Xt)&&e.x===t.x)!=((e.y===0||e.y===Xt)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,ui(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Xt!=e.x>Xt&&this.addBorderIntersection(1,ui(t.y,e.y,(Xt-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,ui(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Xt!=e.y>Xt&&this.addBorderIntersection(3,ui(t.x,e.x,(Xt-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((t,n)=>t+n.edges,0);return e!==0?this.acc.div(e)._round():new ce(0,0)}span(){return new ce(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class Ku{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Nt,this.centroidVertexArray=new qd,this.indexArray=new gi,this.programConfigurations=new vc(e.layers,e.zoom),this.segments=new en,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=e.enableTerrain}populate(e,t,n,a){this.features=[],this.hasPattern=nu("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(u){const d=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*d/(d*d+1)/Xt/(1<<u.z)}(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:d,index:p,sourceLayerIndex:g}of e){const y=this.layers[0]._featureFilter.needGeometry,T=wl(u,y);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),T,n))continue;const S={id:d,sourceLayerIndex:g,index:p,geometry:y?T.geometry:ya(u,n,a),properties:u.properties,type:u.type,patterns:{}},C=this.layoutVertexArray.length;this.hasPattern?this.features.push(ff("fill-extrusion",this.layers,S,this.zoom,t)):this.addFeature(S,S.geometry,p,n,{},t.availableImages,a),t.featureIndex.insert(u,S.geometry,p,g,this.index,C)}this.sortBorders()}addFeatures(e,t,n,a,u){for(const d of this.features){const{geometry:p}=d;this.addFeature(d,p,d.index,t,n,a,u)}this.sortBorders()}update(e,t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,F_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,B_.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,R_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,a,u,d,p){const g=[new ce(0,0),new ce(Xt,Xt)],y=p.projection,T=y.name==="globe",S=this.enableTerrain&&!T?new Hu:null,C=G_[e.type]==="Polygon";T&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Jt);const O=ld(t,500);for(let ae=O.length-1;ae>=0;ae--){const pe=O[ae];(pe.length===0||(F=pe[0]).every(le=>le.x<=0)||F.every(le=>le.x>=Xt)||F.every(le=>le.y<=0)||F.every(le=>le.y>=Xt))&&O.splice(ae,1)}var F;let $;if(T)$=$p(O,g,a);else{$=[];for(const ae of O)$.push({polygon:ae,bounds:g})}const Y=C?this.edgeRadius:0;for(const{polygon:ae,bounds:pe}of $){let le=0,de=0;for(const ge of ae)C&&!ge[0].equals(ge[ge.length-1])&&ge.push(ge[0]),de+=C?ge.length-1:ge.length;const we=this.segments.prepareSegment((C?5:4)*de,this.layoutVertexArray,this.indexArray);if(C){const ge=[],Ne=[];le=we.vertexLength;for(const Ke of ae){let mt,Ge;Ke.length&&Ke!==ae[0]&&Ne.push(ge.length/2),mt=Ke[1].sub(Ke[0])._perp()._unit();for(let et=1;et<Ke.length;et++){const st=Ke[et],tt=Ke[et===Ke.length-1?1:et+1];let{x:ft,y:at}=st;if(Y){Ge=tt.sub(st)._perp()._unit();const zt=mt.add(Ge)._unit(),hi=Y*Math.min(4,1/(mt.x*zt.x+mt.y*zt.y));ft+=hi*zt.x,at+=hi*zt.y,mt=Ge}Wu(this.layoutVertexArray,ft,at,0,0,1,1,0),we.vertexLength++,ge.push(st.x,st.y),T&&Xu(this.layoutVertexExtArray,y.projectTilePoint(ft,at,a),y.upVector(a,ft,at))}}const Fe=rd(ge,Ne);for(let Ke=0;Ke<Fe.length;Ke+=3)this.indexArray.emplaceBack(le+Fe[Ke],le+Fe[Ke+2],le+Fe[Ke+1]),we.primitiveLength++}for(const ge of ae){S&&ge.length&&S.startRing(ge[0]);let Ne,Fe,Ke,mt=ge.length>4&&jp(ge[ge.length-2],ge[0],ge[1]),Ge=Y?q_(ge[ge.length-2],ge[0],ge[1],Y):0;Fe=ge[1].sub(ge[0])._perp()._unit();for(let et=1,st=0;et<ge.length;et++){let tt=ge[et-1],ft=ge[et];const at=ge[et===ge.length-1?1:et+1];if(S&&C&&S.currentPolyCount.top++,Np(ft,tt,pe)){Y&&(Fe=at.sub(ft)._perp()._unit());continue}S&&S.append(ft,tt);const zt=ft.sub(tt)._perp(),hi=zt.x/(Math.abs(zt.x)+Math.abs(zt.y)),vi=zt.y>0?1:0,Zt=tt.dist(ft);if(st+Zt>32768&&(st=0),Y){Ke=at.sub(ft)._perp()._unit();let Dt=Up(tt,ft,at,Fp(Fe,Ke),Y);isNaN(Dt)&&(Dt=0);const lr=ft.sub(tt)._unit();tt=tt.add(lr.mult(Ge))._round(),ft=ft.add(lr.mult(-Dt))._round(),Ge=Dt,Fe=Ke}const Et=we.vertexLength,Mi=ge.length>4&&jp(tt,ft,at);let ni=Vp(st,mt,!0);if(Wu(this.layoutVertexArray,tt.x,tt.y,hi,vi,0,0,ni),Wu(this.layoutVertexArray,tt.x,tt.y,hi,vi,0,1,ni),st+=Zt,ni=Vp(st,Mi,!1),mt=Mi,Wu(this.layoutVertexArray,ft.x,ft.y,hi,vi,0,0,ni),Wu(this.layoutVertexArray,ft.x,ft.y,hi,vi,0,1,ni),we.vertexLength+=4,this.indexArray.emplaceBack(Et+0,Et+1,Et+2),this.indexArray.emplaceBack(Et+1,Et+3,Et+2),we.primitiveLength+=2,Y){const Dt=le+(et===1?ge.length-2:et-2),lr=et===1?le:Dt+1;if(this.indexArray.emplaceBack(Et+1,Dt,Et+3),this.indexArray.emplaceBack(Dt,lr,Et+3),we.primitiveLength+=2,Ne===void 0&&(Ne=Et),!Np(at,ge[et],pe)){const sr=et===ge.length-1?Ne:we.vertexLength;this.indexArray.emplaceBack(Et+2,Et+3,sr),this.indexArray.emplaceBack(Et+3,sr+1,sr),this.indexArray.emplaceBack(Et+3,lr,sr+1),we.primitiveLength+=3}}if(T){const Dt=this.layoutVertexExtArray,lr=y.projectTilePoint(tt.x,tt.y,a),sr=y.projectTilePoint(ft.x,ft.y,a),wr=y.upVector(a,tt.x,tt.y),wi=y.upVector(a,ft.x,ft.y);Xu(Dt,lr,wr),Xu(Dt,lr,wr),Xu(Dt,sr,wi),Xu(Dt,sr,wi)}}C&&(le+=ge.length-1)}}if(S&&S.polyCount.length>0){if(S.borders){S.vertexArrayOffset=this.centroidVertexArray.length;const ae=S.borders,pe=this.featuresOnBorder.push(S)-1;for(let le=0;le<4;le++)ae[le][0]!==Number.MAX_VALUE&&this.borders[le].push(pe)}this.encodeCentroid(S.borders?void 0:S.centroid(),S)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,d,a)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,t,n=!0){let a,u;if(e)if(e.y!==0){const p=t.span()._mult(this.tileToMeter);a=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(p.x/10)),u=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(p.y/10))}else a=Math.ceil(7*(e.x+450)),u=0;else a=0,u=+n;let d=n?this.centroidVertexArray.length:t.vertexArrayOffset;for(const p of t.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*p.edges+p.top);for(let g=0;g<p.top;g++)this.centroidVertexArray.emplace(d++,a,u);for(let g=0;g<2*p.edges;g++)this.centroidVertexArray.emplace(d++,0,u),this.centroidVertexArray.emplace(d++,a,u)}}}function Fp(i,e){const t=i.add(e)._unit();return i.x*t.x+i.y*t.y}function q_(i,e,t,n){const a=e.sub(i)._perp()._unit(),u=t.sub(e)._perp()._unit();return Up(i,e,t,Fp(a,u),n)}function Up(i,e,t,n,a){const u=Math.sqrt(1-n*n);return Math.min(i.dist(e)/3,e.dist(t)/3,a*u/n)}function Np(i,e,t){return i.x<t[0].x&&e.x<t[0].x||i.x>t[1].x&&e.x>t[1].x||i.y<t[0].y&&e.y<t[0].y||i.y>t[1].y&&e.y>t[1].y}function jp(i,e,t){if(i.x<0||i.x>=Xt||e.x<0||e.x>=Xt||t.x<0||t.x>=Xt)return!1;const n=t.sub(e),a=n.perp(),u=i.sub(e);return(n.x*u.x+n.y*u.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(u.x*u.x+u.y*u.y))>-.866&&a.x*u.x+a.y*u.y<0}function Vp(i,e,t){const n=e?2|i:-3&i;return t?1|n:-2&n}function Gp(){const i=Math.PI/32,e=Math.tan(i),t=Jc;return t*Math.sqrt(1+2*e*e)-t}function $p(i,e,t){const n=1<<t.z,a=yo(t.x/n),u=yo((t.x+1)/n),d=kn(t.y/n),p=kn((t.y+1)/n);return function(g,y,T,S,C=0,O){const F=[];if(!g.length||!T||!S)return F;const $=(ge,Ne)=>{for(const Fe of ge)F.push({polygon:Fe,bounds:Ne})},Y=Math.ceil(Math.log2(T)),ae=Math.ceil(Math.log2(S)),pe=Y-ae,le=[];for(let ge=0;ge<Math.abs(pe);ge++)le.push(pe>0?0:1);for(let ge=0;ge<Math.min(Y,ae);ge++)le.push(0),le.push(1);let de=g;if(de=Zu(de,y[0].y-C,y[1].y+C,1),de=Zu(de,y[0].x-C,y[1].x+C,0),!de.length)return F;const we=[];for(le.length?we.push({polygons:de,bounds:y,depth:0}):$(de,y);we.length;){const ge=we.pop(),Ne=ge.depth,Fe=le[Ne],Ke=ge.bounds[0],mt=ge.bounds[1],Ge=Fe===0?Ke.x:Ke.y,et=Fe===0?mt.x:mt.y,st=O?O(Fe,Ge,et):.5*(Ge+et),tt=Zu(ge.polygons,Ge-C,st+C,Fe),ft=Zu(ge.polygons,st-C,et+C,Fe);if(tt.length){const at=[Ke,new ce(Fe===0?st:mt.x,Fe===1?st:mt.y)];le.length>Ne+1?we.push({polygons:tt,bounds:at,depth:Ne+1}):$(tt,at)}if(ft.length){const at=[new ce(Fe===0?st:Ke.x,Fe===1?st:Ke.y),mt];le.length>Ne+1?we.push({polygons:ft,bounds:at,depth:Ne+1}):$(ft,at)}}return F}(i,e,Math.ceil((u-a)/11.25),Math.ceil((d-p)/11.25),1,(g,y,T)=>{if(g===0)return .5*(y+T);{const S=kn((t.y+y/Xt)/n);return(xl(.5*(kn((t.y+T/Xt)/n)+S))*n-t.y)*Xt}})}kt(Ku,"FillExtrusionBucket",{omit:["layers","features"]}),kt(Hu,"PartMetadata");const Z_=new He({"fill-extrusion-edge-radius":new fe($e["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var W_={paint:new He({"fill-extrusion-opacity":new fe($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ee($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new fe($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new fe($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Le($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ee($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ee($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new fe($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new fe($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new fe($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Z_};function Yu(i,e,t){var n=2*Math.PI*6378137/256/Math.pow(2,t);return[i*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class ud{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=Cc(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const n=function(u,d,p){var g=Yu(256*u,256*(d=Math.pow(2,p)-d-1),p),y=Yu(256*(u+1),256*(d+1),p);return g[0]+","+g[1]+","+y[0]+","+y[1]}(this.x,this.y,this.z),a=function(u,d,p){let g,y="";for(let T=u;T>0;T--)g=1<<T-1,y+=(d&g?1:0)+(p&g?2:0);return y}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pf{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Cc(e,t.z,t.z,t.x,t.y)}}class Jn{constructor(e,t,n,a,u){this.overscaledZ=e,this.wrap=t,this.canonical=new ud(n,+a,+u),this.key=t===0&&e===n?this.canonical.key:Cc(t,e,n,a,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Jn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jn(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Cc(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return Cc(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Jn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,a=2*this.canonical.y;return[new Jn(t,this.wrap,t,n,a),new Jn(t,this.wrap,t,n+1,a),new Jn(t,this.wrap,t,n,a+1),new Jn(t,this.wrap,t,n+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Jn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Jn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Cc(i,e,t,n,a){const u=1<<Math.min(t,22);let d=u*(a%u)+n%u;return i&&t<22&&(d+=u*u*((i<0?-2*i-1:2*i)%(1<<2*(22-t)))),16*(32*d+t)+(e-t)}function su(i,e){return i.x*e.x+i.y*e.y}function mf(i,e){if(i.length===1){let t=0;const n=e[t++];let a;for(;!a||n.equals(a);)if(a=e[t++],!a)return 1/0;for(;t<e.length;t++){const u=e[t],d=i[0],p=a.sub(n),g=u.sub(n),y=d.sub(n),T=su(p,p),S=su(p,g),C=su(g,g),O=su(y,p),F=su(y,g),$=T*C-S*S,Y=(C*O-S*F)/$,ae=(T*F-S*O)/$,pe=n.z*(1-Y-ae)+a.z*Y+u.z*ae;if(isFinite(pe))return pe}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}function Ju(i){const e=new ce(i[0],i[1]);return e.z=i[2],e}function _f(i,e,t,n,a,u,d,p){const g=d*a.getElevationAt(i,e,!0,!0),y=u[0]!==0,T=y?u[1]===0?d*(u[0]/7-450):d*function(S,C,O){const F=Math.floor(C[0]/8),$=Math.floor(C[1]/8),Y=10*(C[0]-8*F),ae=10*(C[1]-8*$),pe=S.getElevationAt(F,$,!0,!0),le=S.getMeterToDEM(O),de=Math.floor(.5*(Y*le-1)),we=Math.floor(.5*(ae*le-1)),ge=S.tileCoordToPixel(F,$),Ne=2*de+1,Fe=2*we+1,Ke=function(ft,at,zt,hi,vi){return[ft.getElevationAtPixel(at,zt,!0),ft.getElevationAtPixel(at+vi,zt,!0),ft.getElevationAtPixel(at,zt+vi,!0),ft.getElevationAtPixel(at+hi,zt+vi,!0)]}(S,ge.x-de,ge.y-we,Ne,Fe),mt=Math.abs(Ke[0]-Ke[1]),Ge=Math.abs(Ke[2]-Ke[3]),et=Math.abs(Ke[0]-Ke[2])+Math.abs(Ke[1]-Ke[3]),st=Math.min(.25,.5*le*(mt+Ge)/Ne),tt=Math.min(.25,.5*le*et/Fe);return pe+Math.max(st*Y,tt*ae)}(a,u,p):g;return{base:g+(t===0)?-1:t,top:y?Math.max(T+n,g+t+2):g+n}}kt(ud,"CanonicalTileID"),kt(Jn,"OverscaledTileID",{omit:["projMatrix"]});const X_=Qe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:H_}=X_,K_=Qe([{name:"a_packed",components:4,type:"Float32"}]),{members:hd}=K_,dd=Ql.VectorTileFeature.types,Y_=Math.cos(Math.PI/180*37.5);class fd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new Ht,this.layoutVertexArray2=new Ei,this.indexArray=new gi,this.programConfigurations=new vc(e.layers,e.zoom),this.segments=new en,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,n,a){this.hasPattern=nu("line",this.layers,t);const u=this.layers[0].layout.get("line-sort-key"),d=[];for(const{feature:T,id:S,index:C,sourceLayerIndex:O}of e){const F=this.layers[0]._featureFilter.needGeometry,$=wl(T,F);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),$,n))continue;const Y=u?u.evaluate($,{},n):void 0,ae={id:S,properties:T.properties,type:T.type,sourceLayerIndex:O,index:C,geometry:F?$.geometry:ya(T,n,a),patterns:{},sortKey:Y};d.push(ae)}u&&d.sort((T,S)=>T.sortKey-S.sortKey);const{lineAtlas:p,featureIndex:g}=t,y=this.addConstantDashes(p);for(const T of d){const{geometry:S,index:C,sourceLayerIndex:O}=T;if(y&&this.addFeatureDashes(T,p),this.hasPattern){const F=ff("line",this.layers,T,this.zoom,t);this.patternFeatures.push(F)}else this.addFeature(T,S,C,n,p.positions,t.availableImages);g.insert(e[C].feature,S,C,O,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const a=n.paint.get("line-dasharray").value,u=n.layout.get("line-cap").value;if(a.kind!=="constant"||u.kind!=="constant")t=!0;else{const d=u.value,p=a.value;if(!p)continue;e.addDash(p.from,d),e.addDash(p.to,d),p.other&&e.addDash(p.other,d)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(u.kind==="constant"&&d.kind==="constant")continue;let p,g,y,T,S,C;if(u.kind==="constant"){const Y=u.value;if(!Y)continue;p=Y.other||Y.to,g=Y.to,y=Y.from}else p=u.evaluate({zoom:n-1},e),g=u.evaluate({zoom:n},e),y=u.evaluate({zoom:n+1},e);d.kind==="constant"?T=S=C=d.value:(T=d.evaluate({zoom:n-1},e),S=d.evaluate({zoom:n},e),C=d.evaluate({zoom:n+1},e)),t.addDash(p,T),t.addDash(g,S),t.addDash(y,C);const O=t.getKey(p,T),F=t.getKey(g,S),$=t.getKey(y,C);e.patterns[a.id]={min:O,mid:F,max:$}}}update(e,t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,a)}addFeatures(e,t,n,a,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,t,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,hd)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,H_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,a,u,d){const p=this.layers[0].layout,g=p.get("line-join").evaluate(e,{}),y=p.get("line-cap").evaluate(e,{}),T=p.get("line-miter-limit"),S=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const C of t)this.addLine(C,e,g,y,T,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,d,a)}addLine(e,t,n,a,u,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ae=0;ae<e.length-1;ae++)this.totalDistance+=e[ae].dist(e[ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const p=dd[t.type]==="Polygon";let g=e.length;for(;g>=2&&e[g-1].equals(e[g-2]);)g--;let y=0;for(;y<g-1&&e[y].equals(e[y+1]);)y++;if(g<(p?3:2))return;n==="bevel"&&(u=1.05);const T=this.overscaling<=16?122880/(512*this.overscaling):0,S=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let C,O,F,$,Y;this.e1=this.e2=-1,p&&(C=e[g-2],Y=e[y].sub(C)._unit()._perp());for(let ae=y;ae<g;ae++){if(F=ae===g-1?p?e[y+1]:void 0:e[ae+1],F&&e[ae].equals(F))continue;Y&&($=Y),C&&(O=C),C=e[ae],Y=F?F.sub(C)._unit()._perp():$,$=$||Y;let pe=$.add(Y);pe.x===0&&pe.y===0||pe._unit();const le=$.x*Y.x+$.y*Y.y,de=pe.x*Y.x+pe.y*Y.y,we=de!==0?1/de:1/0,ge=2*Math.sqrt(2-2*de),Ne=de<Y_&&O&&F,Fe=$.x*Y.y-$.y*Y.x>0;if(Ne&&ae>y){const Ge=C.dist(O);if(Ge>2*T){const et=C.sub(C.sub(O)._mult(T/Ge)._round());this.updateDistance(O,et),this.addCurrentVertex(et,$,0,0,S),O=et}}const Ke=O&&F;let mt=Ke?n:p?"butt":a;if(Ke&&mt==="round"&&(we<d?mt="miter":we<=2&&(mt="fakeround")),mt==="miter"&&we>u&&(mt="bevel"),mt==="bevel"&&(we>2&&(mt="flipbevel"),we<u&&(mt="miter")),O&&this.updateDistance(O,C),mt==="miter")pe._mult(we),this.addCurrentVertex(C,pe,0,0,S);else if(mt==="flipbevel"){if(we>100)pe=Y.mult(-1);else{const Ge=we*$.add(Y).mag()/$.sub(Y).mag();pe._perp()._mult(Ge*(Fe?-1:1))}this.addCurrentVertex(C,pe,0,0,S),this.addCurrentVertex(C,pe.mult(-1),0,0,S)}else if(mt==="bevel"||mt==="fakeround"){const Ge=-Math.sqrt(we*we-1),et=Fe?Ge:0,st=Fe?0:Ge;if(O&&this.addCurrentVertex(C,$,et,st,S),mt==="fakeround"){const tt=Math.round(180*ge/Math.PI/20);for(let ft=1;ft<tt;ft++){let at=ft/tt;if(at!==.5){const hi=at-.5;at+=at*hi*(at-1)*((1.0904+le*(le*(3.55645-1.43519*le)-3.2452))*hi*hi+(.848013+le*(.215638*le-1.06021)))}const zt=Y.sub($)._mult(at)._add($)._unit()._mult(Fe?-1:1);this.addHalfVertex(C,zt.x,zt.y,!1,Fe,0,S)}}F&&this.addCurrentVertex(C,Y,-et,-st,S)}else if(mt==="butt")this.addCurrentVertex(C,pe,0,0,S);else if(mt==="square"){const Ge=O?1:-1;O||this.addCurrentVertex(C,pe,Ge,Ge,S),this.addCurrentVertex(C,pe,0,0,S),O&&this.addCurrentVertex(C,pe,Ge,Ge,S)}else mt==="round"&&(O&&(this.addCurrentVertex(C,$,0,0,S),this.addCurrentVertex(C,$,1,1,S,!0)),F&&(this.addCurrentVertex(C,Y,-1,-1,S,!0),this.addCurrentVertex(C,Y,0,0,S)));if(Ne&&ae<g-1){const Ge=C.dist(F);if(Ge>2*T){const et=C.add(F.sub(C)._mult(T/Ge)._round());this.updateDistance(C,et),this.addCurrentVertex(et,Y,0,0,S),C=et}}}}addCurrentVertex(e,t,n,a,u,d=!1){const p=t.y*a-t.x,g=-t.y-t.x*a;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,d,!1,n,u),this.addHalfVertex(e,p,g,d,!0,-a,u)}addHalfVertex({x:e,y:t},n,a,u,d,p,g){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(t<<1)+(d?1:0),Math.round(63*n)+128,Math.round(63*a)+128,1+(p===0?0:p<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const y=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,y),g.primitiveLength++),d?this.e2=y:this.e1=y}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}kt(fd,"LineBucket",{omit:["layers","patternFeatures"]});const gf=new He({"line-cap":new Ee($e.layout_line["line-cap"]),"line-join":new Ee($e.layout_line["line-join"]),"line-miter-limit":new fe($e.layout_line["line-miter-limit"]),"line-round-limit":new fe($e.layout_line["line-round-limit"]),"line-sort-key":new Ee($e.layout_line["line-sort-key"])});var yf={paint:new He({"line-opacity":new Ee($e.paint_line["line-opacity"]),"line-color":new Ee($e.paint_line["line-color"]),"line-translate":new fe($e.paint_line["line-translate"]),"line-translate-anchor":new fe($e.paint_line["line-translate-anchor"]),"line-width":new Ee($e.paint_line["line-width"]),"line-gap-width":new Ee($e.paint_line["line-gap-width"]),"line-offset":new Ee($e.paint_line["line-offset"]),"line-blur":new Ee($e.paint_line["line-blur"]),"line-dasharray":new Le($e.paint_line["line-dasharray"]),"line-pattern":new Le($e.paint_line["line-pattern"]),"line-gradient":new Pe($e.paint_line["line-gradient"]),"line-trim-offset":new fe($e.paint_line["line-trim-offset"])}),layout:gf};const qp=new class extends Ee{possiblyEvaluate(i,e){return e=new J(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,t,n){return e=At({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,t,n)}}(yf.paint.properties["line-width"].specification);function Zp(i,e){return e>0?e+2*i:i}qp.useIntegerZoom=!0;const J_=Qe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Q_=Qe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),eg=Qe([{name:"a_projected_pos",components:4,type:"Float32"}],4);Qe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tg=Qe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ig=Qe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Wp=Qe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rg=Qe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qe([{name:"triangle",components:3,type:"Uint16"}]),Qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Qe([{type:"Float32",name:"offsetX"}]),Qe([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Gn=24;const Wa=128;function vf(i,e){const{expression:t}=e;if(t.kind==="constant")return{kind:"constant",layoutSize:t.evaluate(new J(i+1))};if(t.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:a}=t;let u=0;for(;u<n.length&&n[u]<=i;)u++;u=Math.max(0,u-1);let d=u;for(;d<n.length&&n[d]<i+1;)d++;d=Math.min(n.length-1,d);const p=n[u],g=n[d];return t.kind==="composite"?{kind:"composite",minZoom:p,maxZoom:g,interpolationType:a}:{kind:"camera",minZoom:p,maxZoom:g,minSize:t.evaluate(new J(p)),maxSize:t.evaluate(new J(g)),interpolationType:a}}}function No(i,{uSize:e,uSizeT:t},{lowerSize:n,upperSize:a}){return i.kind==="source"?n/Wa:i.kind==="composite"?ui(n/Wa,a/Wa,t):e}function au(i,e){let t=0,n=0;if(i.kind==="constant")n=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:a,minZoom:u,maxZoom:d}=i,p=a?Ye(Hn.interpolationFactor(a,e,u,d),0,1):0;i.kind==="camera"?n=ui(i.minSize,i.maxSize,p):t=p}return{uSizeT:t,uSize:n}}var ng=Object.freeze({__proto__:null,getSizeData:vf,evaluateSizeForFeature:No,evaluateSizeForZoom:au,SIZE_PACK_FACTOR:Wa});function Pc(i,e,t){return i.sections.forEach(n=>{n.text=function(a,u,d){const p=u.layout.get("text-transform").evaluate(d,{});return p==="uppercase"?a=a.toLocaleUpperCase():p==="lowercase"&&(a=a.toLocaleLowerCase()),ee.applyArabicShaping&&(a=ee.applyArabicShaping(a)),a}(n.text,e,t)}),i}const yi={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function og(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function jo(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var rn=function(i,e,t,n,a){var u,d,p=8*a-n-1,g=(1<<p)-1,y=g>>1,T=-7,S=t?a-1:0,C=t?-1:1,O=i[e+S];for(S+=C,u=O&(1<<-T)-1,O>>=-T,T+=p;T>0;u=256*u+i[e+S],S+=C,T-=8);for(d=u&(1<<-T)-1,u>>=-T,T+=n;T>0;d=256*d+i[e+S],S+=C,T-=8);if(u===0)u=1-y;else{if(u===g)return d?NaN:1/0*(O?-1:1);d+=Math.pow(2,n),u-=y}return(O?-1:1)*d*Math.pow(2,u-n)},Xp=function(i,e,t,n,a,u){var d,p,g,y=8*u-a-1,T=(1<<y)-1,S=T>>1,C=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=n?0:u-1,F=n?1:-1,$=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(p=isNaN(e)?1:0,d=T):(d=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-d))<1&&(d--,g*=2),(e+=d+S>=1?C/g:C*Math.pow(2,1-S))*g>=2&&(d++,g/=2),d+S>=T?(p=0,d=T):d+S>=1?(p=(e*g-1)*Math.pow(2,a),d+=S):(p=e*Math.pow(2,S-1)*Math.pow(2,a),d=0));a>=8;i[t+O]=255&p,O+=F,p/=256,a-=8);for(d=d<<a|p,y+=a;y>0;i[t+O]=255&d,O+=F,d/=256,y-=8);i[t+O-F]|=128*$},js=er;function er(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}er.Varint=0,er.Fixed64=1,er.Bytes=2,er.Fixed32=5;var xf=4294967296,Hp=1/xf,Kp=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Al(i){return i.type===er.Bytes?i.readVarint()+i.pos:i.pos+1}function ec(i,e,t){return t?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Yp(i,e,t){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(n);for(var a=t.pos-1;a>=i;a--)t.buf[a+n]=t.buf[a]}function Sl(i,e){for(var t=0;t<i.length;t++)e.writeVarint(i[t])}function Jp(i,e){for(var t=0;t<i.length;t++)e.writeSVarint(i[t])}function pd(i,e){for(var t=0;t<i.length;t++)e.writeFloat(i[t])}function Gr(i,e){for(var t=0;t<i.length;t++)e.writeDouble(i[t])}function nn(i,e){for(var t=0;t<i.length;t++)e.writeBoolean(i[t])}function Qp(i,e){for(var t=0;t<i.length;t++)e.writeFixed32(i[t])}function sg(i,e){for(var t=0;t<i.length;t++)e.writeSFixed32(i[t])}function ag(i,e){for(var t=0;t<i.length;t++)e.writeFixed64(i[t])}function lg(i,e){for(var t=0;t<i.length;t++)e.writeSFixed64(i[t])}function md(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function lu(i,e,t){i[t]=e,i[t+1]=e>>>8,i[t+2]=e>>>16,i[t+3]=e>>>24}function em(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function tm(i,e,t){e.glyphs=[],i===1&&t.readMessage(Qu,e)}function Qu(i,e,t){if(i===3){const{id:n,bitmap:a,width:u,height:d,left:p,top:g,advance:y}=t.readMessage(bf,{});e.glyphs.push({id:n,bitmap:new El({width:u+6,height:d+6},a),metrics:{width:u,height:d,left:p,top:g,advance:y}})}else i===4?e.ascender=t.readSVarint():i===5&&(e.descender=t.readSVarint())}function bf(i,e,t){i===1?e.id=t.readVarint():i===2?e.bitmap=t.readBytes():i===3?e.width=t.readVarint():i===4?e.height=t.readVarint():i===5?e.left=t.readSVarint():i===6?e.top=t.readSVarint():i===7&&(e.advance=t.readVarint())}function wf(i){let e=0,t=0;for(const d of i)e+=d.w*d.h,t=Math.max(t,d.w);i.sort((d,p)=>p.h-d.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let a=0,u=0;for(const d of i)for(let p=n.length-1;p>=0;p--){const g=n[p];if(!(d.w>g.w||d.h>g.h)){if(d.x=g.x,d.y=g.y,u=Math.max(u,d.y+d.h),a=Math.max(a,d.x+d.w),d.w===g.w&&d.h===g.h){const y=n.pop();p<n.length&&(n[p]=y)}else d.h===g.h?(g.x+=d.w,g.w-=d.w):d.w===g.w?(g.y+=d.h,g.h-=d.h):(n.push({x:g.x+d.w,y:g.y,w:g.w-d.w,h:d.h}),g.y+=d.h,g.h-=d.h);break}}return{w:a,h:u,fill:e/(a*u)||0}}er.prototype={destroy:function(){this.buf=null},readFields:function(i,e,t){for(t=t||this.length;this.pos<t;){var n=this.readVarint(),a=n>>3,u=this.pos;this.type=7&n,i(a,e,this),this.pos===u&&this.skip(n)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=md(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=em(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=md(this.buf,this.pos)+md(this.buf,this.pos+4)*xf;return this.pos+=8,i},readSFixed64:function(){var i=md(this.buf,this.pos)+em(this.buf,this.pos+4)*xf;return this.pos+=8,i},readFloat:function(){var i=rn(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=rn(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,t,n=this.buf;return e=127&(t=n[this.pos++]),t<128?e:(e|=(127&(t=n[this.pos++]))<<7,t<128?e:(e|=(127&(t=n[this.pos++]))<<14,t<128?e:(e|=(127&(t=n[this.pos++]))<<21,t<128?e:function(a,u,d){var p,g,y=d.buf;if(p=(112&(g=y[d.pos++]))>>4,g<128||(p|=(127&(g=y[d.pos++]))<<3,g<128)||(p|=(127&(g=y[d.pos++]))<<10,g<128)||(p|=(127&(g=y[d.pos++]))<<17,g<128)||(p|=(127&(g=y[d.pos++]))<<24,g<128)||(p|=(1&(g=y[d.pos++]))<<31,g<128))return ec(a,p,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(t=n[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Kp?function(t,n,a){return Kp.decode(t.subarray(n,a))}(this.buf,e,i):function(t,n,a){for(var u="",d=n;d<a;){var p,g,y,T=t[d],S=null,C=T>239?4:T>223?3:T>191?2:1;if(d+C>a)break;C===1?T<128&&(S=T):C===2?(192&(p=t[d+1]))==128&&(S=(31&T)<<6|63&p)<=127&&(S=null):C===3?(g=t[d+2],(192&(p=t[d+1]))==128&&(192&g)==128&&((S=(15&T)<<12|(63&p)<<6|63&g)<=2047||S>=55296&&S<=57343)&&(S=null)):C===4&&(g=t[d+2],y=t[d+3],(192&(p=t[d+1]))==128&&(192&g)==128&&(192&y)==128&&((S=(15&T)<<18|(63&p)<<12|(63&g)<<6|63&y)<=65535||S>=1114112)&&(S=null)),S===null?(S=65533,C=1):S>65535&&(S-=65536,u+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),u+=String.fromCharCode(S),d+=C}return u}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==er.Bytes)return i.push(this.readVarint(e));var t=Al(this);for(i=i||[];this.pos<t;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==er.Bytes)return i.push(this.readSVarint());var e=Al(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==er.Bytes)return i.push(this.readBoolean());var e=Al(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==er.Bytes)return i.push(this.readFloat());var e=Al(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==er.Bytes)return i.push(this.readDouble());var e=Al(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==er.Bytes)return i.push(this.readFixed32());var e=Al(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==er.Bytes)return i.push(this.readSFixed32());var e=Al(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==er.Bytes)return i.push(this.readFixed64());var e=Al(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==er.Bytes)return i.push(this.readSFixed64());var e=Al(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===er.Varint)for(;this.buf[this.pos++]>127;);else if(e===er.Bytes)this.pos=this.readVarint()+this.pos;else if(e===er.Fixed32)this.pos+=4;else{if(e!==er.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),lu(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),lu(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),lu(this.buf,-1&i,this.pos),lu(this.buf,Math.floor(i*Hp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),lu(this.buf,-1&i,this.pos),lu(this.buf,Math.floor(i*Hp),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,t){var n,a;if(e>=0?(n=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(u,d,p){p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,p.buf[p.pos]=127&(u>>>=7)}(n,0,t),function(u,d){var p=(7&u)<<4;d.buf[d.pos++]|=p|((u>>>=3)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u)))))}(a,t)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(n,a,u){for(var d,p,g=0;g<a.length;g++){if((d=a.charCodeAt(g))>55295&&d<57344){if(!p){d>56319||g+1===a.length?(n[u++]=239,n[u++]=191,n[u++]=189):p=d;continue}if(d<56320){n[u++]=239,n[u++]=191,n[u++]=189,p=d;continue}d=p-55296<<10|d-56320|65536,p=null}else p&&(n[u++]=239,n[u++]=191,n[u++]=189,p=null);d<128?n[u++]=d:(d<2048?n[u++]=d>>6|192:(d<65536?n[u++]=d>>12|224:(n[u++]=d>>18|240,n[u++]=d>>12&63|128),n[u++]=d>>6&63|128),n[u++]=63&d|128)}return u}(this.buf,i,this.pos);var t=this.pos-e;t>=128&&Yp(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(i){this.realloc(4),Xp(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Xp(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=i[t]},writeRawMessage:function(i,e){this.pos++;var t=this.pos;i(e,this);var n=this.pos-t;n>=128&&Yp(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,e,t){this.writeTag(i,er.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Sl,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Jp,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,nn,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,pd,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Gr,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Qp,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,sg,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,ag,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,lg,e)},writeBytesField:function(i,e){this.writeTag(i,er.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,er.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,er.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,er.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,er.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,er.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,er.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,er.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,er.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,er.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class _d{constructor(e,{pixelRatio:t,version:n,stretchX:a,stretchY:u,content:d}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=a,this.stretchY=u,this.content=d,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class eh{constructor(e,t){const n={},a={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,n,u),this.addImages(t,a,u);const{w:d,h:p}=wf(u),g=new Uo({width:d||1,height:p||1});for(const y in e){const T=e[y],S=n[y].paddedRect;Uo.copy(T.data,g,{x:0,y:0},{x:S.x+1,y:S.y+1},T.data)}for(const y in t){const T=t[y],S=a[y].paddedRect,C=S.x+1,O=S.y+1,F=T.data.width,$=T.data.height;Uo.copy(T.data,g,{x:0,y:0},{x:C,y:O},T.data),Uo.copy(T.data,g,{x:0,y:$-1},{x:C,y:O-1},{width:F,height:1}),Uo.copy(T.data,g,{x:0,y:0},{x:C,y:O+$},{width:F,height:1}),Uo.copy(T.data,g,{x:F-1,y:0},{x:C-1,y:O},{width:1,height:$}),Uo.copy(T.data,g,{x:0,y:0},{x:C+F,y:O},{width:1,height:$})}this.image=g,this.iconPositions=n,this.patternPositions=a}addImages(e,t,n){for(const a in e){const u=e[a],d={x:0,y:0,w:u.data.width+2,h:u.data.height+2};n.push(d),t[a]=new _d(d,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(n=>e.hasImage(n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t||e.version===t.version)return;e.version=t.version;const[a,u]=e.tl;n.update(t.data,void 0,{x:a,y:u})}}kt(_d,"ImagePosition"),kt(eh,"ImageAtlas");const Ir={horizontal:1,vertical:2,horizontalOnly:3};class Xa{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new Xa;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new Xa;return t.imageName=e,t}}class cu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new cu;for(let a=0;a<e.sections.length;a++){const u=e.sections[a];u.image?n.addImageSection(u):n.addTextSection(u,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,n){let a="";for(let u=0;u<t.length;u++){const d=t.charCodeAt(u+1)||null,p=t.charCodeAt(u-1)||null;a+=!n&&(d&&gc(d)&&!yi[t[u+1]]||p&&gc(p)&&!yi[t[u-1]])||!yi[t[u]]?t[u]:yi[t[u]]}return a}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&gd[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&gd[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new cu;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Xa.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.name:"";if(t.length===0)return void _r("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Xa.forImage(t)),this.sectionIndex.push(this.sections.length-1)):_r("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Tf(i,e,t,n,a,u,d,p,g,y,T,S,C,O,F,$){const Y=cu.fromFeature(i,a);let ae;S===Ir.vertical&&Y.verticalizePunctuation(C);const{processBidirectionalText:pe,processStyledBidirectionalText:le}=ee;if(pe&&Y.sections.length===1){ae=[];const ge=pe(Y.toString(),Vo(Y,y,u,e,n,O,F));for(const Ne of ge){const Fe=new cu;Fe.text=Ne,Fe.sections=Y.sections;for(let Ke=0;Ke<Ne.length;Ke++)Fe.sectionIndex.push(0);ae.push(Fe)}}else if(le){ae=[];const ge=le(Y.text,Y.sectionIndex,Vo(Y,y,u,e,n,O,F));for(const Ne of ge){const Fe=new cu;Fe.text=Ne[0],Fe.sectionIndex=Ne[1],Fe.sections=Y.sections,ae.push(Fe)}}else ae=function(ge,Ne){const Fe=[],Ke=ge.text;let mt=0;for(const Ge of Ne)Fe.push(ge.substring(mt,Ge)),mt=Ge;return mt<Ke.length&&Fe.push(ge.substring(mt,Ke.length)),Fe}(Y,Vo(Y,y,u,e,n,O,F));const de=[],we={positionedLines:de,text:Y.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ge,Ne,Fe,Ke,mt,Ge,et,st,tt,ft,at,zt){let hi=0,vi=0,Zt=0;const Et=st==="right"?1:st==="left"?0:.5;let Mi=!1;for(const wi of mt){const Ui=wi.getSections();for(const cr of Ui){if(cr.imageName)continue;const ar=Ne[cr.fontStack];if(ar&&(Mi=ar.ascender!==void 0&&ar.descender!==void 0,!Mi))break}if(!Mi)break}let ni=0;for(const wi of mt){wi.trim();const Ui=wi.getMaxScale(),cr=(Ui-1)*Gn,ar={positionedGlyphs:[],lineOffset:0};ge.positionedLines[ni]=ar;const tr=ar.positionedGlyphs;let vr=0;if(!wi.length()){vi+=Ge,++ni;continue}let Mr=0,Qn=0;for(let Oi=0;Oi<wi.length();Oi++){const qr=wi.getSection(Oi),Eo=wi.getSectionIndex(Oi),Wi=wi.getCharCode(Oi);let Cr=qr.scale,qo=null,Tr=null,on=null,eo=Gn,qn=0;const po=!(tt===Ir.horizontal||!at&&!ml(Wi)||at&&(gd[Wi]||(Dt=Wi,Mh(Dt)||Ch(Dt)||Ph(Dt)||mc(Dt)||qc(Dt))));if(qr.imageName){const Zo=Ke[qr.imageName];if(!Zo)continue;on=qr.imageName,ge.iconsInText=ge.iconsInText||!0,Tr=Zo.paddedRect;const to=Zo.displaySize;Cr=Cr*Gn/zt,qo={width:to[0],height:to[1],left:1,top:-3,advance:po?to[1]:to[0],localGlyph:!1},qn=Mi?-qo.height*Cr:Ui*Gn-17-to[1]*Cr,eo=qo.advance;const kc=(po?to[0]:to[1])*Cr-Gn*Ui;kc>0&&kc>vr&&(vr=kc)}else{const Zo=Fe[qr.fontStack];if(!Zo)continue;Zo[Wi]&&(Tr=Zo[Wi]);const to=Ne[qr.fontStack];if(!to)continue;const kc=to.glyphs[Wi];if(!kc)continue;if(qo=kc.metrics,eo=Wi!==8203?Gn:0,Mi){const kd=to.ascender!==void 0?Math.abs(to.ascender):0,$f=to.descender!==void 0?Math.abs(to.descender):0,qf=(kd+$f)*Cr;Mr<qf&&(Mr=qf,Qn=(kd-$f)/2*Cr),qn=-kd*Cr}else qn=(Ui-Cr)*Gn-17}po?(ge.verticalizable=!0,tr.push({glyph:Wi,imageName:on,x:hi,y:vi+qn,vertical:po,scale:Cr,localGlyph:qo.localGlyph,fontStack:qr.fontStack,sectionIndex:Eo,metrics:qo,rect:Tr}),hi+=eo*Cr+ft):(tr.push({glyph:Wi,imageName:on,x:hi,y:vi+qn,vertical:po,scale:Cr,localGlyph:qo.localGlyph,fontStack:qr.fontStack,sectionIndex:Eo,metrics:qo,rect:Tr}),hi+=qo.advance*Cr+ft)}tr.length!==0&&(Zt=Math.max(hi-ft,Zt),Mi?rm(tr,Et,vr,Qn,Ge*Ui/2):rm(tr,Et,vr,0,Ge/2)),hi=0;const ds=Ge*Ui+vr;ar.lineOffset=Math.max(vr,cr),vi+=ds,++ni}var Dt;const lr=vi,{horizontalAlign:sr,verticalAlign:wr}=yd(et);(function(wi,Ui,cr,ar,tr,vr){const Mr=(Ui-cr)*tr,Qn=-vr*ar;for(const ds of wi)for(const Oi of ds.positionedGlyphs)Oi.x+=Mr,Oi.y+=Qn})(ge.positionedLines,Et,sr,wr,Zt,lr),ge.top+=-wr*lr,ge.bottom=ge.top+lr,ge.left+=-sr*Zt,ge.right=ge.left+Zt,ge.hasBaseline=Mi}(we,e,t,n,ae,d,p,g,S,y,C,$),!function(ge){for(const Ne of ge)if(Ne.positionedGlyphs.length!==0)return!1;return!0}(de)&&we}const gd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},cg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function im(i,e,t,n,a,u){if(e.imageName){const d=n[e.imageName];return d?d.displaySize[0]*e.scale*Gn/u+a:0}{const d=t[e.fontStack],p=d&&d.glyphs[i];return p?p.metrics.advance*e.scale+a:0}}function Ef(i,e,t,n){const a=Math.pow(i-e,2);return n?i<e?a/2:2*a:a+Math.abs(t)*t}function Il(i,e,t){let n=0;return i===10&&(n-=1e4),t&&(n+=150),i!==40&&i!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function Si(i,e,t,n,a,u){let d=null,p=Ef(e,t,a,u);for(const g of n){const y=Ef(e-g.x,t,a,u)+g.badness;y<=p&&(d=g,p=y)}return{index:i,x:e,priorBreak:d,badness:p}}function Af(i){return i?Af(i.priorBreak).concat(i.index):[]}function Vo(i,e,t,n,a,u,d){if(u!=="point")return[];if(!i)return[];const p=[],g=function(C,O,F,$,Y,ae){let pe=0;for(let le=0;le<C.length();le++){const de=C.getSection(le);pe+=im(C.getCharCode(le),de,$,Y,O,ae)}return pe/Math.max(1,Math.ceil(pe/F))}(i,e,t,n,a,d),y=i.text.indexOf("\u200B")>=0;let T=0;for(let C=0;C<i.length();C++){const O=i.getSection(C),F=i.getCharCode(C);if(gd[F]||(T+=im(F,O,n,a,e,d)),C<i.length()-1){const $=!((S=F)<11904||!(Iu(S)||Ls(S)||zu(S)||Lh(S)||Pu(S)||Ds(S)||kh(S)||Gc(S)||fa(S)||pc(S)||Cu(S)||Du(S)||Su(S)||fc(S)||zh(S)||Mu(S)||pl(S)||Oh(S)||Do(S)||$c(S)));(cg[F]||$||O.imageName)&&p.push(Si(C+1,T,g,p,Il(F,i.getCharCode(C+1),$&&y),!1))}}var S;return Af(Si(i.length(),T,g,p,0,!0))}function yd(i){let e=.5,t=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function rm(i,e,t,n,a){if(!(e||t||n||a))return;const u=i.length-1,d=i[u],p=(d.x+d.metrics.advance*d.scale)*e;for(let g=0;g<=u;g++)i[g].x-=p,i[g].y+=t+n+a}function or(i,e,t){const{horizontalAlign:n,verticalAlign:a}=yd(t),u=e[0]-i.displaySize[0]*n,d=e[1]-i.displaySize[1]*a;return{image:i,top:d,bottom:d+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function nm(i,e,t,n,a,u){const d=i.image;let p;if(d.content){const Y=d.content,ae=d.pixelRatio||1;p=[Y[0]/ae,Y[1]/ae,d.displaySize[0]-Y[2]/ae,d.displaySize[1]-Y[3]/ae]}const g=e.left*u,y=e.right*u;let T,S,C,O;t==="width"||t==="both"?(O=a[0]+g-n[3],S=a[0]+y+n[1]):(O=a[0]+(g+y-d.displaySize[0])/2,S=O+d.displaySize[0]);const F=e.top*u,$=e.bottom*u;return t==="height"||t==="both"?(T=a[1]+F-n[0],C=a[1]+$+n[2]):(T=a[1]+(F+$-d.displaySize[1])/2,C=T+d.displaySize[1]),{image:d,top:T,right:S,bottom:C,left:O,collisionPadding:p}}class Ha extends ce{constructor(e,t,n,a,u){super(e,t),this.angle=a,this.z=n,u!==void 0&&(this.segment=u)}clone(){return new Ha(this.x,this.y,this.z,this.angle,this.segment)}}function th(i,e,t,n,a){if(e.segment===void 0)return!0;let u=e,d=e.segment+1,p=0;for(;p>-t/2;){if(d--,d<0)return!1;p-=i[d].dist(u),u=i[d]}p+=i[d].dist(i[d+1]),d++;const g=[];let y=0;for(;p<t/2;){const T=i[d],S=i[d+1];if(!S)return!1;let C=i[d-1].angleTo(T)-T.angleTo(S);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:p,angleDelta:C}),y+=C;p-g[0].distance>n;)y-=g.shift().angleDelta;if(y>a)return!1;d++,p+=T.dist(S)}return!0}function om(i){let e=0;for(let t=0;t<i.length-1;t++)e+=i[t].dist(i[t+1]);return e}function sm(i,e,t){return i?.6*e*t:0}function am(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function ug(i,e,t,n,a,u){const d=sm(t,a,u),p=am(t,n)*u;let g=0;const y=om(i)/2;for(let T=0;T<i.length-1;T++){const S=i[T],C=i[T+1],O=S.dist(C);if(g+O>y){const F=(y-g)/O,$=ui(S.x,C.x,F),Y=ui(S.y,C.y,F),ae=new Ha($,Y,0,C.angleTo(S),T);return!d||th(i,ae,p,d,e)?ae:void 0}g+=O}}function hg(i,e,t,n,a,u,d,p,g){const y=sm(n,u,d),T=am(n,a),S=T*d,C=i[0].x===0||i[0].x===g||i[0].y===0||i[0].y===g;return e-S<e/4&&(e=S+e/4),lm(i,C?e/2*p%e:(T/2+2*u)*d*p%e,e,y,t,S,C,!1,g)}function lm(i,e,t,n,a,u,d,p,g){const y=u/2,T=om(i);let S=0,C=e-t,O=[];for(let F=0;F<i.length-1;F++){const $=i[F],Y=i[F+1],ae=$.dist(Y),pe=Y.angleTo($);for(;C+t<S+ae;){C+=t;const le=(C-S)/ae,de=ui($.x,Y.x,le),we=ui($.y,Y.y,le);if(de>=0&&de<g&&we>=0&&we<g&&C-y>=0&&C+y<=T){const ge=new Ha(de,we,0,pe,F);ge._round(),n&&!th(i,ge,u,n,a)||O.push(ge)}}S+=ae}return p||O.length||d||(O=lm(i,S/2,t,n,a,u,d,!0,g)),O}function cm(i,e,t,n,a){const u=[];for(let d=0;d<i.length;d++){const p=i[d];let g;for(let y=0;y<p.length-1;y++){let T=p[y],S=p[y+1];T.x<e&&S.x<e||(T.x<e?T=new ce(e,T.y+(e-T.x)/(S.x-T.x)*(S.y-T.y))._round():S.x<e&&(S=new ce(e,T.y+(e-T.x)/(S.x-T.x)*(S.y-T.y))._round()),T.y<t&&S.y<t||(T.y<t?T=new ce(T.x+(t-T.y)/(S.y-T.y)*(S.x-T.x),t)._round():S.y<t&&(S=new ce(T.x+(t-T.y)/(S.y-T.y)*(S.x-T.x),t)._round()),T.x>=n&&S.x>=n||(T.x>=n?T=new ce(n,T.y+(n-T.x)/(S.x-T.x)*(S.y-T.y))._round():S.x>=n&&(S=new ce(n,T.y+(n-T.x)/(S.x-T.x)*(S.y-T.y))._round()),T.y>=a&&S.y>=a||(T.y>=a?T=new ce(T.x+(a-T.y)/(S.y-T.y)*(S.x-T.x),a)._round():S.y>=a&&(S=new ce(T.x+(a-T.y)/(S.y-T.y)*(S.x-T.x),a)._round()),g&&T.equals(g[g.length-1])||(g=[T],u.push(g)),g.push(S)))))}}return u}kt(Ha,"Anchor");const ih=1e20;function um(i,e,t,n,a,u,d,p,g){for(let y=e;y<e+n;y++)hm(i,t*u+y,u,a,d,p,g);for(let y=t;y<t+a;y++)hm(i,y*u+e,1,n,d,p,g)}function hm(i,e,t,n,a,u,d){u[0]=0,d[0]=-ih,d[1]=ih,a[0]=i[e];for(let p=1,g=0,y=0;p<n;p++){a[p]=i[e+p*t];const T=p*p;do{const S=u[g];y=(a[p]-a[S]+T-S*S)/(p-S)/2}while(y<=d[g]&&--g>-1);g++,u[g]=p,d[g]=y,d[g+1]=ih}for(let p=0,g=0;p<n;p++){for(;d[g+1]<p;)g++;const y=u[g],T=p-y;i[e+p*t]=a[y]+T*T}}const Sf={none:0,ideographs:1,all:2};class uu{constructor(e,t,n){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const n=[];for(const a in e)for(const u of e[a])n.push({stack:a,id:u});xt(n,({stack:a,id:u},d)=>{let p=this.entries[a];p||(p=this.entries[a]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let g=p.glyphs[u];if(g!==void 0)return void d(null,{stack:a,id:u,glyph:g});if(g=this._tinySDF(p,a,u),g)return p.glyphs[u]=g,void d(null,{stack:a,id:u,glyph:g});const y=Math.floor(u/256);if(256*y>65535)return void d(new Error("glyphs > 65535 not supported"));if(p.ranges[y])return void d(null,{stack:a,id:u,glyph:g});let T=p.requests[y];T||(T=p.requests[y]=[],uu.loadGlyphRange(a,y,this.url,this.requestManager,(S,C)=>{if(C){p.ascender=C.ascender,p.descender=C.descender;for(const O in C.glyphs)this._doesCharSupportLocalGlyph(+O)||(p.glyphs[+O]=C.glyphs[+O]);p.ranges[y]=!0}for(const O of T)O(S,C);delete p.requests[y]})),T.push((S,C)=>{S?d(S):C&&d(null,{stack:a,id:u,glyph:C.glyphs[u]||null})})},(a,u)=>{if(a)t(a);else if(u){const d={};for(const{stack:p,id:g,glyph:y}of u)d[p]===void 0&&(d[p]={}),d[p].glyphs===void 0&&(d[p].glyphs={}),d[p].glyphs[g]=y&&{id:y.id,bitmap:y.bitmap.clone(),metrics:y.metrics},d[p].ascender=this.entries[p].ascender,d[p].descender=this.entries[p].descender;t(null,d)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Sf.none&&(this.localGlyphMode===Sf.all?!!this.localFontFamily:!!this.localFontFamily&&(pc(e)||Dh(e)||Su(e)||pl(e)||Gc(e)))}_tinySDF(e,t,n){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(n))return;let u=e.tinySDF;if(!u){let $="400";/bold/i.test(t)?$="900":/medium/i.test(t)?$="500":/light/i.test(t)&&($="200"),u=e.tinySDF=new uu.TinySDF({fontFamily:a,fontWeight:$,fontSize:48,buffer:6,radius:16}),u.fontWeight=$}if(this.localGlyphs[u.fontWeight][n])return this.localGlyphs[u.fontWeight][n];const d=String.fromCharCode(n),{data:p,width:g,height:y,glyphWidth:T,glyphHeight:S,glyphLeft:C,glyphTop:O,glyphAdvance:F}=u.draw(d);return this.localGlyphs[u.fontWeight][n]={id:n,bitmap:new El({width:g,height:y},p),metrics:{width:T/2,height:S/2,left:C/2,top:O/2-27,advance:F/2,localGlyph:!0}}}}function dm(i,e,t,n){const a=[],u=i.image,d=u.pixelRatio,p=u.paddedRect.w-2,g=u.paddedRect.h-2,y=i.right-i.left,T=i.bottom-i.top,S=u.stretchX||[[0,p]],C=u.stretchY||[[0,g]],O=(Ge,et)=>Ge+et[1]-et[0],F=S.reduce(O,0),$=C.reduce(O,0),Y=p-F,ae=g-$;let pe=0,le=F,de=0,we=$,ge=0,Ne=Y,Fe=0,Ke=ae;if(u.content&&n){const Ge=u.content;pe=hu(S,0,Ge[0]),de=hu(C,0,Ge[1]),le=hu(S,Ge[0],Ge[2]),we=hu(C,Ge[1],Ge[3]),ge=Ge[0]-pe,Fe=Ge[1]-de,Ne=Ge[2]-Ge[0]-le,Ke=Ge[3]-Ge[1]-we}const mt=(Ge,et,st,tt)=>{const ft=du(Ge.stretch-pe,le,y,i.left),at=vd(Ge.fixed-ge,Ne,Ge.stretch,F),zt=du(et.stretch-de,we,T,i.top),hi=vd(et.fixed-Fe,Ke,et.stretch,$),vi=du(st.stretch-pe,le,y,i.left),Zt=vd(st.fixed-ge,Ne,st.stretch,F),Et=du(tt.stretch-de,we,T,i.top),Mi=vd(tt.fixed-Fe,Ke,tt.stretch,$),ni=new ce(ft,zt),Dt=new ce(vi,zt),lr=new ce(vi,Et),sr=new ce(ft,Et),wr=new ce(at/d,hi/d),wi=new ce(Zt/d,Mi/d),Ui=e*Math.PI/180;if(Ui){const tr=Math.sin(Ui),vr=Math.cos(Ui),Mr=[vr,-tr,tr,vr];ni._matMult(Mr),Dt._matMult(Mr),sr._matMult(Mr),lr._matMult(Mr)}const cr=Ge.stretch+Ge.fixed,ar=et.stretch+et.fixed;return{tl:ni,tr:Dt,bl:sr,br:lr,tex:{x:u.paddedRect.x+1+cr,y:u.paddedRect.y+1+ar,w:st.stretch+st.fixed-cr,h:tt.stretch+tt.fixed-ar},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wr,pixelOffsetBR:wi,minFontScaleX:Ne/d/y,minFontScaleY:Ke/d/T,isSDF:t}};if(n&&(u.stretchX||u.stretchY)){const Ge=fm(S,Y,F),et=fm(C,ae,$);for(let st=0;st<Ge.length-1;st++){const tt=Ge[st],ft=Ge[st+1];for(let at=0;at<et.length-1;at++)a.push(mt(tt,et[at],ft,et[at+1]))}}else a.push(mt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:p+1},{fixed:0,stretch:g+1}));return a}function hu(i,e,t){let n=0;for(const a of i)n+=Math.max(e,Math.min(t,a[1]))-Math.max(e,Math.min(t,a[0]));return n}function fm(i,e,t){const n=[{fixed:-1,stretch:0}];for(const[a,u]of i){const d=n[n.length-1];n.push({fixed:a-d.stretch,stretch:d.stretch}),n.push({fixed:a-d.stretch,stretch:d.stretch+(u-a)})}return n.push({fixed:e+1,stretch:t}),n}function du(i,e,t,n){return i/e*t+n}function vd(i,e,t,n){return i-e*t/n}function dg(i,e,t,n){const a=e+i.positionedLines[n].lineOffset;return n===0?t+a/2:t+(a+(e+i.positionedLines[n-1].lineOffset))/2}uu.loadGlyphRange=function(i,e,t,n,a){const u=256*e,d=u+255,p=n.transformRequest(n.normalizeGlyphsURL(t).replace("{fontstack}",i).replace("{range}",`${u}-${d}`),be.Glyphs);ke(p,(g,y)=>{if(g)a(g);else if(y){const T={},S=function(C){return new js(C).readFields(tm,{})}(y);for(const C of S.glyphs)T[C.id]=C;a(null,{glyphs:T,ascender:S.ascender,descender:S.descender})}})},uu.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:t=8,cutoff:n=.25,fontFamily:a="sans-serif",fontWeight:u="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=t;const p=this.size=i+4*e,g=this._createCanvas(p),y=this.ctx=g.getContext("2d",{willReadFrequently:!0});y.font=`${d} ${u} ${i}px ${a}`,y.textBaseline="alphabetic",y.textAlign="left",y.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:t,actualBoundingBoxDescent:n,actualBoundingBoxLeft:a,actualBoundingBoxRight:u}=this.ctx.measureText(i),d=Math.ceil(t),p=Math.min(this.size-this.buffer,Math.ceil(u-a)),g=Math.min(this.size-this.buffer,d+Math.ceil(n)),y=p+2*this.buffer,T=g+2*this.buffer,S=Math.max(y*T,0),C=new Uint8ClampedArray(S),O={data:C,width:y,height:T,glyphWidth:p,glyphHeight:g,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(p===0||g===0)return O;const{ctx:F,buffer:$,gridInner:Y,gridOuter:ae}=this;F.clearRect($,$,p,g),F.fillText(i,$,$+d);const pe=F.getImageData($,$,p,g);ae.fill(ih,0,S),Y.fill(0,0,S);for(let le=0;le<g;le++)for(let de=0;de<p;de++){const we=pe.data[4*(le*p+de)+3]/255;if(we===0)continue;const ge=(le+$)*y+de+$;if(we===1)ae[ge]=0,Y[ge]=ih;else{const Ne=.5-we;ae[ge]=Ne>0?Ne*Ne:0,Y[ge]=Ne<0?Ne*Ne:0}}um(ae,0,0,y,T,y,this.f,this.v,this.z),um(Y,$,$,p,g,y,this.f,this.v,this.z);for(let le=0;le<S;le++){const de=Math.sqrt(ae[le])-Math.sqrt(Y[le]);C[le]=Math.round(255-255*(de/this.radius+this.cutoff))}return O}};class fg{constructor(e=[],t=$n){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,a=t[e];for(;e>0;){const u=e-1>>1,d=t[u];if(n(a,d)>=0)break;t[e]=d,e=u}t[e]=a}_down(e){const{data:t,compare:n}=this,a=this.length>>1,u=t[e];for(;e<a;){let d=1+(e<<1),p=t[d];const g=d+1;if(g<this.length&&n(t[g],p)<0&&(d=g,p=t[g]),n(p,u)>=0)break;t[e]=p,e=d}t[e]=u}}function $n(i,e){return i<e?-1:i>e?1:0}function Go(i,e=1,t=!1){let n=1/0,a=1/0,u=-1/0,d=-1/0;const p=i[0];for(let O=0;O<p.length;O++){const F=p[O];(!O||F.x<n)&&(n=F.x),(!O||F.y<a)&&(a=F.y),(!O||F.x>u)&&(u=F.x),(!O||F.y>d)&&(d=F.y)}const g=Math.min(u-n,d-a);let y=g/2;const T=new fg([],pg);if(g===0)return new ce(n,a);for(let O=n;O<u;O+=g)for(let F=a;F<d;F+=g)T.push(new fu(O+y,F+y,y,i));let S=function(O){let F=0,$=0,Y=0;const ae=O[0];for(let pe=0,le=ae.length,de=le-1;pe<le;de=pe++){const we=ae[pe],ge=ae[de],Ne=we.x*ge.y-ge.x*we.y;$+=(we.x+ge.x)*Ne,Y+=(we.y+ge.y)*Ne,F+=3*Ne}return new fu($/F,Y/F,0,O)}(i),C=T.length;for(;T.length;){const O=T.pop();(O.d>S.d||!S.d)&&(S=O,t&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,C)),O.max-S.d<=e||(y=O.h/2,T.push(new fu(O.p.x-y,O.p.y-y,y,i)),T.push(new fu(O.p.x+y,O.p.y-y,y,i)),T.push(new fu(O.p.x-y,O.p.y+y,y,i)),T.push(new fu(O.p.x+y,O.p.y+y,y,i)),C+=4)}return t&&(console.log(`num probes: ${C}`),console.log(`best distance: ${S.d}`)),S.p}function pg(i,e){return e.max-i.max}function fu(i,e,t,n){this.p=new ce(i,e),this.h=t,this.d=function(a,u){let d=!1,p=1/0;for(let g=0;g<u.length;g++){const y=u[g];for(let T=0,S=y.length,C=S-1;T<S;C=T++){const O=y[T],F=y[C];O.y>a.y!=F.y>a.y&&a.x<(F.x-O.x)*(a.y-O.y)/(F.y-O.y)+O.x&&(d=!d),p=Math.min(p,Yn(a,O,F))}}return(d?1:-1)*Math.sqrt(p)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const If=Number.POSITIVE_INFINITY,pm=Math.sqrt(2);function mm(i,e){return e[1]!==If?function(t,n,a){let u=0,d=0;switch(n=Math.abs(n),a=Math.abs(a),t){case"top-right":case"top-left":case"top":d=a-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-a}switch(t){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}return[u,d]}(i,e[0],e[1]):function(t,n){let a=0,u=0;n<0&&(n=0);const d=n/pm;switch(t){case"top-right":case"top-left":u=d-7;break;case"bottom-right":case"bottom-left":u=7-d;break;case"bottom":u=7-n;break;case"top":u=n-7}switch(t){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=n;break;case"right":a=-n}return[a,u]}(i,e[0])}function mg(i,e,t,n,a,u,d,p,g,y){i.createArrays(),i.tilePixelRatio=Xt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const T=i.layers[0].layout,S=i.layers[0]._unevaluatedLayout._values,C={};if(i.textSizeData.kind==="composite"){const{minZoom:$,maxZoom:Y}=i.textSizeData;C.compositeTextSizes=[S["text-size"].possiblyEvaluate(new J($),p),S["text-size"].possiblyEvaluate(new J(Y),p)]}if(i.iconSizeData.kind==="composite"){const{minZoom:$,maxZoom:Y}=i.iconSizeData;C.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new J($),p),S["icon-size"].possiblyEvaluate(new J(Y),p)]}C.layoutTextSize=S["text-size"].possiblyEvaluate(new J(g+1),p),C.layoutIconSize=S["icon-size"].possiblyEvaluate(new J(g+1),p),C.textMaxSize=S["text-size"].possiblyEvaluate(new J(18),p);const O=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",F=T.get("text-size");for(const $ of i.features){const Y=T.get("text-font").evaluate($,{},p).join(","),ae=F.evaluate($,{},p),pe=C.layoutTextSize.evaluate($,{},p),le=(C.layoutIconSize.evaluate($,{},p),{horizontal:{},vertical:void 0}),de=$.text;let we,ge=[0,0];if(de){const Ke=de.toString(),mt=T.get("text-letter-spacing").evaluate($,{},p)*Gn,Ge=T.get("text-line-height").evaluate($,{},p)*Gn,et=Lu(Ke)?mt:0,st=T.get("text-anchor").evaluate($,{},p),tt=T.get("text-variable-anchor");if(!tt){const Zt=T.get("text-radial-offset").evaluate($,{},p);ge=Zt?mm(st,[Zt*Gn,If]):T.get("text-offset").evaluate($,{},p).map(Et=>Et*Gn)}let ft=O?"center":T.get("text-justify").evaluate($,{},p);const at=T.get("symbol-placement"),zt=at==="point",hi=at==="point"?T.get("text-max-width").evaluate($,{},p)*Gn:0,vi=Zt=>{i.allowVerticalPlacement&&Zc(Ke)&&(le.vertical=Tf(de,e,t,a,Y,hi,Ge,st,Zt,et,ge,Ir.vertical,!0,at,pe,ae))};if(!O&&tt){const Zt=ft==="auto"?tt.map(Mi=>Mf(Mi)):[ft];let Et=!1;for(let Mi=0;Mi<Zt.length;Mi++){const ni=Zt[Mi];if(!le.horizontal[ni])if(Et)le.horizontal[ni]=le.horizontal[0];else{const Dt=Tf(de,e,t,a,Y,hi,Ge,"center",ni,et,ge,Ir.horizontal,!1,at,pe,ae);Dt&&(le.horizontal[ni]=Dt,Et=Dt.positionedLines.length===1)}}vi("left")}else{if(ft==="auto"&&(ft=Mf(st)),zt||T.get("text-writing-mode").indexOf("horizontal")>=0||!Zc(Ke)){const Zt=Tf(de,e,t,a,Y,hi,Ge,st,ft,et,ge,Ir.horizontal,!1,at,pe,ae);Zt&&(le.horizontal[ft]=Zt)}vi(at==="point"?"left":ft)}}let Ne=!1;if($.icon&&$.icon.name){const Ke=n[$.icon.name];Ke&&(we=or(a[$.icon.name],T.get("icon-offset").evaluate($,{},p),T.get("icon-anchor").evaluate($,{},p)),Ne=Ke.sdf,i.sdfIcons===void 0?i.sdfIcons=Ke.sdf:i.sdfIcons!==Ke.sdf&&_r("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ke.pixelRatio!==i.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Fe=ym(le.horizontal)||le.vertical;i.iconsInText||(i.iconsInText=!!Fe&&Fe.iconsInText),(Fe||we)&&_m(i,$,le,we,n,C,pe,0,ge,Ne,d,p,y)}u&&i.generateCollisionDebugBuffers(g,i.collisionBoxArray)}function Mf(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function _m(i,e,t,n,a,u,d,p,g,y,T,S,C){let O=u.textMaxSize.evaluate(e,{},S);O===void 0&&(O=d);const F=i.layers[0].layout,$=F.get("icon-offset").evaluate(e,{},S),Y=ym(t.horizontal)||t.vertical,ae=C.name==="globe",pe=d/24,le=i.tilePixelRatio*O/24,de=(et=i.overscaling,i.zoom>18&&et>2&&(et>>=1),Math.max(Xt/(512*et),1)*F.get("symbol-spacing")),we=F.get("text-padding")*i.tilePixelRatio,ge=F.get("icon-padding")*i.tilePixelRatio,Ne=it(F.get("text-max-angle")),Fe=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Ke=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",mt=F.get("symbol-placement"),Ge=de/2;var et;const st=F.get("icon-text-fit");let tt;n&&st!=="none"&&(i.allowVerticalPlacement&&t.vertical&&(tt=nm(n,t.vertical,st,F.get("icon-text-fit-padding"),$,pe)),Y&&(n=nm(n,Y,st,F.get("icon-text-fit-padding"),$,pe)));const ft=(at,zt,hi)=>{if(zt.x<0||zt.x>=Xt||zt.y<0||zt.y>=Xt)return;let vi=null;if(ae){const{x:Zt,y:Et,z:Mi}=C.projectTilePoint(zt.x,zt.y,hi);vi={anchor:new Ha(Zt,Et,Mi,0,void 0),up:C.upVector(hi,zt.x,zt.y)}}(function(Zt,Et,Mi,ni,Dt,lr,sr,wr,wi,Ui,cr,ar,tr,vr,Mr,Qn,ds,Oi,qr,Eo,Wi,Cr,qo,Tr,on){const eo=Zt.addToLineVertexArray(Et,ni);let qn,po,Zo,to,kc,kd,$f,qf=0,sv=0,av=0,lv=0,Ug=-1,Ng=-1;const oc={};let cv=yc("");const hh=Mi?Mi.anchor:Et;let jg=0,Vg=0;if(wi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[jg,Vg]=wi.layout.get("text-offset").evaluate(Wi,{},on).map(Gs=>Gs*Gn):(jg=wi.layout.get("text-radial-offset").evaluate(Wi,{},on)*Gn,Vg=If),Zt.allowVerticalPlacement&&Dt.vertical){const Gs=Dt.vertical;if(Mr)kd=xd(Gs),wr&&($f=xd(wr));else{const $s=wi.layout.get("text-rotate").evaluate(Wi,{},on)+90;Zo=rh(Ui,hh,Et,cr,ar,tr,Gs,vr,$s,Qn),wr&&(to=rh(Ui,hh,Et,cr,ar,tr,wr,Oi,$s))}}if(lr){const Gs=wi.layout.get("icon-rotate").evaluate(Wi,{},on),$s=wi.layout.get("icon-text-fit")!=="none",Zf=dm(lr,Gs,qo,$s),$g=wr?dm(wr,Gs,qo,$s):void 0;po=rh(Ui,hh,Et,cr,ar,tr,lr,Oi,Gs),qf=4*Zf.length;const uv=Zt.iconSizeData;let dh=null;uv.kind==="source"?(dh=[Wa*wi.layout.get("icon-size").evaluate(Wi,{},on)],dh[0]>tc&&_r(`${Zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):uv.kind==="composite"&&(dh=[Wa*Cr.compositeIconSizes[0].evaluate(Wi,{},on),Wa*Cr.compositeIconSizes[1].evaluate(Wi,{},on)],(dh[0]>tc||dh[1]>tc)&&_r(`${Zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Zt.addSymbols(Zt.icon,Zf,dh,Eo,qr,Wi,!1,Mi,Et,eo.lineStartIndex,eo.lineLength,-1,Tr,on),Ug=Zt.icon.placedSymbolArray.length-1,$g&&(sv=4*$g.length,Zt.addSymbols(Zt.icon,$g,dh,Eo,qr,Wi,Ir.vertical,Mi,Et,eo.lineStartIndex,eo.lineLength,-1,Tr,on),Ng=Zt.icon.placedSymbolArray.length-1)}for(const Gs in Dt.horizontal){const $s=Dt.horizontal[Gs];qn||(cv=yc($s.text),Mr?kc=xd($s):qn=rh(Ui,hh,Et,cr,ar,tr,$s,vr,wi.layout.get("text-rotate").evaluate(Wi,{},on),Qn));const Zf=$s.positionedLines.length===1;if(av+=gm(Zt,Mi,Et,$s,sr,wi,Mr,Wi,Qn,eo,Dt.vertical?Ir.horizontal:Ir.horizontalOnly,Zf?Object.keys(Dt.horizontal):[Gs],oc,Ug,Cr,Tr,on),Zf)break}Dt.vertical&&(lv+=gm(Zt,Mi,Et,Dt.vertical,sr,wi,Mr,Wi,Qn,eo,Ir.vertical,["vertical"],oc,Ng,Cr,Tr,on));let vu=-1;const Gg=(Gs,$s)=>Gs?Math.max(Gs,$s):$s;vu=Gg(kc,vu),vu=Gg(kd,vu),vu=Gg($f,vu);const g0=vu>-1?1:0;Zt.glyphOffsetArray.length>=Ja.MAX_GLYPHS&&_r("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Wi.sortKey!==void 0&&Zt.addToSortKeyRanges(Zt.symbolInstances.length,Wi.sortKey),Zt.symbolInstances.emplaceBack(hh.x,hh.y,hh.z,Et.x,Et.y,oc.right>=0?oc.right:-1,oc.center>=0?oc.center:-1,oc.left>=0?oc.left:-1,oc.vertical>=0?oc.vertical:-1,Ug,Ng,cv,qn!==void 0?qn:Zt.collisionBoxArray.length,qn!==void 0?qn+1:Zt.collisionBoxArray.length,Zo!==void 0?Zo:Zt.collisionBoxArray.length,Zo!==void 0?Zo+1:Zt.collisionBoxArray.length,po!==void 0?po:Zt.collisionBoxArray.length,po!==void 0?po+1:Zt.collisionBoxArray.length,to||Zt.collisionBoxArray.length,to?to+1:Zt.collisionBoxArray.length,cr,av,lv,qf,sv,g0,0,jg,Vg,vu)})(i,zt,vi,at,t,n,a,tt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,we,Fe,g,0,ge,Ke,$,e,u,y,T,S)};if(mt==="line")for(const at of cm(e.geometry,0,0,Xt,Xt)){const zt=hg(at,de,Ne,t.vertical||Y,n,24,le,i.overscaling,Xt);for(const hi of zt){const vi=Y;vi&&_g(i,vi.text,Ge,hi)||ft(at,hi,S)}}else if(mt==="line-center"){for(const at of e.geometry)if(at.length>1){const zt=ug(at,Ne,t.vertical||Y,n,24,le);zt&&ft(at,zt,S)}}else if(e.type==="Polygon")for(const at of ld(e.geometry,0)){const zt=Go(at,16);ft(at[0],new Ha(zt.x,zt.y,0,0,void 0),S)}else if(e.type==="LineString")for(const at of e.geometry)ft(at,new Ha(at[0].x,at[0].y,0,0,void 0),S);else if(e.type==="Point")for(const at of e.geometry)for(const zt of at)ft([zt],new Ha(zt.x,zt.y,0,0,void 0),S)}const tc=32640;function gm(i,e,t,n,a,u,d,p,g,y,T,S,C,O,F,$,Y){const ae=function(de,we,ge,Ne,Fe,Ke,mt,Ge){const et=[];if(we.positionedLines.length===0)return et;const st=Ne.layout.get("text-rotate").evaluate(Ke,{})*Math.PI/180,tt=function(vi){const Zt=vi[0],Et=vi[1],Mi=Zt*Et;return Mi>0?[Zt,-Et]:Mi<0?[-Zt,Et]:Zt===0?[Et,Zt]:[Et,-Zt]}(ge);let ft=Math.abs(we.top-we.bottom);for(const vi of we.positionedLines)ft-=vi.lineOffset;const at=we.positionedLines.length,zt=ft/at;let hi=we.top-ge[1];for(let vi=0;vi<at;++vi){const Zt=we.positionedLines[vi];hi=dg(we,zt,hi,vi);for(const Et of Zt.positionedGlyphs){if(!Et.rect)continue;const Mi=Et.rect||{};let ni=4,Dt=!0,lr=1,sr=0;if(Et.imageName){const Tr=mt[Et.imageName];if(!Tr)continue;if(Tr.sdf){_r("SDF images are not supported in formatted text and will be ignored.");continue}Dt=!1,lr=Tr.pixelRatio,ni=1/lr}const wr=(Fe||Ge)&&Et.vertical,wi=Et.metrics.advance*Et.scale/2,Ui=Et.metrics,cr=Et.rect;if(cr===null)continue;Ge&&we.verticalizable&&(sr=Et.imageName?wi-Et.metrics.width*Et.scale/2:0);const ar=Fe?[Et.x+wi,Et.y]:[0,0];let tr=[0,0],vr=[0,0],Mr=!1;Fe||(wr?(vr=[Et.x+wi+tt[0],Et.y+tt[1]-sr],Mr=!0):tr=[Et.x+wi+ge[0],Et.y+ge[1]-sr]);const Qn=cr.w*Et.scale/(lr*(Et.localGlyph?2:1)),ds=cr.h*Et.scale/(lr*(Et.localGlyph?2:1));let Oi,qr,Eo,Wi;if(wr){const Tr=Et.y-hi,on=new ce(-wi,wi-Tr),eo=-Math.PI/2,qn=new ce(...vr);Oi=new ce(-wi+tr[0],tr[1]),Oi._rotateAround(eo,on)._add(qn),Oi.x+=-Tr+wi,Oi.y-=(Ui.left-ni)*Et.scale;const po=Et.imageName?Ui.advance*Et.scale:Gn*Et.scale,Zo=String.fromCharCode(Et.glyph);og(Zo)?Oi.x+=(1-ni)*Et.scale:jo(Zo)?Oi.x+=po-Ui.height*Et.scale+(-ni-1)*Et.scale:Oi.x+=Et.imageName||Ui.width+2*ni===cr.w&&Ui.height+2*ni===cr.h?(po-ds)/2:(po-(Ui.height+2*ni)*Et.scale)/2,qr=new ce(Oi.x,Oi.y-Qn),Eo=new ce(Oi.x+ds,Oi.y),Wi=new ce(Oi.x+ds,Oi.y-Qn)}else{const Tr=(Ui.left-ni)*Et.scale-wi+tr[0],on=(-Ui.top-ni)*Et.scale+tr[1],eo=Tr+Qn,qn=on+ds;Oi=new ce(Tr,on),qr=new ce(eo,on),Eo=new ce(Tr,qn),Wi=new ce(eo,qn)}if(st){let Tr;Tr=Fe?new ce(0,0):Mr?new ce(tt[0],tt[1]):new ce(ge[0],ge[1]),Oi._rotateAround(st,Tr),qr._rotateAround(st,Tr),Eo._rotateAround(st,Tr),Wi._rotateAround(st,Tr)}const Cr=new ce(0,0),qo=new ce(0,0);et.push({tl:Oi,tr:qr,bl:Eo,br:Wi,tex:Mi,writingMode:we.writingMode,glyphOffset:ar,sectionIndex:Et.sectionIndex,isSDF:Dt,pixelOffsetTL:Cr,pixelOffsetBR:qo,minFontScaleX:0,minFontScaleY:0})}}return et}(0,n,g,u,d,p,a,i.allowVerticalPlacement),pe=i.textSizeData;let le=null;pe.kind==="source"?(le=[Wa*u.layout.get("text-size").evaluate(p,{},Y)],le[0]>tc&&_r(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):pe.kind==="composite"&&(le=[Wa*F.compositeTextSizes[0].evaluate(p,{},Y),Wa*F.compositeTextSizes[1].evaluate(p,{},Y)],(le[0]>tc||le[1]>tc)&&_r(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,ae,le,g,d,p,T,e,t,y.lineStartIndex,y.lineLength,O,$,Y);for(const de of S)C[de]=i.text.placedSymbolArray.length-1;return 4*ae.length}function ym(i){for(const e in i)return i[e];return null}function rh(i,e,t,n,a,u,d,p,g,y){let T=d.top,S=d.bottom,C=d.left,O=d.right;const F=d.collisionPadding;if(F&&(C-=F[0],T-=F[1],O+=F[2],S+=F[3]),g){const $=new ce(C,T),Y=new ce(O,T),ae=new ce(C,S),pe=new ce(O,S),le=it(g);let de=new ce(0,0);y&&(de=new ce(y[0],y[1])),$._rotateAround(le,de),Y._rotateAround(le,de),ae._rotateAround(le,de),pe._rotateAround(le,de),C=Math.min($.x,Y.x,ae.x,pe.x),O=Math.max($.x,Y.x,ae.x,pe.x),T=Math.min($.y,Y.y,ae.y,pe.y),S=Math.max($.y,Y.y,ae.y,pe.y)}return i.emplaceBack(e.x,e.y,e.z,t.x,t.y,C,T,O,S,p,n,a,u),i.length-1}function xd(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function _g(i,e,t,n){const a=i.compareText;if(e in a){const u=a[e];for(let d=u.length-1;d>=0;d--)if(n.dist(u[d])<t)return!0}else a[e]=[];return a[e].push(n),!1}const gg=Qe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:vm}=gg,xm=Qe([{name:"a_pos_3",components:3,type:"Int16"}]);var Ka=Qe([{name:"a_pos",type:"Int16",components:2}]);const Ml=Xt/Math.PI/2,Cf=2*us(1,0)*Ml*Math.PI,pu=[64,32,16],xa=-Ml,ba=Ml,bm=[new xo([xa,xa,xa],[ba,ba,ba]),new xo([xa,xa,xa],[0,0,ba]),new xo([0,xa,xa],[ba,0,ba]),new xo([xa,0,xa],[0,ba,ba]),new xo([0,0,xa],[ba,ba,ba])];function Pf(i,e,t,n=!0){const a=Us([],i._camera.position,i.worldSize),u=[e,t,1,1];Sc(u,u,i.pixelMatrixInverse),bp(u,u,1/u[3]);const d=tn([],va([],u,a)),p=i.globeMatrix,g=[p[12],p[13],p[14]],y=va([],g,a),T=Ec(y),S=tn([],y),C=i.worldSize/(2*Math.PI),O=Ns(S,d),F=Math.asin(C/T);if(F<Math.acos(O)){if(!n)return null;const mt=[],Ge=[];Us(mt,d,T/O),tn(Ge,va(Ge,mt,y)),tn(d,Fs(d,y,Us(d,Ge,Math.tan(F)*T)))}const $=[];new ed(a,d).closestPointOnSphere(g,C,$);const Y=tn([],zr(p,0)),ae=tn([],zr(p,1)),pe=tn([],zr(p,2)),le=Ns(Y,$),de=Ns(ae,$),we=Ns(pe,$),ge=Ze(Math.asin(-de/C));let Ne=Ze(Math.atan2(le,we));Ne=i.center.lng+function(mt,Ge){const et=(Ge-mt+180)%360-180;return et<-180?et+360:et}(i.center.lng,Ne);const Fe=cs(Ne),Ke=Ye(xl(ge),0,1);return new Ro(Fe,Ke)}class yg{constructor(e,t,n){this.a=va([],e,n),this.b=va([],t,n),this.center=n;const a=tn([],this.a),u=tn([],this.b);this.angle=Math.acos(Ns(a,u))}}function zf(i,e){if(i.angle===0)return null;let t;return t=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),t<0||t>1?null:function(n,a,u,d){const p=Math.sin(u);return n*(Math.sin((1-d)*u)/p)+a*(Math.sin(d*u)/p)}(i.a[e],i.b[e],i.angle,Ye(t,0,1))+i.center[e]}function Ya(i){if(i.z<=1)return bm[i.z+2*i.y+i.x];const e=kf(bd(i));return xo.fromPoints(e)}function wm(i,e){const t=sh(e.zoom);if(t===0)return Ya(i);const n=bd(i),a=kf(n),u=cs(n.getWest())*e.worldSize,d=cs(n.getEast())*e.worldSize,p=xl(n.getNorth())*e.worldSize,g=xl(n.getSouth())*e.worldSize,y=[u,p,0],T=[d,p,0],S=[u,g,0],C=[d,g,0],O=rf([],e.globeMatrix);return dn(y,y,O),dn(T,T,O),dn(S,S,O),dn(C,C,O),a[0]=Ss(a[0],S,t),a[1]=Ss(a[1],C,t),a[2]=Ss(a[2],T,t),a[3]=Ss(a[3],y,t),xo.fromPoints(a)}function Tm(i,e,t,n,a){for(const u of t)dn(u,u,n),Us(u,u,a),Jh(i,i,u),iu(e,e,u)}function vg(i,e,t){const n=e/i.worldSize,a=Number.MAX_VALUE,u=[-a,-a,-a],d=[a,a,a],p=i.globeMatrix;if(t.z<=1)return Tm(d,u,Ya(t).getCorners(),p,n),new xo(d,u);const g=bd(t),y=kf(g);if(Tm(d,u,y,p,n),g.contains(i.center)){u[2]=0;const Ne=i.point,Fe=[Ne.x*n,Ne.y*n,0];return Jh(d,d,Fe),iu(u,u,Fe),new xo(d,u)}const T=[p[12]*n,p[13]*n,p[14]*n],S=g.getCenter(),C=Ye(i.center.lat,-85.051129,$a),O=Ye(S.lat,-85.051129,$a),F=cs(i.center.lng),$=xl(C);let Y=F-cs(S.lng);const ae=$-xl(O);Y>.5?Y-=1:Y<-.5&&(Y+=1);let pe=0;Math.abs(Y)>Math.abs(ae)?pe=Y>=0?1:3:(pe=ae>=0?0:2,hs(T,T,[p[4]*n,p[5]*n,p[6]*n],-Math.sin(it(ae>=0?g.getSouth():g.getNorth()))*Ml));const le=y[pe],de=y[(pe+1)%4],we=new yg(le,de,T),ge=[zf(we,0)||le[0],zf(we,1)||le[1],zf(we,2)||le[2]];return d[2]=Math.min(le[2],de[2]),Jh(d,d,ge),iu(u,u,ge),new xo(d,u)}function bd({x:i,y:e,z:t}){const n=1/(1<<t),a=new $i(yo(i*n),kn((e+1)*n)),u=new $i(yo((i+1)*n),kn(e*n));return new vl(a,u)}function kf(i){const e=it(i.getNorth()),t=it(i.getSouth()),n=Math.cos(e),a=Math.cos(t),u=Math.sin(e),d=Math.sin(t),p=i.getWest(),g=i.getEast();return[mu(a,d,p),mu(a,d,g),mu(n,u,g),mu(n,u,p)]}function mu(i,e,t,n=Ml){return t=it(t),[i*Math.sin(t)*n,-e*n,i*Math.cos(t)*n]}function wd(i,e,t){return mu(Math.cos(it(i)),Math.sin(it(i)),e,t)}function nh(i,e,t,n){const a=1<<t.z,u=(i/Xt+t.x)/a;return wd(kn((e/Xt+t.y)/a),yo(u),n)}function Td({min:i,max:e}){return 16383/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}const Em=new Float64Array(16);function oh(i){const e=Td(i),t=_p(Em,[e,e,e]);return tu(t,t,((n=[])[0]=-(a=i.min)[0],n[1]=-a[1],n[2]=-a[2],n));var n,a}function Df(i){const e=(n=i.min,(t=Em)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t);var t,n;const a=1/Td(i);return Jl(e,e,[a,a,a])}function Am(i,e,t,n,a){const u=function(g){const y=Xt/(2*Math.PI);return g/(2*Math.PI)/y}(t),d=[i,e,-t/(2*Math.PI)],p=qa(new Float64Array(16));return tu(p,p,d),Jl(p,p,[u,u,u]),nf(p,p,it(-a)),Kh(p,p,it(-n)),p}function sh(i){return ci(5,6,i)}function Sm(i,e){const t=wd(e.lat,e.lng);return u=(n=ju([],function(O){const F=wd(O._center.lat,O._center.lng);let $=Qh([],Ac(0,1,0),F);const Y=gp([],-O.angle,F);$=dn($,$,Y),gp(Y,-O._pitch,$);const ae=tn([],F);return Us(ae,ae,O.cameraToCenterDistance/O.pixelsPerMeter*Cf),dn(ae,ae,Y),Fs([],F,ae)}(i),t))[0],d=n[1],p=n[2],g=(a=t)[0],y=a[1],T=a[2],C=(S=Math.sqrt(u*u+d*d+p*p)*Math.sqrt(g*g+y*y+T*T))&&Ns(n,a)/S,Math.acos(Math.min(Math.max(C,-1),1));var n,a,u,d,p,g,y,T,S,C}const Im=it(85),xg=Math.cos(Im),bg=Math.sin(Im);function Mm(i,e){const t=i.fovAboveCenter,n=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,a=(i._camera.position[2]*i.worldSize-n)/Math.cos(i._pitch),u=Math.sin(t)*a/Math.sin(Math.max(Math.PI/2-i._pitch-t,.01)),d=Math.sin(i._pitch)*u+a;return Math.min(1.01*d,a*(1/i._horizonShift))}function zc(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const t=Math.pow(2,-i.z),n=i.x*t,a=(i.x+1)*t,u=i.y*t,d=(i.y+1)*t,p=yo(n),g=yo(a),y=kn(u),T=kn(d),S=e.project(p,y),C=e.project(g,y),O=e.project(g,T),F=e.project(p,T);let $=Math.min(S.x,C.x,O.x,F.x),Y=Math.min(S.y,C.y,O.y,F.y),ae=Math.max(S.x,C.x,O.x,F.x),pe=Math.max(S.y,C.y,O.y,F.y);const le=t/16;function de(ge,Ne,Fe,Ke,mt,Ge){const et=(Fe+mt)/2,st=(Ke+Ge)/2,tt=e.project(yo(et),kn(st)),ft=Math.max(0,$-tt.x,Y-tt.y,tt.x-ae,tt.y-pe);$=Math.min($,tt.x),ae=Math.max(ae,tt.x),Y=Math.min(Y,tt.y),pe=Math.max(pe,tt.y),ft>le&&(de(ge,tt,Fe,Ke,et,st),de(tt,Ne,et,st,mt,Ge))}de(S,C,n,u,a,u),de(C,O,a,u,a,d),de(O,F,a,d,n,d),de(F,S,n,d,n,u),$-=le,Y-=le,ae+=le,pe+=le;const we=1/Math.max(ae-$,pe-Y);return{scale:we,x:$*we,y:Y*we,x2:ae*we,y2:pe*we,projection:e}}const wg=qa(new Float32Array(16));class ic{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new $i(0,0)}projectTilePoint(e,t,n){return{x:e,y:t,z:0}}locationPoint(e,t,n=!0){return e._coordinatePoint(e.locationCoordinate(t),n)}pixelsPerMeter(e,t){return us(1,e)*t}pixelSpaceConversion(e,t,n){return 1}farthestPixelDistance(e){return Mm(e,e.pixelsPerMeter)}pointCoordinate(e,t,n,a){const u=e.horizonLineFromTop(!1),d=new ce(t,Math.max(u,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,a))}pointCoordinate3D(e,t,n){const a=new ce(t,n);if(e.elevation)return e.elevation.pointCoordinate(a);{const u=this.pointCoordinate(e,a.x,a.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const n=e.horizonLineFromTop();return t.y<n}createInversionMatrix(e,t){return wg}createTileMatrix(e,t,n){let a,u,d;const p=n.canonical,g=qa(new Float64Array(16));if(this.isReprojectedInTileSpace){const y=zc(p,this);a=1,u=y.x+n.wrap*y.scale,d=y.y,Jl(g,g,[a/y.scale,a/y.scale,e.pixelsPerMeter/t])}else a=t/e.zoomScale(p.z),u=(p.x+Math.pow(2,p.z)*n.wrap)*a,d=p.y*a;return tu(g,g,[u,d,0]),Jl(g,g,[a/Xt,a/Xt,1]),g}upVector(e,t,n){return[0,0,1]}upVectorScale(e,t,n){return{metersToTile:1}}}class Lf extends ic{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,n]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(it(t));this.n=(a+Math.sin(it(n)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n,c:a,r0:u}=this,d=it(e-this.center[0]),p=it(t),g=Math.sqrt(a-2*n*Math.sin(p))/n;return{x:g*Math.sin(d*n),y:g*Math.cos(d*n)-u,z:0}}unproject(e,t){const{n,c:a,r0:u}=this,d=u+t;let p=Math.atan2(e,Math.abs(d))*Math.sign(d);d*n<0&&(p-=Math.PI*Math.sign(e)*Math.sign(d));const g=it(this.center[0])*n;p=Pi(p,-Math.PI-g,Math.PI-g);const y=Ze(p/n)+this.center[0],T=Math.asin(Ye((a-(e*e+d*d)*n*n)/(2*n),-1,1)),S=Ye(Ze(T),-85.051129,$a);return new $i(y,S)}}const _u=1.340264,gu=-.081106,ah=893e-6,lh=.003796,Ed=Math.sqrt(3)/2;class Of extends ic{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(Ed*Math.sin(t)),a=n*n,u=a*a*a;return{x:.5*(e*Math.cos(n)/(Ed*(_u+3*gu*a+u*(7*ah+9*lh*a)))/Math.PI+.5),y:1-.5*(n*(_u+gu*a+u*(ah+lh*a))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,a=n*n,u=a*a*a;for(let T,S,C,O=0;O<12&&(S=n*(_u+gu*a+u*(ah+lh*a))-t,C=_u+3*gu*a+u*(7*ah+9*lh*a),T=S/C,n=Ye(n-T,-Math.PI/3,Math.PI/3),a=n*n,u=a*a*a,!(Math.abs(T)<1e-12));++O);const d=Ed*e*(_u+3*gu*a+u*(7*ah+9*lh*a))/Math.cos(n),p=Math.asin(Math.sin(n)/Ed),g=Ye(180*d/Math.PI,-180,180),y=Ye(180*p/Math.PI,-85.051129,$a);return new $i(g,y)}}class Tg extends ic{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const n=360*(e-.5),a=Ye(360*(.5-t),-85.051129,$a);return new $i(n,a)}}const yu=Math.PI/2;function Ad(i){return Math.tan((yu+i)/2)}class $o extends ic{constructor(e){super(e),this.center=e.center||[0,30];const[t,n]=this.parallels=e.parallels||[30,30],a=it(t),u=it(n),d=Math.cos(a);this.n=a===u?Math.sin(a):Math.log(d/Math.cos(u))/Math.log(Ad(u)/Ad(a)),this.f=d*Math.pow(Ad(a),this.n)/this.n}project(e,t){t=it(t),e=it(e-this.center[0]);const n=1e-6,{n:a,f:u}=this;u>0?t<-yu+n&&(t=-yu+n):t>yu-n&&(t=yu-n);const d=u/Math.pow(Ad(t),a),p=d*Math.sin(a*e),g=u-d*Math.cos(a*e);return{x:.5*(p/Math.PI+.5),y:1-.5*(g/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n,f:a}=this,u=a-t,d=Math.sign(u),p=Math.sign(n)*Math.sqrt(e*e+u*u);let g=Math.atan2(e,Math.abs(u))*d;u*n<0&&(g-=Math.PI*Math.sign(e)*d);const y=Ye(Ze(g/n)+this.center[0],-180,180),T=Ye(Ze(2*Math.atan(Math.pow(a/p,1/n))-yu),-85.051129,$a);return new $i(y,T)}}class Sd extends ic{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:cs(e),y:xl(t),z:0}}unproject(e,t){const n=yo(e),a=kn(t);return new $i(n,a)}}const Cm=it($a);class Eg extends ic{project(e,t){const n=(t=it(t))*t,a=n*n;return{x:.5*((e=it(e))*(.8707-.131979*n+a*(a*(.003971*n-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+a*(.028874*n-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,a=25,u=0,d=n*n;do{d=n*n;const y=d*d;u=(n*(1.007226+d*(.015085+y*(.028874*d-.044475-.005916*y)))-t)/(1.007226+d*(.045255+y*(.259866*d-.311325-.005916*11*y))),n=Ye(n-u,-Cm,Cm)}while(Math.abs(u)>1e-6&&--a>0);d=n*n;const p=Ye(Ze(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),g=Ze(n);return new $i(p,g)}}const Pm=it($a);class Ag extends ic{project(e,t){t=it(t),e=it(e);const n=Math.cos(t),a=2/Math.PI,u=Math.acos(n*Math.cos(e/2)),d=Math.sin(u)/u,p=.5*(e*a+2*n*Math.sin(e/2)/d)||0,g=.5*(t+Math.sin(t)/d)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(g/Math.PI+1),z:0}}unproject(e,t){let n=e=(2*e-.5)*Math.PI,a=t=(2*(1-t)-1)*Math.PI,u=25;const d=1e-6;let p=0,g=0;do{const y=Math.cos(a),T=Math.sin(a),S=2*T*y,C=T*T,O=y*y,F=Math.cos(n/2),$=Math.sin(n/2),Y=2*F*$,ae=$*$,pe=1-O*F*F,le=pe?1/pe:0,de=pe?Math.acos(y*F)*Math.sqrt(1/pe):0,we=.5*(2*de*y*$+2*n/Math.PI)-e,ge=.5*(de*T+a)-t,Ne=.5*le*(O*ae+de*y*F*C)+1/Math.PI,Fe=le*(Y*S/4-de*T*$),Ke=.125*le*(S*$-de*T*O*Y),mt=.5*le*(C*F+de*ae*y)+.5,Ge=Fe*Ke-mt*Ne;p=(ge*Fe-we*mt)/Ge,g=(we*Ke-ge*Ne)/Ge,n=Ye(n-p,-Math.PI,Math.PI),a=Ye(a-g,-Pm,Pm)}while((Math.abs(p)>d||Math.abs(g)>d)&&--u>0);return new $i(Ze(n),Ze(a))}}class Id extends ic{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(it(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:n,cosPhi:a}=this;return{x:it(e)*a*n+.5,y:-Math.sin(it(t))/a*n+.5,z:0}}unproject(e,t){const{scale:n,cosPhi:a}=this,u=-(t-.5)/n,d=Ye(Ze((e-.5)/n)/a,-180,180),p=Math.asin(Ye(u*a,-1,1)),g=Ye(Ze(p),-85.051129,$a);return new $i(d,g)}}class Sg extends Sd{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,n){const a=nh(e,t,n);return dn(a,a,oh(Ya(n))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,t){const n=wd(t.lat,t.lng),a=tn([],n),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;hs(n,n,a,us(1,0)*Xt*u);const d=qa(new Float64Array(16));return Za(d,e.pixelMatrix,e.globeMatrix),dn(n,n,d),new ce(n[0],n[1])}pixelsPerMeter(e,t){return us(1,0)*t}pixelSpaceConversion(e,t,n){const a=ui(us(1,45)*t,us(1,e)*t,n);return this.pixelsPerMeter(e,t)/a}createTileMatrix(e,t,n){const a=Df(Ya(n.canonical));return Za(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,t){const{center:n}=e,a=oh(Ya(t));return Kh(a,a,it(n.lng)),nf(a,a,it(n.lat)),Jl(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,t,n,a){return Pf(e,t,n,!0)||new Ro(0,0)}pointCoordinate3D(e,t,n){const a=this.pointCoordinate(e,t,n,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,t){return!Pf(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(a,u){const d=a.cameraToCenterDistance,p=a._centerAltitude*u,g=a._camera,y=a._camera.forward(),T=Fs([],Us([],y,-d),[0,0,p]),S=a.worldSize/(2*Math.PI),C=[0,0,-S],O=a.width/a.height,F=Math.tan(a.fovAboveCenter),$=Us([],g.up(),F),Y=Us([],g.right(),F*O),ae=tn([],Fs([],Fs([],y,$),Y)),pe=[];let le;if(new ed(T,ae).closestPointOnSphere(C,S,pe)){const de=Fs([],pe,C),we=va([],de,T);le=Math.cos(a.fovAboveCenter)*Ec(we)}else{const de=va([],T,C),we=va([],C,T);tn(we,we);const ge=Ec(de)-S;le=Math.sqrt(ge*(ge+2*S));const Ne=Math.acos(le/(S+ge))-Math.acos(Ns(y,we));le*=Math.cos(Ne)}return 1.01*le}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=sh(e.zoom);if(n>0){const a=Mm(e,us(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ui(t,a+u*(1-Math.cos(d)),Math.pow(n,10))}return t}upVector(e,t,n){return nh(t,n,e,1)}upVectorScale(e){return{metersToTile:Cf*Td(Ya(e))}}}function Md(i){const e=i.parallels,t=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new Sd(i);case"equirectangular":return new Tg(i);case"naturalEarth":return new Eg(i);case"equalEarth":return new Of(i);case"winkelTripel":return new Ag(i);case"albers":return t?new Id(i):new Lf(i);case"lambertConformalConic":return t?new Id(i):new $o(i);case"globe":return new Sg(i)}throw new Error(`Invalid projection name: ${i.name}`)}const Ig=Ql.VectorTileFeature.types,Mg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Cd(i,e,t,n,a,u,d,p,g,y,T,S,C){const O=p?Math.min(tc,Math.round(p[0])):0,F=p?Math.min(tc,Math.round(p[1])):0;i.emplaceBack(e,t,Math.round(32*n),Math.round(32*a),u,d,(O<<1)+(g?1:0),F,16*y,16*T,256*S,256*C)}function Pd(i,e,t,n,a,u,d){i.emplaceBack(e,t,n,a,u,d)}function ch(i,e,t,n,a){i.emplaceBack(e,t,n,a),i.emplaceBack(e,t,n,a),i.emplaceBack(e,t,n,a),i.emplaceBack(e,t,n,a)}function Cg(i){for(const e of i.sections)if(s(e.text))return!0;return!1}class Rf{constructor(e){this.layoutVertexArray=new Qi,this.indexArray=new gi,this.programConfigurations=e,this.segments=new en,this.dynamicLayoutVertexArray=new Ei,this.opacityVertexArray=new qi,this.placedSymbolArray=new Gd,this.globeExtVertexArray=new br}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,t,n,a){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,J_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,eg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Mg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Q_.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}kt(Rf,"SymbolBuffers");class Bf{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new en,this.collisionVertexArray=new Ki,this.collisionVertexArrayExt=new pr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,tg.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,ig.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}kt(Bf,"CollisionBuffers");class Ja{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=qa([]),this.placementViewportMatrix=qa([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vf(this.zoom,t["text-size"]),this.iconSizeData=vf(this.zoom,t["icon-size"]);const n=this.layers[0].layout,a=n.get("symbol-sort-key"),u=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(d=>Ir[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Rf(new vc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Rf(new vc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ls,this.lineVertexArray=new sp,this.symbolInstances=new op}calculateGlyphDependencies(e,t,n,a,u){for(let d=0;d<e.length;d++)if(t[e.charCodeAt(d)]=!0,a&&u){const p=yi[e.charAt(d)];p&&(t[p.charCodeAt(0)]=!0)}}populate(e,t,n,a){const u=this.layers[0],d=u.layout,p=this.projection.name==="globe",g=d.get("text-font"),y=d.get("text-field"),T=d.get("icon-image"),S=(y.value.kind!=="constant"||y.value.value instanceof Nr&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),C=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,O=d.get("symbol-sort-key");if(this.features=[],!S&&!C)return;const F=t.iconDependencies,$=t.glyphDependencies,Y=t.availableImages,ae=new J(this.zoom);for(const{feature:pe,id:le,index:de,sourceLayerIndex:we}of e){const ge=u._featureFilter.needGeometry,Ne=wl(pe,ge);if(!u._featureFilter.filter(ae,Ne,n))continue;if(ge||(Ne.geometry=ya(pe,n,a)),p&&pe.type!==1&&n.z<=5){const Ge=Ne.geometry,et=.98078528056;for(let st=0;st<Ge.length;st++)Ge[st]=hp(Ge[st],tt=>tt,(tt,ft)=>Ns(nh(tt.x,tt.y,n,1),nh(ft.x,ft.y,n,1))<et)}let Fe,Ke;if(S){const Ge=u.getValueAndResolveTokens("text-field",Ne,n,Y),et=Nr.factory(Ge);Cg(et)&&(this.hasRTLText=!0),(!this.hasRTLText||Z()==="unavailable"||this.hasRTLText&&ee.isParsed())&&(Fe=Pc(et,u,Ne))}if(C){const Ge=u.getValueAndResolveTokens("icon-image",Ne,n,Y);Ke=Ge instanceof Rn?Ge:Rn.fromString(Ge)}if(!Fe&&!Ke)continue;const mt=this.sortFeaturesByKey?O.evaluate(Ne,{},n):void 0;if(this.features.push({id:le,text:Fe,icon:Ke,index:de,sourceLayerIndex:we,geometry:Ne.geometry,properties:pe.properties,type:Ig[pe.type],sortKey:mt}),Ke&&(F[Ke.name]=!0),Fe){const Ge=g.evaluate(Ne,{},n).join(","),et=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ir.vertical)>=0;for(const st of Fe.sections)if(st.image)F[st.image.name]=!0;else{const tt=Zc(Fe.toString()),ft=st.fontStack||Ge,at=$[ft]=$[ft]||{};this.calculateGlyphDependencies(st.text,at,et,this.allowVerticalPlacement,tt)}}}d.get("symbol-placement")==="line"&&(this.features=function(pe){const le={},de={},we=[];let ge=0;function Ne(Ge){we.push(pe[Ge]),ge++}function Fe(Ge,et,st){const tt=de[Ge];return delete de[Ge],de[et]=tt,we[tt].geometry[0].pop(),we[tt].geometry[0]=we[tt].geometry[0].concat(st[0]),tt}function Ke(Ge,et,st){const tt=le[et];return delete le[et],le[Ge]=tt,we[tt].geometry[0].shift(),we[tt].geometry[0]=st[0].concat(we[tt].geometry[0]),tt}function mt(Ge,et,st){const tt=st?et[0][et[0].length-1]:et[0][0];return`${Ge}:${tt.x}:${tt.y}`}for(let Ge=0;Ge<pe.length;Ge++){const et=pe[Ge],st=et.geometry,tt=et.text?et.text.toString():null;if(!tt){Ne(Ge);continue}const ft=mt(tt,st),at=mt(tt,st,!0);if(ft in de&&at in le&&de[ft]!==le[at]){const zt=Ke(ft,at,st),hi=Fe(ft,at,we[zt].geometry);delete le[ft],delete de[at],de[mt(tt,we[hi].geometry,!0)]=hi,we[zt].geometry=null}else ft in de?Fe(ft,at,st):at in le?Ke(ft,at,st):(Ne(Ge),le[ft]=ge-1,de[at]=ge-1)}return we.filter(Ge=>Ge.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,le)=>pe.sortKey-le.sortKey)}update(e,t,n,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n,a),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Md(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length,a=e.segment;if(a!==void 0){let u=e.dist(t[a+1]),d=e.dist(t[a]);const p={};for(let g=a+1;g<t.length;g++)p[g]={x:t[g].x,y:t[g].y,tileUnitDistanceFromAnchor:u},g<t.length-1&&(u+=t[g+1].dist(t[g]));for(let g=a||0;g>=0;g--)p[g]={x:t[g].x,y:t[g].y,tileUnitDistanceFromAnchor:d},g>0&&(d+=t[g-1].dist(t[g]));for(let g=0;g<t.length;g++){const y=p[g];this.lineVertexArray.emplaceBack(y.x,y.y,y.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,a,u,d,p,g,y,T,S,C,O,F){const $=e.indexArray,Y=e.layoutVertexArray,ae=e.globeExtVertexArray,pe=e.segments.prepareSegment(4*t.length,Y,$,this.canOverlap?d.sortKey:void 0),le=this.glyphOffsetArray.length,de=pe.vertexLength,we=this.allowVerticalPlacement&&p===Ir.vertical?Math.PI/2:0,ge=d.text&&d.text.sections;for(let Fe=0;Fe<t.length;Fe++){const{tl:Ke,tr:mt,bl:Ge,br:et,tex:st,pixelOffsetTL:tt,pixelOffsetBR:ft,minFontScaleX:at,minFontScaleY:zt,glyphOffset:hi,isSDF:vi,sectionIndex:Zt}=t[Fe],Et=pe.vertexLength,Mi=hi[1];if(Cd(Y,y.x,y.y,Ke.x,Mi+Ke.y,st.x,st.y,n,vi,tt.x,tt.y,at,zt),Cd(Y,y.x,y.y,mt.x,Mi+mt.y,st.x+st.w,st.y,n,vi,ft.x,tt.y,at,zt),Cd(Y,y.x,y.y,Ge.x,Mi+Ge.y,st.x,st.y+st.h,n,vi,tt.x,ft.y,at,zt),Cd(Y,y.x,y.y,et.x,Mi+et.y,st.x+st.w,st.y+st.h,n,vi,ft.x,ft.y,at,zt),g){const ni=g.anchor,Dt=g.up;Pd(ae,ni.x,ni.y,ni.z,Dt[0],Dt[1],Dt[2]),Pd(ae,ni.x,ni.y,ni.z,Dt[0],Dt[1],Dt[2]),Pd(ae,ni.x,ni.y,ni.z,Dt[0],Dt[1],Dt[2]),Pd(ae,ni.x,ni.y,ni.z,Dt[0],Dt[1],Dt[2]),ch(e.dynamicLayoutVertexArray,ni.x,ni.y,ni.z,we)}else ch(e.dynamicLayoutVertexArray,y.x,y.y,y.z,we);$.emplaceBack(Et,Et+1,Et+2),$.emplaceBack(Et+1,Et+2,Et+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(hi[0]),Fe!==t.length-1&&Zt===t[Fe+1].sectionIndex||e.programConfigurations.populatePaintArrays(Y.length,d,d.index,{},O,F,ge&&ge[Zt])}const Ne=g?g.anchor:y;e.placedSymbolArray.emplaceBack(Ne.x,Ne.y,Ne.z,y.x,y.y,le,this.glyphOffsetArray.length-le,de,T,S,y.segment,n?n[0]:0,n?n[1]:0,a[0],a[1],p,0,!1,0,C,0)}_commitLayoutVertex(e,t,n,a,u,d,p){e.emplaceBack(t,n,a,u,d,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(e,t,n,a,u,d,p){const g=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),y=g.vertexLength,T=p.tileAnchorX,S=p.tileAnchorY;for(let O=0;O<4;O++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,a,u,d,T,S,new ce(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,u,d,T,S,new ce(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,u,d,T,S,new ce(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,a,u,d,T,S,new ce(e.x1,e.y2)),g.vertexLength+=4;const C=n.indexArray;C.emplaceBack(y,y+1),C.emplaceBack(y+1,y+2),C.emplaceBack(y+2,y+3),C.emplaceBack(y+3,y),g.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,a,u,d){for(let p=a;p<u;p++){const g=n.get(p),y=this.getSymbolInstanceTextSize(e,d,t,p);this._addCollisionDebugVertices(g,y,this.textCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,t,n,a,u,d){for(let p=a;p<u;p++){const g=n.get(p),y=this.getSymbolInstanceIconSize(e,t,p);this._addCollisionDebugVertices(g,y,this.iconCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bf(Lo,Wp.members,Vn),this.iconCollisionBox=new Bf(Lo,Wp.members,Vn);const n=au(this.iconSizeData,e),a=au(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const d=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(a,e,t,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(a,e,t,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(n,e,t,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(n,e,t,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(e,t,n,a){const u=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:a),d=No(this.textSizeData,e,u)/Gn;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,t,n){const a=this.icon.placedSymbolArray.get(n),u=No(this.iconSizeData,e,a);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,t,n){e.emplaceBack(t,-n,-n),e.emplaceBack(t,n,-n),e.emplaceBack(t,n,n),e.emplaceBack(t,-n,n)}_updateTextDebugCollisionBoxes(e,t,n,a,u,d){for(let p=a;p<u;p++){const g=n.get(p),y=this.getSymbolInstanceTextSize(e,d,t,p);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,y,g.padding)}}_updateIconDebugCollisionBoxes(e,t,n,a,u){for(let d=a;d<u;d++){const p=n.get(d),g=this.getSymbolInstanceIconSize(e,t,d);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,g,p.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=au(this.iconSizeData,e),a=au(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const d=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(a,e,t,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(a,e,t,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(n,e,t,d.iconBoxStartIndex,d.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,t,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,a,u,d,p,g,y){const T={};for(let S=t;S<n;S++){const C=e.get(S);T.textBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},T.textFeatureIndex=C.featureIndex;break}for(let S=a;S<u;S++){const C=e.get(S);T.verticalTextBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},T.verticalTextFeatureIndex=C.featureIndex;break}for(let S=d;S<p;S++){const C=e.get(S);T.iconBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},T.iconFeatureIndex=C.featureIndex;break}for(let S=g;S<y;S++){const C=e.get(S);T.verticalIconBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},T.verticalIconFeatureIndex=C.featureIndex;break}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),a=n.vertexStartIndex+4*n.numGlyphs;for(let u=n.vertexStartIndex;u<a;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),a=[],u=[],d=[];for(let p=0;p<this.symbolInstances.length;++p){d.push(p);const g=this.symbolInstances.get(p);a.push(0|Math.round(t*g.tileAnchorX+n*g.tileAnchorY)),u.push(g.featureIndex)}return d.sort((p,g)=>a[p]-a[g]||u[g]-u[p]),d}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const n=this.symbolInstances.get(t);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((a,u,d)=>{a>=0&&d.indexOf(a)===u&&this.addIndicesForPlacedSymbol(this.text,a)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}kt(Ja,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ja.MAX_GLYPHS=65535,Ja.addDynamicAttributes=ch;const Ff=new He({"symbol-placement":new fe($e.layout_symbol["symbol-placement"]),"symbol-spacing":new fe($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new fe($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ee($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new fe($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new fe($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new fe($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new fe($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new fe($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ee($e.layout_symbol["icon-size"]),"icon-text-fit":new fe($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new fe($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ee($e.layout_symbol["icon-image"]),"icon-rotate":new Ee($e.layout_symbol["icon-rotate"]),"icon-padding":new fe($e.layout_symbol["icon-padding"]),"icon-keep-upright":new fe($e.layout_symbol["icon-keep-upright"]),"icon-offset":new Ee($e.layout_symbol["icon-offset"]),"icon-anchor":new Ee($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new fe($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new fe($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new fe($e.layout_symbol["text-rotation-alignment"]),"text-field":new Ee($e.layout_symbol["text-field"]),"text-font":new Ee($e.layout_symbol["text-font"]),"text-size":new Ee($e.layout_symbol["text-size"]),"text-max-width":new Ee($e.layout_symbol["text-max-width"]),"text-line-height":new Ee($e.layout_symbol["text-line-height"]),"text-letter-spacing":new Ee($e.layout_symbol["text-letter-spacing"]),"text-justify":new Ee($e.layout_symbol["text-justify"]),"text-radial-offset":new Ee($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new fe($e.layout_symbol["text-variable-anchor"]),"text-anchor":new Ee($e.layout_symbol["text-anchor"]),"text-max-angle":new fe($e.layout_symbol["text-max-angle"]),"text-writing-mode":new fe($e.layout_symbol["text-writing-mode"]),"text-rotate":new Ee($e.layout_symbol["text-rotate"]),"text-padding":new fe($e.layout_symbol["text-padding"]),"text-keep-upright":new fe($e.layout_symbol["text-keep-upright"]),"text-transform":new Ee($e.layout_symbol["text-transform"]),"text-offset":new Ee($e.layout_symbol["text-offset"]),"text-allow-overlap":new fe($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new fe($e.layout_symbol["text-ignore-placement"]),"text-optional":new fe($e.layout_symbol["text-optional"])});var Uf={paint:new He({"icon-opacity":new Ee($e.paint_symbol["icon-opacity"]),"icon-color":new Ee($e.paint_symbol["icon-color"]),"icon-halo-color":new Ee($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ee($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ee($e.paint_symbol["icon-halo-blur"]),"icon-translate":new fe($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new fe($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ee($e.paint_symbol["text-opacity"]),"text-color":new Ee($e.paint_symbol["text-color"],{runtimeType:no,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ee($e.paint_symbol["text-halo-color"]),"text-halo-width":new Ee($e.paint_symbol["text-halo-width"]),"text-halo-blur":new Ee($e.paint_symbol["text-halo-blur"]),"text-translate":new fe($e.paint_symbol["text-translate"]),"text-translate-anchor":new fe($e.paint_symbol["text-translate-anchor"])}),layout:Ff};class zm{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ea,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}kt(zm,"FormatSectionOverride",{omit:["defaultValue"]});class zd extends Bs{constructor(e){super(e,Uf)}recalculate(e,t){super.recalculate(e,t),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const a=[];for(const u of n)a.indexOf(u)<0&&a.push(u);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,a){const u=this.layout.get(e).evaluate(t,{},n,a),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||ka(d.value)||!u?u:function(p,g){return g.replace(/{([^{}]+)}/g,(y,T)=>T in p?String(p[T]):"")}(t.properties,u)}createBucket(e){return new Ja(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Uf.paint.overridableProperties){if(!zd.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new zm(t),a=new ss(n,t.property.specification);let u=null;u=t.value.kind==="constant"||t.value.kind==="source"?new zs("source",a):new uo("composite",a,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new he(t.property,u,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&zd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),a=Uf.paint.properties[t];let u=!1;const d=p=>{for(const g of p)if(a.overrides&&a.overrides.hasOverride(g))return void(u=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Nr)d(n.value.value.sections);else if(n.value.kind==="source"){const p=y=>{u||(y instanceof tl&&gr(y.value)===vs?d(y.value.sections):y instanceof il?d(y.sections):y.eachChild(p))},g=n.value;g._styleExpression&&p(g._styleExpression.expression)}return u}getProgramConfiguration(e){return new Kn(this,e)}}var Pg={paint:new He({"background-color":new fe($e.paint_background["background-color"]),"background-pattern":new ht($e.paint_background["background-pattern"]),"background-opacity":new fe($e.paint_background["background-opacity"])})},zg={paint:new He({"raster-opacity":new fe($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new fe($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new fe($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new fe($e.paint_raster["raster-brightness-max"]),"raster-saturation":new fe($e.paint_raster["raster-saturation"]),"raster-contrast":new fe($e.paint_raster["raster-contrast"]),"raster-resampling":new fe($e.paint_raster["raster-resampling"]),"raster-fade-duration":new fe($e.paint_raster["raster-fade-duration"])})};class kg extends Bs{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Dg={paint:new He({"sky-type":new fe($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new fe($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new fe($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new fe($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new fe($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new Pe($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new fe($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new fe($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new fe($e.paint_sky["sky-opacity"])})};function Nf(i,e,t){const n=[0,0,1],a=Tp([]);return sf(a,a,t?-it(i)+Math.PI:it(i)),Ep(a,a,-it(e)),xp(n,n,a),tn(n,n)}const Lg={circle:class extends Bs{constructor(i){super(i,vo)}createBucket(i){return new Yl(i)}queryRadius(i){const e=i;return Tc("circle-radius",this,e)+Tc("circle-stroke-width",this,e)+Xh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,t,n,a,u,d,p){const g=mp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),y=this.paint.get("circle-radius").evaluate(e,t)+this.paint.get("circle-stroke-width").evaluate(e,t);return Ap(i,n,u,d,p,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",g,y)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Kn(this,i)}},heatmap:class extends Bs{createBucket(i){return new Mp(i)}constructor(i){super(i,g_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=id({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Tc("heatmap-radius",this,i)}queryIntersectsFeature(i,e,t,n,a,u,d,p){const g=this.paint.get("heatmap-radius").evaluate(e,t);return Ap(i,n,u,d,p,!0,!0,new ce(0,0),g)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Kn(this,i)}},hillshade:class extends Bs{constructor(i){super(i,y_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Bs{constructor(i){super(i,L_)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),t=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&t.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),t}getProgramConfiguration(i){return new Kn(this,i)}recalculate(i,e){super.recalculate(i,e);const t=this.paint._values["fill-outline-color"];t.value.kind==="constant"&&t.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new cd(i)}queryRadius(){return Xh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,t,n,a,u){return!i.queryGeometry.isAboveHorizon&&Zh(pp(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends Bs{constructor(i){super(i,W_)}createBucket(i){return new Ku(i)}queryRadius(){return Xh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Kn(this,i)}queryIntersectsFeature(i,e,t,n,a,u,d,p,g){const y=mp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,t),S=this.paint.get("fill-extrusion-base").evaluate(e,t),C=[0,0],O=p&&u.elevation,F=u.elevation?u.elevation.exaggeration():1,$=i.tile.getBucket(this);if(O&&$ instanceof Ku){const pe=$.centroidVertexArray,le=g+1;if(le<pe.length){const de=pe.get(le);C[0]=de.a_centroid_pos0,C[1]=de.a_centroid_pos1}}if(C[0]===0&&C[1]===1)return!1;u.projection.name==="globe"&&(n=$p([n],[new ce(0,0),new ce(Xt,Xt)],i.tileID.canonical).map(pe=>pe.polygon).flat());const Y=function(pe,le,de,we,ge,Ne,Fe,Ke,mt,Ge,et){return pe.projection.name==="globe"?function(st,tt,ft,at,zt,hi,vi,Zt,Et,Mi,ni){const Dt=[],lr=[],sr=st.projection.upVectorScale(ni,st.center.lat,st.worldSize).metersToTile,wr=[0,0,0,1],wi=[0,0,0,1],Ui=(ar,tr,vr,Mr)=>{ar[0]=tr,ar[1]=vr,ar[2]=Mr,ar[3]=1},cr=Gp();ft>0&&(ft+=cr),at+=cr;for(const ar of tt){const tr=[],vr=[];for(const Mr of ar){const Qn=Mr.x+zt.x,ds=Mr.y+zt.y,Oi=st.projection.projectTilePoint(Qn,ds,ni),qr=st.projection.upVector(ni,Mr.x,Mr.y);let Eo=ft,Wi=at;if(vi){const Cr=_f(Qn,ds,ft,at,vi,Zt,Et,Mi);Eo+=Cr.base,Wi+=Cr.top}ft!==0?Ui(wr,Oi.x+qr[0]*sr*Eo,Oi.y+qr[1]*sr*Eo,Oi.z+qr[2]*sr*Eo):Ui(wr,Oi.x,Oi.y,Oi.z),Ui(wi,Oi.x+qr[0]*sr*Wi,Oi.y+qr[1]*sr*Wi,Oi.z+qr[2]*sr*Wi),dn(wr,wr,hi),dn(wi,wi,hi),tr.push(Ju(wr)),vr.push(Ju(wi))}Dt.push(tr),lr.push(vr)}return[Dt,lr]}(pe,le,de,we,ge,Ne,Fe,Ke,mt,Ge,et):Fe?function(st,tt,ft,at,zt,hi,vi,Zt,Et){const Mi=[],ni=[],Dt=[0,0,0,1];for(const lr of st){const sr=[],wr=[];for(const wi of lr){const Ui=wi.x+at.x,cr=wi.y+at.y,ar=_f(Ui,cr,tt,ft,hi,vi,Zt,Et);Dt[0]=Ui,Dt[1]=cr,Dt[2]=ar.base,Dt[3]=1,Sc(Dt,Dt,zt),Dt[3]=Math.max(Dt[3],1e-5);const tr=Ju([Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]]);Dt[0]=Ui,Dt[1]=cr,Dt[2]=ar.top,Dt[3]=1,Sc(Dt,Dt,zt),Dt[3]=Math.max(Dt[3],1e-5);const vr=Ju([Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]]);sr.push(tr),wr.push(vr)}Mi.push(sr),ni.push(wr)}return[Mi,ni]}(le,de,we,ge,Ne,Fe,Ke,mt,Ge):function(st,tt,ft,at,zt){const hi=[],vi=[],Zt=zt[8]*tt,Et=zt[9]*tt,Mi=zt[10]*tt,ni=zt[11]*tt,Dt=zt[8]*ft,lr=zt[9]*ft,sr=zt[10]*ft,wr=zt[11]*ft;for(const wi of st){const Ui=[],cr=[];for(const ar of wi){const tr=ar.x+at.x,vr=ar.y+at.y,Mr=zt[0]*tr+zt[4]*vr+zt[12],Qn=zt[1]*tr+zt[5]*vr+zt[13],ds=zt[2]*tr+zt[6]*vr+zt[14],Oi=zt[3]*tr+zt[7]*vr+zt[15],qr=Mr+Zt,Eo=Qn+Et,Wi=ds+Mi,Cr=Math.max(Oi+ni,1e-5),qo=Mr+Dt,Tr=Qn+lr,on=ds+sr,eo=Math.max(Oi+wr,1e-5),qn=new ce(qr/Cr,Eo/Cr);qn.z=Wi/Cr,Ui.push(qn);const po=new ce(qo/eo,Tr/eo);po.z=on/eo,cr.push(po)}hi.push(Ui),vi.push(cr)}return[hi,vi]}(le,de,we,ge,Ne)}(u,n,S,T,y,d,O?p:null,C,F,u.center.lat,i.tileID.canonical),ae=i.queryGeometry;return function(pe,le,de){let we=1/0;Zh(de,le)&&(we=mf(de,le[0]));for(let ge=0;ge<le.length;ge++){const Ne=le[ge],Fe=pe[ge];for(let Ke=0;Ke<Ne.length-1;Ke++){const mt=Ne[Ke],Ge=[mt,Ne[Ke+1],Fe[Ke+1],Fe[Ke],mt];ri(de,Ge)&&(we=Math.min(we,mf(de,Ge)))}}return we!==1/0&&we}(Y[0],Y[1],ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends Bs{constructor(i){super(i,yf),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof rr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=qp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new fd(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Kn(this,i)}queryRadius(i){const e=i,t=Zp(Tc("line-width",this,e),Tc("line-gap-width",this,e)),n=Tc("line-offset",this,e);return t/2+Math.abs(n)+Xh(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,t,n,a,u){if(i.queryGeometry.isAboveHorizon)return!1;const d=pp(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),p=i.pixelToTileUnitsFactor/2*Zp(this.paint.get("line-width").evaluate(e,t),this.paint.get("line-gap-width").evaluate(e,t)),g=this.paint.get("line-offset").evaluate(e,t);return g&&(n=function(y,T){const S=[],C=new ce(0,0);for(let O=0;O<y.length;O++){const F=y[O],$=[];for(let Y=0;Y<F.length;Y++){const ae=F[Y-1],pe=F[Y],le=F[Y+1],de=Y===0?C:pe.sub(ae)._unit()._perp(),we=Y===F.length-1?C:le.sub(pe)._unit()._perp(),ge=de._add(we)._unit();ge._mult(1/(ge.x*we.x+ge.y*we.y)),$.push(ge._mult(T)._add(pe))}S.push($)}return S}(n,g*i.pixelToTileUnitsFactor)),function(y,T,S){for(let C=0;C<T.length;C++){const O=T[C];if(y.length>=3){for(let F=0;F<O.length;F++)if(wc(y,O[F]))return!0}if(bc(y,O,S))return!0}return!1}(d,n,p)}isTileClipped(){return!0}},symbol:zd,background:class extends Bs{constructor(i){super(i,Pg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Bs{constructor(i){super(i,zg)}getProgramIds(){return["raster"]}},sky:class extends Bs{constructor(i){super(i,Dg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=id({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),a=!n,u=i.style.light,d=u.properties.get("position");return a&&u.properties.get("anchor")==="viewport"&&_r("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Nf(d.azimuthal,90-d.polar,e):Nf(n[0],90-n[1],e)}const t=this.paint.get("sky-gradient-center");return Nf(t[0],90-t[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class uh{constructor(e,t,n,a){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,a)}update(e,t,n){const{width:a,height:u}=e,{context:d}=this,{gl:p}=d,{HTMLImageElement:g,HTMLCanvasElement:y,HTMLVideoElement:T,ImageData:S,ImageBitmap:C}=Q;if(p.bindTexture(p.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA&&(!t||t.premultiply!==!1)),n||this.size&&this.size[0]===a&&this.size[1]===u){const{x:O,y:F}=n||{x:0,y:0};e instanceof g||e instanceof y||e instanceof T||e instanceof S||C&&e instanceof C?p.texSubImage2D(p.TEXTURE_2D,0,O,F,p.RGBA,p.UNSIGNED_BYTE,e):p.texSubImage2D(p.TEXTURE_2D,0,O,F,a,u,p.RGBA,p.UNSIGNED_BYTE,e.data)}else this.size=[a,u],e instanceof g||e instanceof y||e instanceof T||e instanceof S||C&&e instanceof C?p.texImage2D(p.TEXTURE_2D,0,this.format,this.format,p.UNSIGNED_BYTE,e):p.texImage2D(p.TEXTURE_2D,0,this.format,a,u,0,this.format,p.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,t){const{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class jf{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new El({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=Ni(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const a=[];let u=e.length%2==1?-e[e.length-1]*n:0,d=e[0]*n,p=!0;a.push({left:u,right:d,isDash:p,zeroLength:e[0]===0});let g=e[0];for(let y=1;y<e.length;y++){p=!p;const T=e[y];u=g*n,g+=T,d=g*n,a.push({left:u,right:d,isDash:p,zeroLength:T===0})}return a}addRoundDash(e,t,n){const a=t/2;for(let u=-n;u<=n;u++){const d=this.width*(this.nextRow+n+u);let p=0,g=e[p];for(let y=0;y<this.width;y++){y/g.right>1&&(g=e[++p]);const T=Math.abs(y-g.left),S=Math.abs(y-g.right),C=Math.min(T,S);let O;const F=u/n*(a+1);if(g.isDash){const $=a-Math.abs(F);O=Math.sqrt(C*C+$*$)}else O=a-Math.sqrt(C*C+F*F);this.image.data[d+y]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e,t){for(let g=e.length-1;g>=0;--g){const y=e[g],T=e[g+1];y.zeroLength?e.splice(g,1):T&&T.isDash===y.isDash&&(T.left=y.left,e.splice(g,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const u=this.width*this.nextRow;let d=0,p=e[d];for(let g=0;g<this.width;g++){g/p.right>1&&(p=e[++d]);const y=Math.abs(g-p.left),T=Math.abs(g-p.right),S=Math.min(y,T);this.image.data[u+g]=Math.max(0,Math.min(255,(p.isDash?S:-S)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const a=t==="round",u=a?7:0,d=2*u+1;if(this.nextRow+d>this.height)return _r("LineAtlas out of space"),null;e.length===0&&e.push(1);let p=0;for(let T=0;T<e.length;T++)e[T]<0&&(_r("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),p+=e[T];if(p!==0){const T=this.width/p,S=this.getDashRanges(e,this.width,T);a?this.addRoundDash(S,T,u):this.addRegularDash(S,t==="square"?.5*T:0)}const g=this.nextRow+u;this.nextRow+=d;const y={tl:[g,u],br:[p,0]};return this.positions[n]=y,y}}kt(jf,"LineAtlas");class Og{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Rg{constructor(){this.tasks={},this.taskQueue=[],wn(["process"],this),this.invoker=new Og(this.process),this.nextId=0}add(e,t){const n=this.nextId++,a=function({type:u,isSymbolTile:d,zoom:p}){return p=p||0,u==="message"?0:u!=="maybePrepare"||d?u!=="parseTile"||d?u==="parseTile"&&d?300-p:u==="maybePrepare"&&d?400-p:500:200-p:100-p}(t);if(a===0){Zr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:t,priority:a,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){Zr();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let a=0;a<this.taskQueue.length;a++){const u=this.tasks[this.taskQueue[a]];u.priority<t&&(t=u.priority,e=a)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class km{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Bg=["tile","layer","source","sourceLayer","state"];class Dm{constructor(e,t,n,a,u){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=n,this._y=a,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const t of Bg)this[t]!==void 0&&(e[t]=this[t]);return e}}const Vs=32,Qa=33,rc=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,t=0,n=0,a=0,u=0,d=0,p=0;for(1&e?a=u=d=Vs:t=n=p=Vs;(e>>=1)>1;){const y=t+a>>1,T=n+u>>1;1&e?(a=t,u=n,t=d,n=p):(t=a,n=u,a=d,u=p),d=y,p=T}const g=4*i;rc[g+0]=t,rc[g+1]=n,rc[g+2]=a,rc[g+3]=u}const el=new Uint16Array(2178),nc=new Uint8Array(1089),c=new Uint16Array(1089);function f(i){return i===0?-.03125:i===32?.03125:0}var b=Qe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const z={type:2,extent:Xt,loadGeometry:()=>[[new ce(0,0),new ce(8193,0),new ce(8193,8193),new ce(0,8193),new ce(0,0)]]};class V{constructor(e,t,n,a,u){this.tileID=e,this.uid=Yt(),this.uses=0,this.tileSize=t,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<Xn.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=zc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,u){const d={};if(!u)return d;for(const p of a){const g=p.layerIds.map(y=>u.getLayer(y)).filter(Boolean);if(g.length!==0){p.layers=g,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(y=>g.filter(T=>T.id===y)[0]));for(const y of g)d[y.id]=p}}return d}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const u=this.buckets[a];if(u instanceof Ja){if(this.hasSymbolBuckets=!0,!n)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const u=this.buckets[a];if(u instanceof Ja&&u.hasRTLText){this.hasRTLText=!0,ee.isLoading()||ee.isLoaded()||Z()!=="deferred"||te();break}}this.queryPadding=0;for(const a in this.buckets){const u=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(a).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ja}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const a=this.buckets[n];a.uploadPending()&&a.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new uh(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new uh(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new uh(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,n,a,u,d,p,g){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:p,transform:d,params:u,tileTransform:this.tileTransform},e,t,n):{}}querySourceFeatures(e,t){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const a=n.loadVTLayers(),u=t?t.sourceLayer:"",d=a._geojsonTileLayer||a[u];if(!d)return;const p=Ra(t&&t.filter),{z:g,x:y,y:T}=this.tileID.canonical,S={z:g,x:y,y:T};for(let C=0;C<d.length;C++){const O=d.feature(C);if(p.needGeometry){const Y=wl(O,!0);if(!p.filter(new J(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!p.filter(new J(this.tileID.overscaledZ),O))continue;const F=n.getId(O,u),$=new Dm(O,g,y,T,F);$.tile=S,e.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const n=Wn(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let a=!1;if(this.expirationTime>n)a=!1;else if(t)if(this.expirationTime<t)a=!0;else{const u=this.expirationTime-t;u?this.expirationTime=n+Math.max(u,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!t)return;const n=this.latestFeatureIndex.loadVTLayers(),a=t.style.listImages();for(const u in this.buckets){if(!t.style.hasLayer(u))continue;const d=this.buckets[u],p=d.layers[0].sourceLayer||"_geojsonTileLayer",g=n[p],y=e[p];if(!g||!y||Object.keys(y).length===0)continue;if(d.update(y,g,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),d instanceof fd||d instanceof cd){const S=t.style._getSourceCache(d.layers[0].source);t._terrain&&t._terrain.enabled&&S&&d.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(S.id,this.tileID)}const T=t&&t.style&&t.style.getLayer(u);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Xn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Xn.now()+e}setTexture(e,t){const n=t.context,a=n.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new uh(n,e,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax))}setDependencies(e,t){const n={};for(const a of t)n[a]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const a=this.dependencies[n];if(a){for(const u of t)if(a[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||t.name==="mercator"||this._tileDebugBuffer)return;const n=ya(z,this.tileID.canonical,this.tileTransform)[0],a=new wt,u=new ma;for(let d=0;d<n.length;d++){const{x:p,y:g}=n[d];a.emplaceBack(p,g),u.emplaceBack(d)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(a,Ka.members),this._tileDebugSegments=en.simpleSegment(0,0,a.length,u.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||t.name==="mercator")return;const n=ya(z,this.tileID.canonical,this.tileTransform)[0];let a,u;if(this.isRaster){const d=function(p,g){const y=zc(p,g),T=Math.pow(2,p.z);for(let Y=0;Y<Qa;Y++)for(let ae=0;ae<Qa;ae++){const pe=yo((p.x+(ae+f(ae))/Vs)/T),le=kn((p.y+(Y+f(Y))/Vs)/T),de=g.project(pe,le),we=Y*Qa+ae;el[2*we+0]=Math.round((de.x*y.scale-y.x)*Xt),el[2*we+1]=Math.round((de.y*y.scale-y.y)*Xt)}nc.fill(0),c.fill(0);for(let Y=2045;Y>=0;Y--){const ae=4*Y,pe=rc[ae+0],le=rc[ae+1],de=rc[ae+2],we=rc[ae+3],ge=pe+de>>1,Ne=le+we>>1,Fe=ge+Ne-le,Ke=Ne+pe-ge,mt=le*Qa+pe,Ge=we*Qa+de,et=Ne*Qa+ge,st=Math.hypot((el[2*mt+0]+el[2*Ge+0])/2-el[2*et+0],(el[2*mt+1]+el[2*Ge+1])/2-el[2*et+1])>=16;if(nc[et]=nc[et]||(st?1:0),Y<1022){const tt=(le+Ke>>1)*Qa+(pe+Fe>>1),ft=(we+Ke>>1)*Qa+(de+Fe>>1);nc[et]=nc[et]||nc[tt]||nc[ft]}}const S=new Nt,C=new gi;let O=0;function F(Y,ae){const pe=ae*Qa+Y;return c[pe]===0&&(S.emplaceBack(el[2*pe+0],el[2*pe+1],Y*Xt/Vs,ae*Xt/Vs),c[pe]=++O),c[pe]-1}function $(Y,ae,pe,le,de,we){const ge=Y+pe>>1,Ne=ae+le>>1;if(Math.abs(Y-de)+Math.abs(ae-we)>1&&nc[Ne*Qa+ge])$(de,we,Y,ae,ge,Ne),$(pe,le,de,we,ge,Ne);else{const Fe=F(Y,ae),Ke=F(pe,le),mt=F(de,we);C.emplaceBack(Fe,Ke,mt)}}return $(0,0,Vs,Vs,Vs,0),$(Vs,Vs,0,0,0,Vs),{vertices:S,indices:C}}(this.tileID.canonical,t);a=d.vertices,u=d.indices}else{a=new Nt,u=new gi;for(const{x:p,y:g}of n)a.emplaceBack(p,g,0,0);const d=rd(a.int16,void 0,4);for(let p=0;p<d.length;p+=3)u.emplaceBack(d[p],d[p+1],d[p+2])}this._tileBoundsBuffer=e.createVertexBuffer(a,b.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=en.simpleSegment(0,0,a.length,u.length)}_makeGlobeTileDebugBuffers(e,t){const n=t.projection;if(!n||n.name!=="globe"||t.freezeTileCoverage)return;const a=this.tileID.canonical,u=oh(wm(a,t)),d=sh(t.zoom);let p;d>0&&(p=rf(new Float64Array(16),t.globeMatrix));const g=(a.x+.5)/(1<<a.z)-cs(t.center.lng);let y=0;g>.5?y=-1:g<-.5&&(y=1),this._makeGlobeTileDebugBorderBuffer(e,a,t,u,p,d,y),this._makeGlobeTileDebugTextBuffer(e,a,t,u,p,d,y)}_globePoint(e,t,n,a,u,d,p,g){let y=nh(e,t,n);if(d){const T=1<<n.z,S=[((e/Xt+n.x)/T+g)*a,(t/Xt+n.y)/T*a,0];dn(S,S,d),y=Ss(y,S,p)}return dn(y,y,u)}_makeGlobeTileDebugBorderBuffer(e,t,n,a,u,d,p){const g=new wt,y=new ma,T=new Ot,S=(O,F,$,Y,ae)=>{const pe=($-O)/(ae-1),le=(Y-F)/(ae-1),de=g.length;for(let we=0;we<ae;we++){const ge=O+we*pe,Ne=F+we*le;g.emplaceBack(ge,Ne);const Fe=this._globePoint(ge,Ne,t,n.worldSize,a,u,d,p);T.emplaceBack(Fe[0],Fe[1],Fe[2]),y.emplaceBack(de+we)}},C=Xt;S(0,0,C,0,16),S(C,0,C,C,16),S(C,C,0,C,16),S(0,C,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(g,Ka.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(T,xm.members),this._tileDebugSegments=en.simpleSegment(0,0,g.length,y.length)}_makeGlobeTileDebugTextBuffer(e,t,n,a,u,d,p){const g=new wt,y=new gi,T=new Ot,S=25;y.reserve(32),g.reserve(S),T.reserve(S);const C=(O,F)=>S*O+F;for(let O=0;O<S;O++){const F=2048*O;for(let $=0;$<S;$++){const Y=2048*$;g.emplaceBack(Y,F);const ae=this._globePoint(Y,F,t,n.worldSize,a,u,d,p);T.emplaceBack(ae[0],ae[1],ae[2])}}for(let O=0;O<4;O++)for(let F=0;F<4;F++){const $=C(O,F),Y=C(O,F+1),ae=C(O+1,F),pe=C(O+1,F+1);y.emplaceBack($,Y,ae),y.emplaceBack(ae,Y,pe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(y),this._tileDebugTextBuffer=e.createVertexBuffer(g,Ka.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(T,xm.members),this._tileDebugTextSegments=en.simpleSegment(0,0,S,32)}}class re{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,n){const a=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},At(this.stateChanges[e][a],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==a&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][a]===null){this.deletedStates[e][a]={};for(const u in this.state[e][a])n[u]||(this.deletedStates[e][a][u]=null)}else for(const u in n)this.deletedStates[e]&&this.deletedStates[e][a]&&this.deletedStates[e][a][u]===null&&delete this.deletedStates[e][a][u]}removeFeatureState(e,t,n){if(this.deletedStates[e]===null)return;const a=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&t!==void 0)this.deletedStates[e][a]!==null&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][n]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][a])for(n in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][n]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,t){const n=String(t),a=At({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][t];if(u===null)return{};for(const d in u)delete a[d]}return a}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const n={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const u={};for(const d in this.stateChanges[a])this.state[a][d]||(this.state[a][d]={}),At(this.state[a][d],this.stateChanges[a][d]),u[d]=this.state[a][d];n[a]=u}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const u={};if(this.deletedStates[a]===null)for(const d in this.state[a])u[d]={},this.state[a][d]={};else for(const d in this.deletedStates[a]){if(this.deletedStates[a][d]===null)this.state[a][d]={};else for(const p of Object.keys(this.deletedStates[a][d]))delete this.state[a][d][p];u[d]=this.state[a][d]}n[a]=n[a]||{},At(n[a],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const a in e)e[a].setFeatureState(n,t)}}class _e{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Ae(i,e,t,n){let a=0,u=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(n[d])<1e-15){if(t[d]<i[d]||t[d]>e[d])return null}else{const p=1/n[d];let g=(i[d]-t[d])*p,y=(e[d]-t[d])*p;if(g>y){const T=g;g=y,y=T}if(g>a&&(a=g),y<u&&(u=y),a>u)return null}return a}function De(i,e,t,n,a,u,d,p,g,y,T){const S=n-i,C=a-e,O=u-t,F=d-i,$=p-e,Y=g-t,ae=T[1]*Y-T[2]*$,pe=T[2]*F-T[0]*Y,le=T[0]*$-T[1]*F,de=S*ae+C*pe+O*le;if(Math.abs(de)<1e-15)return null;const we=1/de,ge=y[0]-i,Ne=y[1]-e,Fe=y[2]-t,Ke=(ge*ae+Ne*pe+Fe*le)*we;if(Ke<0||Ke>1)return null;const mt=Ne*O-Fe*C,Ge=Fe*S-ge*O,et=ge*C-Ne*S,st=(T[0]*mt+T[1]*Ge+T[2]*et)*we;return st<0||Ke+st>1?null:(F*mt+$*Ge+Y*et)*we}function ct(i,e,t){return(i-e)/(t-e)}function ut(i,e,t,n,a,u,d,p,g){const y=1<<t,T=u-n,S=d-a,C=(i+1)/y*T+n,O=(e+0)/y*S+a,F=(e+1)/y*S+a;p[0]=(i+0)/y*T+n,p[1]=O,g[0]=C,g[1]=F}class pt{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(u){const d=Math.ceil(Math.log2(u.dim/8)),p=[];let g=Math.ceil(Math.pow(2,d));const y=1/g,T=(O,F,$,Y,ae)=>{const pe=Y?1:0,le=(O+1)*$-pe,de=F*$,we=(F+1)*$-pe;ae[0]=O*$,ae[1]=de,ae[2]=le,ae[3]=we};let S=new _e(g);const C=[];for(let O=0;O<g*g;O++){T(O%g,Math.floor(O/g),y,!1,C);const F=jt(C[0],C[1],u),$=jt(C[2],C[1],u),Y=jt(C[2],C[3],u),ae=jt(C[0],C[3],u);S.minimums.push(Math.min(F,$,Y,ae)),S.maximums.push(Math.max(F,$,Y,ae)),S.leaves.push(1)}for(p.push(S),g/=2;g>=1;g/=2){const O=p[p.length-1];S=new _e(g);for(let F=0;F<g*g;F++){T(F%g,Math.floor(F/g),2,!0,C);const $=O.getElevation(C[0],C[1]),Y=O.getElevation(C[2],C[1]),ae=O.getElevation(C[2],C[3]),pe=O.getElevation(C[0],C[3]),le=O.isLeaf(C[0],C[1]),de=O.isLeaf(C[2],C[1]),we=O.isLeaf(C[2],C[3]),ge=O.isLeaf(C[0],C[3]),Ne=Math.min($.min,Y.min,ae.min,pe.min),Fe=Math.max($.max,Y.max,ae.max,pe.max),Ke=le&&de&&we&&ge;S.maximums.push(Fe),S.minimums.push(Ne),S.leaves.push(Fe-Ne<=5&&Ke?1:0)}p.push(S)}return p}(this.dem),n=t.length-1,a=t[n];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,a,u,d,p=1){return Ae([e,t,-100],[n,a,this.maximums[0]*p],u,d)}raycast(e,t,n,a,u,d,p=1){if(!this.nodeCount)return null;const g=this.raycastRoot(e,t,n,a,u,d,p);if(g==null)return null;const y=[],T=[],S=[],C=[],O=[{idx:0,t:g,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:F,t:$,nodex:Y,nodey:ae,depth:pe}=O.pop();if(this.leaves[F]){ut(Y,ae,pe,e,t,n,a,S,C);const de=1<<pe,we=(Y+0)/de,ge=(Y+1)/de,Ne=(ae+0)/de,Fe=(ae+1)/de,Ke=jt(we,Ne,this.dem)*p,mt=jt(ge,Ne,this.dem)*p,Ge=jt(ge,Fe,this.dem)*p,et=jt(we,Fe,this.dem)*p,st=De(S[0],S[1],Ke,C[0],S[1],mt,C[0],C[1],Ge,u,d),tt=De(C[0],C[1],Ge,S[0],C[1],et,S[0],S[1],Ke,u,d),ft=Math.min(st!==null?st:Number.MAX_VALUE,tt!==null?tt:Number.MAX_VALUE);if(ft!==Number.MAX_VALUE)return ft;{const at=hs([],u,d,$);if(Bt(Ke,mt,et,Ge,ct(at[0],S[0],C[0]),ct(at[1],S[1],C[1]))>=at[2])return $}continue}let le=0;for(let de=0;de<this._siblingOffset.length;de++){ut((Y<<1)+this._siblingOffset[de][0],(ae<<1)+this._siblingOffset[de][1],pe+1,e,t,n,a,S,C),S[2]=-100,C[2]=this.maximums[this.childOffsets[F]+de]*p;const we=Ae(S,C,u,d);if(we!=null){const ge=we;y[de]=ge;let Ne=!1;for(let Fe=0;Fe<le&&!Ne;Fe++)ge>=y[T[Fe]]&&(T.splice(Fe,0,de),Ne=!0);Ne||(T[le]=de),le++}}for(let de=0;de<le;de++){const we=T[de];O.push({idx:this.childOffsets[F]+we,t:y[we],nodex:(Y<<1)+this._siblingOffset[we][0],nodey:(ae<<1)+this._siblingOffset[we][1],depth:pe+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,a,u){if(e[a].isLeaf(t,n)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const d=a-1,p=e[d];let g=0,y=0;for(let T=0;T<this._siblingOffset.length;T++){const S=2*t+this._siblingOffset[T][0],C=2*n+this._siblingOffset[T][1],O=p.getElevation(S,C),F=p.isLeaf(S,C),$=this._addNode(O.min,O.max,F);F&&(g|=1<<T),y||(y=$)}for(let T=0;T<this._siblingOffset.length;T++)g&1<<T||this._construct(e,2*t+this._siblingOffset[T][0],2*n+this._siblingOffset[T][1],d,y+T)}}function Bt(i,e,t,n,a,u){return ui(ui(i,t,u),ui(e,n,u),a)}function jt(i,e,t){const n=t.dim,a=Ye(i*n-.5,0,n-1),u=Ye(e*n-.5,0,n-1),d=Math.floor(a),p=Math.floor(u),g=Math.min(d+1,n-1),y=Math.min(p+1,n-1);return Bt(t.get(d,p),t.get(g,p),t.get(d,y),t.get(g,y),a-d,u-p)}const ai={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Ai{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n,a=!1,u=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return _r(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const d=this.dim=t.height-2,p=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=n||"mapbox",this.borderReady=a,!a){for(let g=0;g<d;g++)p[this._idx(-1,g)]=p[this._idx(0,g)],p[this._idx(d,g)]=p[this._idx(d-1,g)],p[this._idx(g,-1)]=p[this._idx(g,0)],p[this._idx(g,d)]=p[this._idx(g,d-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(d,-1)]=p[this._idx(d-1,0)],p[this._idx(-1,d)]=p[this._idx(0,d-1)],p[this._idx(d,d)]=p[this._idx(d-1,d-1)],u&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new pt(this)}get(e,t,n=!1){n&&(e=Ye(e,-1,this.dim),t=Ye(t,-1,this.dim));const a=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[a],this.pixels[a+1],this.pixels[a+2])}static getUnpackVector(e){return ai[e]}get unpackVector(){return ai[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,n){return(256*e*256+256*t+n)/10-1e4}_unpackTerrarium(e,t,n){return 256*e+t+n/256-32768}static pack(e,t){const n=[0,0,0,0],a=Ai.getUnpackVector(t);let u=Math.floor((e+a[3])/a[2]);return n[2]=u%256,u=Math.floor(u/256),n[1]=u%256,u=Math.floor(u/256),n[0]=u,n}getPixels(){return new Uo({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=t*this.dim,u=t*this.dim+this.dim,d=n*this.dim,p=n*this.dim+this.dim;switch(t){case-1:a=u-1;break;case 1:u=a+1}switch(n){case-1:d=p-1;break;case 1:p=d+1}const g=-t*this.dim,y=-n*this.dim;for(let T=d;T<p;T++)for(let S=a;S<u;S++){const C=4*this._idx(S,T),O=4*this._idx(S+g,T+y);this.pixels[C+0]=e.pixels[O+0],this.pixels[C+1]=e.pixels[O+1],this.pixels[C+2]=e.pixels[O+2],this.pixels[C+3]=e.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}kt(Ai,"DEMData"),kt(pt,"DemMinMaxQuadTree",{omit:["dem"]});class li{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const a=e.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const u={value:t,timeout:void 0};if(n!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},n)),this.data[a].push(u),this.order.push(a),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,a=t===void 0?0:this.data[n].indexOf(t),u=this.data[n][a];return this.data[n].splice(a,1),u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(u.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(e){const t=[];for(const n in this.data)for(const a of this.data[n])e(a.value)||t.push(a);for(const n of t)this.remove(n.value.tileID,n)}}class Ii{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}Ii.ReadOnly=!1,Ii.ReadWrite=!0,Ii.disabled=new Ii(519,Ii.ReadOnly,[0,1]);const Fi=7680;class bo{constructor(e,t,n,a,u,d){this.test=e,this.ref=t,this.mask=n,this.fail=a,this.depthFail=u,this.pass=d}}bo.disabled=new bo({func:519,mask:0},0,0,Fi,Fi,Fi);class Br{constructor(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n}}Br.Replace=[1,0],Br.disabled=new Br(Br.Replace,Ri.transparent,[!1,!1,!1,!1]),Br.unblended=new Br(Br.Replace,Ri.transparent,[!0,!0,!0,!0]),Br.alphaBlended=new Br([1,771],Ri.transparent,[!0,!0,!0,!0]);const wo=1029,$r=2305;class fn{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}fn.disabled=new fn(!1,wo,$r),fn.backCCW=new fn(!0,wo,$r),fn.backCW=new fn(!0,wo,2304),fn.frontCW=new fn(!0,1028,2304),fn.frontCCW=new fn(!0,1028,$r);class To extends Ft{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",a=>{a.dataType==="source"&&a.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&a.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new li(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new re,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if(t.state!=="loaded"&&t.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const n=this._tiles[t];this._source.prepareTile(n)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,n.tileID),n.upload(e),n.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return bt(this._tiles).map(e=>e.tileID).sort(Vf).map(e=>e.key)}getRenderableIds(e){const t=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&t.push(this._tiles[n]);return e?t.sort((n,a)=>{const u=n.tileID,d=a.tileID,p=new ce(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),g=new ce(d.canonical.x,d.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-d.overscaledZ||g.y-p.y||g.x-p.x}).map(n=>n.tileID.key):t.map(n=>n.tileID).sort(Vf).map(n=>n.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(e,t,n,a){if(a)if(e.state="errored",a.status!==404)this._source.fire(new xi(a,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Xn.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Zi("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let a=0;a<t.length;a++){const u=t[a];if(e.neighboringTiles&&e.neighboringTiles[u]){const d=this.getTileByID(u);n(e,d),n(d,e)}}function n(a,u){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let d=u.tileID.canonical.x-a.tileID.canonical.x;const p=u.tileID.canonical.y-a.tileID.canonical.y,g=Math.pow(2,a.tileID.canonical.z),y=u.tileID.key;d===0&&p===0||Math.abs(p)>1||(Math.abs(d)>1&&(Math.abs(d+g)===1?d+=g:Math.abs(d-g)===1&&(d-=g)),u.dem&&a.dem&&(a.dem.backfillBorder(u.dem,d,p),a.neighboringTiles&&a.neighboringTiles[y]&&(a.neighboringTiles[y].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,a){for(const u in this._tiles){let d=this._tiles[u];if(a[u]||!d.hasData()||d.tileID.overscaledZ<=t||d.tileID.overscaledZ>n)continue;let p=d.tileID;for(;d&&d.tileID.overscaledZ>t+1;){const y=d.tileID.scaledTo(d.tileID.overscaledZ-1);d=this._tiles[y.key],d&&d.hasData()&&(p=y)}let g=p;for(;g.overscaledZ>t;)if(g=g.scaledTo(g.overscaledZ-1),e[g.key]){a[p.key]=p;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const a=e.scaledTo(n),u=this._getLoadedTile(a);if(u)return u}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,a=Math.ceil(e.height/t)+1,u=Math.floor(n*a*5),d=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(p)}handleWrapJump(e){const t=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,t){const n={};for(const a in this._tiles){const u=this._tiles[a];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+t),n[u.tileID.key]=u}this._tiles=n;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,t,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let a;this.updateCacheSize(e,t),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(p=>new Jn(p.canonical.z,p.wrap,p.canonical.z,p.canonical.x,p.canonical.y)):(a=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter(p=>this._source.hasTile(p)))):a=[];const u=this._updateRetainedTiles(a);if(ev(this._source.type)&&a.length!==0){const p={},g={},y=Object.keys(u);for(const S of y){const C=u[S],O=this._tiles[S];if(!O||O.fadeEndTime&&O.fadeEndTime<=Xn.now())continue;const F=this.findLoadedParent(C,Math.max(C.overscaledZ-To.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),p[F.tileID.key]=F.tileID),g[S]=C}const T=a[a.length-1].overscaledZ;for(const S in this._tiles){const C=this._tiles[S];if(u[S]||!C.hasData())continue;let O=C.tileID;for(;O.overscaledZ>T;){O=O.scaledTo(O.overscaledZ-1);const F=this._tiles[O.key];if(F&&F.hasData()&&g[O.key]){u[S]=C.tileID;break}}}for(const S in p)u[S]||(this._coveredTiles[S]=!0,u[S]=p[S])}for(const p in u)this._tiles[p].clearFadeHold();const d=function(p,g){const y=[];for(const T in p)T in g||y.push(T);return y}(this._tiles,u);for(const p of d){const g=this._tiles[p];g.hasSymbolBuckets&&!g.holdingForFade()?g.setHoldDuration(this.map._fadeDuration):g.hasSymbolBuckets&&!g.symbolFadeFinished()||this._removeTile(+p)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(e.length===0)return t;const n={},a=e.reduce((y,T)=>Math.min(y,T.overscaledZ),1/0),u=e[0].overscaledZ,d=Math.max(u-To.maxOverzooming,this._source.minzoom),p=Math.max(u+To.maxUnderzooming,this._source.minzoom),g={};for(const y of e){const T=this._addTile(y);t[y.key]=y,T.hasData()||a<this._source.maxzoom&&(g[y.key]=y)}this._retainLoadedChildren(g,a,p,t);for(const y of e){let T=this._tiles[y.key];if(T.hasData())continue;if(y.canonical.z>=this._source.maxzoom){const C=y.children(this._source.maxzoom)[0],O=this.getTile(C);if(O&&O.hasData()){t[C.key]=C;continue}}else{const C=y.children(this._source.maxzoom);if(t[C[0].key]&&t[C[1].key]&&t[C[2].key]&&t[C[3].key])continue}let S=T.wasRequested();for(let C=y.overscaledZ-1;C>=d;--C){const O=y.scaledTo(C);if(n[O.key]||(n[O.key]=!0,T=this.getTile(O),!T&&S&&(T=this._addTile(O)),T&&(t[O.key]=O,S=T.wasRequested(),T.hasData())))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){n=this._loadedParentTiles[a.key];break}t.push(a.key);const u=a.scaledTo(a.overscaledZ-1);if(n=this._getLoadedTile(u),n)break;a=u}for(const u of t)this._loadedParentTiles[u]=n}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const n=Boolean(t);if(!n){const a=this.map?this.map.painter:null;t=new V(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new Zi("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&t.state!=="reloading"?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,n){const a=[],u=this.transform;if(!u)return a;const d=u.projection.name==="globe",p=cs(u.center.lng);for(const g in this._tiles){const y=this._tiles[g];if(n&&y.clearQueryDebugViz(),y.holdingForFade())continue;let T;if(d){const S=y.tileID.canonical;if(S.z===0){const C=[Math.abs(Ye(p,...Gf(S,-1))-p),Math.abs(Ye(p,...Gf(S,1))-p)];T=[0,2*C.indexOf(Math.min(...C))-1]}else{const C=[Math.abs(Ye(p,...Gf(S,-1))-p),Math.abs(Ye(p,...Gf(S,0))-p),Math.abs(Ye(p,...Gf(S,1))-p)];T=[C.indexOf(Math.min(...C))-1]}}else T=[0];for(const S of T){const C=e.containsTile(y,u,t,S);C&&a.push(C)}}return a}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of t)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(ev(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(t.fadeEndTime!==void 0&&t.fadeEndTime>=Xn.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const a=this._tiles[e];a&&a.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,t))}_preloadTiles(e,t){const n=new Map,a=Array.isArray(e)?e:[e],u=this.map.painter.terrain,d=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const p of a){const g=p.coveringTiles({tileSize:d,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const y of g)n.set(y.key,y);this.usedForTerrain&&p.updateElevation(!1)}xt(Array.from(n.values()),(p,g)=>{const y=new V(p,this._source.tileSize*p.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(y,T=>{this._source.type==="raster-dem"&&y.dem&&this._backfillDEM(y),g(T,y)})},t)}}function Vf(i,e){const t=Math.abs(2*i.wrap)-+(i.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||n-t||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function ev(i){return i==="raster"||i==="image"||i==="video"}function Gf(i,e){const t=1<<i.z;return[i.x/t+e,(i.x+1)/t+e]}To.maxOverzooming=10,To.maxUnderzooming=3;class Lm{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const a=n||e.findDEMTileFor(t);if(!a||!a.dem)return;const u=a.dem,d=a.tileID,p=1<<t.canonical.z-d.canonical.z;return new Lm(a,a.tileSize/Xt/p,[(t.canonical.x/p-d.canonical.x)*u.dim,(t.canonical.y/p-d.canonical.y)*u.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(n);return new ce(a,u)}getElevationAt(e,t,n,a){const u=e*this._scale+this._offset[0],d=t*this._scale+this._offset[1],p=Math.floor(u),g=Math.floor(d),y=this._dem;return a=!!a,n?ui(ui(y.get(p,g,a),y.get(p,g+1,a),d-g),ui(y.get(p+1,g,a),y.get(p+1,g+1,a),d-g),u-p):y.get(p,g,a)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*us(1,e)*this._dem.stride}}class tv{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new da(Xt,16,0),this.featureIndexArray=new Rh,this.promoteId=t}insert(e,t,n,a,u,d=0){const p=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,a,u,d);const g=this.grid;for(let y=0;y<t.length;y++){const T=t[y],S=[1/0,1/0,-1/0,-1/0];for(let C=0;C<T.length;C++){const O=T[C];S[0]=Math.min(S[0],O.x),S[1]=Math.min(S[1],O.y),S[2]=Math.max(S[2],O.x),S[3]=Math.max(S[3],O.y)}S[0]<Xt&&S[1]<Xt&&S[2]>=0&&S[3]>=0&&g.insert(p,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ql.VectorTile(new js(this.rawTileData)).layers,this.sourceLayerCoder=new km(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,n,a){this.loadVTLayers();const u=e.params||{},d=Ra(u.filter),p=e.tileResult,g=e.transform,y=p.bufferedTilespaceBounds,T=this.grid.query(y.min.x,y.min.y,y.max.x,y.max.y,(F,$,Y,ae)=>tf(p.bufferedTilespaceGeometry,F,$,Y,ae));T.sort(m0);let S=null;g.elevation&&T.length>0&&(S=Lm.create(g.elevation,this.tileID));const C={};let O;for(let F=0;F<T.length;F++){const $=T[F];if($===O)continue;O=$;const Y=this.featureIndexArray.get($);let ae=null;this.loadMatchingFeature(C,Y,d,u.layers,u.availableImages,t,n,a,(pe,le,de,we=0)=>(ae||(ae=ya(pe,this.tileID.canonical,e.tileTransform)),le.queryIntersectsFeature(p,pe,de,ae,this.z,e.transform,e.pixelPosMatrix,S,we)))}return C}loadMatchingFeature(e,t,n,a,u,d,p,g,y){const{featureIndex:T,bucketIndex:S,sourceLayerIndex:C,layoutVertexArrayOffset:O}=t,F=this.bucketLayerIDs[S];if(a&&!function(pe,le){for(let de=0;de<pe.length;de++)if(le.indexOf(pe[de])>=0)return!0;return!1}(a,F))return;const $=this.sourceLayerCoder.decode(C),Y=this.vtLayers[$].feature(T);if(n.needGeometry){const pe=wl(Y,!0);if(!n.filter(new J(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!n.filter(new J(this.tileID.overscaledZ),Y))return;const ae=this.getId(Y,$);for(let pe=0;pe<F.length;pe++){const le=F[pe];if(a&&a.indexOf(le)<0)continue;const de=d[le];if(!de)continue;let we={};ae!==void 0&&g&&(we=g.getState(de.sourceLayer||"_geojsonTileLayer",ae));const ge=At({},p[le]);ge.paint=iv(ge.paint,de.paint,Y,we,u),ge.layout=iv(ge.layout,de.layout,Y,we,u);const Ne=!y||y(Y,de,we,O);if(!Ne)continue;const Fe=new Dm(Y,this.z,this.x,this.y,ae);Fe.layer=ge;let Ke=e[le];Ke===void 0&&(Ke=e[le]=[]),Ke.push({featureIndex:T,feature:Fe,intersectionZ:Ne})}}lookupSymbolFeatures(e,t,n,a,u,d,p,g){const y={};this.loadVTLayers();const T=Ra(u);for(const S of e)this.loadMatchingFeature(y,{bucketIndex:n,sourceLayerIndex:a,featureIndex:S,layoutVertexArrayOffset:0},T,d,p,g,t);return y}loadFeature(e){const{featureIndex:t,sourceLayerIndex:n}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(n),u=this.vtFeatures[a];if(u[t])return u[t];const d=this.vtLayers[a].feature(t);return u[t]=d,d}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]],typeof n=="boolean"&&(n=Number(n))),n}}function iv(i,e,t,n,a){return xr(i,(u,d)=>{const p=e instanceof ve?e.get(d):null;return p&&p.evaluate?p.evaluate(t,n,a):p})}function m0(i,e){return e-i}kt(tv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class rv{constructor(e){const t={},n=[];for(const p in e){const g=e[p],y=t[p]={};for(const T in g.glyphs){const S=g.glyphs[+T];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const C=S.metrics.localGlyph?2:1,O={x:0,y:0,w:S.bitmap.width+2*C,h:S.bitmap.height+2*C};n.push(O),y[T]=O}}const{w:a,h:u}=wf(n),d=new El({width:a||1,height:u||1});for(const p in e){const g=e[p];for(const y in g.glyphs){const T=g.glyphs[+y];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;const S=t[p][y],C=T.metrics.localGlyph?2:1;El.copy(T.bitmap,d,{x:0,y:0},{x:S.x+C,y:S.y+C},T.bitmap)}}this.image=d,this.positions=t}}kt(rv,"GlyphAtlas");class _0{constructor(e){this.tileID=new Jn(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=zc(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,n,a,u){this.status="parsing",this.data=e,this.collisionBoxArray=new ja;const d=new km(Object.keys(e.layers).sort()),p=new tv(this.tileID,this.promoteId);p.bucketLayerIDs=[];const g={},y=new jf(256,256),T={featureIndex:p,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:y,availableImages:n},S=t.familiesBySource[this.source];for(const we in S){const ge=e.layers[we];if(!ge)continue;let Ne=!1,Fe=!1;for(const Ge of S[we])Ge[0].type==="symbol"?Ne=!0:Fe=!0;if(this.isSymbolTile===!0&&!Ne||this.isSymbolTile===!1&&!Fe)continue;ge.version===1&&_r(`Vector tile source "${this.source}" layer "${we}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ke=d.encode(we),mt=[];for(let Ge=0;Ge<ge.length;Ge++){const et=ge.feature(Ge),st=p.getId(et,we);mt.push({feature:et,id:st,index:Ge,sourceLayerIndex:Ke})}for(const Ge of S[we]){const et=Ge[0];this.isSymbolTile!==void 0&&et.type==="symbol"!==this.isSymbolTile||et.minzoom&&this.zoom<Math.floor(et.minzoom)||et.maxzoom&&this.zoom>=et.maxzoom||et.visibility!=="none"&&(Fg(Ge,this.zoom,n),(g[et.id]=et.createBucket({index:p.bucketLayerIDs.length,layers:Ge,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ke,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:n})).populate(mt,T,this.tileID.canonical,this.tileTransform),p.bucketLayerIDs.push(Ge.map(st=>st.id)))}}let C,O,F,$;y.trim();const Y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ae=xr(T.glyphDependencies,we=>Object.keys(we).map(Number));Object.keys(ae).length?a.send("getGlyphs",{uid:this.uid,stacks:ae},(we,ge)=>{C||(C=we,O=ge,de.call(this))},void 0,!1,Y):O={};const pe=Object.keys(T.iconDependencies);pe.length?a.send("getImages",{icons:pe,source:this.source,tileID:this.tileID,type:"icons"},(we,ge)=>{C||(C=we,F=ge,de.call(this))},void 0,!1,Y):F={};const le=Object.keys(T.patternDependencies);function de(){if(C)return u(C);if(O&&F&&$){const we=new rv(O),ge=new eh(F,$);for(const Ne in g){const Fe=g[Ne];Fe instanceof Ja?(Fg(Fe.layers,this.zoom,n),mg(Fe,O,we.positions,F,ge.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection)):Fe.hasPattern&&(Fe instanceof fd||Fe instanceof cd||Fe instanceof Ku)&&(Fg(Fe.layers,this.zoom,n),Fe.addFeatures(T,this.tileID.canonical,ge.patternPositions,n,this.tileTransform))}this.status="done",u(null,{buckets:bt(g).filter(Ne=>!Ne.isEmpty()),featureIndex:p,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:we.image,lineAtlas:y,imageAtlas:ge,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?F:null,glyphPositions:this.returnDependencies?we.positions:null})}}le.length?a.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"patterns"},(we,ge)=>{C||(C=we,$=ge,de.call(this))},void 0,!1,Y):$={},de.call(this)}}function Fg(i,e,t){const n=new J(e);for(const a of i)a.recalculate(n,t)}class nv{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,a){const u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){const[d,p]=u.result;return this.scheduler?this.scheduler.add(()=>{a(d,p)},t):a(d,p),()=>{}}return u.callbacks.push(a),u.cancel||(u.cancel=n((d,p)=>{u.result=[d,p];for(const g of u.callbacks)this.scheduler?this.scheduler.add(()=>{g(d,p)},t):g(d,p);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(d=>d!==a),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function ov(i,e,t){const n=JSON.stringify(i.request);return i.data&&(this.deduped.entries[n]={result:[null,i.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},a=>{const u=ke(i.request,(d,p,g,y)=>{d?a(d):p&&a(null,{vectorTile:t?void 0:new Ql.VectorTile(new js(p)),rawData:p,cacheControl:g,expires:y})});return()=>{u.cancel(),a()}},e)}o.ARRAY_TYPE=Bo,o.AUTH_ERR_MSG=Fr,o.Aabb=xo,o.Actor=class{constructor(i,e,t){this.target=i,this.parent=e,this.mapId=t,this.callbacks={},this.cancelCallbacks={},wn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Zr()?i:Q,this.scheduler=new Rg}send(i,e,t,n,a=!1,u){const d=Math.round(1e18*Math.random()).toString(36).substring(0,10);t&&(t.metadata=u,this.callbacks[d]=t);const p=Pr(this.globalScope)?void 0:[];return this.target.postMessage({id:d,type:i,hasCallback:!!t,targetMapId:n,mustQueue:a,sourceMapId:this.mapId,data:ko(e,p)},p),{cancel:()=>{t&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(i){const e=i.data,t=e.id;if(t&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const n=this.cancelCallbacks[t];delete this.cancelCallbacks[t],n&&n.cancel()}else if(e.mustQueue||Zr()){const n=this.callbacks[t];this.cancelCallbacks[t]=this.scheduler.add(()=>this.processTask(t,e),n&&n.metadata||{type:"message"})}else this.processTask(t,e)}processTask(i,e){if(e.type==="<response>"){const t=this.callbacks[i];delete this.callbacks[i],t&&(e.error?t(dc(e.error)):t(null,dc(e.data)))}else{const t=Pr(this.globalScope)?void 0:[],n=e.hasCallback?(u,d)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:u?ko(u):null,data:ko(d,t)},t)}:u=>{},a=dc(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,a,n);else if(this.parent.getWorkerSource){const u=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,u[0],a.source)[u[1]](a,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=ud,o.Color=Ri,o.ColorMode=Br,o.CullFaceMode=fn,o.DEMData=Ai,o.DataConstantProperty=fe,o.DedupedRequest=nv,o.DepthMode=Ii,o.EXTENT=Xt,o.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(!e||i.y<0||i.y>1)return!1;const t=e.getSource().maxzoom,n=1<<t,a=Math.floor(i.x),u=Math.floor((i.x-a)*n),d=Math.floor(i.y*n),p=this.findDEMTileFor(new Jn(t,a,t,u,d));return!(!p||!p.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,t=!0){e==null&&(e=null);const n=this._source();if(!n||i.y<0||i.y>1)return e;const a=n.getSource().maxzoom,u=1<<a,d=Math.floor(i.x),p=i.x-d,g=new Jn(a,d,a,Math.floor(p*u),Math.floor(i.y*u)),y=this.findDEMTileFor(g);if(!y||!y.dem)return e;const T=y.dem,S=1<<y.tileID.canonical.z,C=(p*S-y.tileID.canonical.x)*T.dim,O=(i.y*S-y.tileID.canonical.y)*T.dim,F=Math.floor(C),$=Math.floor(O);return(t?this.exaggeration():1)*ui(ui(T.get(F,$),T.get(F,$+1),O-$),ui(T.get(F+1,$),T.get(F+1,$+1),O-$),C-F)}getAtTileOffset(i,e,t){const n=1<<i.canonical.z;return this.getAtPointOrZero(new Ro(i.wrap+(i.canonical.x+e/Xt)/n,(i.canonical.y+t/Xt)/n))}getAtTileOffsetFunc(i,e,t,n){return a=>{const u=this.getAtTileOffset(i,a.x,a.y),d=n.upVector(i.canonical,a.x,a.y);return Us(d,d,u*n.upVectorScale(i.canonical,e,t).metersToTile),d}}getForTilePoints(i,e,t,n){const a=Lm.create(this,i,n);return!!a&&(e.forEach(u=>{u[2]=this.exaggeration()*a.getElevationAt(u[0],u[1],t)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const t=e.dem.tree,n=e.tileID,a=1<<i.canonical.z-n.canonical.z;let u=i.canonical.x/a-n.canonical.x,d=i.canonical.y/a-n.canonical.y,p=0;for(let g=0;g<i.canonical.z-n.canonical.z&&!t.leaves[p];g++){u*=2,d*=2;const y=2*Math.floor(d)+Math.floor(u);p=t.childOffsets[p]+y,u%=1,d%=1}return{min:this.exaggeration()*t.minimums[p],max:this.exaggeration()*t.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,t){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=xi,o.EvaluationParameters=J,o.Event=Zi,o.Evented=Ft,o.FillExtrusionBucket=Ku,o.Frustum=af,o.FrustumCorners=td,o.GLOBE_METERS_TO_ECEF=Cf,o.GLOBE_RADIUS=Ml,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_createGrid(i){const e=new wt,t=new gi,n=65;for(let a=0;a<n;a++)for(let u=0;u<n;u++)e.emplaceBack(u,a);this._gridSegments=[];for(let a=0,u=0;a<pu.length;a++){const d=pu[a];for(let g=0;g<d;g++)for(let y=0;y<64;y++){const T=g*n+y;t.emplaceBack(T+1,T,T+n),t.emplaceBack(T+n,T+n+1,T+1)}const p=64*d*2;this._gridSegments.push(en.simpleSegment(0,u,(d+1)*n,p)),u+=p}this._gridBuffer=i.createVertexBuffer(e,Ka.members),this._gridIndexBuffer=i.createIndexBuffer(t,!0)}_createPoles(i){const e=new gi;for(let a=0;a<=64;a++)e.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const t=new jn,n=new jn;this._poleSegments=[];for(let a=0,u=0;a<5;a++){const d=360/(1<<a);t.emplaceBack(0,-Ml,0,.5,0),n.emplaceBack(0,-Ml,0,.5,1);for(let p=0;p<=64;p++){const g=p/64,y=ui(0,d,g),[T,S,C]=mu(xg,bg,y,Ml);t.emplaceBack(T,S,C,g,0),n.emplaceBack(T,S,C,g,1)}this._poleSegments.push(en.simpleSegment(u,0,66,64)),u+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(t,vm,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(n,vm,!1)}getGridBuffers(i){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[i]]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){const t=new Vn,n=64,a=n+1;this._wireframeSegments=[];for(let u=0,d=0;u<pu.length;u++){const p=pu[u];for(let y=0;y<p;y++)for(let T=0;T<n;T++){const S=y*a+T;t.emplaceBack(S,S+1),t.emplaceBack(S,S+a),t.emplaceBack(S,S+a+1)}const g=p*n*3;this._wireframeSegments.push(en.simpleSegment(0,d,(p+1)*a,g)),d+=g}this._wireframeIndexBuffer=i.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},o.GlyphManager=uu,o.ImagePosition=_d,o.LineAtlas=jf,o.LngLat=$i,o.LngLatBounds=vl,o.LocalGlyphMode=Sf,o.MAX_MERCATOR_LATITUDE=$a,o.MercatorCoordinate=Ro,o.ONE_EM=Gn,o.OverscaledTileID=Jn,o.Properties=He,o.RGBAImage=Uo,o.Ray=ed,o.RequestManager=class{constructor(i,e,t){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!t,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",io,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!gn(i))return i;const t=An(i);return t.path=`/styles/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!gn(i))return i;const t=An(i);return t.path=`/fonts/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeSourceURL(i,e,t,n){if(!gn(i))return i;const a=An(i);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),t&&a.params.push(`language=${t}`),n&&a.params.push(`worldview=${n}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(i,e,t,n){const a=An(i);return gn(i)?(a.path=`/styles/v1${a.path}/sprite${e}${t}`,this._makeAPIURL(a,this._customAccessToken||n)):(a.path+=`${e}${t}`,Sn(a))}normalizeTileURL(i,e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!gn(i))return i;const n=An(i);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||t&&n.authority!=="raster"&&t===512?"@2x":""}${kr.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${Qt.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${Qt.TILE_URL_VERSION}${n.path}`);const a=this._customAccessToken||function(u){for(const d of u){const p=d.match(/^access_token=(.*)$/);if(p)return p[1]}return null}(n.params)||Qt.ACCESS_TOKEN;return Qt.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,a)}canonicalizeTileURL(i,e){const t=An(i);if(!t.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!t.path.match(/\.[\w]+$/))return i;let n="mapbox://";t.path.match(/^\/raster\/v1\//)?n+=`raster/${t.path.replace(`/${Qt.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${t.path.replace(`/${Qt.TILE_URL_VERSION}/`,"")}`;let a=t.params;return e&&(a=a.filter(u=>!u.match(/^access_token=/))),a.length&&(n+=`?${a.join("&")}`),n}canonicalizeTileset(i,e){const t=!!e&&gn(e),n=[];for(const a of i.tiles||[])Xo(a)?n.push(this.canonicalizeTileURL(a,t)):n.push(a);return n}_makeAPIURL(i,e){const t="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=An(Qt.API_URL);if(i.protocol=n.protocol,i.authority=n.authority,i.protocol==="http"){const a=i.params.indexOf("secure");a>=0&&i.params.splice(a,1)}if(n.path!=="/"&&(i.path=`${n.path}${i.path}`),!Qt.REQUIRE_ACCESS_TOKEN)return Sn(i);if(e=e||Qt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${t}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${t}`)}return i.params=i.params.filter(a=>a.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),Sn(i)}},o.ResourceType=be,o.SegmentVector=en,o.SourceCache=To,o.StencilMode=bo,o.StructArrayLayout1ui2=ma,o.StructArrayLayout2f1f2i16=Os,o.StructArrayLayout2i4=wt,o.StructArrayLayout2ui4=Vn,o.StructArrayLayout3f12=pr,o.StructArrayLayout3ui6=gi,o.StructArrayLayout4i8=Nt,o.StructArrayLayout5f20=jn,o.Texture=uh,o.Tile=V,o.Transitionable=se,o.Uniform1f=Bu,o.Uniform1i=class extends fo{constructor(i){super(i),this.current=0}set(i,e,t){this.fetchUniformLocation(i,e)&&this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},o.Uniform2f=class extends fo{constructor(i){super(i),this.current=[0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1])))}},o.Uniform3f=class extends fo{constructor(i){super(i),this.current=[0,0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2])))}},o.Uniform4f=Wd,o.UniformColor=Uh,o.UniformMatrix2f=class extends fo{constructor(i){super(i),this.current=u_}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let n=0;n<4;n++)if(t[n]!==this.current[n]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}}},o.UniformMatrix3f=class extends fo{constructor(i){super(i),this.current=c_}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let n=0;n<9;n++)if(t[n]!==this.current[n]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}}},o.UniformMatrix4f=class extends fo{constructor(i){super(i),this.current=l_}set(i,e,t){if(this.fetchUniformLocation(i,e)){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let n=1;n<16;n++)if(t[n]!==this.current[n]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}}},o.UnwrappedTileID=pf,o.ValidationError=St,o.VectorTileWorkerSource=class extends Ft{constructor(i,e,t,n,a){super(),this.actor=i,this.layerIndex=e,this.availableImages=t,this.loadVectorData=a||ov,this.loading={},this.loaded={},this.deduped=new nv(i.scheduler),this.isSpriteLoaded=n,this.scheduler=i.scheduler}loadTile(i,e){const t=i.uid,n=i&&i.request,a=n&&n.collectResourceTiming,u=this.loading[t]=new _0(i);u.abort=this.loadVectorData(i,(d,p)=>{const g=!this.loading[t];if(delete this.loading[t],g||d||!p)return u.status="done",g||(this.loaded[t]=u),e(d);const y=p.rawData,T={};p.expires&&(T.expires=p.expires),p.cacheControl&&(T.cacheControl=p.cacheControl),u.vectorTile=p.vectorTile||new Ql.VectorTile(new js(y));const S=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(C,O)=>{if(C||!O)return e(C);const F={};if(a){const $=_n(n);$.length>0&&(F.resourceTiming=JSON.parse(JSON.stringify($)))}e(null,At({rawTileData:y.slice(0)},O,T,F))})};this.isSpriteLoaded?S():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(S,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):S()}),this.loaded=this.loaded||{},this.loaded[t]=u})}reloadTile(i,e){const t=this.loaded,n=i.uid,a=this;if(t&&t[n]){const u=t[n];u.showCollisionBoxes=i.showCollisionBoxes,u.enableTerrain=!!i.enableTerrain,u.projection=i.projection,u.tileTransform=zc(i.tileID.canonical,i.projection);const d=(p,g)=>{const y=u.reloadCallback;y&&(delete u.reloadCallback,u.parse(u.vectorTile,a.layerIndex,this.availableImages,a.actor,y)),e(p,g)};u.status==="parsing"?u.reloadCallback=d:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,d):d())}}abortTile(i,e){const t=i.uid,n=this.loading[t];n&&(n.abort&&n.abort(),delete this.loading[t]),e()}removeTile(i,e){const t=this.loaded,n=i.uid;t&&t[n]&&delete t[n],e()}},o.WritingMode=Ir,o.ZoomHistory=Ih,o.add=Fs,o.addDynamicAttributes=ch,o.adjoint=function(i,e){var t=e[0],n=e[1],a=e[2],u=e[3],d=e[4],p=e[5],g=e[6],y=e[7],T=e[8];return i[0]=d*T-p*y,i[1]=a*y-n*T,i[2]=n*p-a*d,i[3]=p*g-u*T,i[4]=t*T-a*g,i[5]=a*u-t*p,i[6]=u*y-d*g,i[7]=n*g-t*y,i[8]=t*d-n*u,i},o.asyncAll=xt,o.bezier=Oe,o.bindAll=wn,o.boundsAttributes=b,o.bufferConvexPolygon=function(i,e){const t=[];for(let n=0;n<i.length;n++){const a=Pi(n-1,-1,i.length-1),u=Pi(n+1,-1,i.length-1),d=i[n],p=i[u],g=i[a].sub(d).unit(),y=p.sub(d).unit(),T=y.angleWithSep(g.x,g.y),S=g.add(y).unit().mult(-1*e/Math.sin(T/2));t.push(d.add(S))}return t},o.cacheEntryPossiblyAdded=function(i){ue++,ue>zl&&(i.getActor().send("enforceCacheSizeLimit",Co),ue=0)},o.calculateGlobeLabelMatrix=function(i,e){const{x:t,y:n}=i.point,a=Am(t,n,i.worldSize/i._pixelsPerMercatorPixel,0,0);return Za(a,a,Df(Ya(e)))},o.calculateGlobeMatrix=function(i){const{x:e,y:t}=i.point,{lng:n,lat:a}=i._center;return Am(e,t,i.worldSize,n,a)},o.calculateGlobeMercatorMatrix=function(i){const e=i.pixelsPerMeter,t=e/us(1,i.center.lat),n=qa(new Float64Array(16));return tu(n,n,[i.point.x,i.point.y,0]),Jl(n,n,[t,t,e]),Float32Array.from(n)},o.circumferenceAtLatitude=Nu,o.clamp=Ye,o.clearTileCache=function(i){const e=oe(),t=[];for(const n in In)e&&t.push(e.delete(n)),delete In[n];i&&Promise.all(t).catch(i).then(()=>i())},o.clipLine=cm,o.clone=function(i){var e=new Bo(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.clone$1=pn,o.collisionCircleLayout=rg,o.config=Qt,o.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},o.create=function(){var i=new Bo(16);return Bo!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.create$1=Hh,o.createExpression=Da,o.createLayout=Qe,o.createStyleLayer=function(i){return i.type==="custom"?new kg(i):new Lg[i.type](i)},o.cross=Qh,o.degToRad=it,o.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},o.div=function(i,e,t){return i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},o.dot=Ns,o.ease=qe,o.easeCubicInOut=je,o.emitValidationErrors=Na,o.endsWith=Dn,o.enforceCacheSizeLimit=function(i){for(const e in In)N(e),In[e].then(t=>{t.keys().then(n=>{for(let a=0;a<n.length-i;a++)t.delete(n[a])})})},o.evaluateSizeForFeature=No,o.evaluateSizeForZoom=au,o.evaluateVariableOffset=mm,o.evented=j,o.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},o.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},o.exported=Xn,o.exported$1=kr,o.extend=At,o.extend$1=sn,o.fillExtrusionHeightLift=Gp,o.filterObject=ps,o.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},o.fromQuat=function(i,e){var t=e[0],n=e[1],a=e[2],u=e[3],d=t+t,p=n+n,g=a+a,y=t*d,T=n*d,S=n*p,C=a*d,O=a*p,F=a*g,$=u*d,Y=u*p,ae=u*g;return i[0]=1-S-F,i[1]=T+ae,i[2]=C-Y,i[3]=0,i[4]=T-ae,i[5]=1-y-F,i[6]=O+$,i[7]=0,i[8]=C+Y,i[9]=O-$,i[10]=1-y-S,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.fromRotation=function(i,e){var t=Math.sin(e),n=Math.cos(e);return i[0]=n,i[1]=t,i[2]=0,i[3]=-t,i[4]=n,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},o.fromScaling=_p,o.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return Ie[e]},o.getAABBPointSquareDist=function(i,e,t){let n=0;for(let a=0;a<2;++a){const u=t?t[a]:0;i[a]>u&&(n+=(i[a]-u)*(i[a]-u)),e[a]<u&&(n+=(u-e[a])*(u-e[a]))}return n},o.getAnchorAlignment=yd,o.getAnchorJustification=Mf,o.getBounds=function(i){let e=1/0,t=1/0,n=-1/0,a=-1/0;for(const u of i)e=Math.min(e,u.x),t=Math.min(t,u.y),n=Math.max(n,u.x),a=Math.max(a,u.y);return{min:new ce(e,t),max:new ce(n,a)}},o.getColumn=zr,o.getGridMatrix=function(i,e,t){const n=e.getNorth(),a=e.getSouth(),u=e.getWest(),d=.015625;return[0,(e.getEast()-u)*d,1<<i.z,(a-n)/pu[t],0,i.y,n,u,d]},o.getImage=Wt,o.getJSON=function(i,e){return Te(At(i,{type:"json"}),e)},o.getLatitudinalLod=function(i){const e=80.051129;i=Ye(i,-80.051129,e)/e*90;const t=Math.pow(Math.abs(Math.sin(it(i))),3);return Math.round(t*(pu.length-1))},o.getMapSessionAPI=gs,o.getPerformanceMeasurement=_n,o.getProjection=Md,o.getRTLTextPluginStatus=Z,o.getReferrer=Me,o.getTilePoint=function(i,{x:e,y:t},n=0){return new ce(((e-n)*i.scale-i.x)*Xt,(t*i.scale-i.y)*Xt)},o.getTileVec3=function(i,e,t=0){return Ac(((e.x-t)*i.scale-i.x)*Xt,(e.y*i.scale-i.y)*Xt,Gh(e.z,e.y))},o.getVideo=function(i,e){const t=Q.document.createElement("video");t.muted=!0,t.onloadstart=function(){e(null,t)};for(let n=0;n<i.length;n++){const a=Q.document.createElement("source");lt(i[n])||(t.crossOrigin="Anonymous"),a.src=i[n],t.appendChild(a)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(i){const e=[0,0,0],t=qa(new Float64Array(16));return Za(t,i.pixelMatrix,i.globeMatrix),dn(e,e,t),new ce(e[0],e[1])},o.globeDenormalizeECEF=Df,o.globeECEFOrigin=function(i,e){const t=[0,0,0];return dn(t,t,oh(Ya(e.canonical))),dn(t,t,i),t},o.globeNormalizeECEF=oh,o.globePixelsToTileUnits=function(i,e){return Xt/(512*Math.pow(2,i))*Td(Ya(e))},o.globePoleMatrixForTile=function(i,e,t){const n=qa(new Float64Array(16)),a=(e/(1<<i)-.5)*Math.PI*2;return Kh(n,t.globeMatrix,a),Float32Array.from(n)},o.globeTileBounds=Ya,o.globeTiltAtLngLat=Sm,o.globeToMercatorTransition=sh,o.globeUseCustomAntiAliasing=function(i,e,t){const n=sh(t.zoom),a=i.style.map._antialias,u=!!e.extStandardDerivatives,d=e.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return n===0&&!a&&!d&&u},o.identity=qa,o.identity$1=Tp,o.invert=rf,o.isFullscreen=function(){return!!Q.document.fullscreenElement||!!Q.document.webkitFullscreenElement},o.isLngLatBehindGlobe=function(i,e){return Sm(i,e)>Math.PI/2*1.01},o.isMapAuthenticated=function(i){return Ko.has(i)},o.isMapboxURL=gn,o.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!Pr(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=kn,o.len=p_,o.length=Ec,o.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},o.loadVectorTile=ov,o.makeRequest=Te,o.mapValue=function(i,e,t,n,a){return Ye((i-e)/(t-e)*(a-n)+n,n,a)},o.mercatorScale=Hd,o.mercatorXfromLng=cs,o.mercatorYfromLat=xl,o.mercatorZfromAltitude=us,o.mul=yp,o.mul$1=f_,o.multiply=Za,o.multiply$1=function(i,e,t){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],g=e[5],y=e[6],T=e[7],S=e[8],C=t[0],O=t[1],F=t[2],$=t[3],Y=t[4],ae=t[5],pe=t[6],le=t[7],de=t[8];return i[0]=C*n+O*d+F*y,i[1]=C*a+O*p+F*T,i[2]=C*u+O*g+F*S,i[3]=$*n+Y*d+ae*y,i[4]=$*a+Y*p+ae*T,i[5]=$*u+Y*g+ae*S,i[6]=pe*n+le*d+de*y,i[7]=pe*a+le*p+de*T,i[8]=pe*u+le*g+de*S,i},o.multiply$2=of,o.nextPowerOfTwo=Ni,o.normalize=tn,o.normalize$1=function(i,e){var t=e[0],n=e[1],a=e[2],u=e[3],d=t*t+n*n+a*a+u*u;return d>0&&(d=1/Math.sqrt(d)),i[0]=t*d,i[1]=n*d,i[2]=a*d,i[3]=u*d,i},o.number=ui,o.ortho=function(i,e,t,n,a,u,d){var p=1/(e-t),g=1/(n-a),y=1/(u-d);return i[0]=-2*p,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*y,i[11]=0,i[12]=(e+t)*p,i[13]=(a+n)*g,i[14]=(d+u)*y,i[15]=1,i},o.pbf=js,o.perspective=function(i,e,t,n,a){var u,d=1/Math.tan(e/2);return i[0]=d/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,a!=null&&a!==1/0?(i[10]=(a+n)*(u=1/(n-a)),i[14]=2*a*n*u):(i[10]=-1,i[14]=-2*n),i},o.pick=function(i,e){const t={};for(let n=0;n<e.length;n++){const a=e[n];a in i&&(t[a]=i[a])}return t},o.plugin=ee,o.pointGeometry=ce,o.polygonContainsPoint=wc,o.polygonIntersectsBox=tf,o.polygonIntersectsPolygon=ri,o.polygonizeBounds=function(i,e,t=0,n=!0){const a=new ce(t,t),u=i.sub(a),d=e.add(a),p=[u,new ce(d.x,u.y),d,new ce(u.x,d.y)];return n&&p.push(u.clone()),p},o.posAttributes=Ka,o.postMapLoadEvent=_s,o.postTurnstileEvent=Dr,o.potpack=wf,o.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},o.radToDeg=Ze,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(i){return i({pluginStatus:w,pluginURL:A}),j.on("pluginStateChange",i),i},o.removeAuthState=function(i){Ko.delete(i)},o.renderColorRamp=id,o.resample=Kd,o.rotateX=nf,o.rotateX$1=Ep,o.rotateY=Kh,o.rotateY$1=sf,o.rotateZ=function(i,e,t){var n=Math.sin(t),a=Math.cos(t),u=e[0],d=e[1],p=e[2],g=e[3],y=e[4],T=e[5],S=e[6],C=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*a+y*n,i[1]=d*a+T*n,i[2]=p*a+S*n,i[3]=g*a+C*n,i[4]=y*a-u*n,i[5]=T*a-d*n,i[6]=S*a-p*n,i[7]=C*a-g*n,i},o.rotateZ$1=function(i,e,t){t*=.5;var n=e[0],a=e[1],u=e[2],d=e[3],p=Math.sin(t),g=Math.cos(t);return i[0]=n*g+a*p,i[1]=a*g-n*p,i[2]=u*g+d*p,i[3]=d*g-u*p,i},o.scale=Jl,o.scale$1=bp,o.scale$2=Us,o.scaleAndAdd=hs,o.setCacheLimits=function(i,e){Co=i,zl=e},o.setColumn=function(i,e,t){i[4*e+0]=t[0],i[4*e+1]=t[1],i[4*e+2]=t[2],i[4*e+3]=t[3]},o.setRTLTextPlugin=function(i,e,t=!1){if(w===h||w===m||w===_)throw new Error("setRTLTextPlugin cannot be called multiple times.");A=Xn.resolveURL(i),w=h,x=e,k(),t||te()},o.smoothstep=ci,o.spec=$e,o.storeAuthState=function(i,e){e?Ko.add(i):Ko.delete(i)},o.sub=va,o.subtract=ju,o.symbolSize=ng,o.tileAABB=function(i,e,t,n,a,u,d,p,g){if(g.name==="globe")return vg(i,e,new ud(t,n,a));const y=zc({z:t,x:n,y:a},g);return new xo([(u+y.x/y.scale)*e,e*(y.y/y.scale),d],[(u+y.x2/y.scale)*e,e*(y.y2/y.scale),p])},o.tileCornersToBounds=bd,o.tileTransform=zc,o.transformMat3=function(i,e,t){var n=e[0],a=e[1],u=e[2];return i[0]=n*t[0]+a*t[3]+u*t[6],i[1]=n*t[1]+a*t[4]+u*t[7],i[2]=n*t[2]+a*t[5]+u*t[8],i},o.transformMat4=dn,o.transformMat4$1=Sc,o.transformQuat=xp,o.transitionTileAABBinECEF=wm,o.translate=tu,o.transpose=function(i,e){if(i===e){var t=e[1],n=e[2],a=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=n,i[7]=a}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},o.triggerPluginCompletionEvent=P,o.uniqueId=Yt,o.updateGlobeVertexNormal=function(i,e,t,n,a){const u=5*e+2;i.float32[u+0]=t,i.float32[u+1]=n,i.float32[u+2]=a},o.validateCustomStyleLayer=function(i){const e=[],t=i.id;return t===void 0&&e.push({message:`layers.${t}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${t}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${t}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=i=>X(hl(i)),o.validateFog=i=>X(Eh(i)),o.validateLayer=i=>X(ha(i)),o.validateLight=i=>X(dl(i)),o.validateSource=i=>X(hc(i)),o.validateStyle=fl,o.validateTerrain=i=>X(Vc(i)),o.values=bt,o.vectorTile=Ql,o.version=_o,o.warnOnce=_r,o.window=Q,o.wrap=Pi}),U(["./shared"],function(o){function Q(oe){if(typeof oe=="number"||typeof oe=="boolean"||typeof oe=="string"||oe==null)return JSON.stringify(oe);if(Array.isArray(oe)){let G="[";for(const ne of oe)G+=`${Q(ne)},`;return`${G}]`}let N="{";for(const G of Object.keys(oe).sort())N+=`${G}:${Q(oe[G])},`;return`${N}}`}function me(oe){let N="";for(const G of o.refProperties)N+=`/${Q(oe[G])}`;return N}class Ce{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,G){for(const ue of N)this._layerConfigs[ue.id]=ue,(this._layers[ue.id]=o.createStyleLayer(ue)).compileFilter(),this.keyCache[ue.id]&&delete this.keyCache[ue.id];for(const ue of G)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const ne=function(ue,be){const ze={};for(let Te=0;Te<ue.length;Te++){const ke=be&&be[ue[Te].id]||me(ue[Te]);be&&(be[ue[Te].id]=ke);let nt=ze[ke];nt||(nt=ze[ke]=[]),nt.push(ue[Te])}const Me=[];for(const Te in ze)Me.push(ze[Te]);return Me}(o.values(this._layerConfigs),this.keyCache);for(const ue of ne){const be=ue.map(Mt=>this._layers[Mt.id]),ze=be[0];if(ze.visibility==="none")continue;const Me=ze.source||"";let Te=this.familiesBySource[Me];Te||(Te=this.familiesBySource[Me]={});const ke=ze.sourceLayer||"_geojsonTileLayer";let nt=Te[ke];nt||(nt=Te[ke]=[]),nt.push(be)}}}class ce{loadTile(N,G){const{uid:ne,encoding:ue,rawImageData:be,padding:ze,buildQuadTree:Me}=N,Te=o.window.ImageBitmap&&be instanceof o.window.ImageBitmap?this.getImageData(be,ze):be;G(null,new o.DEMData(ne,Te,ue,ze<1,Me))}getImageData(N,G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);const ne=this.offscreenCanvasContext.getImageData(-G,-G,N.width+2*G,N.height+2*G);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ne}}var Ue=function oe(N,G){var ne,ue=N&&N.type;if(ue==="FeatureCollection")for(ne=0;ne<N.features.length;ne++)oe(N.features[ne],G);else if(ue==="GeometryCollection")for(ne=0;ne<N.geometries.length;ne++)oe(N.geometries[ne],G);else if(ue==="Feature")oe(N.geometry,G);else if(ue==="Polygon")We(N.coordinates,G);else if(ue==="MultiPolygon")for(ne=0;ne<N.coordinates.length;ne++)We(N.coordinates[ne],G);return N};function We(oe,N){if(oe.length!==0){ot(oe[0],N);for(var G=1;G<oe.length;G++)ot(oe[G],!N)}}function ot(oe,N){for(var G=0,ne=0,ue=0,be=oe.length,ze=be-1;ue<be;ze=ue++){var Me=(oe[ue][0]-oe[ze][0])*(oe[ze][1]+oe[ue][1]),Te=G+Me;ne+=Math.abs(G)>=Math.abs(Me)?G-Te+Me:Me-Te+G,G=Te}G+ne>=0!=!!N&&oe.reverse()}const it=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ze{constructor(N){this._feature=N,this.extent=o.EXTENT,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))}loadGeometry(){if(this._feature.type===1){const N=[];for(const G of this._feature.geometry)N.push([new o.pointGeometry(G[0],G[1])]);return N}{const N=[];for(const G of this._feature.geometry){const ne=[];for(const ue of G)ne.push(new o.pointGeometry(ue[0],ue[1]));N.push(ne)}return N}}toGeoJSON(N,G,ne){return it.call(this,N,G,ne)}}class Ie{constructor(N){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=N.length,this._features=N}feature(N){return new Ze(this._features[N])}}var je=o.vectorTile.VectorTileFeature,Oe=qe;function qe(oe,N){this.options=N||{},this.features=oe,this.length=oe.length}function Ye(oe,N){this.id=typeof oe.id=="number"?oe.id:void 0,this.type=oe.type,this.rawGeometry=oe.type===1?[oe.geometry]:oe.geometry,this.properties=oe.tags,this.extent=N||4096}qe.prototype.feature=function(oe){return new Ye(this.features[oe],this.options.extent)},Ye.prototype.loadGeometry=function(){var oe=this.rawGeometry;this.geometry=[];for(var N=0;N<oe.length;N++){for(var G=oe[N],ne=[],ue=0;ue<G.length;ue++)ne.push(new o.pointGeometry(G[ue][0],G[ue][1]));this.geometry.push(ne)}return this.geometry},Ye.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var oe=this.geometry,N=1/0,G=-1/0,ne=1/0,ue=-1/0,be=0;be<oe.length;be++)for(var ze=oe[be],Me=0;Me<ze.length;Me++){var Te=ze[Me];N=Math.min(N,Te.x),G=Math.max(G,Te.x),ne=Math.min(ne,Te.y),ue=Math.max(ue,Te.y)}return[N,ne,G,ue]},Ye.prototype.toGeoJSON=je.prototype.toGeoJSON;var ci=xt,Pi=Oe;function xt(oe){var N=new o.pbf;return function(G,ne){for(var ue in G.layers)ne.writeMessage(3,bt,G.layers[ue])}(oe,N),N.finish()}function bt(oe,N){var G;N.writeVarintField(15,oe.version||1),N.writeStringField(1,oe.name||""),N.writeVarintField(5,oe.extent||4096);var ne={keys:[],values:[],keycache:{},valuecache:{}};for(G=0;G<oe.length;G++)ne.feature=oe.feature(G),N.writeMessage(2,At,ne);var ue=ne.keys;for(G=0;G<ue.length;G++)N.writeStringField(3,ue[G]);var be=ne.values;for(G=0;G<be.length;G++)N.writeMessage(4,mr,be[G])}function At(oe,N){var G=oe.feature;G.id!==void 0&&N.writeVarintField(1,G.id),N.writeMessage(2,vt,oe),N.writeVarintField(3,G.type),N.writeMessage(4,Ni,G)}function vt(oe,N){var G=oe.feature,ne=oe.keys,ue=oe.values,be=oe.keycache,ze=oe.valuecache;for(var Me in G.properties){var Te=G.properties[Me],ke=be[Me];if(Te!==null){ke===void 0&&(ne.push(Me),be[Me]=ke=ne.length-1),N.writeVarint(ke);var nt=typeof Te;nt!=="string"&&nt!=="boolean"&&nt!=="number"&&(Te=JSON.stringify(Te));var Mt=nt+":"+Te,lt=ze[Mt];lt===void 0&&(ue.push(Te),ze[Mt]=lt=ue.length-1),N.writeVarint(lt)}}}function Yt(oe,N){return(N<<3)+(7&oe)}function ei(oe){return oe<<1^oe>>31}function Ni(oe,N){for(var G=oe.loadGeometry(),ne=oe.type,ue=0,be=0,ze=G.length,Me=0;Me<ze;Me++){var Te=G[Me],ke=1;ne===1&&(ke=Te.length),N.writeVarint(Yt(1,ke));for(var nt=ne===3?Te.length-1:Te.length,Mt=0;Mt<nt;Mt++){Mt===1&&ne!==1&&N.writeVarint(Yt(2,nt-1));var lt=Te[Mt].x-ue,$t=Te[Mt].y-be;N.writeVarint(ei(lt)),N.writeVarint(ei($t)),ue+=lt,be+=$t}ne===3&&N.writeVarint(Yt(7,1))}}function mr(oe,N){var G=typeof oe;G==="string"?N.writeStringField(1,oe):G==="boolean"?N.writeBooleanField(7,oe):G==="number"&&(oe%1!=0?N.writeDoubleField(3,oe):oe<0?N.writeSVarintField(6,oe):N.writeVarintField(5,oe))}function wn(oe,N,G,ne,ue,be){if(ue-ne<=G)return;const ze=ne+ue>>1;Dn(oe,N,ze,ne,ue,be%2),wn(oe,N,G,ne,ze-1,be+1),wn(oe,N,G,ze+1,ue,be+1)}function Dn(oe,N,G,ne,ue,be){for(;ue>ne;){if(ue-ne>600){const ke=ue-ne+1,nt=G-ne+1,Mt=Math.log(ke),lt=.5*Math.exp(2*Mt/3),$t=.5*Math.sqrt(Mt*lt*(ke-lt)/ke)*(nt-ke/2<0?-1:1);Dn(oe,N,G,Math.max(ne,Math.floor(G-nt*lt/ke+$t)),Math.min(ue,Math.floor(G+(ke-nt)*lt/ke+$t)),be)}const ze=N[2*G+be];let Me=ne,Te=ue;for(xr(oe,N,ne,G),N[2*ue+be]>ze&&xr(oe,N,ne,ue);Me<Te;){for(xr(oe,N,Me,Te),Me++,Te--;N[2*Me+be]<ze;)Me++;for(;N[2*Te+be]>ze;)Te--}N[2*ne+be]===ze?xr(oe,N,ne,Te):(Te++,xr(oe,N,Te,ue)),Te<=G&&(ne=Te+1),G<=Te&&(ue=Te-1)}}function xr(oe,N,G,ne){ps(oe,G,ne),ps(N,2*G,2*ne),ps(N,2*G+1,2*ne+1)}function ps(oe,N,G){const ne=oe[N];oe[N]=oe[G],oe[G]=ne}function pn(oe,N,G,ne){const ue=oe-G,be=N-ne;return ue*ue+be*be}ci.fromVectorTileJs=xt,ci.fromGeojsonVt=function(oe,N){N=N||{};var G={};for(var ne in oe)G[ne]=new Oe(oe[ne].features,N),G[ne].name=ne,G[ne].version=N.version,G[ne].extent=N.extent;return xt({layers:G})},ci.GeoJSONWrapper=Pi;const Tn=oe=>oe[0],_r=oe=>oe[1];class mn{constructor(N,G=Tn,ne=_r,ue=64,be=Float64Array){this.nodeSize=ue,this.points=N;const ze=N.length<65536?Uint16Array:Uint32Array,Me=this.ids=new ze(N.length),Te=this.coords=new be(2*N.length);for(let ke=0;ke<N.length;ke++)Me[ke]=ke,Te[2*ke]=G(N[ke]),Te[2*ke+1]=ne(N[ke]);wn(Me,Te,ue,0,Me.length-1,0)}range(N,G,ne,ue){return function(be,ze,Me,Te,ke,nt,Mt){const lt=[0,be.length-1,0],$t=[];let Vt,Ut;for(;lt.length;){const Wt=lt.pop(),oi=lt.pop(),ji=lt.pop();if(oi-ji<=Mt){for(let Ft=ji;Ft<=oi;Ft++)Vt=ze[2*Ft],Ut=ze[2*Ft+1],Vt>=Me&&Vt<=ke&&Ut>=Te&&Ut<=nt&&$t.push(be[Ft]);continue}const Zi=Math.floor((ji+oi)/2);Vt=ze[2*Zi],Ut=ze[2*Zi+1],Vt>=Me&&Vt<=ke&&Ut>=Te&&Ut<=nt&&$t.push(be[Zi]);const xi=(Wt+1)%2;(Wt===0?Me<=Vt:Te<=Ut)&&(lt.push(ji),lt.push(Zi-1),lt.push(xi)),(Wt===0?ke>=Vt:nt>=Ut)&&(lt.push(Zi+1),lt.push(oi),lt.push(xi))}return $t}(this.ids,this.coords,N,G,ne,ue,this.nodeSize)}within(N,G,ne){return function(ue,be,ze,Me,Te,ke){const nt=[0,ue.length-1,0],Mt=[],lt=Te*Te;for(;nt.length;){const $t=nt.pop(),Vt=nt.pop(),Ut=nt.pop();if(Vt-Ut<=ke){for(let xi=Ut;xi<=Vt;xi++)pn(be[2*xi],be[2*xi+1],ze,Me)<=lt&&Mt.push(ue[xi]);continue}const Wt=Math.floor((Ut+Vt)/2),oi=be[2*Wt],ji=be[2*Wt+1];pn(oi,ji,ze,Me)<=lt&&Mt.push(ue[Wt]);const Zi=($t+1)%2;($t===0?ze-Te<=oi:Me-Te<=ji)&&(nt.push(Ut),nt.push(Wt-1),nt.push(Zi)),($t===0?ze+Te>=oi:Me+Te>=ji)&&(nt.push(Wt+1),nt.push(Vt),nt.push(Zi))}return Mt}(this.ids,this.coords,N,G,ne,this.nodeSize)}}const Ao={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:oe=>oe},Zr=Math.fround||(Wn=new Float32Array(1),oe=>(Wn[0]=+oe,Wn[0]));var Wn;class So{constructor(N){this.options=Wr(Object.create(Ao),N),this.trees=new Array(this.options.maxZoom+1)}load(N){const{log:G,minZoom:ne,maxZoom:ue,nodeSize:be}=this.options;G&&console.time("total time");const ze=`prepare ${N.length} points`;G&&console.time(ze),this.points=N;let Me=[];for(let Te=0;Te<N.length;Te++)N[Te].geometry&&Me.push(Ln(N[Te],Te));this.trees[ue+1]=new mn(Me,Wo,Xr,be,Float32Array),G&&console.timeEnd(ze);for(let Te=ue;Te>=ne;Te--){const ke=+Date.now();Me=this._cluster(Me,Te),this.trees[Te]=new mn(Me,Wo,Xr,be,Float32Array),G&&console.log("z%d: %d clusters in %dms",Te,Me.length,+Date.now()-ke)}return G&&console.timeEnd("total time"),this}getClusters(N,G){let ne=((N[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,N[1]));let be=N[2]===180?180:((N[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)ne=-180,be=180;else if(ne>be){const nt=this.getClusters([ne,ue,180,ze],G),Mt=this.getClusters([-180,ue,be,ze],G);return nt.concat(Mt)}const Me=this.trees[this._limitZoom(G)],Te=Me.range(_n(ne),_o(ze),_n(be),_o(ue)),ke=[];for(const nt of Te){const Mt=Me.points[nt];ke.push(Mt.numPoints?zr(Mt):this.points[Mt.index])}return ke}getChildren(N){const G=this._getOriginId(N),ne=this._getOriginZoom(N),ue="No cluster with the specified id.",be=this.trees[ne];if(!be)throw new Error(ue);const ze=be.points[G];if(!ze)throw new Error(ue);const Me=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),Te=be.within(ze.x,ze.y,Me),ke=[];for(const nt of Te){const Mt=be.points[nt];Mt.parentId===N&&ke.push(Mt.numPoints?zr(Mt):this.points[Mt.index])}if(ke.length===0)throw new Error(ue);return ke}getLeaves(N,G,ne){const ue=[];return this._appendLeaves(ue,N,G=G||10,ne=ne||0,0),ue}getTile(N,G,ne){const ue=this.trees[this._limitZoom(N)],be=Math.pow(2,N),{extent:ze,radius:Me}=this.options,Te=Me/ze,ke=(ne-Te)/be,nt=(ne+1+Te)/be,Mt={features:[]};return this._addTileFeatures(ue.range((G-Te)/be,ke,(G+1+Te)/be,nt),ue.points,G,ne,be,Mt),G===0&&this._addTileFeatures(ue.range(1-Te/be,ke,1,nt),ue.points,be,ne,be,Mt),G===be-1&&this._addTileFeatures(ue.range(0,ke,Te/be,nt),ue.points,-1,ne,be,Mt),Mt.features.length?Mt:null}getClusterExpansionZoom(N){let G=this._getOriginZoom(N)-1;for(;G<=this.options.maxZoom;){const ne=this.getChildren(N);if(G++,ne.length!==1)break;N=ne[0].properties.cluster_id}return G}_appendLeaves(N,G,ne,ue,be){const ze=this.getChildren(G);for(const Me of ze){const Te=Me.properties;if(Te&&Te.cluster?be+Te.point_count<=ue?be+=Te.point_count:be=this._appendLeaves(N,Te.cluster_id,ne,ue,be):be<ue?be++:N.push(Me),N.length===ne)break}return be}_addTileFeatures(N,G,ne,ue,be,ze){for(const Me of N){const Te=G[Me],ke=Te.numPoints;let nt,Mt,lt;if(ke)nt=ms(Te),Mt=Te.x,lt=Te.y;else{const Ut=this.points[Te.index];nt=Ut.properties,Mt=_n(Ut.geometry.coordinates[0]),lt=_o(Ut.geometry.coordinates[1])}const $t={type:1,geometry:[[Math.round(this.options.extent*(Mt*be-ne)),Math.round(this.options.extent*(lt*be-ue))]],tags:nt};let Vt;ke?Vt=Te.id:this.options.generateId?Vt=Te.index:this.points[Te.index].id&&(Vt=this.points[Te.index].id),Vt!==void 0&&($t.id=Vt),ze.features.push($t)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(+N,this.options.maxZoom+1))}_cluster(N,G){const ne=[],{radius:ue,extent:be,reduce:ze,minPoints:Me}=this.options,Te=ue/(be*Math.pow(2,G));for(let ke=0;ke<N.length;ke++){const nt=N[ke];if(nt.zoom<=G)continue;nt.zoom=G;const Mt=this.trees[G+1],lt=Mt.within(nt.x,nt.y,Te),$t=nt.numPoints||1;let Vt=$t;for(const Ut of lt){const Wt=Mt.points[Ut];Wt.zoom>G&&(Vt+=Wt.numPoints||1)}if(Vt>$t&&Vt>=Me){let Ut=nt.x*$t,Wt=nt.y*$t,oi=ze&&$t>1?this._map(nt,!0):null;const ji=(ke<<5)+(G+1)+this.points.length;for(const Zi of lt){const xi=Mt.points[Zi];if(xi.zoom<=G)continue;xi.zoom=G;const Ft=xi.numPoints||1;Ut+=xi.x*Ft,Wt+=xi.y*Ft,xi.parentId=ji,ze&&(oi||(oi=this._map(nt,!0)),ze(oi,this._map(xi)))}nt.parentId=ji,ne.push(Pr(Ut/Vt,Wt/Vt,ji,Vt,oi))}else if(ne.push(nt),Vt>1)for(const Ut of lt){const Wt=Mt.points[Ut];Wt.zoom<=G||(Wt.zoom=G,ne.push(Wt))}}return ne}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,G){if(N.numPoints)return G?Wr({},N.properties):N.properties;const ne=this.points[N.index].properties,ue=this.options.map(ne);return G&&ue===ne?Wr({},ue):ue}}function Pr(oe,N,G,ne,ue){return{x:Zr(oe),y:Zr(N),zoom:1/0,id:G,parentId:-1,numPoints:ne,properties:ue}}function Ln(oe,N){const[G,ne]=oe.geometry.coordinates;return{x:Zr(_n(G)),y:Zr(_o(ne)),zoom:1/0,index:N,parentId:-1}}function zr(oe){return{type:"Feature",id:oe.id,properties:ms(oe),geometry:{type:"Point",coordinates:[(N=oe.x,360*(N-.5)),Kt(oe.y)]}};var N}function ms(oe){const N=oe.numPoints,G=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N;return Wr(Wr({},oe.properties),{cluster:!0,cluster_id:oe.id,point_count:N,point_count_abbreviated:G})}function _n(oe){return oe/360+.5}function _o(oe){const N=Math.sin(oe*Math.PI/180),G=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return G<0?0:G>1?1:G}function Kt(oe){const N=(180-360*oe)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function Wr(oe,N){for(const G in N)oe[G]=N[G];return oe}function Wo(oe){return oe.x}function Xr(oe){return oe.y}function Xn(oe,N,G,ne){for(var ue,be=ne,ze=G-N>>1,Me=G-N,Te=oe[N],ke=oe[N+1],nt=oe[G],Mt=oe[G+1],lt=N+3;lt<G;lt+=3){var $t=En(oe[lt],oe[lt+1],Te,ke,nt,Mt);if($t>be)ue=lt,be=$t;else if($t===be){var Vt=Math.abs(lt-ze);Vt<Me&&(ue=lt,Me=Vt)}}be>ne&&(ue-N>3&&Xn(oe,N,ue,ne),oe[ue+2]=be,G-ue>3&&Xn(oe,ue,G,ne))}function En(oe,N,G,ne,ue,be){var ze=ue-G,Me=be-ne;if(ze!==0||Me!==0){var Te=((oe-G)*ze+(N-ne)*Me)/(ze*ze+Me*Me);Te>1?(G=ue,ne=be):Te>0&&(G+=ze*Te,ne+=Me*Te)}return(ze=oe-G)*ze+(Me=N-ne)*Me}function Qt(oe,N,G,ne){var ue={id:oe===void 0?null:oe,type:N,geometry:G,tags:ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(be){var ze=be.geometry,Me=be.type;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")kr(be,ze);else if(Me==="Polygon"||Me==="MultiLineString")for(var Te=0;Te<ze.length;Te++)kr(be,ze[Te]);else if(Me==="MultiPolygon")for(Te=0;Te<ze.length;Te++)for(var ke=0;ke<ze[Te].length;ke++)kr(be,ze[Te][ke])}(ue),ue}function kr(oe,N){for(var G=0;G<N.length;G+=3)oe.minX=Math.min(oe.minX,N[G]),oe.minY=Math.min(oe.minY,N[G+1]),oe.maxX=Math.max(oe.maxX,N[G]),oe.maxY=Math.max(oe.maxY,N[G+1])}function Er(oe,N,G,ne){if(N.geometry){var ue=N.geometry.coordinates,be=N.geometry.type,ze=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),Me=[],Te=N.id;if(G.promoteId?Te=N.properties[G.promoteId]:G.generateId&&(Te=ne||0),be==="Point")On(ue,Me);else if(be==="MultiPoint")for(var ke=0;ke<ue.length;ke++)On(ue[ke],Me);else if(be==="LineString")Zs(ue,Me,ze,!1);else if(be==="MultiLineString"){if(G.lineMetrics){for(ke=0;ke<ue.length;ke++)Zs(ue[ke],Me=[],ze,!1),oe.push(Qt(Te,"LineString",Me,N.properties));return}Io(ue,Me,ze,!1)}else if(be==="Polygon")Io(ue,Me,ze,!0);else{if(be!=="MultiPolygon"){if(be==="GeometryCollection"){for(ke=0;ke<N.geometry.geometries.length;ke++)Er(oe,{id:Te,geometry:N.geometry.geometries[ke],properties:N.properties},G,ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ke=0;ke<ue.length;ke++){var nt=[];Io(ue[ke],nt,ze,!0),Me.push(nt)}}oe.push(Qt(Te,be,Me,N.properties))}}function On(oe,N){N.push(Ws(oe[0])),N.push(io(oe[1])),N.push(0)}function Zs(oe,N,G,ne){for(var ue,be,ze=0,Me=0;Me<oe.length;Me++){var Te=Ws(oe[Me][0]),ke=io(oe[Me][1]);N.push(Te),N.push(ke),N.push(0),Me>0&&(ze+=ne?(ue*ke-Te*be)/2:Math.sqrt(Math.pow(Te-ue,2)+Math.pow(ke-be,2))),ue=Te,be=ke}var nt=N.length-3;N[2]=1,Xn(N,0,nt,G),N[nt+2]=1,N.size=Math.abs(ze),N.start=0,N.end=N.size}function Io(oe,N,G,ne){for(var ue=0;ue<oe.length;ue++){var be=[];Zs(oe[ue],be,G,ne),N.push(be)}}function Ws(oe){return oe/360+.5}function io(oe){var N=Math.sin(oe*Math.PI/180),G=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return G<0?0:G>1?1:G}function Fr(oe,N,G,ne,ue,be,ze,Me){if(ne/=N,be>=(G/=N)&&ze<ne)return oe;if(ze<G||be>=ne)return null;for(var Te=[],ke=0;ke<oe.length;ke++){var nt=oe[ke],Mt=nt.geometry,lt=nt.type,$t=ue===0?nt.minX:nt.minY,Vt=ue===0?nt.maxX:nt.maxY;if($t>=G&&Vt<ne)Te.push(nt);else if(!(Vt<G||$t>=ne)){var Ut=[];if(lt==="Point"||lt==="MultiPoint")gn(Mt,Ut,G,ne,ue);else if(lt==="LineString")Xo(Mt,Ut,G,ne,ue,!1,Me.lineMetrics);else if(lt==="MultiLineString")An(Mt,Ut,G,ne,ue,!1);else if(lt==="Polygon")An(Mt,Ut,G,ne,ue,!0);else if(lt==="MultiPolygon")for(var Wt=0;Wt<Mt.length;Wt++){var oi=[];An(Mt[Wt],oi,G,ne,ue,!0),oi.length&&Ut.push(oi)}if(Ut.length){if(Me.lineMetrics&&lt==="LineString"){for(Wt=0;Wt<Ut.length;Wt++)Te.push(Qt(nt.id,lt,Ut[Wt],nt.tags));continue}lt!=="LineString"&&lt!=="MultiLineString"||(Ut.length===1?(lt="LineString",Ut=Ut[0]):lt="MultiLineString"),lt!=="Point"&&lt!=="MultiPoint"||(lt=Ut.length===3?"Point":"MultiPoint"),Te.push(Qt(nt.id,lt,Ut,nt.tags))}}}return Te.length?Te:null}function gn(oe,N,G,ne,ue){for(var be=0;be<oe.length;be+=3){var ze=oe[be+ue];ze>=G&&ze<=ne&&(N.push(oe[be]),N.push(oe[be+1]),N.push(oe[be+2]))}}function Xo(oe,N,G,ne,ue,be,ze){for(var Me,Te,ke=Xs(oe),nt=ue===0?Ur:Hr,Mt=oe.start,lt=0;lt<oe.length-3;lt+=3){var $t=oe[lt],Vt=oe[lt+1],Ut=oe[lt+2],Wt=oe[lt+3],oi=oe[lt+4],ji=ue===0?$t:Vt,Zi=ue===0?Wt:oi,xi=!1;ze&&(Me=Math.sqrt(Math.pow($t-Wt,2)+Math.pow(Vt-oi,2))),ji<G?Zi>G&&(Te=nt(ke,$t,Vt,Wt,oi,G),ze&&(ke.start=Mt+Me*Te)):ji>ne?Zi<ne&&(Te=nt(ke,$t,Vt,Wt,oi,ne),ze&&(ke.start=Mt+Me*Te)):Sn(ke,$t,Vt,Ut),Zi<G&&ji>=G&&(Te=nt(ke,$t,Vt,Wt,oi,G),xi=!0),Zi>ne&&ji<=ne&&(Te=nt(ke,$t,Vt,Wt,oi,ne),xi=!0),!be&&xi&&(ze&&(ke.end=Mt+Me*Te),N.push(ke),ke=Xs(oe)),ze&&(Mt+=Me)}var Ft=oe.length-3;$t=oe[Ft],Vt=oe[Ft+1],Ut=oe[Ft+2],(ji=ue===0?$t:Vt)>=G&&ji<=ne&&Sn(ke,$t,Vt,Ut),Ft=ke.length-3,be&&Ft>=3&&(ke[Ft]!==ke[0]||ke[Ft+1]!==ke[1])&&Sn(ke,ke[0],ke[1],ke[2]),ke.length&&N.push(ke)}function Xs(oe){var N=[];return N.size=oe.size,N.start=oe.start,N.end=oe.end,N}function An(oe,N,G,ne,ue,be){for(var ze=0;ze<oe.length;ze++)Xo(oe[ze],N,G,ne,ue,be,!1)}function Sn(oe,N,G,ne){oe.push(N),oe.push(G),oe.push(ne)}function Ur(oe,N,G,ne,ue,be){var ze=(be-N)/(ne-N);return oe.push(be),oe.push(G+(ue-G)*ze),oe.push(1),ze}function Hr(oe,N,G,ne,ue,be){var ze=(be-G)/(ue-G);return oe.push(N+(ne-N)*ze),oe.push(be),oe.push(1),ze}function Kr(oe,N){for(var G=[],ne=0;ne<oe.length;ne++){var ue,be=oe[ne],ze=be.type;if(ze==="Point"||ze==="MultiPoint"||ze==="LineString")ue=Dr(be.geometry,N);else if(ze==="MultiLineString"||ze==="Polygon"){ue=[];for(var Me=0;Me<be.geometry.length;Me++)ue.push(Dr(be.geometry[Me],N))}else if(ze==="MultiPolygon")for(ue=[],Me=0;Me<be.geometry.length;Me++){for(var Te=[],ke=0;ke<be.geometry[Me].length;ke++)Te.push(Dr(be.geometry[Me][ke],N));ue.push(Te)}G.push(Qt(be.id,ze,ue,be.tags))}return G}function Dr(oe,N){var G=[];G.size=oe.size,oe.start!==void 0&&(G.start=oe.start,G.end=oe.end);for(var ne=0;ne<oe.length;ne+=3)G.push(oe[ne]+N,oe[ne+1],oe[ne+2]);return G}function Hs(oe,N){if(oe.transformed)return oe;var G,ne,ue,be=1<<oe.z,ze=oe.x,Me=oe.y;for(G=0;G<oe.features.length;G++){var Te=oe.features[G],ke=Te.geometry,nt=Te.type;if(Te.geometry=[],nt===1)for(ne=0;ne<ke.length;ne+=2)Te.geometry.push(_s(ke[ne],ke[ne+1],N,be,ze,Me));else for(ne=0;ne<ke.length;ne++){var Mt=[];for(ue=0;ue<ke[ne].length;ue+=2)Mt.push(_s(ke[ne][ue],ke[ne][ue+1],N,be,ze,Me));Te.geometry.push(Mt)}}return oe.transformed=!0,oe}function _s(oe,N,G,ne,ue,be){return[Math.round(G*(oe*ne-ue)),Math.round(G*(N*ne-be))]}function Ho(oe,N,G,ne,ue){for(var be=N===ue.maxZoom?0:ue.tolerance/((1<<N)*ue.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:G,y:ne,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Me=0;Me<oe.length;Me++){ze.numFeatures++,gs(ze,oe[Me],be,ue);var Te=oe[Me].minX,ke=oe[Me].minY,nt=oe[Me].maxX,Mt=oe[Me].maxY;Te<ze.minX&&(ze.minX=Te),ke<ze.minY&&(ze.minY=ke),nt>ze.maxX&&(ze.maxX=nt),Mt>ze.maxY&&(ze.maxY=Mt)}return ze}function gs(oe,N,G,ne){var ue=N.geometry,be=N.type,ze=[];if(be==="Point"||be==="MultiPoint")for(var Me=0;Me<ue.length;Me+=3)ze.push(ue[Me]),ze.push(ue[Me+1]),oe.numPoints++,oe.numSimplified++;else if(be==="LineString")Ko(ze,ue,oe,G,!1,!1);else if(be==="MultiLineString"||be==="Polygon")for(Me=0;Me<ue.length;Me++)Ko(ze,ue[Me],oe,G,be==="Polygon",Me===0);else if(be==="MultiPolygon")for(var Te=0;Te<ue.length;Te++){var ke=ue[Te];for(Me=0;Me<ke.length;Me++)Ko(ze,ke[Me],oe,G,!0,Me===0)}if(ze.length){var nt=N.tags||null;if(be==="LineString"&&ne.lineMetrics){for(var Mt in nt={},N.tags)nt[Mt]=N.tags[Mt];nt.mapbox_clip_start=ue.start/ue.size,nt.mapbox_clip_end=ue.end/ue.size}var lt={geometry:ze,type:be==="Polygon"||be==="MultiPolygon"?3:be==="LineString"||be==="MultiLineString"?2:1,tags:nt};N.id!==null&&(lt.id=N.id),oe.features.push(lt)}}function Ko(oe,N,G,ne,ue,be){var ze=ne*ne;if(ne>0&&N.size<(ue?ze:ne))G.numPoints+=N.length/3;else{for(var Me=[],Te=0;Te<N.length;Te+=3)(ne===0||N[Te+2]>ze)&&(G.numSimplified++,Me.push(N[Te]),Me.push(N[Te+1])),G.numPoints++;ue&&function(ke,nt){for(var Mt=0,lt=0,$t=ke.length,Vt=$t-2;lt<$t;Vt=lt,lt+=2)Mt+=(ke[lt]-ke[Vt])*(ke[lt+1]+ke[Vt+1]);if(Mt>0===nt)for(lt=0,$t=ke.length;lt<$t/2;lt+=2){var Ut=ke[lt],Wt=ke[lt+1];ke[lt]=ke[$t-2-lt],ke[lt+1]=ke[$t-1-lt],ke[$t-2-lt]=Ut,ke[$t-1-lt]=Wt}}(Me,be),oe.push(Me)}}function Mo(oe,N){var G=(N=this.options=function(ue,be){for(var ze in be)ue[ze]=be[ze];return ue}(Object.create(this.options),N)).debug;if(G&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var ne=function(ue,be){var ze=[];if(ue.type==="FeatureCollection")for(var Me=0;Me<ue.features.length;Me++)Er(ze,ue.features[Me],be,Me);else Er(ze,ue.type==="Feature"?ue:{geometry:ue},be);return ze}(oe,N);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ne=function(ue,be){var ze=be.buffer/be.extent,Me=ue,Te=Fr(ue,1,-1-ze,ze,0,-1,2,be),ke=Fr(ue,1,1-ze,2+ze,0,-1,2,be);return(Te||ke)&&(Me=Fr(ue,1,-ze,1+ze,0,-1,2,be)||[],Te&&(Me=Kr(Te,1).concat(Me)),ke&&(Me=Me.concat(Kr(ke,-1)))),Me}(ne,N)).length&&this.splitTile(ne,0,0,0),G&&(ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Co(oe,N,G){return 32*((1<<oe)*G+N)+oe}function zl(oe,N){const G=oe.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);const ne=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!ne)return N(null,null);const ue=new Ie(ne.features);let be=ci(ue);be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),N(null,{vectorTile:ue,rawData:be.buffer})}Mo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Mo.prototype.splitTile=function(oe,N,G,ne,ue,be,ze){for(var Me=[oe,N,G,ne],Te=this.options,ke=Te.debug;Me.length;){ne=Me.pop(),G=Me.pop(),N=Me.pop(),oe=Me.pop();var nt=1<<N,Mt=Co(N,G,ne),lt=this.tiles[Mt];if(!lt&&(ke>1&&console.time("creation"),lt=this.tiles[Mt]=Ho(oe,N,G,ne,Te),this.tileCoords.push({z:N,x:G,y:ne}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,G,ne,lt.numFeatures,lt.numPoints,lt.numSimplified),console.timeEnd("creation"));var $t="z"+N;this.stats[$t]=(this.stats[$t]||0)+1,this.total++}if(lt.source=oe,ue){if(N===Te.maxZoom||N===ue)continue;var Vt=1<<ue-N;if(G!==Math.floor(be/Vt)||ne!==Math.floor(ze/Vt))continue}else if(N===Te.indexMaxZoom||lt.numPoints<=Te.indexMaxPoints)continue;if(lt.source=null,oe.length!==0){ke>1&&console.time("clipping");var Ut,Wt,oi,ji,Zi,xi,Ft=.5*Te.buffer/Te.extent,$e=.5-Ft,sn=.5+Ft,ur=1+Ft;Ut=Wt=oi=ji=null,Zi=Fr(oe,nt,G-Ft,G+sn,0,lt.minX,lt.maxX,Te),xi=Fr(oe,nt,G+$e,G+ur,0,lt.minX,lt.maxX,Te),oe=null,Zi&&(Ut=Fr(Zi,nt,ne-Ft,ne+sn,1,lt.minY,lt.maxY,Te),Wt=Fr(Zi,nt,ne+$e,ne+ur,1,lt.minY,lt.maxY,Te),Zi=null),xi&&(oi=Fr(xi,nt,ne-Ft,ne+sn,1,lt.minY,lt.maxY,Te),ji=Fr(xi,nt,ne+$e,ne+ur,1,lt.minY,lt.maxY,Te),xi=null),ke>1&&console.timeEnd("clipping"),Me.push(Ut||[],N+1,2*G,2*ne),Me.push(Wt||[],N+1,2*G,2*ne+1),Me.push(oi||[],N+1,2*G+1,2*ne),Me.push(ji||[],N+1,2*G+1,2*ne+1)}}},Mo.prototype.getTile=function(oe,N,G){var ne=this.options,ue=ne.extent,be=ne.debug;if(oe<0||oe>24)return null;var ze=1<<oe,Me=Co(oe,N=(N%ze+ze)%ze,G);if(this.tiles[Me])return Hs(this.tiles[Me],ue);be>1&&console.log("drilling down to z%d-%d-%d",oe,N,G);for(var Te,ke=oe,nt=N,Mt=G;!Te&&ke>0;)ke--,nt=Math.floor(nt/2),Mt=Math.floor(Mt/2),Te=this.tiles[Co(ke,nt,Mt)];return Te&&Te.source?(be>1&&console.log("found parent tile z%d-%d-%d",ke,nt,Mt),be>1&&console.time("drilling down"),this.splitTile(Te.source,ke,nt,Mt,oe,N,G),be>1&&console.timeEnd("drilling down"),this.tiles[Me]?Hs(this.tiles[Me],ue):null):null};class In extends o.VectorTileWorkerSource{constructor(N,G,ne,ue,be){super(N,G,ne,ue,zl),be&&(this.loadGeoJSON=be)}loadData(N,G){const ne=N&&N.request,ue=ne&&ne.collectResourceTiming;this.loadGeoJSON(N,(be,ze)=>{if(be||!ze)return G(be);if(typeof ze!="object")return G(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));{Ue(ze,!0);try{if(N.filter){const Te=o.createExpression(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Te.result==="error")throw new Error(Te.value.map(nt=>`${nt.key}: ${nt.message}`).join(", "));const ke=ze.features.filter(nt=>Te.value.evaluate({zoom:0},nt));ze={type:"FeatureCollection",features:ke}}this._geoJSONIndex=N.cluster?new So(function({superclusterOptions:Te,clusterProperties:ke}){if(!ke||!Te)return Te;const nt={},Mt={},lt={accumulated:null,zoom:0},$t={properties:null},Vt=Object.keys(ke);for(const Ut of Vt){const[Wt,oi]=ke[Ut],ji=o.createExpression(oi),Zi=o.createExpression(typeof Wt=="string"?[Wt,["accumulated"],["get",Ut]]:Wt);nt[Ut]=ji.value,Mt[Ut]=Zi.value}return Te.map=Ut=>{$t.properties=Ut;const Wt={};for(const oi of Vt)Wt[oi]=nt[oi].evaluate(lt,$t);return Wt},Te.reduce=(Ut,Wt)=>{$t.properties=Wt;for(const oi of Vt)lt.accumulated=Ut[oi],Ut[oi]=Mt[oi].evaluate(lt,$t)},Te}(N)).load(ze.features):function(Te,ke){return new Mo(Te,ke)}(ze,N.geojsonVtOptions)}catch(Te){return G(Te)}this.loaded={};const Me={};if(ue){const Te=o.getPerformanceMeasurement(ne);Te&&(Me.resourceTiming={},Me.resourceTiming[N.source]=JSON.parse(JSON.stringify(Te)))}G(null,Me)}})}reloadTile(N,G){const ne=this.loaded;return ne&&ne[N.uid]?super.reloadTile(N,G):this.loadTile(N,G)}loadGeoJSON(N,G){if(N.request)o.getJSON(N.request,G);else{if(typeof N.data!="string")return G(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));try{return G(null,JSON.parse(N.data))}catch{return G(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(N,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(N.clusterId))}catch(ne){G(ne)}}getClusterChildren(N,G){try{G(null,this._geoJSONIndex.getChildren(N.clusterId))}catch(ne){G(ne)}}getClusterLeaves(N,G){try{G(null,this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset))}catch(ne){G(ne)}}}class Ks{constructor(N){this.self=N,this.actor=new o.Actor(N,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:In},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(G,ne)=>{if(this.workerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.workerSourceTypes[G]=ne},this.self.registerRTLTextPlugin=G=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=G.applyArabicShaping,o.plugin.processBidirectionalText=G.processBidirectionalText,o.plugin.processStyledBidirectionalText=G.processStyledBidirectionalText}}clearCaches(N,G,ne){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N],ne()}checkIfReady(N,G,ne){ne()}setReferrer(N,G){this.referrer=G}spriteLoaded(N,G){this.isSpriteLoaded[N]=G;for(const ne in this.workerSources[N]){const ue=this.workerSources[N][ne];for(const be in ue)ue[be]instanceof o.VectorTileWorkerSource&&(ue[be].isSpriteLoaded=G,ue[be].fire(new o.Event("isSpriteLoaded")))}}setImages(N,G,ne){this.availableImages[N]=G;for(const ue in this.workerSources[N]){const be=this.workerSources[N][ue];for(const ze in be)be[ze].availableImages=G}ne()}enableTerrain(N,G,ne){this.terrain=G,ne()}setProjection(N,G){this.projections[N]=o.getProjection(G)}setLayers(N,G,ne){this.getLayerIndex(N).replace(G),ne()}updateLayers(N,G,ne){this.getLayerIndex(N).update(G.layers,G.removedIds),ne()}loadTile(N,G,ne){const ue=this.enableTerrain?o.extend({enableTerrain:this.terrain},G):G;ue.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,G.type,G.source).loadTile(ue,ne)}loadDEMTile(N,G,ne){const ue=this.enableTerrain?o.extend({buildQuadTree:this.terrain},G):G;this.getDEMWorkerSource(N,G.source).loadTile(ue,ne)}reloadTile(N,G,ne){const ue=this.enableTerrain?o.extend({enableTerrain:this.terrain},G):G;ue.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,G.type,G.source).reloadTile(ue,ne)}abortTile(N,G,ne){this.getWorkerSource(N,G.type,G.source).abortTile(G,ne)}removeTile(N,G,ne){this.getWorkerSource(N,G.type,G.source).removeTile(G,ne)}removeSource(N,G,ne){if(!this.workerSources[N]||!this.workerSources[N][G.type]||!this.workerSources[N][G.type][G.source])return;const ue=this.workerSources[N][G.type][G.source];delete this.workerSources[N][G.type][G.source],ue.removeSource!==void 0?ue.removeSource(G,ne):ne()}loadWorkerSource(N,G,ne){try{this.self.importScripts(G.url),ne()}catch(ue){ne(ue.toString())}}syncRTLPluginState(N,G,ne){try{o.plugin.setState(G);const ue=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ue!=null){this.self.importScripts(ue);const be=o.plugin.isParsed();ne(be?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ue}`),be)}}catch(ue){ne(ue.toString())}}getAvailableImages(N){let G=this.availableImages[N];return G||(G=[]),G}getLayerIndex(N){let G=this.layerIndexes[N];return G||(G=this.layerIndexes[N]=new Ce),G}getWorkerSource(N,G,ne){return this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][G]||(this.workerSources[N][G]={}),this.workerSources[N][G][ne]||(this.workerSources[N][G][ne]=new this.workerSourceTypes[G]({send:(ue,be,ze,Me,Te,ke)=>{this.actor.send(ue,be,ze,N,Te,ke)},scheduler:this.actor.scheduler},this.getLayerIndex(N),this.getAvailableImages(N),this.isSpriteLoaded[N])),this.workerSources[N][G][ne]}getDEMWorkerSource(N,G){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][G]||(this.demWorkerSources[N][G]=new ce),this.demWorkerSources[N][G]}enforceCacheSizeLimit(N,G){o.enforceCacheSizeLimit(G)}getWorkerPerformanceMetrics(N,G,ne){ne(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ks(self)),Ks}),U(["./shared"],function(o){function Q(l,r){if(Array.isArray(l)){if(!Array.isArray(r)||l.length!==r.length)return!1;for(let s=0;s<l.length;s++)if(!Q(l[s],r[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&r!==null){if(typeof r!="object"||Object.keys(l).length!==Object.keys(r).length)return!1;for(const s in l)if(!Q(l[s],r[s]))return!1;return!0}return l===r}var me=Ce;function Ce(l){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,m,_=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(_);try{m=new Worker(x),h=!0}catch{h=!1}return m&&m.terminate(),URL.revokeObjectURL(x),h}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var h=document.createElement("canvas");h.width=h.height=1;var m=h.getContext("2d");if(!m)return!1;var _=m.getImageData(0,0,1,1);return _&&_.width===h.width}()?(ce[s=r&&r.failIfMajorPerformanceCaveat]===void 0&&(ce[s]=function(h){var m,_=function(x){var w=document.createElement("canvas"),A=Object.create(Ce.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=x,w.getContext("webgl",A)||w.getContext("experimental-webgl",A)}(h);if(!_)return!1;try{m=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!m||_.isContextLost())&&(_.shaderSource(m,"void main() {}"),_.compileShader(m),_.getShaderParameter(m,_.COMPILE_STATUS)===!0)}(s)),ce[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(l)}var ce={};function Ue(l,r,s){const h=o.window.document.createElement(l);return r!==void 0&&(h.className=r),s&&s.appendChild(h),h}function We(l,r,s){const h=o.window.document.createElementNS("http://www.w3.org/2000/svg",l);for(const m of Object.keys(r))h.setAttributeNS(null,m,r[m]);return s&&s.appendChild(h),h}Ce.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ot=o.window.document&&o.window.document.documentElement.style,it=ot&&ot.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ze;function Ie(){ot&&it&&(Ze=ot[it],ot[it]="none")}function je(){ot&&it&&(ot[it]=Ze)}function Oe(l){l.preventDefault(),l.stopPropagation(),o.window.removeEventListener("click",Oe,!0)}function qe(){o.window.addEventListener("click",Oe,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Oe,!0)},0)}function Ye(l,r){const s=l.getBoundingClientRect();return xt(l,s,r)}function ci(l,r){const s=l.getBoundingClientRect(),h=[];for(let m=0;m<r.length;m++)h.push(xt(l,s,r[m]));return h}function Pi(l){return o.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button}function xt(l,r,s){const h=l.offsetWidth===r.width?1:l.offsetWidth/r.width;return new o.pointGeometry((s.clientX-r.left)*h,(s.clientY-r.top)*h)}function bt(l,r){var s=r[0],h=r[1],m=r[2],_=r[3],x=s*_-m*h;return x?(l[0]=_*(x=1/x),l[1]=-h*x,l[2]=-m*x,l[3]=s*x,l):null}function At(l){const{userImage:r}=l;return!!(r&&r.render&&r.render())&&(l.data.replace(new Uint8Array(r.data.buffer)),!0)}class vt extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:s,callback:h}of this.requestors)this._notify(s,h);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,s){this._validate(r,s)&&(this.images[r]=s)}_validate(r,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),h=!1),h}_validateStretch(r,s){if(!r)return!0;let h=0;for(const m of r){if(m[0]<h||m[1]<m[0]||s<m[1])return!1;h=m[1]}return!0}_validateContent(r,s){return!(r&&(r.length!==4||r[0]<0||s.data.width<r[0]||r[1]<0||s.data.height<r[1]||r[2]<0||s.data.width<r[2]||r[3]<0||s.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,s){s.version=this.images[r].version+1,this.images[r]=s,this.updatedImages[r]=!0}removeImage(r){const s=this.images[r];delete this.images[r],delete this.patterns[r],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,s){let h=!0;if(!this.isLoaded())for(const m of r)this.images[m]||(h=!1);this.isLoaded()||h?this._notify(r,s):this.requestors.push({ids:r,callback:s})}_notify(r,s){const h={};for(const m of r){this.images[m]||this.fire(new o.Event("styleimagemissing",{id:m}));const _=this.images[m];_?h[m]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:Boolean(_.userImage&&_.userImage.render)}:o.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,h)}getPixelSize(){const{width:r,height:s}=this.atlasImage;return{width:r,height:s}}getPattern(r){const s=this.patterns[r],h=this.getImage(r);if(!h)return null;if(s&&s.position.version===h.version)return s.position;if(s)s.position.version=h.version;else{const m={w:h.data.width+2,h:h.data.height+2,x:0,y:0},_=new o.ImagePosition(m,h);this.patterns[r]={bin:m,position:_}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const s=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(r,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const _ in this.patterns)r.push(this.patterns[_].bin);const{w:s,h}=o.potpack(r),m=this.atlasImage;m.resize({width:s||1,height:h||1});for(const _ in this.patterns){const{bin:x}=this.patterns[_],w=x.x+1,A=x.y+1,P=this.images[_].data,k=P.width,j=P.height;o.RGBAImage.copy(P,m,{x:0,y:0},{x:w,y:A},{width:k,height:j}),o.RGBAImage.copy(P,m,{x:0,y:j-1},{x:w,y:A-1},{width:k,height:1}),o.RGBAImage.copy(P,m,{x:0,y:0},{x:w,y:A+j},{width:k,height:1}),o.RGBAImage.copy(P,m,{x:k-1,y:0},{x:w-1,y:A},{width:1,height:j}),o.RGBAImage.copy(P,m,{x:0,y:0},{x:w+k,y:A},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const s of r){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const h=this.images[s];At(h)&&this.updateImage(s,h)}}}const Yt=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(l,r){return function([s,h,m]){const _=o.degToRad(h+90),x=o.degToRad(m);return{x:s*Math.cos(_)*Math.sin(x),y:s*Math.sin(_)*Math.sin(x),z:s*Math.cos(x),azimuthal:h,polar:m}}(l.expression.evaluate(r))}interpolate(l,r,s){return{x:o.number(l.x,r.x,s),y:o.number(l.y,r.y,s),z:o.number(l.z,r.z,s),azimuthal:o.number(l.azimuthal,r.azimuthal,s),polar:o.number(l.polar,r.polar,s)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),ei="-transition";class Ni extends o.Evented{constructor(r){super(),this._transitionable=new o.Transitionable(Yt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,s={}){if(!this._validate(o.validateLight,r,s))for(const h in r){const m=r[h];o.endsWith(h,ei)?this._transitionable.setTransition(h.slice(0,-ei.length),m):this._transitionable.setValue(h,m)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,h){return(!h||h.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const mr=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),wn="-transition";class Dn extends o.Evented{constructor(r,s){super(),this._transitionable=new o.Transitionable(mr),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(r){for(const s in r){const h=r[s];o.endsWith(s,wn)?this._transitionable.setTransition(s.slice(0,-wn.length),h):this._transitionable.setValue(s,h)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function xr(l,r,s,h){const m=o.smoothstep(45,65,s),[_,x]=ps(l,h),w=o.length(r);let A=1-Math.min(1,Math.exp((w-_)/(x-_)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*m*l.alpha}function ps(l,r){const s=.5/Math.tan(.5*r);return[l.range[0]+s,l.range[1]+s]}const pn=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),Tn="-transition";class _r extends o.Evented{constructor(r,s){super(),this._transitionable=new o.Transitionable(pn),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=s}get state(){const r=this._transform,s=r.projection.name==="globe",h=o.globeToMercatorTransition(r.zoom),m=this.properties.get("range"),_=[.5,3];return{range:s?[o.number(_[0],m[0],h),o.number(_[1],m[1],h)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,s={}){if(!this._validate(o.validateFog,r,s)){for(const h of Object.keys(o.spec.fog))r&&r[h]===void 0&&(r[h]=o.spec.fog[h].default);for(const h in r){const m=r[h];o.endsWith(h,Tn)?this._transitionable.setTransition(h.slice(0,-Tn.length),m):this._transitionable.setValue(h,m)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,r))*s.a}getOpacityAtLatLng(r,s){return this._transform.projection.supportsFog?function(h,m,_){const x=o.MercatorCoordinate.fromLngLat(m),w=_.elevation?_.elevation.getAtPointOrZero(x):0,A=[x.x,x.y,w];return o.transformMat4(A,A,_.mercatorFogMatrix),xr(h,A,_.pitch,_._fov)}(this.state,r,s):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?ps(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,h){return(!h||h.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class mn{constructor(r,s){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const h=this.workerPool.acquire(this.id);for(let m=0;m<h.length;m++){const _=new mn.Actor(h[m],s,this.id);_.name=`Worker ${m}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,s,h){o.asyncAll(this.actors,(m,_)=>{m.send(r,s,_)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ao(l,r,s){return r*(o.EXTENT/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}mn.Actor=o.Actor;class Zr{constructor(r,s,h,m){this.screenBounds=r,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(r,s){let h,m;if(r instanceof o.pointGeometry||typeof r[0]=="number"){const _=o.pointGeometry.convert(r);h=[o.pointGeometry.convert(r)],m=s.isPointAboveHorizon(_)}else{const _=o.pointGeometry.convert(r[0]),x=o.pointGeometry.convert(r[1]);h=[_,x],m=o.polygonizeBounds(_,x).every(w=>s.isPointAboveHorizon(w))}return new Zr(h,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],m=o.polygonizeBounds(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),o.bufferConvexPolygon(m,r)}bufferedCameraGeometryGlobe(r){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],m=o.polygonizeBounds(s,h,r),_=this.cameraPoint.clone();switch(3*((_.y>s.y)+(_.y>h.y))+((_.x>s.x)+(_.x>h.x))){case 0:m[0]=_,m[4]=_.clone();break;case 1:m.splice(1,0,_);break;case 2:m[1]=_;break;case 3:m.splice(4,0,_);break;case 5:m.splice(2,0,_);break;case 6:m[3]=_;break;case 7:m.splice(3,0,_);break;case 8:m[2]=_}return m}containsTile(r,s,h,m=0){const _=r.queryPadding/s._pixelsPerMercatorPixel+1,x=h?this._bufferedCameraMercator(_,s):this._bufferedScreenMercator(_,s);let w=r.tileID.wrap+(x.unwrapped?m:0);const A=x.polygon.map(H=>o.getTilePoint(r.tileTransform,H,w));if(!o.polygonIntersectsBox(A,0,0,o.EXTENT,o.EXTENT))return;w=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const P=this.screenGeometryMercator.polygon.map(H=>o.getTileVec3(r.tileTransform,H,w)),k=P.map(H=>new o.pointGeometry(H[0],H[1])),j=s.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),Z=o.getTileVec3(r.tileTransform,j,w),te=P.map(H=>{const K=o.sub(H,H,Z);return o.normalize(K,K),new o.Ray(Z,K)}),ee=Ao(r,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:te,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(J=o.getBounds(A),J.min.x=o.clamp(J.min.x,0,o.EXTENT),J.min.y=o.clamp(J.min.y,0,o.EXTENT),J.max.x=o.clamp(J.max.x,0,o.EXTENT),J.max.y=o.clamp(J.max.y,0,o.EXTENT),J),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:ee};var J}_bufferedScreenMercator(r,s){const h=Pr(r);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),s):{polygon:this.bufferedScreenGeometry(r).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[h]=m,m}}_bufferedCameraMercator(r,s){const h=Pr(r);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),s):{polygon:this.bufferedCameraGeometry(r).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[h]=m,m}}_projectAndResample(r,s){const h=function(_,x){const w=o.multiply([],x.pixelMatrix,x.globeMatrix),A=[0,-o.GLOBE_RADIUS,0,1],P=[0,o.GLOBE_RADIUS,0,1],k=[0,0,0,1];o.transformMat4$1(A,A,w),o.transformMat4$1(P,P,w),o.transformMat4$1(k,k,w);const j=new o.pointGeometry(A[0]/A[3],A[1]/A[3]),Z=new o.pointGeometry(P[0]/P[3],P[1]/P[3]),te=o.polygonContainsPoint(_,j)&&A[3]<k[3],ee=o.polygonContainsPoint(_,Z)&&P[3]<k[3];if(!te&&!ee)return null;const J=function(ve,fe,Ee){for(let Le=1;Le<ve.length;Le++){const ht=So(fe.pointCoordinate3D(ve[Le-1]).x),Pe=So(fe.pointCoordinate3D(ve[Le]).x);if(Ee<0){if(ht<Pe)return{idx:Le,t:-ht/(Pe-1-ht)}}else if(Pe<ht)return{idx:Le,t:(1-ht)/(Pe+1-ht)}}return null}(_,x,te?-1:1);if(!J)return null;const{idx:H,t:K}=J;let se=H>1?Wn(_.slice(0,H),x):[],ie=H<_.length?Wn(_.slice(H),x):[];se=se.map(ve=>new o.pointGeometry(So(ve.x),ve.y)),ie=ie.map(ve=>new o.pointGeometry(So(ve.x),ve.y));const xe=[...se];xe.length===0&&xe.push(ie[ie.length-1]);const ye=o.number(xe[xe.length-1].y,(ie.length===0?se[0]:ie[0]).y,K);let he;return he=te?[new o.pointGeometry(0,ye),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,ye)]:[new o.pointGeometry(1,ye),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,ye)],xe.push(...he),ie.length===0?xe.push(se[0]):xe.push(...ie),{polygon:xe.map(ve=>new o.MercatorCoordinate(ve.x,ve.y)),unwrapped:!1}}(r,s);if(h)return h;const m=function(_,x){let w=!1,A=-1/0,P=0;for(let j=0;j<_.length-1;j++)_[j].x>A&&(A=_[j].x,P=j);for(let j=0;j<_.length-1;j++){const Z=(P+j)%(_.length-1),te=_[Z],ee=_[Z+1];Math.abs(te.x-ee.x)>.5&&(te.x<ee.x?(te.x+=1,Z===0&&(_[_.length-1].x+=1)):(ee.x+=1,Z+1===_.length-1&&(_[0].x+=1)),w=!0)}const k=o.mercatorXfromLng(x.center.lng);return w&&k<Math.abs(k-1)&&_.forEach(j=>{j.x-=1}),{polygon:_,unwrapped:w}}(Wn(r,s).map(_=>new o.pointGeometry(So(_.x),_.y)),s);return{polygon:m.polygon.map(_=>new o.MercatorCoordinate(_.x,_.y)),unwrapped:m.unwrapped}}}function Wn(l,r){return o.resample(l,s=>{const h=r.pointCoordinate3D(s);s.x=h.x,s.y=h.y},1/256)}function So(l){return l<0?1+l%1:l%1}function Pr(l){return 100*l|0}function Ln(l,r,s,h,m){const _=function(x,w){if(x)return m(x);if(w){const A=o.pick(o.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(A.vectorLayers=w.vector_layers,A.vectorLayerIds=A.vectorLayers.map(P=>P.id)),w.language_options&&(A.languageOptions=w.language_options),w.language&&w.language[w.id]&&(A.language=w.language[w.id]),w.worldview_options&&(A.worldviewOptions=w.worldview_options),w.worldview?A.worldview=w.worldview[w.id]:w.worldview_default&&(A.worldview=w.worldview_default),A.tiles=r.canonicalizeTileset(A,l.url),m(null,A)}};return l.url?o.getJSON(r.transformRequest(r.normalizeSourceURL(l.url,null,s,h),o.ResourceType.Source),_):o.exported.frame(()=>_(null,l))}class zr{constructor(r,s,h){this.bounds=o.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const s=Math.pow(2,r.z),h=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*s),m=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*s),_=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*s),x=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*s);return r.x>=h&&r.x<_&&r.y>=m&&r.y<x}}class ms{constructor(r,s,h){this.context=r;const m=r.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const _n={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _o{constructor(r,s,h,m){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.context=r;const _=r.gl;this.buffer=_.createBuffer(),r.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,s){for(let h=0;h<this.attributes.length;h++){const m=s.attributes[this.attributes[h].name];m!==void 0&&r.enableVertexAttribArray(m)}}setVertexAttribPointers(r,s,h){for(let m=0;m<this.attributes.length;m++){const _=this.attributes[m],x=s.attributes[_.name];x!==void 0&&r.vertexAttribPointer(x,_.components,r[_n[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Kt{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wr extends Kt{getDefault(){return o.Color.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Wo extends Kt{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Xr extends Kt{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Xn extends Kt{getDefault(){return[!0,!0,!0,!0]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class En extends Kt{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Qt extends Kt{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class kr extends Kt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const s=this.current;(r.func!==s.func||r.ref!==s.ref||r.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Er extends Kt{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class On extends Kt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=r,this.dirty=!1}}class Zs extends Kt{getDefault(){return[0,1]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Io extends Kt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=r,this.dirty=!1}}class Ws extends Kt{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class io extends Kt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.BLEND):s.disable(s.BLEND),this.current=r,this.dirty=!1}}class Fr extends Kt{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class gn extends Kt{getDefault(){return o.Color.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Xo extends Kt{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Xs extends Kt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=r,this.dirty=!1}}class An extends Kt{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Sn extends Kt{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Ur extends Kt{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class Hr extends Kt{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Kr extends Kt{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Dr extends Kt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Hs extends Kt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class _s extends Kt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Ho extends Kt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class gs extends Kt{getDefault(){return null}set(r){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Ko extends Kt{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Mo extends Kt{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Co extends Kt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class zl extends Kt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class In extends Kt{constructor(r,s){super(r),this.context=r,this.parent=s}getDefault(){return null}}class Ks extends In{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class oe extends In{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class N extends oe{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class G{constructor(r,s,h,m){this.context=r,this.width=s,this.height=h;const _=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Ks(r,_),m&&(this.depthAttachment=new oe(r,_))}destroy(){const r=this.context.gl,s=this.colorAttachment.get();if(s&&r.deleteTexture(s),this.depthAttachment){const h=this.depthAttachment.get();h&&r.deleteRenderbuffer(h)}r.deleteFramebuffer(this.framebuffer)}}class ne{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Wr(this),this.clearDepth=new Wo(this),this.clearStencil=new Xr(this),this.colorMask=new Xn(this),this.depthMask=new En(this),this.stencilMask=new Qt(this),this.stencilFunc=new kr(this),this.stencilOp=new Er(this),this.stencilTest=new On(this),this.depthRange=new Zs(this),this.depthTest=new Io(this),this.depthFunc=new Ws(this),this.blend=new io(this),this.blendFunc=new Fr(this),this.blendColor=new gn(this),this.blendEquation=new Xo(this),this.cullFace=new Xs(this),this.cullFaceSide=new An(this),this.frontFace=new Sn(this),this.program=new Ur(this),this.activeTexture=new Hr(this),this.viewport=new Kr(this),this.bindFramebuffer=new Dr(this),this.bindRenderbuffer=new Hs(this),this.bindTexture=new _s(this),this.bindVertexBuffer=new Ho(this),this.bindElementBuffer=new gs(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ko(this),this.pixelStoreUnpack=new Mo(this),this.pixelStoreUnpackPremultiplyAlpha=new Co(this),this.pixelStoreUnpackFlipY=new zl(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,s){return new ms(this,r,s)}createVertexBuffer(r,s,h){return new _o(this,r,s,h)}createRenderbuffer(r,s,h){const m=this.gl,_=m.createRenderbuffer();return this.bindRenderbuffer.set(_),m.renderbufferStorage(m.RENDERBUFFER,r,s,h),this.bindRenderbuffer.set(null),_}createFramebuffer(r,s,h){return new G(this,r,s,h)}clear({color:r,depth:s,stencil:h}){const m=this.gl;let _=0;r&&(_|=m.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(_|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(_|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),m.clear(_)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Q(r.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ue extends o.Evented{constructor(r,s,h,m){super(),this.id=r,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},s),o.extend(this,o.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ln(this._options,this.map._requestManager,null,null,(r,s)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new zr(s.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(s.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,s){const h=o.exported.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);r.request=o.getImage(this.map._requestManager.transformRequest(m,o.ResourceType.Tile),(_,x,w,A)=>(delete r.request,r.aborted?(r.state="unloaded",s(null)):_?(r.state="errored",s(_)):x?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:w,expires:A}),r.setTexture(x,this.map.painter),r.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void s(null)):s(null)))}static loadTileData(r,s,h){r.setTexture(s,h)}static unloadTileData(r,s){r.texture&&s.saveTileTexture(r.texture)}abortTile(r,s){r.request&&(r.request.cancel(),delete r.request),s()}unloadTile(r,s){r.texture&&this.map.painter.saveTileTexture(r.texture),s()}hasTransition(){return!1}}let be;function ze(l,r,s,h,m,_,x,w){const A=[l,s,m,r,h,_,1,1,1],P=[x,w,1],k=o.adjoint([],A),[j,Z,te]=o.transformMat3(P,P,o.transpose(k,k));return o.multiply$1(A,[j,0,0,0,Z,0,0,0,te],A)}class Me extends o.Evented{constructor(r,s,h,m){super(),this.id=r,this.dispatcher=h,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=s}load(r,s){this._loaded=s||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(h,m)=>{if(this._loaded=!0,h)this.fire(new o.ErrorEvent(h));else if(m){const{HTMLImageElement:_}=o.window;this.image=m instanceof _?o.exported.getImageData(m):m,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const s=r.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(h){let m=1/0,_=1/0,x=-1/0,w=-1/0;for(const j of h)m=Math.min(m,j.x),_=Math.min(_,j.y),x=Math.max(x,j.x),w=Math.max(w,j.y);const A=Math.max(x-m,w-_),P=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),k=Math.pow(2,P);return new o.CanonicalTileID(P,Math.floor((m+x)/2*k),Math.floor((_+w)/2*k))}(s),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const A in this.tiles){const P=this.tiles[A];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}if(this._boundsArray)return;const s=o.tileTransform(this.tileID,this.map.transform.projection),[h,m,_,x]=this.coordinates.map(A=>{const P=s.projection.project(A[0],A[1]);return o.getTilePoint(s,P)._round()});this.perspectiveTransform=function(A,P,k,j,Z,te,ee,J,H,K){const se=ze(0,0,A,0,0,P,A,P),ie=ze(k,j,Z,te,ee,J,H,K);return o.multiply$1(ie,o.adjoint(se,se),ie),[ie[6]/ie[8]*A/o.EXTENT,ie[7]/ie[8]*P/o.EXTENT]}(this.width,this.height,h.x,h.y,m.x,m.y,x.x,x.y,_.x,_.y);const w=this._boundsArray=new o.StructArrayLayout4i8;w.emplaceBack(h.x,h.y,0,0),w.emplaceBack(m.x,m.y,o.EXTENT,0),w.emplaceBack(x.x,x.y,0,o.EXTENT),w.emplaceBack(_.x,_.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(w,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,s=r.gl;this.texture?this.texture.update(this.image):(this.texture=new o.Texture(r,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._prepareData(r)}loadTile(r,s){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},s(null)):(r.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Te={vector:class extends o.Evented{constructor(l,r,s,h){if(super(),this.id=l,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(r,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(l){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const r=this.language||this.map._language,s=this.worldview||this.map._worldview;this._tileJSONRequest=Ln(this._options,this.map._requestManager,r,s,(h,m)=>{this._tileJSONRequest=null,this._loaded=!0,h?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${r}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new o.ErrorEvent(h))):m&&(o.extend(this,m),m.bounds&&(this.tileBounds=new zr(m.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(m.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(h)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l(),this.load(()=>{const r=this.map.style._getSourceCaches(this.id);for(const s of r)s.clearTiles()})}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}_setLanguage(l){return l===this.language||this.setSourceProperty(()=>{this.language=l}),this}_setWorldview(l){return l===this.worldview?this:this.worldviewOptions&&l&&!this.worldviewOptions[l]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${l}".`),this):(this.setSourceProperty(()=>{this.worldview=l}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(l,r){const s=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,o.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(h.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=r:l.request=l.actor.send("reloadTile",h,m.bind(this));else if(l.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",h,m.bind(this),void 0,!0);else{const _=o.loadVectorTile.call({deduped:this._deduped},h,(x,w)=>{x||!w?m.call(this,x):(h.data={cacheControl:w.cacheControl,expires:w.expires,rawData:w.rawData.slice(0)},l.actor&&l.actor.send("loadTile",h,m.bind(this),void 0,!0))},!0);l.request={cancel:_}}function m(_,x){return delete l.request,l.aborted?r(null):_&&_.status!==404?r(_):(x&&x.resourceTiming&&(l.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&x&&l.setExpiryData(x),l.loadVectorData(x,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ue,"raster-dem":class extends ue{constructor(l,r,s,h){super(l,r,s,h),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(l,r){const s=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(m,_){m&&(l.state="errored",r(m)),_&&(l.dem=_,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",r(null))}l.request=o.getImage(this.map._requestManager.transformRequest(s,o.ResourceType.Tile),function(m,_,x,w){if(delete l.request,l.aborted)l.state="unloaded",r(null);else if(m)l.state="errored",r(m);else if(_){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:x,expires:w});const A=o.window.ImageBitmap&&_ instanceof o.window.ImageBitmap&&(be==null&&(be=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),be),P=1-(_.width-o.prevPowerOfTwo(_.width))/2;P<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const k=A?_:o.exported.getImageData(_,P),j={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:k,encoding:this.encoding,padding:P};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",j,h.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(l){const r=l.canonical,s=Math.pow(2,r.z),h=(r.x-1+s)%s,m=r.x===0?l.wrap-1:l.wrap,_=(r.x+1+s)%s,x=r.x+1===s?l.wrap+1:l.wrap,w={};return w[new o.OverscaledTileID(l.overscaledZ,m,r.z,h,r.y).key]={backfilled:!1},w[new o.OverscaledTileID(l.overscaledZ,x,r.z,_,r.y).key]={backfilled:!1},r.y>0&&(w[new o.OverscaledTileID(l.overscaledZ,m,r.z,h,r.y-1).key]={backfilled:!1},w[new o.OverscaledTileID(l.overscaledZ,l.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},w[new o.OverscaledTileID(l.overscaledZ,x,r.z,_,r.y-1).key]={backfilled:!1}),r.y+1<s&&(w[new o.OverscaledTileID(l.overscaledZ,m,r.z,h,r.y+1).key]={backfilled:!1},w[new o.OverscaledTileID(l.overscaledZ,l.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},w[new o.OverscaledTileID(l.overscaledZ,x,r.z,_,r.y+1).key]={backfilled:!1}),w}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded"}},geojson:class extends o.Evented{constructor(l,r,s,h){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=r.data,this._options=o.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const m=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*m,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*m,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*m,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}getClusterExpansionZoom(l,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},r),this}getClusterChildren(l,r){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},r),this}getClusterLeaves(l,r,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:r,offset:s},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const l=o.extend({},this.workerOptions),r=this._data;typeof r=="string"?(l.request=this.map._requestManager.transformRequest(o.exported.resolveURL(r),o.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(s,h)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new o.ErrorEvent(s));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(m.resourceTiming=h.resourceTiming[this.id]),this.fire(new o.Event("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(l,r){const s=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(s,{type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(h,m)=>(delete l.request,l.unloadVectorData(),l.aborted?r(null):h?r(h):(l.loadVectorData(m,this.map.painter,s==="reloadTile"),r(null))),void 0,s==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Me{constructor(l,r,s,h){super(l,r,s,h),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const r of l.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.ResourceType.Source).url);o.getVideo(this.urls,(r,s)=>{this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const r=this.video.seekable;l<r.start(0)||l>r.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,r=l.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(l,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Me,canvas:class extends Me{constructor(l,r,s,h){super(l,r,s,h),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(_=>typeof _!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends o.Evented{constructor(l,r,s,h){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=r,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new zr(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this._map=l,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:r,y:s,z:h}=l.canonical;return this._implementation.hasTile({x:r,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,r){const{x:s,y:h,z:m}=l.tileID.canonical,_=new o.window.AbortController,x=this._implementation.loadTile({x:s,y:h,z:m},{signal:_.signal});if(!x)return this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",r(null);x.cancel=()=>_.abort(),l.request=x.then(function(w){return delete l.request,l.aborted?(l.state="unloaded",r(null)):w?function(A){return A instanceof o.window.ImageData||A instanceof o.window.ImageBitmap||A instanceof o.window.HTMLCanvasElement}(w)?(this.loadTileData(l,w),l.state="loaded",void r(null)):(l.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",r(null))}.bind(this)).catch(w=>{w.code!==20&&(l.state="errored",r(w))})}loadTileData(l,r){ue.loadTileData(l,r,this._map.painter)}unloadTileData(l){ue.unloadTileData(l,this._map.painter)}prepareTile(l){if(!this._implementation.prepareTile)return null;const{x:r,y:s,z:h}=l.tileID.canonical,m=this._implementation.prepareTile({x:r,y:s,z:h});return m?(this.loadTileData(l,m),l.state="loaded",m):null}unloadTile(l,r){if(this.unloadTileData(l),this._implementation.unloadTile){const{x:s,y:h,z:m}=l.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:m})}r()}abortTile(l,r){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ke=function(l,r,s,h){const m=new Te[r.type](l,r,s,h);if(m.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${m.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],m),m};function nt(l,r){const s=o.identity([]);return o.scale(s,s,[.5*l.width,.5*-l.height,1]),o.translate(s,s,[1,-1,0]),o.multiply(s,s,l.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(s)}function Mt(l,r,s,h,m,_,x,w=!1){const A=l.tilesIn(h,x,w);A.sort($t);const P=[];for(const j of A)P.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(r,s,l._state,j,m,_,nt(l.transform,j.tile.tileID),w)});const k=function(j){const Z={},te={};for(const ee of j){const J=ee.queryResults,H=ee.wrappedTileID,K=te[H]=te[H]||{};for(const se in J){const ie=J[se],xe=K[se]=K[se]||{},ye=Z[se]=Z[se]||[];for(const he of ie)xe[he.featureIndex]||(xe[he.featureIndex]=!0,ye.push(he))}}return Z}(P);for(const j in k)k[j].forEach(Z=>{const te=Z.feature,ee=te.layer;ee&&ee.type!=="background"&&ee.type!=="sky"&&(te.source=ee.source,ee["source-layer"]&&(te.sourceLayer=ee["source-layer"]),te.state=te.id!==void 0?l.getFeatureState(ee["source-layer"],te.id):{})});return k}function lt(l,r){const s=l.getRenderableIds().map(_=>l.getTileByID(_)),h=[],m={};for(let _=0;_<s.length;_++){const x=s[_],w=x.tileID.canonical.key;m[w]||(m[w]=!0,x.querySourceFeatures(h,r))}return h}function $t(l,r){const s=l.tileID,h=r.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function Vt(){return gc.workerClass!=null?new gc.workerClass:new o.window.Worker(gc.workerUrl)}const Ut="mapboxgl_preloaded_worker_pool";class Wt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Wt.workerCount;)this.workers.push(new Vt);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ut]}numActive(){return Object.keys(this.active).length}}let oi;function ji(){return oi||(oi=new Wt),oi}function Zi(l,r){const s={};for(const h in l)h!=="ref"&&(s[h]=l[h]);return o.refProperties.forEach(h=>{h in r&&(s[h]=r[h])}),s}function xi(l){l=l.slice();const r=Object.create(null);for(let s=0;s<l.length;s++)r[l[s].id]=l[s];for(let s=0;s<l.length;s++)"ref"in l[s]&&(l[s]=Zi(l[s],r[l[s].ref]));return l}Wt.workerCount=2;const Ft={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function $e(l,r,s){s.push({command:Ft.addSource,args:[l,r[l]]})}function sn(l,r,s){r.push({command:Ft.removeSource,args:[l]}),s[l]=!0}function ur(l,r,s,h){sn(l,s,h),$e(l,r,s)}function ys(l,r,s){let h;for(h in l[s])if(l[s].hasOwnProperty(h)&&h!=="data"&&!Q(l[s][h],r[s][h]))return!1;for(h in r[s])if(r[s].hasOwnProperty(h)&&h!=="data"&&!Q(l[s][h],r[s][h]))return!1;return!0}function kl(l,r,s,h,m,_){let x;for(x in r=r||{},l=l||{})l.hasOwnProperty(x)&&(Q(l[x],r[x])||s.push({command:_,args:[h,x,r[x],m]}));for(x in r)r.hasOwnProperty(x)&&!l.hasOwnProperty(x)&&(Q(l[x],r[x])||s.push({command:_,args:[h,x,r[x],m]}))}function ro(l){return l.id}function Ta(l,r){return l[r.id]=r,l}class Dc{constructor(r,s){this.reset(r,s)}reset(r,s){this.points=r||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.clamp(r,0,1);let s=1,h=this._distances[s];const m=r*this.paddedLength+this.padding;for(;h<m&&s<this._distances.length;)h=this._distances[++s];const _=s-1,x=this._distances[_],w=h-x,A=w>0?(m-x)/w:0;return this.points[_].mult(1-A).add(this.points[s].mult(A))}}class Ea{constructor(r,s,h){const m=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(r/h),this.yCellCount=Math.ceil(s/h);for(let x=0;x<this.xCellCount*this.yCellCount;x++)m.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=s,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,s,h,m,_){this._forEachCell(s,h,m,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(_)}insertCircle(r,s,h,m){this._forEachCell(s-m,h-m,s+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(s),this.circles.push(h),this.circles.push(m)}_insertBoxCell(r,s,h,m,_,x){this.boxCells[_].push(x)}_insertCircleCell(r,s,h,m,_,x){this.circleCells[_].push(x)}_query(r,s,h,m,_,x){if(h<0||r>this.width||m<0||s>this.height)return!_&&[];const w=[];if(r<=0&&s<=0&&this.width<=h&&this.height<=m){if(_)return!0;for(let A=0;A<this.boxKeys.length;A++)w.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const P=this.circles[3*A],k=this.circles[3*A+1],j=this.circles[3*A+2];w.push({key:this.circleKeys[A],x1:P-j,y1:k-j,x2:P+j,y2:k+j})}return x?w.filter(x):w}return this._forEachCell(r,s,h,m,this._queryCell,w,{hitTest:_,seenUids:{box:{},circle:{}}},x),_?w.length>0:w}_queryCircle(r,s,h,m,_){const x=r-h,w=r+h,A=s-h,P=s+h;if(w<0||x>this.width||P<0||A>this.height)return!m&&[];const k=[];return this._forEachCell(x,A,w,P,this._queryCellCircle,k,{hitTest:m,circle:{x:r,y:s,radius:h},seenUids:{box:{},circle:{}}},_),m?k.length>0:k}query(r,s,h,m,_){return this._query(r,s,h,m,!1,_)}hitTest(r,s,h,m,_){return this._query(r,s,h,m,!0,_)}hitTestCircle(r,s,h,m){return this._queryCircle(r,s,h,!0,m)}_queryCell(r,s,h,m,_,x,w,A){const P=w.seenUids,k=this.boxCells[_];if(k!==null){const Z=this.bboxes;for(const te of k)if(!P.box[te]){P.box[te]=!0;const ee=4*te;if(r<=Z[ee+2]&&s<=Z[ee+3]&&h>=Z[ee+0]&&m>=Z[ee+1]&&(!A||A(this.boxKeys[te]))){if(w.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[te],x1:Z[ee],y1:Z[ee+1],x2:Z[ee+2],y2:Z[ee+3]})}}}const j=this.circleCells[_];if(j!==null){const Z=this.circles;for(const te of j)if(!P.circle[te]){P.circle[te]=!0;const ee=3*te;if(this._circleAndRectCollide(Z[ee],Z[ee+1],Z[ee+2],r,s,h,m)&&(!A||A(this.circleKeys[te]))){if(w.hitTest)return x.push(!0),!0;{const J=Z[ee],H=Z[ee+1],K=Z[ee+2];x.push({key:this.circleKeys[te],x1:J-K,y1:H-K,x2:J+K,y2:H+K})}}}}}_queryCellCircle(r,s,h,m,_,x,w,A){const P=w.circle,k=w.seenUids,j=this.boxCells[_];if(j!==null){const te=this.bboxes;for(const ee of j)if(!k.box[ee]){k.box[ee]=!0;const J=4*ee;if(this._circleAndRectCollide(P.x,P.y,P.radius,te[J+0],te[J+1],te[J+2],te[J+3])&&(!A||A(this.boxKeys[ee])))return x.push(!0),!0}}const Z=this.circleCells[_];if(Z!==null){const te=this.circles;for(const ee of Z)if(!k.circle[ee]){k.circle[ee]=!0;const J=3*ee;if(this._circlesCollide(te[J],te[J+1],te[J+2],P.x,P.y,P.radius)&&(!A||A(this.circleKeys[ee])))return x.push(!0),!0}}}_forEachCell(r,s,h,m,_,x,w,A){const P=this._convertToXCellCoord(r),k=this._convertToYCellCoord(s),j=this._convertToXCellCoord(h),Z=this._convertToYCellCoord(m);for(let te=P;te<=j;te++)for(let ee=k;ee<=Z;ee++)if(_.call(this,r,s,h,m,this.xCellCount*ee+te,x,w,A))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,s,h,m,_,x){const w=m-r,A=_-s,P=h+x;return P*P>w*w+A*A}_circleAndRectCollide(r,s,h,m,_,x,w){const A=(x-m)/2,P=Math.abs(r-(m+A));if(P>A+h)return!1;const k=(w-_)/2,j=Math.abs(s-(_+k));if(j>k+h)return!1;if(P<=A||j<=k)return!0;const Z=P-A,te=j-k;return Z*Z+te*te<=h*h}}const Ct=Math.tan(85*Math.PI/180);function di(l,r,s,h,m,_,x){const w=o.create();if(s)if(_.name==="globe"){const A=o.calculateGlobeLabelMatrix(m,r);o.multiply(w,w,A)}else{const A=bt([],x);w[0]=A[0],w[1]=A[1],w[4]=A[2],w[5]=A[3],h||o.rotateZ(w,w,m.angle)}else o.multiply(w,m.labelPlaneMatrix,l);return w}function fi(l,r,s,h,m,_,x){const w=di(l,r,s,h,m,_,x);return _.name==="globe"&&s||(w[2]=w[6]=w[10]=w[14]=0),w}function no(l,r,s,h,m,_,x){if(s){if(_.name==="globe"){const w=di(l,r,s,h,m,_,x);return o.invert(w,w),o.multiply(w,l,w),w}{const w=o.clone(l),A=o.identity([]);return A[0]=x[0],A[1]=x[1],A[4]=x[2],A[5]=x[3],o.multiply(w,w,A),h||o.rotateZ(w,w,-m.angle),w}}return m.glCoordMatrix}function oo(l,r,s=0){const h=[l.x,l.y,s,1];s?o.transformMat4$1(h,h,r):ln(h,h,r);const m=h[3];return{point:[h[0]/m,h[1]/m,h[2]/m],signedDistanceFromCamera:m}}function ti(l,r){const s=[l[0],l[1],l[2],1];o.transformMat4$1(s,s,r);const h=s[3];return{point:[s[0]/h,s[1]/h,s[2]/h],signedDistanceFromCamera:h}}function Ys(l,r){return Math.min(.5+l/r*.5,1.5)}function vs(l,r){const s=l[0]/l[3],h=l[1]/l[3];return s>=-r[0]&&s<=r[0]&&h>=-r[1]&&h<=r[1]}function Aa(l,r,s,h,m,_,x,w,A,P){const k=s.transform,j=h?l.textSizeData:l.iconSizeData,Z=o.evaluateSizeForZoom(j,s.transform.zoom),te=k.projection.name==="globe",ee=[256/s.width*2+1,256/s.height*2+1],J=h?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;J.clear();let H=null;te&&(H=h?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const K=l.lineVertexArray,se=h?l.text.placedSymbolArray:l.icon.placedSymbolArray,ie=s.transform.width/s.transform.height;let xe=!1;for(let ye=0;ye<se.length;ye++){const he=se.get(ye);if(he.writingMode!==o.WritingMode.vertical||xe||ye!==0&&se.get(ye-1).writingMode===o.WritingMode.horizontal||(xe=!0),(he.hidden||he.writingMode===o.WritingMode.vertical)&&!xe){Yo(he.numGlyphs,J);continue}xe=!1;const ve=new o.pointGeometry(he.tileAnchorX,he.tileAnchorY),fe=A?A(ve):[0,0,0],Ee=k.projection.projectTilePoint(ve.x,ve.y,P.canonical),Le=[Ee.x+fe[0],Ee.y+fe[1],Ee.z+fe[2]],ht=[...Le,1];if(o.transformMat4$1(ht,ht,r),!vs(ht,ee)){Yo(he.numGlyphs,J);continue}const Pe=Ys(s.transform.cameraToCenterDistance,ht[3]),He=o.evaluateSizeForFeature(j,Z,he),rt=x?He/Pe:He*Pe,gt=oo(new o.pointGeometry(Le[0],Le[1]),m,Le[2]);if(gt.signedDistanceFromCamera<=0){Yo(he.numGlyphs,J);continue}let Ve={};const dt=x?null:A,Qe=Lc(he,rt,!1,w,r,m,_,l.glyphOffsetArray,K,J,H,gt.point,ve,Ve,ie,dt,k.projection,P,x);xe=Qe.useVertical,dt&&Qe.needsFlipping&&(Ve={}),(Qe.notEnoughRoom||xe||Qe.needsFlipping&&Lc(he,rt,!0,w,r,m,_,l.glyphOffsetArray,K,J,H,gt.point,ve,Ve,ie,dt,k.projection,P,x).notEnoughRoom)&&Yo(he.numGlyphs,J)}h?(l.text.dynamicLayoutVertexBuffer.updateData(J),H&&l.text.globeExtVertexBuffer.updateData(H)):(l.icon.dynamicLayoutVertexBuffer.updateData(J),H&&l.icon.globeExtVertexBuffer.updateData(H))}function an(l,r,s,h,m,_,x,w,A,P,k,j,Z,te,ee,J){const H=w.glyphStartIndex+w.numGlyphs,K=w.lineStartIndex,se=w.lineStartIndex+w.lineLength,ie=r.getoffsetX(w.glyphStartIndex),xe=r.getoffsetX(H-1),ye=Po(l*ie,s,h,m,_,x,w.segment,K,se,A,P,k,j,Z,!0,te,ee,J);if(!ye)return null;const he=Po(l*xe,s,h,m,_,x,w.segment,K,se,A,P,k,j,Z,!0,te,ee,J);return he?{first:ye,last:he}:null}function ir(l,r,s,h){return l.writingMode===o.WritingMode.horizontal&&Math.abs(s.y-r.y)>Math.abs(s.x-r.x)*h?{useVertical:!0}:l.writingMode===o.WritingMode.vertical?r.y<s.y?{needsFlipping:!0}:null:l.flipState!==0&&function(m,_,x){const w=(_.x-m.x)*x;return w===0||Math.abs((_.y-m.y)/w)>Ct}(r,s,h)?l.flipState===1?{needsFlipping:!0}:null:r.x>s.x?{needsFlipping:!0}:null}function Lc(l,r,s,h,m,_,x,w,A,P,k,j,Z,te,ee,J,H,K,se){const ie=r/24,xe=l.lineOffsetX*ie,ye=l.lineOffsetY*ie;let he;if(l.numGlyphs>1){const ve=l.glyphStartIndex+l.numGlyphs,fe=l.lineStartIndex,Ee=l.lineStartIndex+l.lineLength,Le=an(ie,w,xe,ye,s,j,Z,l,A,_,te,J,!1,H,K,se);if(!Le)return{notEnoughRoom:!0};const ht=ti(Le.first.point,x).point,Pe=ti(Le.last.point,x).point,He=new o.pointGeometry(ht[0],ht[1]),rt=new o.pointGeometry(Pe[0],Pe[1]);if(h&&!s){const gt=ir(l,He,rt,ee);if(l.flipState=gt&&gt.needsFlipping?1:2,gt)return gt}he=[Le.first];for(let gt=l.glyphStartIndex+1;gt<ve-1;gt++)he.push(Po(ie*w.getoffsetX(gt),xe,ye,s,j,Z,l.segment,fe,Ee,A,_,te,J,!1,!1,H,K,se));he.push(Le.last)}else{if(h&&!s){const fe=oo(Z,m).point,Ee=l.lineStartIndex+l.segment+1,Le=new o.pointGeometry(A.getx(Ee),A.gety(Ee)),ht=oo(Le,m),Pe=ht.signedDistanceFromCamera>0?ht.point:Js(Z,Le,fe,1,m,void 0,H,K.canonical),He=ir(l,new o.pointGeometry(fe[0],fe[1]),new o.pointGeometry(Pe[0],Pe[1]),ee);if(l.flipState=He&&He.needsFlipping?1:2,He)return He}const ve=Po(ie*w.getoffsetX(l.glyphStartIndex),xe,ye,s,j,Z,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,A,_,te,J,!1,!1,H,K,se);if(!ve)return{notEnoughRoom:!0};he=[ve]}if(k)for(const ve of he)o.updateGlobeVertexNormal(k,P.length+0,ve.up[0],ve.up[1],ve.up[2]),o.updateGlobeVertexNormal(k,P.length+1,ve.up[0],ve.up[1],ve.up[2]),o.updateGlobeVertexNormal(k,P.length+2,ve.up[0],ve.up[1],ve.up[2]),o.updateGlobeVertexNormal(k,P.length+3,ve.up[0],ve.up[1],ve.up[2]),o.addDynamicAttributes(P,ve.point[0],ve.point[1],ve.point[2],ve.angle);else for(const ve of he)o.addDynamicAttributes(P,ve.point[0],ve.point[1],ve.point[2],ve.angle);return{}}function xs(l,r,s,h,m){const _=h.projectTilePoint(l.x,l.y,r);if(!m)return oo(_,s,_.z);const x=m(l);return oo(new o.pointGeometry(_.x+x[0],_.y+x[1]),s,_.z+x[2])}function Js(l,r,s,h,m,_,x,w){const A=xs(l.add(l.sub(r)._unit()),w,m,x,_).point,P=o.sub([],s,A);return o.scaleAndAdd([],s,P,h/o.length(P))}function Po(l,r,s,h,m,_,x,w,A,P,k,j,Z,te,ee,J,H,K){const se=h?l-r:l+r;let ie=se>0?1:-1,xe=0;h&&(ie*=-1,xe=Math.PI),ie<0&&(xe+=Math.PI);let ye=ie>0?w+x:w+x+1,he=m,ve=m,fe=0,Ee=0;const Le=Math.abs(se),ht=[],Pe=[];let He=_;const rt=()=>{const Rt=ye-ie;return fe===0?_:new o.pointGeometry(P.getx(Rt),P.gety(Rt))},gt=()=>Js(rt(),He,ve,Le-fe+1,k,Z,J,H.canonical);for(;fe+Ee<=Le;){if(ye+=ie,ye<w||ye>=A)return null;if(ve=he,ht.push(he),te&&Pe.push(He||rt()),he=j[ye],he===void 0){He=new o.pointGeometry(P.getx(ye),P.gety(ye));const Rt=xs(He,H.canonical,k,J,Z);he=Rt.signedDistanceFromCamera>0?j[ye]=Rt.point:gt()}else He=null;fe+=Ee,Ee=o.distance(ve,he)}He=He||new o.pointGeometry(P.getx(ye),P.gety(ye));const Ve=rt();ee&&Z&&(j[ye]=he=j[ye]===void 0?he:gt(),Ee=o.distance(ve,he));const dt=(Le-fe)/Ee,Qe=He.sub(Ve).mult(dt)._add(Ve),Tt=o.sub([],he,ve),wt=o.scaleAndAdd([],ve,Tt,dt);let Ot=[0,0,1],Nt=Tt[0],Ht=Tt[1];if(K&&(Ot=J.upVector(H.canonical,Qe.x,Qe.y),Ot[0]!==0||Ot[1]!==0||Ot[2]!==1)){const Rt=[1,0,0],ii=[0,1,0];Rt[0]=Ot[2],Rt[1]=0,Rt[2]=-Ot[0],o.cross(ii,Ot,Rt),o.normalize(Rt,Rt),o.normalize(ii,ii),Nt=o.dot(Tt,Rt),Ht=o.dot(Tt,ii)}if(s){const Rt=o.cross([],Ot,Tt);o.normalize(Rt,Rt),o.scaleAndAdd(wt,wt,Rt,s*ie)}const Ei=xe+Math.atan2(Ht,Nt);return ht.push(wt),te&&Pe.push(Qe),{point:wt,angle:Ei,path:ht,tilePath:Pe,up:Ot}}const Dl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Yo(l,r){for(let s=0;s<l;s++){const h=r.length;r.resize(h+4),r.float32.set(Dl,4*h)}}function ln(l,r,s){const h=r[0],m=r[1];return l[0]=s[0]*h+s[4]*m+s[12],l[1]=s[1]*h+s[5]*m+s[13],l[3]=s[3]*h+s[7]*m+s[15],l}const Ri=100;class Jo{constructor(r,s,h=new Ea(r.width+200,r.height+200,25),m=new Ea(r.width+200,r.height+200,25)){this.transform=r,this.grid=h,this.ignoredGrid=m,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Ri,this.screenBottomBoundary=r.height+Ri,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=s}placeCollisionBox(r,s,h,m,_,x,w,A){let P=h.projectedAnchorX,k=h.projectedAnchorY,j=h.projectedAnchorZ;const Z=h.elevation,te=h.tileID;if(Z&&te){const ye=r.getProjection().upVector(te.canonical,h.tileAnchorX,h.tileAnchorY),he=r.getProjection().upVectorScale(te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ye[0]*Z*he,k+=ye[1]*Z*he,j+=ye[2]*Z*he}const ee=this.projectAndGetPerspectiveRatio(w,[P,k,j],h.tileID,r.projection.name==="globe"||!!Z||this.transform.pitch>0,r.getProjection()),J=x*ee.perspectiveRatio,H=(h.x1*s+m.x-h.padding)*J+ee.point.x,K=(h.y1*s+m.y-h.padding)*J+ee.point.y,se=(h.x2*s+m.x+h.padding)*J+ee.point.x,ie=(h.y2*s+m.y+h.padding)*J+ee.point.y,xe=ee.perspectiveRatio<=.55||ee.occluded;return!this.isInsideGrid(H,K,se,ie)||!_&&this.grid.hitTest(H,K,se,ie,A)||xe?{box:[],offscreen:!1,occluded:ee.occluded}:{box:[H,K,se,ie],offscreen:this.isOffscreen(H,K,se,ie),occluded:!1}}placeCollisionCircles(r,s,h,m,_,x,w,A,P,k,j,Z,te,ee,J){const H=[],K=this.transform.elevation,se=K?K.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,r.getProjection()):Ve=>[0,0,0],ie=new o.pointGeometry(h.tileAnchorX,h.tileAnchorY),xe=r.getProjection().projectTilePoint(h.tileAnchorX,h.tileAnchorY,J.canonical),ye=se(ie),he=[xe.x+ye[0],xe.y+ye[1],xe.z+ye[2]],ve=r.projection.name==="globe",fe=this.projectAndGetPerspectiveRatio(w,[he[0],he[1],he[2]],J,ve||!!K||this.transform.pitch>0,r.getProjection()),{perspectiveRatio:Ee}=fe,Le=(j?x/Ee:x*Ee)/o.ONE_EM,ht=oo(new o.pointGeometry(he[0],he[1]),A,he[2]).point,Pe=fe.signedDistanceFromCamera>0?an(Le,_,h.lineOffsetX*Le,h.lineOffsetY*Le,!1,ht,ie,h,m,A,{},K&&!j?se:null,j&&!!K,r.getProjection(),J,j):null;let He=!1,rt=!1,gt=!0;if(Pe&&!fe.occluded){const Ve=.5*te*Ee+ee,dt=new o.pointGeometry(-100,-100),Qe=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Tt=new Dc,wt=Pe.first,Ot=Pe.last;let Nt=[];for(let Rt=wt.path.length-1;Rt>=1;Rt--)Nt.push(wt.path[Rt]);for(let Rt=1;Rt<Ot.path.length;Rt++)Nt.push(Ot.path[Rt]);const Ht=2.5*Ve;if(P){const Rt=Nt.map(K&&!ve?(ii,Li)=>{const Qi=se(Li<wt.path.length-1?wt.tilePath[wt.path.length-1-Li]:Ot.tilePath[Li-wt.path.length+2]);return ii[2]=Qi[2],ti(ii,P)}:ii=>ti(ii,P));Nt=Rt.some(ii=>ii.signedDistanceFromCamera<=0)?[]:Rt.map(ii=>ii.point)}let Ei=[];if(Nt.length>0){const Rt=Nt.map(qi=>new o.pointGeometry(qi[0],qi[1]));let ii=1/0,Li=-1/0,Qi=1/0,br=-1/0;for(let qi=0;qi<Rt.length;qi++)ii=Math.min(ii,Rt[qi].x),Qi=Math.min(Qi,Rt[qi].y),Li=Math.max(Li,Rt[qi].x),br=Math.max(br,Rt[qi].y);Ei=ii>=dt.x&&Li<=Qe.x&&Qi>=dt.y&&br<=Qe.y?[Rt]:Li<dt.x||ii>Qe.x||br<dt.y||Qi>Qe.y?[]:o.clipLine([Rt],dt.x,dt.y,Qe.x,Qe.y)}for(const Rt of Ei){Tt.reset(Rt,.25*Ve);let ii=0;ii=Tt.length<=.5*Ve?1:Math.ceil(Tt.paddedLength/Ht)+1;for(let Li=0;Li<ii;Li++){const Qi=Li/Math.max(ii-1,1),br=Tt.lerp(Qi),qi=br.x+Ri,xn=br.y+Ri;H.push(qi,xn,Ve,0);const Lo=qi-Ve,Os=xn-Ve,Ki=qi+Ve,pr=xn+Ve;if(gt=gt&&this.isOffscreen(Lo,Os,Ki,pr),rt=rt||this.isInsideGrid(Lo,Os,Ki,pr),!s&&this.grid.hitTestCircle(qi,xn,Ve,Z)&&(He=!0,!k))return{circles:[],offscreen:!1,collisionDetected:He,occluded:!1}}}}return{circles:!k&&He||!rt?[]:H,offscreen:gt,collisionDetected:He,occluded:fe.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,m=1/0,_=-1/0,x=-1/0;for(const k of r){const j=new o.pointGeometry(k.x+Ri,k.y+Ri);h=Math.min(h,j.x),m=Math.min(m,j.y),_=Math.max(_,j.x),x=Math.max(x,j.y),s.push(j)}const w=this.grid.query(h,m,_,x).concat(this.ignoredGrid.query(h,m,_,x)),A={},P={};for(const k of w){const j=k.key;if(A[j.bucketInstanceId]===void 0&&(A[j.bucketInstanceId]={}),A[j.bucketInstanceId][j.featureIndex])continue;const Z=[new o.pointGeometry(k.x1,k.y1),new o.pointGeometry(k.x2,k.y1),new o.pointGeometry(k.x2,k.y2),new o.pointGeometry(k.x1,k.y2)];o.polygonIntersectsPolygon(s,Z)&&(A[j.bucketInstanceId][j.featureIndex]=!0,P[j.bucketInstanceId]===void 0&&(P[j.bucketInstanceId]=[]),P[j.bucketInstanceId].push(j.featureIndex))}return P}insertCollisionBox(r,s,h,m,_){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:_},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,s,h,m,_){const x=s?this.ignoredGrid:this.grid,w={bucketInstanceId:h,featureIndex:m,collisionGroupID:_};for(let A=0;A<r.length;A+=4)x.insertCircle(w,r[A],r[A+1],r[A+2])}projectAndGetPerspectiveRatio(r,s,h,m,_){const x=[s[0],s[1],s[2],1];let w=!1;if(s[2]||this.transform.pitch>0){o.transformMat4$1(x,x,r);const A=_.name==="globe";this.fogState&&h&&!A&&(w=function(P,k,j,Z,te,ee){const J=ee.calculateFogTileMatrix(te),H=[k,j,Z];return o.transformMat4(H,H,J),xr(P,H,ee.pitch,ee._fov)}(this.fogState,s[0],s[1],s[2],h.toUnwrapped(),this.transform)>.9)}else ln(x,x,r);return{point:new o.pointGeometry((x[0]/x[3]+1)/2*this.transform.width+Ri,(-x[1]/x[3]+1)/2*this.transform.height+Ri),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(_)/x[3]*.5,1.5),signedDistanceFromCamera:x[3],occluded:m&&x[2]>x[3]||w}}isOffscreen(r,s,h,m){return h<Ri||r>=this.screenRightBoundary||m<Ri||s>this.screenBottomBoundary}isInsideGrid(r,s,h,m){return h>=0&&r<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const r=o.identity([]);return o.translate(r,r,[-100,-100,0]),r}}function Qs(l,r,s){const h=r.createTileMatrix(l,l.worldSize,s.toUnwrapped());return o.multiply(new Float32Array(16),l.projMatrix,h)}function Nr(l,r,s){if(r.projection.name===s.projection.name)return l.projMatrix;const h=s.clone();return h.setProjection(r.projection),Qs(h,r.getProjection(),l)}function Rn(l,r,s){return r.name===s.projection.name?l.projMatrix:Qs(s,r,l)}class Ll{constructor(r,s,h,m){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?s:-s))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Qo{constructor(r,s,h,m,_,x=!1){this.text=new Ll(r?r.text:null,s,h,_),this.icon=new Ll(r?r.icon:null,s,m,_),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class gr{constructor(r,s,h,m=!1){this.text=r,this.icon=s,this.skipFade=h,this.clipped=m}}class Sa{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class ea{constructor(r,s,h,m,_){this.bucketInstanceId=r,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=_}}class tl{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const s=++this.maxGroupID;this.collisionGroups[r]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[r]}}function Yr(l,r,s,h,m){const{horizontalAlign:_,verticalAlign:x}=o.getAnchorAlignment(l),w=-(_-.5)*r,A=-(x-.5)*s,P=o.evaluateVariableOffset(l,h);return new o.pointGeometry(w+P[0]*m,A+P[1]*m)}function Ia(l,r,s,h,m){const _=new o.pointGeometry(l,r);return s&&_._rotate(h?m:-m),_}class ac{constructor(r,s,h,m,_){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Jo(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new tl(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,s,h,m){const _=h.getBucket(s),x=h.latestFeatureIndex;if(!_||!x||s.id!==_.layerIds[0])return;const w=_.layers[0].layout,A=h.collisionBoxArray,P=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),k=h.tileSize/o.EXTENT,j=h.tileID.toUnwrapped();this.transform.setProjection(_.projection);const Z=(te=h.tileID,ee=_.getProjection(),J=this.transform,ee.name===this.projection?J.calculateProjMatrix(te.toUnwrapped()):Qs(J,ee,te));var te,ee,J;const H=w.get("text-pitch-alignment")==="map",K=w.get("text-rotation-alignment")==="map";s.compileFilter();const se=s.dynamicFilter(),ie=s.dynamicFilterNeedsFeature(),xe=this.transform.calculatePixelsToTileUnitsMatrix(h),ye=fi(Z,h.tileID.canonical,H,K,this.transform,_.getProjection(),xe);let he=null;if(H){const Ee=no(Z,h.tileID.canonical,H,K,this.transform,_.getProjection(),xe);he=o.multiply([],this.transform.labelPlaneMatrix,Ee)}let ve=null;se&&h.latestFeatureIndex&&(ve={unwrappedTileID:j,dynamicFilter:se,dynamicFilterNeedsFeature:ie,featureIndex:h.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new ea(_.bucketInstanceId,x,_.sourceLayerIndex,_.index,h.tileID);const fe={bucket:_,layout:w,posMatrix:Z,textLabelPlaneMatrix:ye,labelToScreenMatrix:he,clippingData:ve,scale:P,textPixelRatio:k,holdingForFade:h.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(m)for(const Ee of _.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:ht,symbolInstanceEnd:Pe}=Ee;r.push({sortKey:Le,symbolInstanceStart:ht,symbolInstanceEnd:Pe,parameters:fe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:fe})}attemptAnchorPlacement(r,s,h,m,_,x,w,A,P,k,j,Z,te,ee,J,H,K,se){const ie=[Z.textOffset0,Z.textOffset1],xe=Yr(r,h,m,ie,_),ye=this.collisionIndex.placeCollisionBox(ee,_,s,Ia(xe.x,xe.y,x,w,this.transform.angle),j,A,P,k.predicate);if((!H||this.collisionIndex.placeCollisionBox(ee,ee.getSymbolInstanceIconSize(se,this.transform.zoom,te),H,Ia(xe.x,xe.y,x,w,this.transform.angle),j,A,P,k.predicate).box.length!==0)&&ye.box.length>0){let he;return this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(he=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),this.variableOffsets[Z.crossTileID]={textOffset:ie,width:h,height:m,anchor:r,textScale:_,prevAnchor:he},this.markUsedJustification(ee,r,Z,J),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,J,Z),this.placedOrientations[Z.crossTileID]=J),{shift:xe,placedGlyphBoxes:ye}}}placeLayerBucketPart(r,s,h,m){const{bucket:_,layout:x,posMatrix:w,textLabelPlaneMatrix:A,labelToScreenMatrix:P,clippingData:k,textPixelRatio:j,holdingForFade:Z,collisionBoxArray:te,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:J,collisionGroup:H}=r.parameters,K=x.get("text-optional"),se=x.get("icon-optional"),ie=x.get("text-allow-overlap"),xe=x.get("icon-allow-overlap"),ye=x.get("text-rotation-alignment")==="map",he=x.get("text-pitch-alignment")==="map",ve=x.get("icon-text-fit")!=="none",fe=x.get("symbol-z-order")==="viewport-y";this.transform.setProjection(_.projection);let Ee=ie&&(xe||!_.hasIconData()||se),Le=xe&&(ie||!_.hasTextData()||K);!_.collisionArrays&&te&&_.deserializeCollisionBoxes(te),h&&m&&_.updateCollisionDebugBuffers(this.transform.zoom,te);const ht=(Pe,He,rt)=>{if(k){const Ki={zoom:this.transform.zoom,pitch:this.transform.pitch};let pr=null;if(k.dynamicFilterNeedsFeature){const gi=this.retainedQueryData[_.bucketInstanceId];pr=k.featureIndex.loadFeature({featureIndex:Pe.featureIndex,bucketIndex:gi.bucketIndex,sourceLayerIndex:gi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(Ki,pr,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new o.pointGeometry(Pe.tileAnchorX,Pe.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[Pe.crossTileID]=new gr(!1,!1,!1,!0),void(s[Pe.crossTileID]=!0)}if(s[Pe.crossTileID])return;if(Z)return void(this.placements[Pe.crossTileID]=new gr(!1,!1,!1));let gt=!1,Ve=!1,dt=!0,Qe=!1,Tt=!1,wt=null,Ot={box:null,offscreen:null,occluded:null},Nt={box:null,offscreen:null,occluded:null},Ht=null,Ei=null,Rt=null,ii=0,Li=0,Qi=0;rt.textFeatureIndex?ii=rt.textFeatureIndex:Pe.useRuntimeCollisionCircles&&(ii=Pe.featureIndex),rt.verticalTextFeatureIndex&&(Li=rt.verticalTextFeatureIndex);const br=Ki=>{Ki.tileID=this.retainedQueryData[_.bucketInstanceId].tileID,(this.transform.elevation||Ki.elevation)&&(Ki.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[_.bucketInstanceId].tileID,Ki.tileAnchorX,Ki.tileAnchorY):0)},qi=rt.textBox;if(qi){br(qi);const Ki=gi=>{let Rr=o.WritingMode.horizontal;if(_.allowVerticalPlacement&&!gi&&this.prevPlacement){const Nn=this.prevPlacement.placedOrientations[Pe.crossTileID];Nn&&(this.placedOrientations[Pe.crossTileID]=Nn,Rr=Nn,this.markUsedOrientation(_,Rr,Pe))}return Rr},pr=(gi,Rr)=>{if(_.allowVerticalPlacement&&Pe.numVerticalGlyphVertices>0&&rt.verticalTextBox){for(const Nn of _.writingModes)if(Nn===o.WritingMode.vertical?(Ot=Rr(),Nt=Ot):Ot=gi(),Ot&&Ot.box&&Ot.box.length)break}else Ot=gi()};if(x.get("text-variable-anchor")){let gi=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Pe.crossTileID]){const Yi=this.prevPlacement.variableOffsets[Pe.crossTileID];gi.indexOf(Yi.anchor)>0&&(gi=gi.filter(jn=>jn!==Yi.anchor),gi.unshift(Yi.anchor))}const Rr=(Yi,jn,pa)=>{const Vn=_.getSymbolInstanceTextSize(ee,Pe,this.transform.zoom,He),ma=(Yi.x2-Yi.x1)*Vn+2*Yi.padding,_l=(Yi.y2-Yi.y1)*Vn+2*Yi.padding,_a=ve&&!xe?jn:null;_a&&br(_a);let Jt={box:[],offscreen:!1,occluded:!1};const gl=ie?2*gi.length:gi.length;for(let ja=0;ja<gl;++ja){const ga=this.attemptAnchorPlacement(gi[ja%gi.length],Yi,ma,_l,Vn,ye,he,j,w,H,ja>=gi.length,Pe,He,_,pa,_a,ee,J);if(ga&&(Jt=ga.placedGlyphBoxes,Jt&&Jt.box&&Jt.box.length)){gt=!0,wt=ga.shift;break}}return Jt};pr(()=>Rr(qi,rt.iconBox,o.WritingMode.horizontal),()=>{const Yi=rt.verticalTextBox;return Yi&&br(Yi),_.allowVerticalPlacement&&!(Ot&&Ot.box&&Ot.box.length)&&Pe.numVerticalGlyphVertices>0&&Yi?Rr(Yi,rt.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Ot&&(gt=Ot.box,dt=Ot.offscreen,Qe=Ot.occluded);const Nn=Ki(Ot&&Ot.box);if(!gt&&this.prevPlacement){const Yi=this.prevPlacement.variableOffsets[Pe.crossTileID];Yi&&(this.variableOffsets[Pe.crossTileID]=Yi,this.markUsedJustification(_,Yi.anchor,Pe,Nn))}}else{const gi=(Rr,Nn)=>{const Yi=_.getSymbolInstanceTextSize(ee,Pe,this.transform.zoom,He),jn=this.collisionIndex.placeCollisionBox(_,Yi,Rr,new o.pointGeometry(0,0),ie,j,w,H.predicate);return jn&&jn.box&&jn.box.length&&(this.markUsedOrientation(_,Nn,Pe),this.placedOrientations[Pe.crossTileID]=Nn),jn};pr(()=>gi(qi,o.WritingMode.horizontal),()=>{const Rr=rt.verticalTextBox;return _.allowVerticalPlacement&&Pe.numVerticalGlyphVertices>0&&Rr?(br(Rr),gi(Rr,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Ki(Ot&&Ot.box&&Ot.box.length)}}if(Ht=Ot,gt=Ht&&Ht.box&&Ht.box.length>0,dt=Ht&&Ht.offscreen,Qe=Ht&&Ht.occluded,Pe.useRuntimeCollisionCircles){const Ki=_.text.placedSymbolArray.get(Pe.centerJustifiedTextSymbolIndex>=0?Pe.centerJustifiedTextSymbolIndex:Pe.verticalPlacedTextSymbolIndex),pr=o.evaluateSizeForFeature(_.textSizeData,ee,Ki),gi=x.get("text-padding");Ei=this.collisionIndex.placeCollisionCircles(_,ie,Ki,_.lineVertexArray,_.glyphOffsetArray,pr,w,A,P,h,he,H.predicate,Pe.collisionCircleDiameter*pr/o.ONE_EM,gi,this.retainedQueryData[_.bucketInstanceId].tileID),gt=ie||Ei.circles.length>0&&!Ei.collisionDetected,dt=dt&&Ei.offscreen,Qe=Ei.occluded}if(rt.iconFeatureIndex&&(Qi=rt.iconFeatureIndex),rt.iconBox){const Ki=pr=>{br(pr);const gi=ve&&wt?Ia(wt.x,wt.y,ye,he,this.transform.angle):new o.pointGeometry(0,0),Rr=_.getSymbolInstanceIconSize(J,this.transform.zoom,He);return this.collisionIndex.placeCollisionBox(_,Rr,pr,gi,xe,j,w,H.predicate)};Nt&&Nt.box&&Nt.box.length&&rt.verticalIconBox?(Rt=Ki(rt.verticalIconBox),Ve=Rt.box.length>0):(Rt=Ki(rt.iconBox),Ve=Rt.box.length>0),dt=dt&&Rt.offscreen,Tt=Rt.occluded}const xn=K||Pe.numHorizontalGlyphVertices===0&&Pe.numVerticalGlyphVertices===0,Lo=se||Pe.numIconVertices===0;if(xn||Lo?Lo?xn||(Ve=Ve&&gt):gt=Ve&&gt:Ve=gt=Ve&&gt,gt&&Ht&&Ht.box&&this.collisionIndex.insertCollisionBox(Ht.box,x.get("text-ignore-placement"),_.bucketInstanceId,Nt&&Nt.box&&Li?Li:ii,H.ID),Ve&&Rt&&this.collisionIndex.insertCollisionBox(Rt.box,x.get("icon-ignore-placement"),_.bucketInstanceId,Qi,H.ID),Ei&&(gt&&this.collisionIndex.insertCollisionCircles(Ei.circles,x.get("text-ignore-placement"),_.bucketInstanceId,ii,H.ID),h)){const Ki=_.bucketInstanceId;let pr=this.collisionCircleArrays[Ki];pr===void 0&&(pr=this.collisionCircleArrays[Ki]=new Sa);for(let gi=0;gi<Ei.circles.length;gi+=4)pr.circles.push(Ei.circles[gi+0]),pr.circles.push(Ei.circles[gi+1]),pr.circles.push(Ei.circles[gi+2]),pr.circles.push(Ei.collisionDetected?1:0)}const Os=_.projection.name!=="globe";Ee=Ee&&(Os||!Qe),Le=Le&&(Os||!Tt),this.placements[Pe.crossTileID]=new gr(gt||Ee,Ve||Le,dt||_.justReloaded),s[Pe.crossTileID]=!0};if(fe){const Pe=_.getSortedSymbolIndexes(this.transform.angle);for(let He=Pe.length-1;He>=0;--He){const rt=Pe[He];ht(_.symbolInstances.get(rt),rt,_.collisionArrays[rt])}}else for(let Pe=r.symbolInstanceStart;Pe<r.symbolInstanceEnd;Pe++)ht(_.symbolInstances.get(Pe),Pe,_.collisionArrays[Pe]);if(h&&_.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[_.bucketInstanceId];o.invert(Pe.invProjMatrix,w),Pe.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(r,s,h,m){let _;_=m===o.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(s)];const x=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const w of x)w>=0&&(r.text.placedSymbolArray.get(w).crossTileID=_>=0&&w!==_?0:h.crossTileID)}markUsedOrientation(r,s,h){const m=s===o.WritingMode.horizontal||s===o.WritingMode.horizontalOnly?s:0,_=s===o.WritingMode.vertical?s:0,x=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const w of x)r.text.placedSymbolArray.get(w).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(r):1,_=s?s.opacities:{},x=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const A in this.placements){const P=this.placements[A],k=_[A];k?(this.opacities[A]=new Qo(k,m,P.text,P.icon,null,P.clipped),h=h||P.text!==k.text.placed||P.icon!==k.icon.placed):(this.opacities[A]=new Qo(null,m,P.text,P.icon,P.skipFade,P.clipped),h=h||P.text||P.icon)}for(const A in _){const P=_[A];if(!this.opacities[A]){const k=new Qo(P,m,!1,!1);k.isHidden()||(this.opacities[A]=k,h=h||P.text.placed||P.icon.placed)}}for(const A in x)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=x[A]);for(const A in w)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=w[A]);h?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:r)}updateLayerOpacities(r,s){const h={};for(const m of s){const _=m.getBucket(r);_&&m.latestFeatureIndex&&r.id===_.layerIds[0]&&this.updateBucketOpacities(_,h,m.collisionBoxArray)}}updateBucketOpacities(r,s,h){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const m=r.layers[0].layout,_=!!r.layers[0].dynamicFilter(),x=new Qo(null,0,!1,!1,!0),w=m.get("text-allow-overlap"),A=m.get("icon-allow-overlap"),P=m.get("text-variable-anchor"),k=m.get("text-rotation-alignment")==="map",j=m.get("text-pitch-alignment")==="map",Z=m.get("icon-text-fit")!=="none",te=new Qo(null,0,w&&(A||!r.hasIconData()||m.get("icon-optional")),A&&(w||!r.hasTextData()||m.get("text-optional")),!0);!r.collisionArrays&&h&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(h);const ee=(H,K,se)=>{for(let ie=0;ie<K/4;ie++)H.opacityVertexArray.emplaceBack(se)};let J=0;for(let H=0;H<r.symbolInstances.length;H++){const K=r.symbolInstances.get(H),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:ie,crossTileID:xe}=K;let ye=this.opacities[xe];s[xe]?ye=x:ye||(ye=te,this.opacities[xe]=ye),s[xe]=!0;const he=se>0||ie>0,ve=K.numIconVertices>0,fe=this.placedOrientations[K.crossTileID],Ee=fe===o.WritingMode.vertical,Le=fe===o.WritingMode.horizontal||fe===o.WritingMode.horizontalOnly;if(!he&&!ve||ye.isHidden()||J++,he){const ht=bs(ye.text);ee(r.text,se,Ee?zi:ht),ee(r.text,ie,Le?zi:ht);const Pe=ye.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach(gt=>{gt>=0&&(r.text.placedSymbolArray.get(gt).hidden=Pe||Ee?1:0)}),K.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=Pe||Le?1:0);const He=this.variableOffsets[K.crossTileID];He&&this.markUsedJustification(r,He.anchor,K,fe);const rt=this.placedOrientations[K.crossTileID];rt&&(this.markUsedJustification(r,"left",K,rt),this.markUsedOrientation(r,rt,K))}if(ve){const ht=bs(ye.icon);K.placedIconSymbolIndex>=0&&(ee(r.icon,K.numIconVertices,Ee?zi:ht),r.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=ye.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(ee(r.icon,K.numVerticalIconVertices,Le?zi:ht),r.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=ye.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const ht=r.collisionArrays[H];if(ht){let Pe=new o.pointGeometry(0,0),He=!0;if(ht.textBox||ht.verticalTextBox){if(P){const gt=this.variableOffsets[xe];gt?(Pe=Yr(gt.anchor,gt.width,gt.height,gt.textOffset,gt.textScale),k&&Pe._rotate(j?this.transform.angle:-this.transform.angle)):He=!1}_&&(He=!ye.clipped),ht.textBox&&so(r.textCollisionBox.collisionVertexArray,ye.text.placed,!He||Ee,Pe.x,Pe.y),ht.verticalTextBox&&so(r.textCollisionBox.collisionVertexArray,ye.text.placed,!He||Le,Pe.x,Pe.y)}const rt=He&&Boolean(!Le&&ht.verticalIconBox);ht.iconBox&&so(r.iconCollisionBox.collisionVertexArray,ye.icon.placed,rt,Z?Pe.x:0,Z?Pe.y:0),ht.verticalIconBox&&so(r.iconCollisionBox.collisionVertexArray,ye.icon.placed,!rt,Z?Pe.x:0,Z?Pe.y:0)}}}if(r.fullyClipped=J===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=H.invProjMatrix,r.placementViewportMatrix=H.viewportMatrix,r.collisionCircleArray=H.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>r}setStale(){this.stale=!0}}function so(l,r,s,h,m){l.emplaceBack(r?1:0,s?1:0,h||0,m||0),l.emplaceBack(r?1:0,s?1:0,h||0,m||0),l.emplaceBack(r?1:0,s?1:0,h||0,m||0),l.emplaceBack(r?1:0,s?1:0,h||0,m||0)}const il=Math.pow(2,25),Ol=Math.pow(2,24),Rl=Math.pow(2,17),Bl=Math.pow(2,16),Ma=Math.pow(2,9),xh=Math.pow(2,8),Oc=Math.pow(2,1);function bs(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const r=l.placed?1:0,s=Math.floor(127*l.opacity);return s*il+r*Ol+s*Rl+r*Bl+s*Ma+r*xh+s*Oc+r}const zi=0;class Xi{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,s,h,m,_){const x=this._bucketParts;for(;this._currentTileIndex<r.length;)if(s.getBucketParts(x,m,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((w,A)=>w.sortKey-A.sortKey));this._currentPartIndex<x.length;){const w=x[this._currentPartIndex];if(s.placeLayerBucketPart(w,this._seenCrossTileIDs,h,w.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class ws{constructor(r,s,h,m,_,x,w,A){this.placement=new ac(r,_,x,w,A),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(r,s,h){const m=o.exported.now(),_=()=>{const x=o.exported.now()-m;return!this._forceFullPlacement&&x>2};for(;this._currentPlacementIndex>=0;){const x=s[r[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=w)&&(!x.maxzoom||x.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Xi(x)),this._inProgressLayer.continuePlacement(h[x.source],this.placement,this._showCollisionBoxes,x,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const lc=512/o.EXTENT/2;class Fl{constructor(r,s,h){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(let m=0;m<s.length;m++){const _=s.get(m),x=_.key;this.indexedSymbolInstances[x]||(this.indexedSymbolInstances[x]=[]),this.indexedSymbolInstances[x].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,r)})}}getScaledCoordinates(r,s){const h=lc/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*o.EXTENT+r.tileAnchorX)*h),y:Math.floor((s.canonical.y*o.EXTENT+r.tileAnchorY)*h)}}findMatches(r,s,h){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let _=0;_<r.length;_++){const x=r.get(_);if(x.crossTileID)continue;const w=this.indexedSymbolInstances[x.key];if(!w)continue;const A=this.getScaledCoordinates(x,s);for(const P of w)if(Math.abs(P.coord.x-A.x)<=m&&Math.abs(P.coord.y-A.y)<=m&&!h[P.crossTileID]){h[P.crossTileID]=!0,x.crossTileID=P.crossTileID;break}}}}class cc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Rc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const s=Math.round((r-this.lng)/360);if(s!==0)for(const h in this.indexes){const m=this.indexes[h],_={};for(const x in m){const w=m[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),_[w.tileID.key]=w}this.indexes[h]=_}this.lng=r}addBucket(r,s,h){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let _=0;_<s.symbolInstances.length;_++)s.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const m=this.usedCrossTileIDs[r.overscaledZ];for(const _ in this.indexes){const x=this.indexes[_];if(Number(_)>r.overscaledZ)for(const w in x){const A=x[w];A.tileID.isChildOf(r)&&A.findMatches(s.symbolInstances,r,m)}else{const w=x[r.scaledTo(Number(_)).key];w&&w.findMatches(s.symbolInstances,r,m)}}for(let _=0;_<s.symbolInstances.length;_++){const x=s.symbolInstances.get(_);x.crossTileID||(x.crossTileID=h.generate(),m[x.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Fl(r,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(r,s){for(const h in s.indexedSymbolInstances)for(const m of s.indexedSymbolInstances[h])delete this.usedCrossTileIDs[r][m.crossTileID]}removeStaleBuckets(r){let s=!1;for(const h in this.indexes){const m=this.indexes[h];for(const _ in m)r[m[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[_]),delete m[_],s=!0)}return s}}class es{constructor(){this.layerIndexes={},this.crossTileIDs=new cc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,s,h,m){let _=this.layerIndexes[r.id];_===void 0&&(_=this.layerIndexes[r.id]=new Rc);let x=!1;const w={};m.name!=="globe"&&_.handleWrapJump(h);for(const A of s){const P=A.getBucket(r);P&&r.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(A.tileID,P,this.crossTileIDs)&&(x=!0),w[P.bucketInstanceId]=!0)}return _.removeStaleBuckets(w)&&(x=!0),x}pruneUnusedLayers(r){const s={};r.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const rl=(l,r)=>o.emitValidationErrors(l,r&&r.filter(s=>s.identifier!=="source.canvas")),Bc=o.pick(Ft,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Jr=o.pick(Ft,["setCenter","setZoom","setBearing","setPitch"]),Ul={version:8,layers:[],sources:{}},Ts={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Bn extends o.Evented{constructor(r,s={}){super(),this.map=r,this.dispatcher=new mn(ji(),this),this.imageManager=new vt,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(r._requestManager,s.localFontFamily?o.LocalGlyphMode.all:s.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new es,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const h=this;this._rtlTextPluginCallback=Bn.registerForPluginStateChange(m=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(_,x)=>{if(o.triggerPluginCompletionEvent(_),x&&x.every(w=>w))for(const w in h._sourceCaches){const A=h._sourceCaches[w],P=A.getSource().type;P!=="vector"&&P!=="geojson"||A.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const _=this.getSource(m.sourceId);if(_&&_.vectorLayerIds)for(const x in this._layers){const w=this._layers[x];w.source===_.id&&this._validateLayer(w)}})}loadURL(r,s={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!o.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,s.accessToken);const m=this.map._requestManager.transformRequest(r,o.ResourceType.Style);this._request=o.getJSON(m,(_,x)=>{this._request=null,_?this.fire(new o.ErrorEvent(_)):x&&this._load(x,h)})}loadJSON(r,s={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(r,s.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Ul,!1)}_updateLayerCount(r,s){const h=s?1:-1;r.is3D()&&(this._num3DLayers+=h),r.type==="circle"&&(this._numCircleLayers+=h),r.type==="symbol"&&(this._numSymbolLayers+=h)}_load(r,s){if(s&&rl(this,o.validateStyle(r)))return;this._loaded=!0,this.stylesheet=o.clone$1(r),this._updateMapProjection();for(const m in r.sources)this.addSource(m,r.sources[m],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const h=xi(this.stylesheet.layers);this._order=h.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of h)m=o.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ni(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(s,h,m){let _,x,w;const A=o.exported.devicePixelRatio>1?"@2x":"";let P=o.getJSON(h.transformRequest(h.normalizeSpriteURL(s,A,".json"),o.ResourceType.SpriteJSON),(Z,te)=>{P=null,w||(w=Z,_=te,j())}),k=o.getImage(h.transformRequest(h.normalizeSpriteURL(s,A,".png"),o.ResourceType.SpriteImage),(Z,te)=>{k=null,w||(w=Z,x=te,j())});function j(){if(w)m(w);else if(_&&x){const Z=o.exported.getImageData(x),te={};for(const ee in _){const{width:J,height:H,x:K,y:se,sdf:ie,pixelRatio:xe,stretchX:ye,stretchY:he,content:ve}=_[ee],fe=new o.RGBAImage({width:J,height:H});o.RGBAImage.copy(Z,fe,{x:K,y:se},{x:0,y:0},{width:J,height:H}),te[ee]={data:fe,pixelRatio:xe,sdf:ie,stretchX:ye,stretchY:he,content:ve}}m(null,te)}}return{cancel(){P&&(P.cancel(),P=null),k&&(k.cancel(),k=null)}}}(r,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new o.ErrorEvent(s));else if(h)for(const m in h)this.imageManager.addImage(m,h[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(r){const s=this.getSource(r.source);if(!s)return;const h=r.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const s=[];for(const h of r){const m=this._layers[h];m.type!=="custom"&&s.push(m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&Ts[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const s=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(m.length||_.length)&&this._updateWorkerLayers(m,_);for(const x in this._updatedSources){const w=this._updatedSources[x];w==="reload"?this._reloadSource(x):w==="clear"&&this._clearSource(x)}this._updateTilesForChangedImages();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const h={};for(const m in this._sourceCaches){const _=this._sourceCaches[m];h[m]=_.used,_.used=!1}for(const m of this._order){const _=this._layers[m];if(_.recalculate(r,this._availableImages),!_.isHidden(r.zoom)){const w=this._getLayerSourceCache(_);w&&(w.used=!0)}const x=this.map.painter;if(x){const w=_.getProgramIds();if(!w)continue;const A=_.getProgramConfiguration(r.zoom);for(const P of w)x.useProgram(P,A)}}for(const m in h){const _=this._sourceCaches[m];h[m]!==_.used&&_.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),rl(this,o.validateStyle(r)))return!1;(r=o.clone$1(r)).layers=xi(r.layers);const s=function(m,_){if(!m)return[{command:Ft.setStyle,args:[_]}];let x=[];try{if(!Q(m.version,_.version))return[{command:Ft.setStyle,args:[_]}];Q(m.center,_.center)||x.push({command:Ft.setCenter,args:[_.center]}),Q(m.zoom,_.zoom)||x.push({command:Ft.setZoom,args:[_.zoom]}),Q(m.bearing,_.bearing)||x.push({command:Ft.setBearing,args:[_.bearing]}),Q(m.pitch,_.pitch)||x.push({command:Ft.setPitch,args:[_.pitch]}),Q(m.sprite,_.sprite)||x.push({command:Ft.setSprite,args:[_.sprite]}),Q(m.glyphs,_.glyphs)||x.push({command:Ft.setGlyphs,args:[_.glyphs]}),Q(m.transition,_.transition)||x.push({command:Ft.setTransition,args:[_.transition]}),Q(m.light,_.light)||x.push({command:Ft.setLight,args:[_.light]}),Q(m.fog,_.fog)||x.push({command:Ft.setFog,args:[_.fog]}),Q(m.projection,_.projection)||x.push({command:Ft.setProjection,args:[_.projection]});const w={},A=[];(function(j,Z,te,ee){let J;for(J in Z=Z||{},j=j||{})j.hasOwnProperty(J)&&(Z.hasOwnProperty(J)||sn(J,te,ee));for(J in Z)Z.hasOwnProperty(J)&&(j.hasOwnProperty(J)?Q(j[J],Z[J])||(j[J].type==="geojson"&&Z[J].type==="geojson"&&ys(j,Z,J)?te.push({command:Ft.setGeoJSONSourceData,args:[J,Z[J].data]}):ur(J,Z,te,ee)):$e(J,Z,te))})(m.sources,_.sources,A,w);const P=[];m.layers&&m.layers.forEach(j=>{j.source&&w[j.source]?x.push({command:Ft.removeLayer,args:[j.id]}):P.push(j)});let k=m.terrain;k&&w[k.source]&&(x.push({command:Ft.setTerrain,args:[void 0]}),k=void 0),x=x.concat(A),Q(k,_.terrain)||x.push({command:Ft.setTerrain,args:[_.terrain]}),function(j,Z,te){Z=Z||[];const ee=(j=j||[]).map(ro),J=Z.map(ro),H=j.reduce(Ta,{}),K=Z.reduce(Ta,{}),se=ee.slice(),ie=Object.create(null);let xe,ye,he,ve,fe,Ee,Le;for(xe=0,ye=0;xe<ee.length;xe++)he=ee[xe],K.hasOwnProperty(he)?ye++:(te.push({command:Ft.removeLayer,args:[he]}),se.splice(se.indexOf(he,ye),1));for(xe=0,ye=0;xe<J.length;xe++)he=J[J.length-1-xe],se[se.length-1-xe]!==he&&(H.hasOwnProperty(he)?(te.push({command:Ft.removeLayer,args:[he]}),se.splice(se.lastIndexOf(he,se.length-ye),1)):ye++,Ee=se[se.length-xe],te.push({command:Ft.addLayer,args:[K[he],Ee]}),se.splice(se.length-xe,0,he),ie[he]=!0);for(xe=0;xe<J.length;xe++)if(he=J[xe],ve=H[he],fe=K[he],!ie[he]&&!Q(ve,fe))if(Q(ve.source,fe.source)&&Q(ve["source-layer"],fe["source-layer"])&&Q(ve.type,fe.type)){for(Le in kl(ve.layout,fe.layout,te,he,null,Ft.setLayoutProperty),kl(ve.paint,fe.paint,te,he,null,Ft.setPaintProperty),Q(ve.filter,fe.filter)||te.push({command:Ft.setFilter,args:[he,fe.filter]}),Q(ve.minzoom,fe.minzoom)&&Q(ve.maxzoom,fe.maxzoom)||te.push({command:Ft.setLayerZoomRange,args:[he,fe.minzoom,fe.maxzoom]}),ve)ve.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?kl(ve[Le],fe[Le],te,he,Le.slice(6),Ft.setPaintProperty):Q(ve[Le],fe[Le])||te.push({command:Ft.setLayerProperty,args:[he,Le,fe[Le]]}));for(Le in fe)fe.hasOwnProperty(Le)&&!ve.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?kl(ve[Le],fe[Le],te,he,Le.slice(6),Ft.setPaintProperty):Q(ve[Le],fe[Le])||te.push({command:Ft.setLayerProperty,args:[he,Le,fe[Le]]}))}else te.push({command:Ft.removeLayer,args:[he]}),Ee=se[se.lastIndexOf(he)+1],te.push({command:Ft.addLayer,args:[fe,Ee]})}(P,_.layers,x)}catch(w){console.warn("Unable to compute style diff:",w),x=[{command:Ft.setStyle,args:[_]}]}return x}(this.serialize(),r).filter(m=>!(m.command in Jr));if(s.length===0)return!1;const h=s.filter(m=>!(m.command in Bc));if(h.length>0)throw new Error(`Unimplemented: ${h.map(m=>m.command).join(", ")}.`);return s.forEach(m=>{m.command!=="setTransition"&&m.command!=="setProjection"&&this[m.command].apply(this,m.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,s){return this.getImage(r)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,s),this._afterImageUpdated(r),this)}updateImage(r,s){this.imageManager.updateImage(r,s)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,s,h={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.validateSource,`sources.${r}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=ke(r,s,this.dispatcher,this);m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:m.serialize(),sourceId:r}));const _=x=>{const w=(x?"symbol:":"other:")+r,A=this._sourceCaches[w]=new o.SourceCache(w,m,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[r]=A,A.style=this,A.onAdd(this.map)};_(!1),s.type!=="vector"&&s.type!=="geojson"||_(!0),m.onAdd&&m.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const s=this.getSource(r);if(!s)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const h=this._getSourceCaches(r);for(const m of h)delete this._sourceCaches[m.id],delete this._updatedSources[m.id],m.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,s){this._checkLoaded(),this.getSource(r).setData(s),this._changed=!0}getSource(r){const s=this._getSourceCache(r);return s&&s.getSource()}addLayer(r,s,h={}){this._checkLoaded();const m=r.id;if(this.getLayer(m))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${m}" already exists on this map`)));let _;if(r.type==="custom"){if(rl(this,o.validateCustomStyleLayer(r)))return;_=o.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(m,r.source),r=o.clone$1(r),r=o.extend(r,{source:m})),this._validate(o.validateLayer,`layers.${m}`,r,{arrayIndex:-1},h))return;_=o.createStyleLayer(r),this._validateLayer(_),_.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}const x=s?this._order.indexOf(s):this._order.length;if(s&&x===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(x,0,m),this._layerOrderChanged=!0,this._layers[m]=_;const w=this._getLayerSourceCache(_);if(this._removedLayers[m]&&_.source&&w&&_.type!=="custom"){const A=this._removedLayers[m];delete this._removedLayers[m],A.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",w.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,s){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===s)return;const h=this._order.indexOf(r);this._order.splice(h,1);const m=s?this._order.indexOf(s):this._order.length;s&&m===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(m,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const s=this._layers[r];if(!s)return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);const h=this._order.indexOf(r);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=s,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const s in this._layers)if(this._layers[s].type===r)return!0;return!1}setLayerZoomRange(r,s,h){this._checkLoaded();const m=this.getLayer(r);m?m.minzoom===s&&m.maxzoom===h||(s!=null&&(m.minzoom=s),h!=null&&(m.maxzoom=h),this._updateLayer(m)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,s,h={}){this._checkLoaded();const m=this.getLayer(r);if(m){if(!Q(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(o.validateFilter,`layers.${m.id}.filter`,s,{layerType:m.type},h)||(m.filter=o.clone$1(s),this._updateLayer(m)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const s=this.getLayer(r);return s&&o.clone$1(s.filter)}setLayoutProperty(r,s,h,m={}){this._checkLoaded();const _=this.getLayer(r);_?Q(_.getLayoutProperty(s),h)||(_.setLayoutProperty(s,h,m),this._updateLayer(_)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,s){const h=this.getLayer(r);if(h)return h.getLayoutProperty(s);this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,s,h,m={}){this._checkLoaded();const _=this.getLayer(r);_?Q(_.getPaintProperty(s),h)||(_.setPaintProperty(s,h,m)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,s){const h=this.getLayer(r);return h&&h.getPaintProperty(s)}setFeatureState(r,s){this._checkLoaded();const h=r.source,m=r.sourceLayer,_=this.getSource(h);if(!_)return void this.fire(new o.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const x=_.type;if(x==="geojson"&&m)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!m)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const w=this._getSourceCaches(h);for(const A of w)A.setFeatureState(m,r.id,s)}removeFeatureState(r,s){this._checkLoaded();const h=r.source,m=this.getSource(h);if(!m)return void this.fire(new o.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const _=m.type,x=_==="vector"?r.sourceLayer:void 0;if(_==="vector"&&!x)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const w=this._getSourceCaches(h);for(const A of w)A.removeFeatureState(x,r.id,s)}getFeatureState(r){this._checkLoaded();const s=r.source,h=r.sourceLayer,m=this.getSource(s);if(m){if(m.type!=="vector"||h)return r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(h,r.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();r[h.id]||(r[h.id]=h.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const s=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&s&&s.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",s.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const s=x=>this._layers[x].type==="fill-extrusion",h={},m=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(s(w)){h[w]=x;for(const A of r){const P=A[w];if(P)for(const k of P)m.push(k)}}}m.sort((x,w)=>w.intersectionZ-x.intersectionZ);const _=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(s(w))for(let A=m.length-1;A>=0;A--){const P=m[A].feature;if(h[P.layer.id]<x)break;_.push(P),m.pop()}else for(const A of r){const P=A[w];if(P)for(const k of P)_.push(k.feature)}}return _}queryRenderedFeatures(r,s,h){s&&s.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",s.filter,null,s);const m={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of s.layers){const P=this._layers[A];if(!P)return this.fire(new o.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];m[P.source]=!0}}const _=[];s.availableImages=this._availableImages;const x=s&&s.layers?s.layers.some(A=>{const P=this.getLayer(A);return P&&P.is3D()}):this.has3DLayers(),w=Zr.createFromScreenPoints(r,h);for(const A in this._sourceCaches){const P=this._sourceCaches[A].getSource().id;s.layers&&!m[P]||_.push(Mt(this._sourceCaches[A],this._layers,this._serializedLayers,w,s,h,x,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(A,P,k,j,Z,te,ee){const J={},H=te.queryRenderedSymbols(j),K=[];for(const se of Object.keys(H).map(Number))K.push(ee[se]);K.sort($t);for(const se of K){const ie=se.featureIndex.lookupSymbolFeatures(H[se.bucketInstanceId],P,se.bucketIndex,se.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,A);for(const xe in ie){const ye=J[xe]=J[xe]||[],he=ie[xe];he.sort((ve,fe)=>{const Ee=se.featureSortOrder;if(Ee){const Le=Ee.indexOf(ve.featureIndex);return Ee.indexOf(fe.featureIndex)-Le}return fe.featureIndex-ve.featureIndex});for(const ve of he)ye.push(ve)}}for(const se in J)J[se].forEach(ie=>{const xe=ie.feature,ye=k(A[se]).getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=ye});return J}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),w.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(r,s){s&&s.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",s.filter,null,s);const h=this._getSourceCaches(r);let m=[];for(const _ of h)m=m.concat(lt(_,s));return m}addSourceType(r,s,h){return Bn.getSourceType(r)?h(new Error(`A source type called "${r}" already exists.`)):(Bn.setSourceType(r,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:s.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(r,s={}){this._checkLoaded();const h=this.light.getLight();let m=!1;for(const x in r)if(!Q(r[x],h[x])){m=!0;break}if(!m)return;const _=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,s),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,s=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(s===1){if(typeof r.source=="object"){const h="terrain-dem-src";this.addSource(h,r.source),r=o.clone$1(r),r=o.extend(r,{source:h})}if(this._validate(o.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&s!==this.terrain.drapeRenderMode)this._createTerrain(r,s);else{const h=this.terrain,m=h.get();for(const _ of Object.keys(o.spec.terrain))!r.hasOwnProperty(_)&&o.spec.terrain[_].default&&(r[_]=o.spec.terrain[_].default);for(const _ in r)if(!Q(r[_],m[_])){h.set(r),this.stylesheet.terrain=r;const x=this._setTransitionParameters({duration:0});h.updateTransitions(x);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const s=this.fog=new _r(r,this.map.transform);this.stylesheet.fog=r;const h=this._setTransitionParameters({duration:0});s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog,h=s.get();Object.keys(r).length===0&&s.set(r);for(const m in r)if(!Q(r[m],h[m])){s.set(r),this.stylesheet.fog=r;const _=this._setTransitionParameters({duration:0});s.updateTransitions(_);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:o.exported.now(),transition:o.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(h=>this.isLayerDraped(this._layers[h])),s=this._order.filter(h=>!this.isLayerDraped(this._layers[h]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...s)}_createTerrain(r,s){const h=this.terrain=new Dn(r,s);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const m=this._setTransitionParameters({duration:0});h.updateTransitions(m)}_force3DLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="symbol"&&this._updateLayer(s)}}_validate(r,s,h,m,_={}){return(!_||_.validate!==!1)&&rl(this,r.call(o.validateStyle,o.extend({key:s,style:this.serialize(),value:h,styleSpec:o.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const s=this._getSourceCaches(r);for(const h of s)h.clearTiles()}_reloadSource(r){const s=this._getSourceCaches(r);for(const h of s)h.resume(),h.reload()}_updateSources(r){for(const s in this._sourceCaches)this._sourceCaches[s].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const s=this._sourceCaches[r];s.resume(),s.reload()}}_updatePlacement(r,s,h,m,_=!1){let x=!1,w=!1;const A={};for(const P of this._order){const k=this._layers[P];if(k.type!=="symbol")continue;if(!A[k.source]){const Z=this._getLayerSourceCache(k);if(!Z)continue;A[k.source]=Z.getRenderableIds(!0).map(te=>Z.getTileByID(te)).sort((te,ee)=>ee.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ee.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(k,A[k.source],r.center.lng,r.projection);x=x||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||h===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),r.zoom))&&(this.pauseablePlacement=new ws(r,this._order,_,s,h,m,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),w=!0),x&&this.pauseablePlacement.placement.setStale()),w||x)for(const P of this._order){const k=this._layers[P];k.type==="symbol"&&this.placement.updateLayerOpacities(k,A[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,s,h){this.imageManager.getImages(s.icons,h),this._updateTilesForChangedImages();const m=_=>{_&&_.setDependencies(s.tileID.key,s.type,s.icons)};m(this._otherSourceCaches[s.source]),m(this._symbolSourceCaches[s.source])}getGlyphs(r,s,h){this.glyphManager.getGlyphs(s.stacks,h)}getResource(r,s,h){return o.makeRequest(s,h)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const s=[];return this._otherSourceCaches[r]&&s.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&s.push(this._symbolSourceCaches[r]),s}_isSourceCacheLoaded(r){const s=this._getSourceCaches(r);return s.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Bn.getSourceType=function(l){return Te[l]},Bn.setSourceType=function(l,r){Te[l]=r},Bn.registerForPluginStateChange=o.registerForPluginStateChange;var nl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Fn="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Nl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,jl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ta=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let ia={},ts={};const zo=[];is(nl,zo),is(Nl,zo),is(jl,zo),is(ta,zo),ia=pi("",Nl),ts=pi(ta,jl);const cn=pi(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Vl=nl,yn=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Gl={background:pi(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:pi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:pi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:pi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:pi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:pi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:pi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:pi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:pi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:pi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:pi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:pi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:pi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:pi(`uniform lowp vec3 u_lightpos;varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
void main() {vec4 color=v_color;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:pi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:pi(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:pi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:pi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:pi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:pi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:pi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:pi(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:pi(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:pi(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Fn),skyboxGradient:pi(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Fn),skyboxCapture:pi(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:pi(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:pi(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function is(l,r){const s=l.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of s)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=h.split(" ");for(const _ of m)r.includes(_)||r.push(_)}}function pi(l,r){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),m={},_=[...zo];return is(l,_),is(r,_),{fragmentSource:l=l.replace(s,(x,w,A,P,k)=>(m[k]=!0,w==="define"?`
#ifndef HAS_UNIFORM_u_${k}
varying ${A} ${P} ${k};
#else
uniform ${A} ${P} u_${k};
#endif
`:`
#ifdef HAS_UNIFORM_u_${k}
    ${A} ${P} ${k} = u_${k};
#endif
`)),vertexSource:r=r.replace(s,(x,w,A,P,k)=>{const j=P==="float"?"vec2":"vec4",Z=k.match(/color/)?"color":j;return m[k]?w==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
attribute ${A} ${j} a_${k};
varying ${A} ${P} ${k};
#else
uniform ${A} ${P} u_${k};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = a_${k};
#else
    ${A} ${P} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = unpack_mix_${Z}(a_${k}, u_${k}_t);
#else
    ${A} ${P} ${k} = u_${k};
#endif
`:w==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
attribute ${A} ${j} a_${k};
#else
uniform ${A} ${P} u_${k};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${A} ${P} ${k} = a_${k};
#else
    ${A} ${P} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${A} ${P} ${k} = unpack_mix_${Z}(a_${k}, u_${k}_t);
#else
    ${A} ${P} ${k} = u_${k};
#endif
`}),staticAttributes:h,usedDefines:_}}class Es{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,s,h,m,_,x,w){this.context=r;let A=this.boundPaintVertexBuffers.length!==m.length;for(let k=0;!A&&k<m.length;k++)this.boundPaintVertexBuffers[k]!==m[k]&&(A=!0);let P=this.boundDynamicVertexBuffers.length!==w.length;for(let k=0;!P&&k<w.length;k++)this.boundDynamicVertexBuffers[k]!==w[k]&&(P=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==h||A||P||this.boundIndexBuffer!==_||this.boundVertexOffset!==x)this.freshBind(s,h,m,_,x,w);else{r.bindVertexArrayOES.set(this.vao);for(const k of w)k&&k.bind();_&&_.dynamicDraw&&_.bind()}}freshBind(r,s,h,m,_,x){let w;const A=r.numAttributes,P=this.context,k=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),w=0,this.boundProgram=r,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=x;else{w=P.currentNumAttributes||0;for(let j=A;j<w;j++)k.disableVertexAttribArray(j)}s.enableAttributes(k,r),s.bind(),s.setVertexAttribPointers(k,r,_);for(const j of h)j.enableAttributes(k,r),j.bind(),j.setVertexAttribPointers(k,r,_);for(const j of x)j&&(j.enableAttributes(k,r),j.bind(),j.setVertexAttribPointers(k,r,_));m&&m.bind(),P.currentNumAttributes=A}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function As(l,r){const s=Math.pow(2,r.canonical.z),h=r.canonical.y;return[new o.MercatorCoordinate(0,h/s).toLngLat().lat,new o.MercatorCoordinate(0,(h+1)/s).toLngLat().lat]}function rr(l,r,s,h,m,_,x){const w=l.context,A=w.gl,P=s.fbo;if(!P)return;l.prepareDrawTile();const k=l.useProgram("hillshade");w.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,P.colorAttachment.get());const j=((J,H,K,se)=>{const ie=K.paint.get("hillshade-shadow-color"),xe=K.paint.get("hillshade-highlight-color"),ye=K.paint.get("hillshade-accent-color");let he=K.paint.get("hillshade-illumination-direction")*(Math.PI/180);K.paint.get("hillshade-illumination-anchor")==="viewport"&&(he-=J.transform.angle);const ve=!J.options.moving;return{u_matrix:se||J.transform.calculateProjMatrix(H.tileID.toUnwrapped(),ve),u_image:0,u_latrange:As(0,H.tileID),u_light:[K.paint.get("hillshade-exaggeration"),he],u_shadow:ie,u_highlight:xe,u_accent:ye}})(l,s,h,l.terrain?r.projMatrix:null);l.prepareDrawProgram(w,k,r.toUnwrapped());const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:te,tileBoundsSegments:ee}=l.getTileBoundsBuffers(s);k.draw(w,A.TRIANGLES,m,_,x,o.CullFaceMode.disabled,j,h.id,Z,te,ee)}function ui(l,r,s){if(!r.needsDEMTextureUpload)return;const h=l.context,m=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||l.getTileTexture(s.stride);const _=s.getPixels();r.demTexture?r.demTexture.update(_,{premultiply:!1}):r.demTexture=new o.Texture(h,_,m.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Ss(l,r,s,h,m,_){const x=l.context,w=x.gl;if(!r.dem)return;const A=r.dem;if(x.activeTexture.set(w.TEXTURE1),ui(l,r,A),!r.demTexture)return;r.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const P=A.dim;x.activeTexture.set(w.TEXTURE0);let k=r.fbo;if(!k){const ee=new o.Texture(x,{width:P,height:P,data:null},w.RGBA);ee.bind(w.LINEAR,w.CLAMP_TO_EDGE),k=r.fbo=x.createFramebuffer(P,P,!0),k.colorAttachment.set(ee.texture)}x.bindFramebuffer.set(k.framebuffer),x.viewport.set([0,0,P,P]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:Z,tileBoundsSegments:te}=l.getMercatorTileBoundsBuffers();l.useProgram("hillshadePrepare").draw(x,w.TRIANGLES,h,m,_,o.CullFaceMode.disabled,((ee,J)=>{const H=J.stride,K=o.create();return o.ortho(K,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(K,K,[0,-o.EXTENT,0]),{u_matrix:K,u_image:1,u_dimension:[H,H],u_zoom:ee.overscaledZ,u_unpack:J.unpackVector}})(r.tileID,A),s.id,j,Z,te),r.needsHillshadePrepare=!1}const ol=l=>({u_matrix:new o.UniformMatrix4f(l),u_image0:new o.Uniform1i(l),u_skirt_height:new o.Uniform1f(l)}),ra=(l,r)=>({u_matrix:l,u_image0:0,u_skirt_height:r}),$l=(l,r,s,h,m,_,x,w,A,P,k,j,Z,te)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:s,u_zoom_transition:m,u_merc_center:_,u_image0:0,u_frustum_tl:x,u_frustum_tr:w,u_frustum_br:A,u_frustum_bl:P,u_globe_pos:k,u_globe_radius:j,u_viewport:Z,u_grid_matrix:te?Float32Array.from(te):new Float32Array(9)});function ql(l,r){return l!=null&&r!=null&&!(!l.hasData()||!r.hasData())&&l.demTexture!=null&&r.demTexture!=null&&l.tileID.key!==r.tileID.key}const Is=new class{constructor(){this.operations={}}newMorphing(l,r,s,h,m){if(l in this.operations){const _=this.operations[l];_.to.tileID.key!==s.tileID.key&&(_.queued=s)}else this.operations[l]={startTime:h,phase:0,duration:m,from:r,to:s,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const r=this.operations[l];return{from:r.from,to:r.to,phase:r.phase}}update(l){for(const r in this.operations){const s=this.operations[r];for(s.phase=(l-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,l)){delete this.operations[r];break}}}_nextOp(l,r){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=r,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},Ca={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function sl(l,r){const s=1<<l.z;return!r&&(l.x===0||l.x===s-1)||l.y===0||l.y===s-1}const Ms=l=>({u_matrix:l});function Zl(l,r,s,h,m){if(m>0){const _=o.exported.now(),x=(_-l.timeAdded)/m,w=r?(_-r.timeAdded)/m:-1,A=s.getSource(),P=h.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),k=!r||Math.abs(r.tileID.overscaledZ-P)>Math.abs(l.tileID.overscaledZ-P),j=k&&l.refreshedUponExpiration?1:o.clamp(k?x:1-w,0,1);return l.refreshedUponExpiration&&x>=1&&(l.refreshedUponExpiration=!1),r?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class al extends o.SourceCache{constructor(r){const s={type:"raster-dem",maxzoom:r.transform.maxZoom},h=new mn(ji(),null),m=ke("mock-dem",s,h,r.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,s){r.state="loaded",s(null)}}class ll extends o.SourceCache{constructor(r){const s=ke("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new mn(ji(),null),r.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,s,h){if(r.freezeTileCoverage)return;this.transform=r;const m=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,x)=>{if(_[x.key]="",!this._tiles[x.key]){const w=new o.Tile(x,this._source.tileSize*x.overscaleFactor(),r.tileZoom);w.state="loaded",this._tiles[x.key]=w}return _},{});for(const _ in this._tiles)_ in m||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(r){const s=this.proxyCachedFBO[r];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Pa extends o.OverscaledTileID{constructor(r,s,h){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class Wl extends o.Elevation{constructor(r,s){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,m,_]=function(A){const P=new o.StructArrayLayout4i8,k=new o.StructArrayLayout3ui6,j=131;P.reserve(17161),k.reserve(33800);const Z=o.EXTENT/128,te=o.EXTENT+Z/2,ee=te+Z;for(let H=-Z;H<ee;H+=Z)for(let K=-Z;K<ee;K+=Z){const se=K<0||K>te||H<0||H>te?24575:0,ie=o.clamp(Math.round(K),0,o.EXTENT),xe=o.clamp(Math.round(H),0,o.EXTENT);P.emplaceBack(ie+se,xe,ie,xe)}const J=(H,K)=>{const se=K*j+H;k.emplaceBack(se+1,se,se+j),k.emplaceBack(se+j,se+j+1,se+1)};for(let H=1;H<129;H++)for(let K=1;K<129;K++)J(K,H);return[0,129].forEach(H=>{for(let K=0;K<130;K++)J(K,H),J(H,K)}),[P,k,32768]}(),x=r.context;this.gridBuffer=x.createVertexBuffer(h,o.boundsAttributes.members),this.gridIndexBuffer=x.createIndexBuffer(m),this.gridSegments=o.SegmentVector.simpleSegment(0,0,h.length,m.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,h.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ll(s.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);const w=x.gl;this._overlapStencilMode=new o.StencilMode({func:w.GEQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new al(s.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,s,h){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const m=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(m.get("source")),this._exaggeration=m.get("exaggeration");const _=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const x=this.getScaledDemTileSize();this.sourceCache.update(s,x,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),s.updateElevation(!h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(A=>{const P=s.getTileByID(A).tileID;return P.projMatrix=h.calculateProjMatrix(P.toUnwrapped()),P});(function(A,P){const k=P.transform.pointCoordinate(P.transform.getCameraPoint()),j=new o.pointGeometry(k.x,k.y);A.sort((Z,te)=>{if(te.overscaledZ-Z.overscaledZ)return te.overscaledZ-Z.overscaledZ;const ee=new o.pointGeometry(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),J=new o.pointGeometry(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),H=j.mult(1<<Z.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(ee)-H.distSqr(J)})})(m,this.painter),this._previousZoom=h.zoom;const _=this.proxyToSource||{};this.proxyToSource={},m.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const x=this._style._sourceCaches;for(const A in x){const P=x[A];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,r[A],_),P.usedForTerrain))continue;const k=r[A];P.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[s.id]=m.map(A=>new Pa(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const w={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const P=this.terrainTileForTile[A.key];if(!P)continue;const k=P.tileID.key;k in w||(this._visibleDemTiles.push(P),w[k]=k)}}_assignTerrainTiles(r){this._initializing||r.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const r=this.painter.context,s=r.gl;for(const h in this.terrainTileForTile){const m=this.terrainTileForTile[h],_=m.dem;!_||m.demTexture&&!m.needsDEMTextureUpload||(r.activeTexture.set(s.TEXTURE1),ui(this.painter,m,_))}}_prepareDemTileUniforms(r,s,h,m){if(!s||s.demTexture==null)return!1;const _=r.tileID.canonical,x=Math.pow(2,s.tileID.canonical.z-_.z),w=m||"";return h[`u_dem_tl${w}`]=[_.x*x%1,_.y*x%1],h[`u_dem_scale${w}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,s=r.gl;if(!this._emptyDepthBufferTexture){const h=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(r,h,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const s=this._visibleDemTiles.reduce((h,m)=>{if(!m.dem)return h;const _=m.dem.tree.minimums[0];return _>0&&r++,h+_},0);return r?s/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,s=r.gl;r.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),m=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(h,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(m,{premultiply:!1}):_=this._emptyDEMTexture=new o.Texture(r,m,s.RGBA,{premultiply:!1}),_}setupElevationDraw(r,s,h){const m=this.painter.context,_=m.gl,x=(w=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(w),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var w;x.u_dem_size=this.sourceCache.getSource().tileSize,x.u_exaggeration=this.exaggeration();const A=this.painter.transform,P=A.projection,k=r.tileID.canonical;x.u_tile_tl_up=P.upVector(k,0,0),x.u_tile_tr_up=P.upVector(k,o.EXTENT,0),x.u_tile_br_up=P.upVector(k,o.EXTENT,o.EXTENT),x.u_tile_bl_up=P.upVector(k,0,o.EXTENT),x.u_tile_up_scale=h&&h.useDenormalizedUpVectorScale?o.GLOBE_METERS_TO_ECEF:P.upVectorScale(k,A.center.lat,A.worldSize).metersToTile;let j=null,Z=null,te=1;if(h&&h.morphing&&this._useVertexMorphing){const ee=h.morphing.srcDemTile,J=h.morphing.dstDemTile;te=h.morphing.phase,ee&&J&&(this._prepareDemTileUniforms(r,ee,x,"_prev")&&(Z=ee),this._prepareDemTileUniforms(r,J,x)&&(j=J))}if(Z&&j?(m.activeTexture.set(_.TEXTURE2),j.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),m.activeTexture.set(_.TEXTURE4),Z.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),x.u_dem_lerp=te):(j=this.terrainTileForTile[r.tileID.key],m.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(r,j,x)?j.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE)),m.activeTexture.set(_.TEXTURE3),h&&h.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(x.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),x.u_depth_size_inv=[1,1]),h&&h.useMeterToDem&&j){const ee=(1<<j.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=ee}h&&h.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(m,x)}renderToBackBuffer(r){const s=this.painter,h=this.painter.context;r.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,_,x,w,A){if(m.transform.projection.name==="globe")(function(P,k,j,Z,te){const ee=P.context,J=ee.gl;let H,K;const se=P.options.showTerrainWireframe?2:0,ie=P.transform,xe=o.globeUseCustomAntiAliasing(P,ee,ie),ye=(gt,Ve)=>{if(K===gt)return;const dt=[Ca[gt],"PROJECTION_GLOBE_VIEW"];xe&&dt.push("CUSTOM_ANTIALIASING"),Ve&&dt.push(Ca[se]),H=P.useProgram("globeRaster",null,dt),K=gt},he=P.colorModeForRenderPass(),ve=new o.DepthMode(J.LEQUAL,o.DepthMode.ReadWrite,P.depthRangeFor3D);Is.update(te);const fe=o.calculateGlobeMercatorMatrix(ie),Ee=[o.mercatorXfromLng(ie.center.lng),o.mercatorYfromLat(ie.center.lat)],Le=se?[!1,!0]:[!1],ht=P.globeSharedBuffers,Pe=[ie.width*o.exported.devicePixelRatio,ie.height*o.exported.devicePixelRatio],He=Float32Array.from(ie.globeMatrix),rt={useDenormalizedUpVectorScale:!0};if(Le.forEach(gt=>{K=-1;const Ve=gt?J.LINES:J.TRIANGLES;for(const dt of Z){const Qe=j.getTile(dt),Tt=o.StencilMode.disabled,wt=k.prevTerrainTileForTile[dt.key],Ot=k.terrainTileForTile[dt.key];ql(wt,Ot)&&Is.newMorphing(dt.key,wt,Ot,te,250),ee.activeTexture.set(J.TEXTURE0),Qe.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Nt=Is.getMorphValuesForProxy(dt.key),Ht=Nt?1:0;Nt&&o.extend$1(rt,{morphing:{srcDemTile:Nt.from,dstDemTile:Nt.to,phase:o.easeCubicInOut(Nt.phase)}});const Ei=o.tileCornersToBounds(dt.canonical),Rt=o.getLatitudinalLod(Ei.getCenter().lat),ii=o.getGridMatrix(dt.canonical,Ei,Rt),Li=o.globeNormalizeECEF(o.globeTileBounds(dt.canonical)),Qi=$l(ie.projMatrix,He,fe,Li,o.globeToMercatorTransition(ie.zoom),Ee,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Pe,ii);if(ye(Ht,gt),k.setupElevationDraw(Qe,H,rt),P.prepareDrawProgram(ee,H,dt.toUnwrapped()),ht){const[br,qi,xn]=gt?ht.getWirefameBuffers(P.context,Rt):ht.getGridBuffers(Rt);H.draw(ee,Ve,ve,Tt,he,o.CullFaceMode.backCCW,Qi,"globe_raster",br,qi,xn)}}}),ht){const gt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];xe&&gt.push("CUSTOM_ANTIALIASING"),H=P.useProgram("globeRaster",null,gt);for(const Ve of Z){const{x:dt,y:Qe,z:Tt}=Ve.canonical,wt=Qe===0,Ot=Qe===(1<<Tt)-1,[Nt,Ht,Ei,Rt]=ht.getPoleBuffers(Tt);if(Rt&&(wt||Ot)){const ii=j.getTile(Ve);ee.activeTexture.set(J.TEXTURE0),ii.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let Li=o.globePoleMatrixForTile(Tt,dt,ie);const Qi=o.globeNormalizeECEF(o.globeTileBounds(Ve.canonical)),br=(qi,xn)=>qi.draw(ee,J.TRIANGLES,ve,o.StencilMode.disabled,he,o.CullFaceMode.disabled,$l(ie.projMatrix,Li,Li,Qi,0,Ee,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Pe),"globe_pole_raster",xn,Ei,Rt);k.setupElevationDraw(ii,H,rt),P.prepareDrawProgram(ee,H,Ve.toUnwrapped()),wt&&br(H,Nt),Ot&&(Li=o.scale(o.create(),Li,[1,-1,1]),br(H,Ht))}}}})(m,_,x,w,A);else{const P=m.context,k=P.gl;let j,Z;const te=m.options.showTerrainWireframe?2:0,ee=(ie,xe)=>{if(Z===ie)return;const ye=[Ca[ie]];xe&&ye.push(Ca[te]),j=m.useProgram("terrainRaster",null,ye),Z=ie},J=m.colorModeForRenderPass(),H=new o.DepthMode(k.LEQUAL,o.DepthMode.ReadWrite,m.depthRangeFor3D);Is.update(A);const K=m.transform,se=6*Math.pow(1.5,22-K.zoom)*_.exaggeration();(te?[!1,!0]:[!1]).forEach(ie=>{Z=-1;const xe=ie?k.LINES:k.TRIANGLES,[ye,he]=ie?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(const ve of w){const fe=x.getTile(ve),Ee=o.StencilMode.disabled,Le=_.prevTerrainTileForTile[ve.key],ht=_.terrainTileForTile[ve.key];ql(Le,ht)&&Is.newMorphing(ve.key,Le,ht,A,250),P.activeTexture.set(k.TEXTURE0),fe.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const Pe=Is.getMorphValuesForProxy(ve.key),He=Pe?1:0;let rt;Pe&&(rt={morphing:{srcDemTile:Pe.from,dstDemTile:Pe.to,phase:o.easeCubicInOut(Pe.phase)}});const gt=ra(ve.projMatrix,sl(ve.canonical,K.renderWorldCopies)?se/10:se);ee(He,ie),_.setupElevationDraw(fe,j,rt),m.prepareDrawProgram(P,j,ve.toUnwrapped()),j.draw(P,xe,H,Ee,J,o.CullFaceMode.backCCW,gt,"terrain_raster",_.gridBuffer,ye,he)}})}}(s,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,m=this.proxySourceCache,_=this.proxiedCoords[m.id],x=this._drapedRenderBatches.shift(),w=[],A=s.style.order;let P=0;for(const k of _){const j=m.getTileByID(k.proxyTileKey),Z=m.proxyCachedFBO[k.key]?m.proxyCachedFBO[k.key][r]:void 0,te=Z!==void 0?m.renderCache[Z]:this.pool[P++],ee=Z!==void 0;if(j.texture=te.tex,ee&&!te.dirty){w.push(j.tileID);continue}let J;h.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(h.clear({color:o.Color.transparent,stencil:0}),te.dirty=!1);for(let H=x.start;H<=x.end;++H){const K=s.style._layers[A[H]];if(K.isHidden(s.transform.zoom))continue;const se=s.style._getLayerSourceCache(K),ie=se?this.proxyToSource[k.key][se.id]:[k];if(!ie)continue;const xe=ie;h.viewport.set([0,0,te.fb.width,te.fb.height]),J!==(se?se.id:null)&&(this._setupStencil(te,ie,K,se),J=se?se.id:null),s.renderLayer(s,se,K,xe)}this.renderedToTile?(te.dirty=!0,w.push(j.tileID)):ee||--P,P===5&&(P=0,this.renderToBackBuffer(w))}return this.renderToBackBuffer(w),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),x.end+1}postRender(){}renderCacheEfficiency(r){const s=r.order.length;if(s===0)return{efficiency:100};let h,m=0,_=0,x=!1;for(let w=0;w<s;++w){const A=r._layers[r.order[w]];this._style.isLayerDraped(A)?(x&&++m,++_):x||(x=!0,h=A.id)}return _===0?{efficiency:100}:{efficiency:100*(1-m/_),firstUndrapedLayer:h}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{r=Math.min(r,s.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,s,h){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const x=_.tileID,w=1<<x.overscaledZ,{x:A,y:P}=x.canonical,k=A/w,j=(A+1)/w,Z=P/w,te=(P+1)/w;return{minx:k,miny:Z,maxx:j,maxy:te,t:_.dem.tree.raycastRoot(k,Z,j,te,r,s,h),tile:_}});m.sort((_,x)=>(_.t!==null?_.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const _ of m){if(_.t==null)return null;const x=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,r,s,h);if(x!=null)return x}return null}_createFBO(){const r=this.painter.context,s=r.gl,h=this.drapeBufferSize;r.activeTexture.set(s.TEXTURE0);const m=new o.Texture(r,{width:h[0],height:h[1],data:null},s.RGBA);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const _=r.createFramebuffer(h[0],h[1],!1);return _.colorAttachment.set(m.texture),_.depthAttachment=new N(r,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:_,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const s=this._style._layers[r],h=s.isHidden(this.painter.transform.zoom),m=s.getCrossfadeParameters(),_=!!m&&m.t!==1,x=s.hasTransition();return s.type!=="custom"&&!h&&(_||x)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s]._source instanceof ue){r=!0;break}if(r)for(let s=0;s<this._style.order.length;++s){const h=this._style._layers[this._style.order[s]],m=h.isHidden(this.painter.transform.zoom),_=this._style._getLayerSourceCache(h);if(h.type!=="raster"||m||!_)continue;const x=h.paint.get("raster-fade-duration");for(const w of this.proxyCoords){const A=this.proxyToSource[w.key][_.id];if(A)for(const P of A){const k=Zl(_.getTile(P),_.findLoadedParent(P,0),_,this.painter.transform,x);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(_.id,P)}}}}_setupDrapedRenderBatches(){const r=this._style.order,s=r.length;if(s===0)return;const h=[];let m,_=0,x=this._style._layers[r[_]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++_<s;)x=this._style._layers[r[_]];for(;_<s;++_){const w=this._style._layers[r[_]];w.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(w)?m===void 0&&(m=_):m!==void 0&&(h.push({start:m,end:_-1}),m=void 0))}m!==void 0&&h.push({start:m,end:_-1}),this._drapedRenderBatches=h}_setupRenderCache(r){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const x=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let w=0;w<x.length;++w){const A=Object.values(x[w]);s.renderCachePool.push(...A)}}return}this._clearRasterFadeFromRenderCache();const h=this.proxyCoords,m=this._tilesDirty;for(let x=h.length-1;x>=0;x--){const w=h[x];if(s.getTileByID(w.key),s.proxyCachedFBO[w.key]!==void 0){const A=r[w.key],P=this.proxyToSource[w.key];let k=0;for(const j in P){const Z=P[j],te=A[j];if(!te||te.length!==Z.length||Z.some((ee,J)=>ee!==te[J]||m[j]&&m[j].hasOwnProperty(ee.key))){k=-1;break}++k}for(const j in s.proxyCachedFBO[w.key])s.renderCache[s.proxyCachedFBO[w.key][j]].dirty=k<0||k!==Object.values(A).length}}const _=[...this._drapedRenderBatches];_.sort((x,w)=>w.end-w.start-(x.end-x.start));for(const x of _)for(const w of h){if(s.proxyCachedFBO[w.key])continue;let A=s.renderCachePool.pop();A===void 0&&s.renderCache.length<50&&(A=s.renderCache.length,s.renderCache.push(this._createFBO())),A!==void 0&&(s.proxyCachedFBO[w.key]={},s.proxyCachedFBO[w.key][x.start]=A,s.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(r,s,h,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,x=_.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let w;if(h.isTileClipped())w=s.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);w=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+w>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=w,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(r,s){const h=this.painter,m=this.painter.context,_=m.gl;h._tileClippingMaskIDs={},m.setColorMode(o.ColorMode.disabled),m.setDepthMode(o.DepthMode.disabled);const x=h.useProgram("clippingMask");for(const w of r){const A=h._tileClippingMaskIDs[w.key]=--s;x.draw(m,_.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:_.ALWAYS,mask:0},A,255,_.KEEP,_.KEEP,_.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Ms(w.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(r){const s=this.painter.transform;if(r.x<0||r.x>s.width||r.y<0||r.y>s.height)return null;const h=[r.x,r.y,1,1];o.transformMat4$1(h,h,s.pixelMatrixInverse),o.scale$1(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const m=s._camera.position,_=o.mercatorZfromAltitude(1,s.center.lat),x=[m[0],m[1],m[2]/_,0],w=o.subtract([],h.slice(0,3),x);o.normalize(w,w);const A=this.raycast(x,w,this._exaggeration);return A!==null&&A?(o.scaleAndAdd(x,x,w,A),x[3]=x[2],x[2]*=_,x):null}drawDepth(){const r=this.painter,s=r.context,h=this.proxySourceCache,m=Math.ceil(r.width),_=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const x=s.gl,w=s.createFramebuffer(m,_,!0);s.activeTexture.set(x.TEXTURE0);const A=new o.Texture(s,{width:m,height:_,data:null},x.RGBA);A.bind(x.NEAREST,x.CLAMP_TO_EDGE),w.colorAttachment.set(A.texture);const P=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,m,_);w.depthAttachment.set(P),this._depthFBO=w,this._depthTexture=A}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,m,_]),function(x,w,A,P){if(x.transform.projection.name==="globe")return;const k=x.context,j=k.gl;k.clear({depth:1});const Z=x.useProgram("terrainDepth"),te=new o.DepthMode(j.LESS,o.DepthMode.ReadWrite,x.depthRangeFor3D);for(const ee of P){const J=A.getTile(ee),H=ra(ee.projMatrix,0);w.setupElevationDraw(J,Z),Z.draw(k,j.TRIANGLES,te,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,H,"terrain_depth",w.gridBuffer,w.gridIndexBuffer,w.gridNoSkirtSegments)}}(r,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,s,h){if(r.getSource()instanceof Me)return this._setupProxiedCoordsForImageSource(r,s,h);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const m=this.proxiedCoords[r.id]=[],_=this.proxyCoords;for(let w=0;w<_.length;w++){const A=_[w],P=this._findTileCoveringTileID(A,r);if(P){const k=this._createProxiedId(A,P,h[A.key]&&h[A.key][r.id]);m.push(k),this.proxyToSource[A.key][r.id]=[k]}}let x=!1;for(let w=0;w<s.length;w++){const A=r.getTile(s[w]);if(!A||!A.hasData())continue;const P=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==A.tileID.canonical.z){const k=this.proxyToSource[P.tileID.key][r.id],j=this._createProxiedId(P.tileID,A,h[P.tileID.key]&&h[P.tileID.key][r.id]);k?k.splice(k.length-1,0,j):this.proxyToSource[P.tileID.key][r.id]=[j],m.push(j),x=!0}}this._sourceTilesOverlap[r.id]=x}_setupProxiedCoordsForImageSource(r,s,h){if(!r.getSource().loaded())return;const m=this.proxiedCoords[r.id]=[],_=this.proxyCoords,x=r.getSource(),w=new o.pointGeometry(x.tileID.x,x.tileID.y)._div(1<<x.tileID.z),A=x.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((k,j)=>(k.min.x=Math.min(k.min.x,j.x-w.x),k.min.y=Math.min(k.min.y,j.y-w.y),k.max.x=Math.max(k.max.x,j.x-w.x),k.max.y=Math.max(k.max.y,j.y-w.y),k),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(k,j)=>{const Z=k.wrap+k.canonical.x/(1<<k.canonical.z),te=k.canonical.y/(1<<k.canonical.z),ee=o.EXTENT/(1<<k.canonical.z),J=j.wrap+j.canonical.x/(1<<j.canonical.z),H=j.canonical.y/(1<<j.canonical.z);return Z+ee<J+A.min.x||Z>J+A.max.x||te+ee<H+A.min.y||te>H+A.max.y};for(let k=0;k<_.length;k++){const j=_[k];for(let Z=0;Z<s.length;Z++){const te=r.getTile(s[Z]);if(!te||!te.hasData()||P(j,te.tileID))continue;const ee=this._createProxiedId(j,te,h[j.key]&&h[j.key][r.id]),J=this.proxyToSource[j.key][r.id];J?J.push(ee):this.proxyToSource[j.key][r.id]=[ee],m.push(ee)}}}_createProxiedId(r,s,h){let m=this.orthoMatrix;if(h){const _=h.find(x=>x.key===s.tileID.key);if(_)return _}if(s.tileID.key!==r.key){const _=r.canonical.z-s.tileID.canonical.z;let x,w,A;m=o.create();const P=s.tileID.wrap-r.wrap<<r.overscaledZ;_>0?(x=o.EXTENT>>_,w=x*((s.tileID.canonical.x<<_)-r.canonical.x+P),A=x*((s.tileID.canonical.y<<_)-r.canonical.y)):(x=o.EXTENT<<-_,w=o.EXTENT*(s.tileID.canonical.x-(r.canonical.x+P<<-_)),A=o.EXTENT*(s.tileID.canonical.y-(r.canonical.y<<-_))),o.ortho(m,0,x,0,x,0,1),o.translate(m,m,[w,A,0])}return new Pa(s.tileID,r.key,m)}_findTileCoveringTileID(r,s){let h=s.getTile(r);if(h&&h.hasData())return h;const m=this._findCoveringTileCache[s.id],_=m[r.key];if(h=_?s.getTileByID(_):null,h&&h.hasData()||_===null)return h;let x=h?h.tileID:r,w=x.overscaledZ;const A=s.getSource().minzoom,P=[];if(!_){const j=s.getSource().maxzoom;if(r.canonical.z>=j){const Z=r.canonical.z-j;s.getSource().reparseOverscaled?(w=Math.max(r.canonical.z+2,s.transform.tileZoom),x=new o.OverscaledTileID(w,r.wrap,j,r.canonical.x>>Z,r.canonical.y>>Z)):Z!==0&&(w=j,x=new o.OverscaledTileID(w,r.wrap,j,r.canonical.x>>Z,r.canonical.y>>Z))}x.key!==r.key&&(P.push(x.key),h=s.getTile(x))}const k=j=>{P.forEach(Z=>{m[Z]=j}),P.length=0};for(w-=1;w>=A&&(!h||!h.hasData());w--){h&&k(h.tileID.key);const j=x.calculateScaledKey(w);if(h=s.getTileByID(j),h&&h.hasData())break;const Z=m[j];if(Z===null)break;Z===void 0?P.push(j):h=s.getTileByID(Z)}return k(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,s){let h=this._tilesDirty[r];h||(h=this._tilesDirty[r]={}),h[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(s){let h=0;const m=new o.StructArrayLayout2ui4,_=131;for(let x=1;x<129;x++){for(let w=1;w<129;w++)h=x*_+w,m.emplaceBack(h,h+1),m.emplaceBack(h,h+_),m.emplaceBack(h+1,h+_),x===128&&m.emplaceBack(h+_,h+_+1);m.emplaceBack(h+1,h+1+_)}return m}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Xl{static cacheKey(r,s,h,m){let _=`${s}${m?m.cacheKey:""}`;for(const x of h)r.usedDefines.includes(x)&&(_+=`/${x}`);return _}constructor(r,s,h,m,_,x){const w=r.gl;this.program=w.createProgram();const A=function(H){const K=[];for(let se=0;se<H.length;se++){if(H[se]===null)continue;const ie=H[se].split(" ");K.push(ie.pop())}return K}(h.staticAttributes),P=m?m.getBinderAttributes():[],k=A.concat(P);let j=m?m.defines():[];j=j.concat(x.map(H=>`#define ${H}`));const Z=j.concat(r.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(yn):yn,yn,Vl,cn.fragmentSource,ts.fragmentSource,h.fragmentSource).join(`
`),te=j.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Vl,cn.vertexSource,ts.vertexSource,ia.vertexSource,h.vertexSource).join(`
`),ee=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(ee,Z),w.compileShader(ee),w.attachShader(this.program,ee);const J=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())this.failedToCreate=!0;else{w.shaderSource(J,te),w.compileShader(J),w.attachShader(this.program,J),this.attributes={},this.numAttributes=k.length;for(let H=0;H<this.numAttributes;H++)k[H]&&(w.bindAttribLocation(this.program,H,k[H]),this.attributes[k[H]]=H);w.linkProgram(this.program),w.deleteShader(J),w.deleteShader(ee),this.fixedUniforms=_(r),this.binderUniforms=m?m.getUniforms(r):[],x.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=(H=>({u_dem:new o.Uniform1i(H),u_dem_prev:new o.Uniform1i(H),u_dem_unpack:new o.Uniform4f(H),u_dem_tl:new o.Uniform2f(H),u_dem_scale:new o.Uniform1f(H),u_dem_tl_prev:new o.Uniform2f(H),u_dem_scale_prev:new o.Uniform1f(H),u_dem_size:new o.Uniform1f(H),u_dem_lerp:new o.Uniform1f(H),u_exaggeration:new o.Uniform1f(H),u_depth:new o.Uniform1i(H),u_depth_size_inv:new o.Uniform2f(H),u_meter_to_dem:new o.Uniform1f(H),u_label_plane_matrix_inv:new o.UniformMatrix4f(H),u_tile_tl_up:new o.Uniform3f(H),u_tile_tr_up:new o.Uniform3f(H),u_tile_br_up:new o.Uniform3f(H),u_tile_bl_up:new o.Uniform3f(H),u_tile_up_scale:new o.Uniform1f(H)}))(r)),x.indexOf("FOG")!==-1&&(this.fogUniforms=(H=>({u_fog_matrix:new o.UniformMatrix4f(H),u_fog_range:new o.Uniform2f(H),u_fog_color:new o.Uniform4f(H),u_fog_horizon_blend:new o.Uniform1f(H),u_fog_temporal_offset:new o.Uniform1f(H),u_frustum_tl:new o.Uniform3f(H),u_frustum_tr:new o.Uniform3f(H),u_frustum_br:new o.Uniform3f(H),u_frustum_bl:new o.Uniform3f(H),u_globe_pos:new o.Uniform3f(H),u_globe_radius:new o.Uniform1f(H),u_globe_transition:new o.Uniform1f(H),u_is_globe:new o.Uniform1i(H),u_viewport:new o.Uniform2f(H)}))(r))}}setTerrainUniformValues(r,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setFogUniformValues(r,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}draw(r,s,h,m,_,x,w,A,P,k,j,Z,te,ee,J){const H=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(h),r.setStencilMode(m),r.setColorMode(_),r.setCullFace(x);for(const se of Object.keys(this.fixedUniforms))this.fixedUniforms[se].set(this.program,se,w[se]);ee&&ee.setUniforms(this.program,r,this.binderUniforms,Z,{zoom:te});const K={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[s];for(const se of j.get()){const ie=se.vaos||(se.vaos={});(ie[A]||(ie[A]=new Es)).bind(r,this,P,ee?ee.getPaintVertexBuffers():[],k,se.vertexOffset,J||[]),H.drawElements(s,se.primitiveLength*K,H.UNSIGNED_SHORT,se.primitiveOffset*K*2)}}}function Fc(l,r,s){const h=1/Ao(s,1,r.transform.tileZoom),m=Math.pow(2,s.tileID.overscaledZ),_=s.tileSize*Math.pow(2,r.transform.tileZoom)/m,x=_*(s.tileID.canonical.x+s.tileID.wrap*m),w=_*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[h,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const rs=o.create(),ns=(l,r,s,h,m,_,x,w,A,P,k)=>{const j=r.style.light,Z=j.properties.get("position"),te=[Z.x,Z.y,Z.z],ee=o.create$1();j.properties.get("anchor")==="viewport"&&(o.fromRotation(ee,-r.transform.angle),o.transformMat3(te,te,ee));const J=j.properties.get("color"),H=r.transform,K={u_matrix:l,u_lightpos:te,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:rs,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:m,u_edge_radius:_};return H.projection.name==="globe"&&(K.u_tile_id=[x.canonical.x,x.canonical.y,1<<x.canonical.z],K.u_zoom_transition=A,K.u_inv_rot_matrix=k,K.u_merc_center=P,K.u_up_dir=H.projection.upVector(new o.CanonicalTileID(0,0,0),P[0]*o.EXTENT,P[1]*o.EXTENT),K.u_height_lift=w),K},na=(l,r,s,h,m,_,x,w,A,P,k,j,Z)=>{const te=ns(l,r,s,h,m,_,x,P,k,j,Z),ee={u_height_factor:-Math.pow(2,x.overscaledZ)/A.tileSize/8};return o.extend(te,Fc(w,r,A),ee)},za=l=>({u_matrix:l}),vn=(l,r,s,h)=>o.extend(za(l),Fc(s,r,h)),Hn=(l,r)=>({u_matrix:l,u_world:r}),oa=(l,r,s,h,m)=>o.extend(vn(l,r,s,h),{u_world:m}),cl=o.create(),ul=(l,r,s,h,m,_)=>{const x=l.transform,w=x.projection.name==="globe";let A;if(_.paint.get("circle-pitch-alignment")==="map")if(w){const k=o.globePixelsToTileUnits(x.zoom,r.canonical)*x._pixelsPerMercatorPixel;A=Float32Array.from([k,0,0,k])}else A=x.calculatePixelsToTileUnitsMatrix(s);else A=new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:x.cameraToCenterDistance,u_matrix:l.translatePosMatrix(r.projMatrix,s,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:cl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(w){P.u_inv_rot_matrix=h,P.u_merc_center=m,P.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],P.u_zoom_transition=o.globeToMercatorTransition(x.zoom);const k=m[0]*o.EXTENT,j=m[1]*o.EXTENT;P.u_up_dir=x.projection.upVector(new o.CanonicalTileID(0,0,0),k,j)}return P},M=l=>{const r=[];return l.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},D=(l,r,s,h)=>{const m=o.EXTENT/s.tileSize;return{u_matrix:l,u_camera_to_center_distance:r.getCameraToCenterDistance(h),u_extrude_scale:[r.pixelsToGLUnits[0]/m,r.pixelsToGLUnits[1]/m]}},R=(l,r,s=1)=>({u_matrix:l,u_color:r,u_overlay:0,u_overlay_scale:s}),W=o.create(),Re=(l,r,s,h,m,_,x)=>{const w=l.transform,A=w.projection.name==="globe",P=A?o.globePixelsToTileUnits(w.zoom,r.canonical)*w._pixelsPerMercatorPixel:Ao(s,1,_),k={u_matrix:r.projMatrix,u_extrude_scale:P,u_intensity:x,u_inv_rot_matrix:W,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){k.u_inv_rot_matrix=h,k.u_merc_center=m,k.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],k.u_zoom_transition=o.globeToMercatorTransition(w.zoom);const j=m[0]*o.EXTENT,Z=m[1]*o.EXTENT;k.u_up_dir=w.projection.upVector(new o.CanonicalTileID(0,0,0),j,Z)}return k},Je=(l,r,s,h,m,_,x,w)=>{const A=l.transform,P=A.calculatePixelsToTileUnitsMatrix(r),k={u_matrix:Pt(l,r,s,m),u_pixels_to_tile_units:P,u_device_pixel_ratio:x,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:w};if(qt(s)){const j=_t(r,l.transform);k.u_texsize=r.lineAtlasTexture.size,k.u_scale=[j,h.fromScale,h.toScale],k.u_mix=h.t}return k},yt=(l,r,s,h,m,_)=>{const x=l.transform,w=_t(r,x);return{u_matrix:Pt(l,r,s,m),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:_,u_image:0,u_scale:[w,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function _t(l,r){return 1/Ao(l,1,r.tileZoom)}function Pt(l,r,s,h){return l.translatePosMatrix(h||r.tileID.projMatrix,r,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}function qt(l){const r=l.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const Lt=(l,r,s,h,m,_)=>{return{u_matrix:l,u_tl_parent:r,u_scale_parent:s,u_fade_t:h.mix,u_opacity:h.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(w=m.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(x=m.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Vi(m.paint.get("raster-hue-rotate")),u_perspective_transform:_};var x,w};function Vi(l){l*=Math.PI/180;const r=Math.sin(l),s=Math.cos(l);return[(2*s+1)/3,(-Math.sqrt(3)*r-s+1)/3,(Math.sqrt(3)*r-s+1)/3]}const Ar=o.create(),bi=(l,r,s,h,m,_,x,w,A,P,k,j,Z,te,ee,J)=>{const H=m.transform,K={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_rotate_symbol:+s,u_aspect_ratio:H.width/H.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+A,u_pitch_with_map:+h,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ar,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ar,u_up_vector:[0,-1,0]};return J.name==="globe"&&(K.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],K.u_zoom_transition=j,K.u_inv_rot_matrix=te,K.u_merc_center=Z,K.u_camera_forward=H._camera.forward(),K.u_ecef_origin=o.globeECEFOrigin(H.globeMatrix,k.toUnwrapped()),K.u_tile_matrix=Float32Array.from(H.globeMatrix),K.u_up_vector=ee),K},Hi=(l,r,s,h,m,_,x,w,A,P,k,j,Z,te,ee,J,H)=>o.extend(bi(l,r,s,h,m,_,x,w,A,P,j,Z,te,ee,J,H),{u_gamma_scale:h?m.transform.cameraToCenterDistance*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+k}),mi=(l,r,s,h,m,_,x,w,A,P,k,j,Z,te,ee,J)=>o.extend(Hi(l,r,s,h,m,_,x,w,!0,A,!0,k,j,Z,te,ee,J),{u_texsize_icon:P,u_texture_icon:1}),Ti=(l,r,s)=>({u_matrix:l,u_opacity:r,u_color:s}),hr=(l,r,s,h,m,_)=>o.extend(function(x,w,A,P){const k=A.imageManager.getPattern(x.from.toString()),j=A.imageManager.getPattern(x.to.toString()),{width:Z,height:te}=A.imageManager.getPixelSize(),ee=Math.pow(2,P.tileID.overscaledZ),J=P.tileSize*Math.pow(2,A.transform.tileZoom)/ee,H=J*(P.tileID.canonical.x+P.tileID.wrap*ee),K=J*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[Z,te],u_mix:w.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/Ao(P,1,A.transform.tileZoom),u_pixel_coord_upper:[H>>16,K>>16],u_pixel_coord_lower:[65535&H,65535&K]}}(h,_,s,m),{u_matrix:l,u_opacity:r}),yr={fillExtrusion:l=>({u_matrix:new o.UniformMatrix4f(l),u_lightpos:new o.Uniform3f(l),u_lightintensity:new o.Uniform1f(l),u_lightcolor:new o.Uniform3f(l),u_vertical_gradient:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l),u_edge_radius:new o.Uniform1f(l),u_ao:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_up_dir:new o.Uniform3f(l),u_height_lift:new o.Uniform1f(l)}),fillExtrusionPattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_lightpos:new o.Uniform3f(l),u_lightintensity:new o.Uniform1f(l),u_lightcolor:new o.Uniform3f(l),u_vertical_gradient:new o.Uniform1f(l),u_height_factor:new o.Uniform1f(l),u_edge_radius:new o.Uniform1f(l),u_ao:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_up_dir:new o.Uniform3f(l),u_height_lift:new o.Uniform1f(l),u_image:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_scale:new o.Uniform3f(l),u_fade:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l)}),fill:l=>({u_matrix:new o.UniformMatrix4f(l)}),fillPattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_image:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_scale:new o.Uniform3f(l),u_fade:new o.Uniform1f(l)}),fillOutline:l=>({u_matrix:new o.UniformMatrix4f(l),u_world:new o.Uniform2f(l)}),fillOutlinePattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_world:new o.Uniform2f(l),u_image:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_scale:new o.Uniform3f(l),u_fade:new o.Uniform1f(l)}),circle:l=>({u_camera_to_center_distance:new o.Uniform1f(l),u_extrude_scale:new o.UniformMatrix2f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_up_dir:new o.Uniform3f(l)}),collisionBox:l=>({u_matrix:new o.UniformMatrix4f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_extrude_scale:new o.Uniform2f(l)}),collisionCircle:l=>({u_matrix:new o.UniformMatrix4f(l),u_inv_matrix:new o.UniformMatrix4f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_viewport_size:new o.Uniform2f(l)}),debug:l=>({u_color:new o.UniformColor(l),u_matrix:new o.UniformMatrix4f(l),u_overlay:new o.Uniform1i(l),u_overlay_scale:new o.Uniform1f(l)}),clippingMask:l=>({u_matrix:new o.UniformMatrix4f(l)}),heatmap:l=>({u_extrude_scale:new o.Uniform1f(l),u_intensity:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_up_dir:new o.Uniform3f(l)}),heatmapTexture:l=>({u_image:new o.Uniform1i(l),u_color_ramp:new o.Uniform1i(l),u_opacity:new o.Uniform1f(l)}),hillshade:l=>({u_matrix:new o.UniformMatrix4f(l),u_image:new o.Uniform1i(l),u_latrange:new o.Uniform2f(l),u_light:new o.Uniform2f(l),u_shadow:new o.UniformColor(l),u_highlight:new o.UniformColor(l),u_accent:new o.UniformColor(l)}),hillshadePrepare:l=>({u_matrix:new o.UniformMatrix4f(l),u_image:new o.Uniform1i(l),u_dimension:new o.Uniform2f(l),u_zoom:new o.Uniform1f(l),u_unpack:new o.Uniform4f(l)}),line:l=>({u_matrix:new o.UniformMatrix4f(l),u_pixels_to_tile_units:new o.UniformMatrix2f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_units_to_pixels:new o.Uniform2f(l),u_dash_image:new o.Uniform1i(l),u_gradient_image:new o.Uniform1i(l),u_image_height:new o.Uniform1f(l),u_texsize:new o.Uniform2f(l),u_scale:new o.Uniform3f(l),u_mix:new o.Uniform1f(l),u_alpha_discard_threshold:new o.Uniform1f(l),u_trim_offset:new o.Uniform2f(l)}),linePattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_texsize:new o.Uniform2f(l),u_pixels_to_tile_units:new o.UniformMatrix2f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_image:new o.Uniform1i(l),u_units_to_pixels:new o.Uniform2f(l),u_scale:new o.Uniform3f(l),u_fade:new o.Uniform1f(l),u_alpha_discard_threshold:new o.Uniform1f(l)}),raster:l=>({u_matrix:new o.UniformMatrix4f(l),u_tl_parent:new o.Uniform2f(l),u_scale_parent:new o.Uniform1f(l),u_fade_t:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l),u_image0:new o.Uniform1i(l),u_image1:new o.Uniform1i(l),u_brightness_low:new o.Uniform1f(l),u_brightness_high:new o.Uniform1f(l),u_saturation_factor:new o.Uniform1f(l),u_contrast_factor:new o.Uniform1f(l),u_spin_weights:new o.Uniform3f(l),u_perspective_transform:new o.Uniform2f(l)}),symbolIcon:l=>({u_is_size_zoom_constant:new o.Uniform1i(l),u_is_size_feature_constant:new o.Uniform1i(l),u_size_t:new o.Uniform1f(l),u_size:new o.Uniform1f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_rotate_symbol:new o.Uniform1i(l),u_aspect_ratio:new o.Uniform1f(l),u_fade_change:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_label_plane_matrix:new o.UniformMatrix4f(l),u_coord_matrix:new o.UniformMatrix4f(l),u_is_text:new o.Uniform1i(l),u_pitch_with_map:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_camera_forward:new o.Uniform3f(l),u_tile_matrix:new o.UniformMatrix4f(l),u_up_vector:new o.Uniform3f(l),u_ecef_origin:new o.Uniform3f(l),u_texture:new o.Uniform1i(l)}),symbolSDF:l=>({u_is_size_zoom_constant:new o.Uniform1i(l),u_is_size_feature_constant:new o.Uniform1i(l),u_size_t:new o.Uniform1f(l),u_size:new o.Uniform1f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_rotate_symbol:new o.Uniform1i(l),u_aspect_ratio:new o.Uniform1f(l),u_fade_change:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_label_plane_matrix:new o.UniformMatrix4f(l),u_coord_matrix:new o.UniformMatrix4f(l),u_is_text:new o.Uniform1i(l),u_pitch_with_map:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_texture:new o.Uniform1i(l),u_gamma_scale:new o.Uniform1f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_camera_forward:new o.Uniform3f(l),u_tile_matrix:new o.UniformMatrix4f(l),u_up_vector:new o.Uniform3f(l),u_ecef_origin:new o.Uniform3f(l),u_is_halo:new o.Uniform1i(l)}),symbolTextAndIcon:l=>({u_is_size_zoom_constant:new o.Uniform1i(l),u_is_size_feature_constant:new o.Uniform1i(l),u_size_t:new o.Uniform1f(l),u_size:new o.Uniform1f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_rotate_symbol:new o.Uniform1i(l),u_aspect_ratio:new o.Uniform1f(l),u_fade_change:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_label_plane_matrix:new o.UniformMatrix4f(l),u_coord_matrix:new o.UniformMatrix4f(l),u_is_text:new o.Uniform1i(l),u_pitch_with_map:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_texsize_icon:new o.Uniform2f(l),u_texture:new o.Uniform1i(l),u_texture_icon:new o.Uniform1i(l),u_gamma_scale:new o.Uniform1f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_is_halo:new o.Uniform1i(l)}),background:l=>({u_matrix:new o.UniformMatrix4f(l),u_opacity:new o.Uniform1f(l),u_color:new o.UniformColor(l)}),backgroundPattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_opacity:new o.Uniform1f(l),u_image:new o.Uniform1i(l),u_pattern_tl_a:new o.Uniform2f(l),u_pattern_br_a:new o.Uniform2f(l),u_pattern_tl_b:new o.Uniform2f(l),u_pattern_br_b:new o.Uniform2f(l),u_texsize:new o.Uniform2f(l),u_mix:new o.Uniform1f(l),u_pattern_size_a:new o.Uniform2f(l),u_pattern_size_b:new o.Uniform2f(l),u_scale_a:new o.Uniform1f(l),u_scale_b:new o.Uniform1f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l)}),terrainRaster:ol,terrainDepth:ol,skybox:l=>({u_matrix:new o.UniformMatrix4f(l),u_sun_direction:new o.Uniform3f(l),u_cubemap:new o.Uniform1i(l),u_opacity:new o.Uniform1f(l),u_temporal_offset:new o.Uniform1f(l)}),skyboxGradient:l=>({u_matrix:new o.UniformMatrix4f(l),u_color_ramp:new o.Uniform1i(l),u_center_direction:new o.Uniform3f(l),u_radius:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l),u_temporal_offset:new o.Uniform1f(l)}),skyboxCapture:l=>({u_matrix_3f:new o.UniformMatrix3f(l),u_sun_direction:new o.Uniform3f(l),u_sun_intensity:new o.Uniform1f(l),u_color_tint_r:new o.Uniform4f(l),u_color_tint_m:new o.Uniform4f(l),u_luminance:new o.Uniform1f(l)}),globeRaster:l=>({u_proj_matrix:new o.UniformMatrix4f(l),u_globe_matrix:new o.UniformMatrix4f(l),u_normalize_matrix:new o.UniformMatrix4f(l),u_merc_matrix:new o.UniformMatrix4f(l),u_zoom_transition:new o.Uniform1f(l),u_merc_center:new o.Uniform2f(l),u_image0:new o.Uniform1i(l),u_grid_matrix:new o.UniformMatrix3f(l),u_frustum_tl:new o.Uniform3f(l),u_frustum_tr:new o.Uniform3f(l),u_frustum_br:new o.Uniform3f(l),u_frustum_bl:new o.Uniform3f(l),u_globe_pos:new o.Uniform3f(l),u_globe_radius:new o.Uniform1f(l),u_viewport:new o.Uniform2f(l)}),globeAtmosphere:l=>({u_frustum_tl:new o.Uniform3f(l),u_frustum_tr:new o.Uniform3f(l),u_frustum_br:new o.Uniform3f(l),u_frustum_bl:new o.Uniform3f(l),u_horizon:new o.Uniform1f(l),u_transition:new o.Uniform1f(l),u_fadeout_range:new o.Uniform1f(l),u_color:new o.Uniform4f(l),u_high_color:new o.Uniform4f(l),u_space_color:new o.Uniform4f(l),u_star_intensity:new o.Uniform1f(l),u_star_density:new o.Uniform1f(l),u_star_size:new o.Uniform1f(l),u_temporal_offset:new o.Uniform1f(l),u_horizon_angle:new o.Uniform1f(l),u_rotation_matrix:new o.UniformMatrix4f(l)})};let nr;function ki(l,r,s,h,m,_,x){const w=l.context,A=w.gl,P=l.transform,k=l.useProgram("collisionBox"),j=[];let Z=0,te=0;for(let xe=0;xe<h.length;xe++){const ye=h[xe],he=r.getTile(ye),ve=he.getBucket(s);if(!ve)continue;const fe=Nr(ye,ve,P);let Ee=fe;m[0]===0&&m[1]===0||(Ee=l.translatePosMatrix(fe,he,m,_));const Le=x?ve.textCollisionBox:ve.iconCollisionBox,ht=ve.collisionCircleArray;if(ht.length>0){const Pe=o.create(),He=Ee;o.mul(Pe,ve.placementInvProjMatrix,P.glCoordMatrix),o.mul(Pe,Pe,ve.placementViewportMatrix),j.push({circleArray:ht,circleOffset:te,transform:He,invTransform:Pe,projection:ve.getProjection()}),Z+=ht.length/4,te=Z}Le&&(l.terrain&&l.terrain.setupElevationDraw(he,k),k.draw(w,A.LINES,o.DepthMode.disabled,o.StencilMode.disabled,l.colorModeForRenderPass(),o.CullFaceMode.disabled,D(Ee,P,he,ve.getProjection()),s.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,null,P.zoom,null,[Le.collisionVertexBuffer,Le.collisionVertexBufferExt]))}if(!x||!j.length)return;const ee=l.useProgram("collisionCircle"),J=new o.StructArrayLayout2f1f2i16;J.resize(4*Z),J._trim();let H=0;for(const xe of j)for(let ye=0;ye<xe.circleArray.length/4;ye++){const he=4*ye,ve=xe.circleArray[he+0],fe=xe.circleArray[he+1],Ee=xe.circleArray[he+2],Le=xe.circleArray[he+3];J.emplace(H++,ve,fe,Ee,Le,0),J.emplace(H++,ve,fe,Ee,Le,1),J.emplace(H++,ve,fe,Ee,Le,2),J.emplace(H++,ve,fe,Ee,Le,3)}(!nr||nr.length<2*Z)&&(nr=function(xe){const ye=2*xe,he=new o.StructArrayLayout3ui6;he.resize(ye),he._trim();for(let ve=0;ve<ye;ve++){const fe=6*ve;he.uint16[fe+0]=4*ve+0,he.uint16[fe+1]=4*ve+1,he.uint16[fe+2]=4*ve+2,he.uint16[fe+3]=4*ve+2,he.uint16[fe+4]=4*ve+3,he.uint16[fe+5]=4*ve+0}return he}(Z));const K=w.createIndexBuffer(nr,!0),se=w.createVertexBuffer(J,o.collisionCircleLayout.members,!0);for(const xe of j){const ye={u_matrix:xe.transform,u_inv_matrix:xe.invTransform,u_camera_to_center_distance:(ie=P).getCameraToCenterDistance(xe.projection),u_viewport_size:[ie.width,ie.height]};ee.draw(w,A.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,l.colorModeForRenderPass(),o.CullFaceMode.disabled,ye,s.id,se,K,o.SegmentVector.simpleSegment(0,2*xe.circleOffset,xe.circleArray.length,xe.circleArray.length/2),null,P.zoom)}var ie;se.destroy(),K.destroy()}const dr=o.create();function Ji(l,r,s,h,m,_){const{horizontalAlign:x,verticalAlign:w}=o.getAnchorAlignment(l),A=-(x-.5)*r,P=-(w-.5)*s,k=o.evaluateVariableOffset(l,h);return new o.pointGeometry((A/m+k[0])*_,(P/m+k[1])*_)}function Gi(l,r,s,h,m,_,x,w,A,P,k){const j=l.text.placedSymbolArray,Z=l.text.dynamicLayoutVertexArray,te=l.icon.dynamicLayoutVertexArray,ee={},J=Rn(w,l.getProjection(),_),H=_.elevation,K=l.getProjection().upVectorScale(w.canonical,_.center.lat,_.worldSize);Z.clear();for(let se=0;se<j.length;se++){const ie=j.get(se),xe=l.allowVerticalPlacement&&!ie.placedOrientation,ye=ie.hidden||!ie.crossTileID||xe?null:h[ie.crossTileID];if(ye){const he=new o.pointGeometry(ie.tileAnchorX,ie.tileAnchorY),ve=l.getProjection().upVector(w.canonical,he.x,he.y),fe=H?H.getAtTileOffset(w,he.x,he.y):0,Ee=ti([ie.projectedAnchorX+fe*ve[0]*K.metersToTile,ie.projectedAnchorY+fe*ve[1]*K.metersToTile,ie.projectedAnchorZ+fe*ve[2]*K.metersToTile],s?J:x),Le=Ys(_.getCameraToCenterDistance(l.getProjection()),Ee.signedDistanceFromCamera);let ht=m.evaluateSizeForFeature(l.textSizeData,P,ie)*Le/o.ONE_EM;s&&(ht*=l.tilePixelRatio/A);const{width:Pe,height:He,anchor:rt,textOffset:gt,textScale:Ve}=ye,dt=Ji(rt,Pe,He,gt,Ve,ht);let Qe;if(s){const wt=he.add(dt),{x:Ot,y:Nt,z:Ht}=l.getProjection().projectTilePoint(wt.x,wt.y,w.canonical);Qe=ti([Ot+fe*ve[0]*K.metersToTile,Nt+fe*ve[1]*K.metersToTile,Ht+fe*ve[2]*K.metersToTile],x).point}else{const wt=r?dt.rotate(-_.angle):dt;Qe=[Ee.point[0]+wt.x,Ee.point[1]+wt.y,0]}const Tt=l.allowVerticalPlacement&&ie.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let wt=0;wt<ie.numGlyphs;wt++)o.addDynamicAttributes(Z,Qe[0],Qe[1],Qe[2],Tt);k&&ie.associatedIconIndex>=0&&(ee[ie.associatedIconIndex]={shiftedAnchor:Qe,angle:Tt})}else Yo(ie.numGlyphs,Z)}if(k){te.clear();const se=l.icon.placedSymbolArray;for(let ie=0;ie<se.length;ie++){const xe=se.get(ie);if(xe.hidden)Yo(xe.numGlyphs,te);else{const ye=ee[ie];if(ye)for(let he=0;he<xe.numGlyphs;he++)o.addDynamicAttributes(te,ye.shiftedAnchor[0],ye.shiftedAnchor[1],ye.shiftedAnchor[2],ye.angle);else Yo(xe.numGlyphs,te)}}l.icon.dynamicLayoutVertexBuffer.updateData(te)}l.text.dynamicLayoutVertexBuffer.updateData(Z)}function Se(l,r,s){return s.iconsInText&&r?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function Xe(l,r,s,h,m,_,x,w,A,P,k,j){const Z=l.context,te=Z.gl,ee=l.transform,J=w==="map",H=A==="map",K=J&&s.layout.get("symbol-placement")!=="point",se=J&&!H&&!K,ie=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let xe=!1;const ye=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),he=[o.mercatorXfromLng(ee.center.lng),o.mercatorYfromLat(ee.center.lat)],ve=s.layout.get("text-variable-anchor"),fe=ee.projection.name==="globe",Ee=[],Le=[0,-1,0];let ht=Le;!fe&&!ee.mercatorFromTransition||J||(ht=function(Pe){const He=Pe._camera.getWorldToCamera(Pe.worldSize,1),rt=o.multiply([],He,Pe.globeMatrix);o.invert(rt,rt);const gt=[0,0,0],Ve=[0,1,0,0];return o.transformMat4$1(Ve,Ve,rt),gt[0]=Ve[0],gt[1]=Ve[1],gt[2]=Ve[2],o.normalize(gt,gt),gt}(ee));for(const Pe of h){const He=r.getTile(Pe),rt=He.getBucket(s);if(!rt||rt.projection.name==="mercator"&&fe)continue;const gt=m?rt.text:rt.icon;if(!gt||rt.fullyClipped||!gt.segments.get().length)continue;const Ve=gt.programConfigurations.get(s.id),dt=m||rt.sdfIcons,Qe=m?rt.textSizeData:rt.iconSizeData,Tt=H||ee.pitch!==0,wt=o.evaluateSizeForZoom(Qe,ee.zoom);let Ot,Nt,Ht,Ei,Rt=[0,0],ii=null;if(m){if(Nt=He.glyphAtlasTexture,Ht=te.LINEAR,Ot=He.glyphAtlasTexture.size,rt.iconsInText){Rt=He.imageAtlasTexture.size,ii=He.imageAtlasTexture;const Jt=Qe.kind==="composite"||Qe.kind==="camera";Ei=Tt||l.options.rotating||l.options.zooming||Jt?te.LINEAR:te.NEAREST}}else{const Jt=s.layout.get("icon-size").constantOr(0)!==1||rt.iconsNeedLinear;Nt=He.imageAtlasTexture,Ht=dt||l.options.rotating||l.options.zooming||Jt||Tt?te.LINEAR:te.NEAREST,Ot=He.imageAtlasTexture.size}const Li=rt.projection.name==="globe",Qi=Li?ht:Le,br=Li?o.globeToMercatorTransition(ee.zoom):0,qi=Rn(Pe,rt.getProjection(),ee),xn=ee.calculatePixelsToTileUnitsMatrix(He),Lo=di(qi,He.tileID.canonical,H,J,ee,rt.getProjection(),xn),Os=l.terrain&&H&&K?o.invert(o.create(),Lo):dr,Ki=no(qi,He.tileID.canonical,H,J,ee,rt.getProjection(),xn),pr=ve&&rt.hasTextData(),gi=s.layout.get("icon-text-fit")!=="none"&&pr&&rt.hasIconData();if(K){const Jt=ee.elevation,gl=Jt?Jt.getAtTileOffsetFunc(Pe,ee.center.lat,ee.worldSize,rt.getProjection()):ga=>[0,0,0],ja=fi(qi,He.tileID.canonical,H,J,ee,rt.getProjection(),xn);Aa(rt,qi,l,m,ja,Ki,H,P,gl,Pe)}const Rr=K||m&&ve||gi,Nn=l.translatePosMatrix(qi,He,_,x),Yi=Rr?dr:Lo,jn=l.translatePosMatrix(Ki,He,_,x,!0),pa=rt.getProjection().createInversionMatrix(ee,Pe.canonical),Vn=[];l.terrain&&H&&Vn.push("PITCH_WITH_MAP_TERRAIN"),Li&&Vn.push("PROJECTION_GLOBE_VIEW"),Rr&&Vn.push("PROJECTED_POS_ON_VIEWPORT");const ma=dt&&s.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let _l;_l=dt?rt.iconsInText?mi(Qe.kind,wt,se,H,l,Nn,Yi,jn,Ot,Rt,Pe,br,he,pa,Qi,rt.getProjection()):Hi(Qe.kind,wt,se,H,l,Nn,Yi,jn,m,Ot,!0,Pe,br,he,pa,Qi,rt.getProjection()):bi(Qe.kind,wt,se,H,l,Nn,Yi,jn,m,Ot,Pe,br,he,pa,Qi,rt.getProjection());const _a={program:l.useProgram(Se(dt,m,rt),Ve,Vn),buffers:gt,uniformValues:_l,atlasTexture:Nt,atlasTextureIcon:ii,atlasInterpolation:Ht,atlasInterpolationIcon:Ei,isSDF:dt,hasHalo:ma,tile:He,labelPlaneMatrixInv:Os};if(ie&&rt.canOverlap){xe=!0;const Jt=gt.segments.get();for(const gl of Jt)Ee.push({segments:new o.SegmentVector([gl]),sortKey:gl.sortKey,state:_a})}else Ee.push({segments:gt.segments,sortKey:0,state:_a})}xe&&Ee.sort((Pe,He)=>Pe.sortKey-He.sortKey);for(const Pe of Ee){const He=Pe.state;if(l.terrain&&l.terrain.setupElevationDraw(He.tile,He.program,{useDepthForOcclusion:!fe,labelPlaneMatrixInv:He.labelPlaneMatrixInv}),Z.activeTexture.set(te.TEXTURE0),He.atlasTexture.bind(He.atlasInterpolation,te.CLAMP_TO_EDGE),He.atlasTextureIcon&&(Z.activeTexture.set(te.TEXTURE1),He.atlasTextureIcon&&He.atlasTextureIcon.bind(He.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),He.isSDF){const rt=He.uniformValues;He.hasHalo&&(rt.u_is_halo=1,Be(He.buffers,Pe.segments,s,l,He.program,ye,k,j,rt)),rt.u_is_halo=0}Be(He.buffers,Pe.segments,s,l,He.program,ye,k,j,He.uniformValues)}}function Be(l,r,s,h,m,_,x,w,A){const P=h.context,k=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.globeExtVertexBuffer];m.draw(P,P.gl.TRIANGLES,_,x,w,o.CullFaceMode.disabled,A,s.id,l.layoutVertexBuffer,l.indexBuffer,r,s.paint,h.transform.zoom,l.programConfigurations.get(s.id),k)}function It(l,r,s,h,m,_,x){const w=l.context.gl,A=s.paint.get("fill-pattern"),P=A&&A.constantOr(1),k=s.getCrossfadeParameters();let j,Z,te,ee,J;x?(Z=P&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=w.LINES):(Z=P?"fillPattern":"fill",j=w.TRIANGLES);for(const H of h){const K=r.getTile(H);if(P&&!K.patternsLoaded())continue;const se=K.getBucket(s);if(!se)continue;l.prepareDrawTile();const ie=se.programConfigurations.get(s.id),xe=l.useProgram(Z,ie);P&&(l.context.activeTexture.set(w.TEXTURE0),K.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),ie.updatePaintBuffers(k));const ye=A.constantOr(null);if(ye&&K.imageAtlas){const ve=K.imageAtlas,fe=ve.patternPositions[ye.to.toString()],Ee=ve.patternPositions[ye.from.toString()];fe&&Ee&&ie.setConstantPatternPositions(fe,Ee)}const he=l.translatePosMatrix(H.projMatrix,K,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(x){ee=se.indexBuffer2,J=se.segments2;const ve=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[w.drawingBufferWidth,w.drawingBufferHeight];te=Z==="fillOutlinePattern"&&P?oa(he,l,k,K,ve):Hn(he,ve)}else ee=se.indexBuffer,J=se.segments,te=P?vn(he,l,k,K):za(he);l.prepareDrawProgram(l.context,xe,H.toUnwrapped()),xe.draw(l.context,j,m,l.stencilModeForClipping(H),_,o.CullFaceMode.disabled,te,s.id,se.layoutVertexBuffer,ee,J,s.paint,l.transform.zoom,ie)}}function Gt(l,r,s,h,m,_,x){const w=l.context,A=w.gl,P=l.transform,k=s.paint.get("fill-extrusion-pattern"),j=k.constantOr(1),Z=s.getCrossfadeParameters(),te=s.paint.get("fill-extrusion-opacity"),ee=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),s.paint.get("fill-extrusion-ambient-occlusion-radius")],J=s.layout.get("fill-extrusion-edge-radius"),H=P.projection.name==="globe"?o.fillExtrusionHeightLift():0,K=P.projection.name==="globe",se=K?o.globeToMercatorTransition(P.zoom):0,ie=[o.mercatorXfromLng(P.center.lng),o.mercatorYfromLat(P.center.lat)],xe=[];K&&(xe.push("PROJECTION_GLOBE_VIEW"),l.style.terrainSetForDrapingOnly()&&xe.push("TERRAIN")),ee[0]>0&&xe.push("FAUX_AO");for(const ye of h){const he=r.getTile(ye),ve=he.getBucket(s);if(!ve||ve.projection.name!==P.projection.name)continue;const fe=ve.programConfigurations.get(s.id),Ee=l.useProgram(j?"fillExtrusionPattern":"fillExtrusion",fe,xe);if(l.terrain){const Ve=l.terrain;if(l.style.terrainSetForDrapingOnly())Ve.setupElevationDraw(he,Ee,{useMeterToDem:!0});else{if(!ve.enableTerrain)continue;if(Ve.setupElevationDraw(he,Ee,{useMeterToDem:!0}),si(w,r,ye,ve,s,Ve),!ve.centroidVertexBuffer){const dt=Ee.attributes.a_centroid_pos;dt!==void 0&&A.vertexAttrib2f(dt,0,0)}}}j&&(l.context.activeTexture.set(A.TEXTURE0),he.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),fe.updatePaintBuffers(Z));const Le=k.constantOr(null);if(Le&&he.imageAtlas){const Ve=he.imageAtlas,dt=Ve.patternPositions[Le.to.toString()],Qe=Ve.patternPositions[Le.from.toString()];dt&&Qe&&fe.setConstantPatternPositions(dt,Qe)}const ht=l.translatePosMatrix(ye.projMatrix,he,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Pe=P.projection.createInversionMatrix(P,ye.canonical),He=s.paint.get("fill-extrusion-vertical-gradient"),rt=j?na(ht,l,He,te,ee,J,ye,Z,he,H,se,ie,Pe):ns(ht,l,He,te,ee,J,ye,H,se,ie,Pe);l.prepareDrawProgram(w,Ee,ye.toUnwrapped());const gt=[];l.terrain&&gt.push(ve.centroidVertexBuffer),K&&gt.push(ve.layoutVertexExtBuffer),Ee.draw(w,w.gl.TRIANGLES,m,_,x,o.CullFaceMode.backCCW,rt,s.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,s.paint,l.transform.zoom,fe,gt)}}function si(l,r,s,h,m,_){const x=[K=>{let se=K.canonical.x-1,ie=K.wrap;return se<0&&(se=(1<<K.canonical.z)-1,ie--),new o.OverscaledTileID(K.overscaledZ,ie,K.canonical.z,se,K.canonical.y)},K=>{let se=K.canonical.x+1,ie=K.wrap;return se===1<<K.canonical.z&&(se=0,ie++),new o.OverscaledTileID(K.overscaledZ,ie,K.canonical.z,se,K.canonical.y)},K=>new o.OverscaledTileID(K.overscaledZ,K.wrap,K.canonical.z,K.canonical.x,(K.canonical.y===0?1<<K.canonical.z:K.canonical.y)-1),K=>new o.OverscaledTileID(K.overscaledZ,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y===(1<<K.canonical.z)-1?0:K.canonical.y+1)],w=K=>{const se=r.getSource().minzoom,ie=ye=>{const he=r.getTileByID(ye);if(he&&he.hasData())return he.getBucket(m)},xe=[0,-1,1];for(const ye of xe){if(K.overscaledZ+ye<se)continue;const he=ie(K.calculateScaledKey(K.overscaledZ+ye));if(he)return he}},A=[0,0,0],P=(K,se)=>(A[0]=Math.min(K.min.y,se.min.y),A[1]=Math.max(K.max.y,se.max.y),A[2]=o.EXTENT-se.min.x>K.max.x?se.min.x-o.EXTENT:K.max.x,A),k=(K,se)=>(A[0]=Math.min(K.min.x,se.min.x),A[1]=Math.max(K.max.x,se.max.x),A[2]=o.EXTENT-se.min.y>K.max.y?se.min.y-o.EXTENT:K.max.y,A),j=[(K,se)=>P(K,se),(K,se)=>P(se,K),(K,se)=>k(K,se),(K,se)=>k(se,K)],Z=new o.pointGeometry(0,0);let te,ee,J;const H=(K,se,ie,xe,ye)=>{const he=[[xe?ie:K,xe?K:ie,0],[xe?ie:se,xe?se:ie,0]],ve=ye<0?o.EXTENT+ye:ye,fe=[xe?ve:(K+se)/2,xe?(K+se)/2:ve,0];return ie===0&&ye<0||ie!==0&&ye>0?_.getForTilePoints(J,[fe],!0,ee):he.push(fe),_.getForTilePoints(s,he,!0,te),Math.max(he[0][2],he[1][2],fe[2])/_.exaggeration()};for(let K=0;K<4;K++){const se=(K<2?1:5)-K,ie=h.borders[K];if(ie.length===0)continue;const xe=J=x[K](s),ye=w(xe);if(!(ye&&ye instanceof o.FillExtrusionBucket&&ye.enableTerrain)||h.borderDoneWithNeighborZ[K]===ye.canonical.z&&ye.borderDoneWithNeighborZ[se]===h.canonical.z||(ee=_.findDEMTileFor(xe),!ee||!ee.dem))continue;if(!te){const Ee=_.findDEMTileFor(s);if(!Ee||!Ee.dem)return;te=Ee}const he=ye.borders[se];let ve=0;const fe=ye.borderDoneWithNeighborZ[se]!==h.canonical.z;if(h.canonical.z===ye.canonical.z){for(let Ee=0;Ee<ie.length;Ee++){const Le=h.featuresOnBorder[ie[Ee]],ht=Le.borders[K];let Pe;for(;ve<he.length&&(Pe=ye.featuresOnBorder[he[ve]],!(Pe.borders[se][1]>ht[0]+3));)fe&&ye.encodeCentroid(void 0,Pe,!1),ve++;if(Pe&&ve<he.length){const He=ve;let rt=0;for(;!(Pe.borders[se][0]>ht[1]-3)&&(rt++,++ve!==he.length);)Pe=ye.featuresOnBorder[he[ve]];if(Pe=ye.featuresOnBorder[he[He]],Le.intersectsCount()>1||Pe.intersectsCount()>1||rt!==1){rt!==1&&(ve=He),h.encodeCentroid(void 0,Le,!1),fe&&ye.encodeCentroid(void 0,Pe,!1);continue}const gt=j[K](Le,Pe),Ve=K%2?o.EXTENT-1:0;Z.x=H(gt[0],Math.min(o.EXTENT-1,gt[1]),Ve,K<2,gt[2]),Z.y=0,h.encodeCentroid(Z,Le,!1),fe&&ye.encodeCentroid(Z,Pe,!1)}else h.encodeCentroid(void 0,Le,!1)}h.borderDoneWithNeighborZ[K]=ye.canonical.z,h.needsCentroidUpdate=!0,fe&&(ye.borderDoneWithNeighborZ[se]=h.canonical.z,ye.needsCentroidUpdate=!0)}else{for(const Ee of ie)h.encodeCentroid(void 0,h.featuresOnBorder[Ee],!1);if(fe){for(const Ee of he)ye.encodeCentroid(void 0,ye.featuresOnBorder[Ee],!1);ye.borderDoneWithNeighborZ[se]=h.canonical.z,ye.needsCentroidUpdate=!0}h.borderDoneWithNeighborZ[K]=ye.canonical.z,h.needsCentroidUpdate=!0}}(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(l)}const fr=new o.Color(1,0,0,1),Di=new o.Color(0,1,0,1),Lr=new o.Color(0,0,1,1),ao=new o.Color(1,0,1,1),un=new o.Color(0,1,1,1);function _i(l,r,s){const h=l.context,m=l.transform,_=h.gl,x=m.projection.name==="globe",w=x?["PROJECTION_GLOBE_VIEW"]:null;let A=s.projMatrix;if(x&&o.globeToMercatorTransition(m.zoom)>0){const Le=o.transitionTileAABBinECEF(s.canonical,m),ht=o.globeDenormalizeECEF(Le);A=o.multiply(new Float32Array(16),m.globeMatrix,ht),o.multiply(A,m.projMatrix,A)}const P=l.useProgram("debug",null,w),k=r.getTileByID(s.key);l.terrain&&l.terrain.setupElevationDraw(k,P);const j=o.DepthMode.disabled,Z=o.StencilMode.disabled,te=l.colorModeForRenderPass(),ee="$debug";h.activeTexture.set(_.TEXTURE0),l.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),x?k._makeGlobeTileDebugBuffers(l.context,m):k._makeDebugTileBoundsBuffers(l.context,m.projection);const J=k._tileDebugBuffer||l.debugBuffer,H=k._tileDebugIndexBuffer||l.debugIndexBuffer,K=k._tileDebugSegments||l.debugSegments;P.draw(h,_.LINE_STRIP,j,Z,te,o.CullFaceMode.disabled,R(A,o.Color.red),ee,J,H,K,null,null,null,[k._globeTileDebugBorderBuffer]);const se=k.latestRawTileData,ie=Math.floor((se&&se.byteLength||0)/1024),xe=r.getTile(s).tileSize,ye=512/Math.min(xe,512)*(s.overscaledZ/m.zoom)*.5;let he=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(he+=` => ${s.overscaledZ}`),he+=` ${ie}kb`,function(Le,ht){Le.initDebugOverlayCanvas();const Pe=Le.debugOverlayCanvas,He=Le.context.gl,rt=Le.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,Pe.width,Pe.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(ht,5,5),rt.strokeText(ht,5,5),Le.debugOverlayTexture.update(Pe),Le.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(l,he);const ve=k._tileDebugTextBuffer||l.debugBuffer,fe=k._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,Ee=k._tileDebugTextSegments||l.debugSegments;P.draw(h,_.TRIANGLES,j,Z,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,R(A,o.Color.transparent,ye),ee,ve,fe,Ee,null,null,null,[k._globeTileDebugTextBuffer])}function Cs(l,r,s,h){lo(l,0,r+s/2,l.transform.width,s,h)}function os(l,r,s,h){lo(l,r-s/2,0,s,l.transform.height,h)}function lo(l,r,s,h,m,_){const x=l.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(r*o.exported.devicePixelRatio,s*o.exported.devicePixelRatio,h*o.exported.devicePixelRatio,m*o.exported.devicePixelRatio),x.clear({color:_}),w.disable(w.SCISSOR_TEST)}const go=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Bi}=go;function Mn(l,r,s,h){l.emplaceBack(r,s,h)}class Ps{constructor(r){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Mn(this.vertexArray,-1,-1,1),Mn(this.vertexArray,1,-1,1),Mn(this.vertexArray,-1,1,1),Mn(this.vertexArray,1,1,1),Mn(this.vertexArray,-1,-1,-1),Mn(this.vertexArray,1,-1,-1),Mn(this.vertexArray,-1,1,-1),Mn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Bi),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function co(l,r,s,h,m,_){const x=l.gl,w=r.paint.get("sky-atmosphere-color"),A=r.paint.get("sky-atmosphere-halo-color"),P=r.paint.get("sky-atmosphere-sun-intensity"),k=((j,Z,te,ee,J)=>({u_matrix_3f:j,u_sun_direction:Z,u_sun_intensity:te,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),h),m,P,w,A);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+_,r.skyboxTexture,0),s.draw(l,x.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,k,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const ss=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ka{constructor(r){const s=new o.StructArrayLayout5f20;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const h=new o.StructArrayLayout3ui6;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(s,ss.members),this.indexBuffer=r.createIndexBuffer(h),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Da={symbol:function(l,r,s,h,m){if(l.renderPass!=="translucent")return;const _=o.StencilMode.disabled,x=l.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(w,A,P,k,j,Z,te){const ee=A.transform,J=j==="map",H=Z==="map";for(const K of w){const se=k.getTile(K),ie=se.getBucket(P);if(!ie||!ie.text||!ie.text.segments.get().length)continue;const xe=o.evaluateSizeForZoom(ie.textSizeData,ee.zoom),ye=Rn(K,ie.getProjection(),ee),he=ee.calculatePixelsToTileUnitsMatrix(se),ve=di(ye,se.tileID.canonical,H,J,ee,ie.getProjection(),he),fe=P.layout.get("icon-text-fit")!=="none"&&ie.hasIconData();if(xe){const Ee=Math.pow(2,ee.zoom-se.tileID.overscaledZ);Gi(ie,J,H,te,o.symbolSize,ee,ve,K,Ee,xe,fe)}}}(h,l,s,r,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m),s.paint.get("icon-opacity").constantOr(1)!==0&&Xe(l,r,s,h,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),_,x),s.paint.get("text-opacity").constantOr(1)!==0&&Xe(l,r,s,h,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),_,x),r.map.showCollisionBoxes&&(ki(l,r,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),ki(l,r,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(l,r,s,h){if(l.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),_=s.paint.get("circle-stroke-width"),x=s.paint.get("circle-stroke-opacity"),w=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(m.constantOr(1)===0&&(_.constantOr(1)===0||x.constantOr(1)===0))return;const A=l.context,P=A.gl,k=l.transform,j=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),Z=o.StencilMode.disabled,te=l.colorModeForRenderPass(),ee=k.projection.name==="globe",J=[o.mercatorXfromLng(k.center.lng),o.mercatorYfromLat(k.center.lat)],H=[];for(let se=0;se<h.length;se++){const ie=h[se],xe=r.getTile(ie),ye=xe.getBucket(s);if(!ye||ye.projection.name!==k.projection.name)continue;const he=ye.programConfigurations.get(s.id),ve=M(s);ee&&ve.push("PROJECTION_GLOBE_VIEW");const fe=l.useProgram("circle",he,ve),Ee=ye.layoutVertexBuffer,Le=ye.globeExtVertexBuffer,ht=ye.indexBuffer,Pe=k.projection.createInversionMatrix(k,ie.canonical),He={programConfiguration:he,program:fe,layoutVertexBuffer:Ee,globeExtVertexBuffer:Le,indexBuffer:ht,uniformValues:ul(l,ie,xe,Pe,J,s),tile:xe};if(w){const rt=ye.segments.get();for(const gt of rt)H.push({segments:new o.SegmentVector([gt]),sortKey:gt.sortKey,state:He})}else H.push({segments:ye.segments,sortKey:0,state:He})}w&&H.sort((se,ie)=>se.sortKey-ie.sortKey);const K={useDepthForOcclusion:!ee};for(const se of H){const{programConfiguration:ie,program:xe,layoutVertexBuffer:ye,globeExtVertexBuffer:he,indexBuffer:ve,uniformValues:fe,tile:Ee}=se.state,Le=se.segments;l.terrain&&l.terrain.setupElevationDraw(Ee,xe,K),l.prepareDrawProgram(A,xe,Ee.tileID.toUnwrapped()),xe.draw(A,P.TRIANGLES,j,Z,te,o.CullFaceMode.disabled,fe,s.id,ye,ve,Le,s.paint,k.zoom,ie,[he])}},heatmap:function(l,r,s,h){if(s.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const m=l.context,_=m.gl,x=o.StencilMode.disabled,w=new o.ColorMode([_.ONE,_.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(te,ee,J,H){const K=te.gl,se=ee.width*H,ie=ee.height*H;te.activeTexture.set(K.TEXTURE1),te.viewport.set([0,0,se,ie]);let xe=J.heatmapFbo;if(!xe||xe&&(xe.width!==se||xe.height!==ie)){xe&&xe.destroy();const ye=K.createTexture();K.bindTexture(K.TEXTURE_2D,ye),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),xe=J.heatmapFbo=te.createFramebuffer(se,ie,!1),function(he,ve,fe,Ee,Le,ht){const Pe=he.gl;Pe.texImage2D(Pe.TEXTURE_2D,0,Pe.RGBA,Le,ht,0,Pe.RGBA,he.extRenderToTextureHalfFloat?he.extTextureHalfFloat.HALF_FLOAT_OES:Pe.UNSIGNED_BYTE,null),Ee.colorAttachment.set(fe)}(te,0,ye,xe,se,ie)}else K.bindTexture(K.TEXTURE_2D,xe.colorAttachment.get()),te.bindFramebuffer.set(xe.framebuffer)})(m,l,s,l.transform.projection.name==="globe"?.5:.25),m.clear({color:o.Color.transparent});const A=l.transform,P=A.projection.name==="globe",k=P?["PROJECTION_GLOBE_VIEW"]:null,j=P?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,Z=[o.mercatorXfromLng(A.center.lng),o.mercatorYfromLat(A.center.lat)];for(let te=0;te<h.length;te++){const ee=h[te];if(r.hasRenderableParent(ee))continue;const J=r.getTile(ee),H=J.getBucket(s);if(!H||H.projection.name!==A.projection.name)continue;const K=H.programConfigurations.get(s.id),se=l.useProgram("heatmap",K,k),{zoom:ie}=l.transform;l.terrain&&l.terrain.setupElevationDraw(J,se),l.prepareDrawProgram(m,se,ee.toUnwrapped());const xe=A.projection.createInversionMatrix(A,ee.canonical);se.draw(m,_.TRIANGLES,o.DepthMode.disabled,x,w,j,Re(l,ee,J,xe,Z,ie,s.paint.get("heatmap-intensity")),s.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,s.paint,l.transform.zoom,K,P?[H.globeExtVertexBuffer]:null)}m.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(m,_){const x=m.context,w=x.gl,A=_.heatmapFbo;if(!A)return;x.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,A.colorAttachment.get()),x.activeTexture.set(w.TEXTURE1);let P=_.colorRampTexture;P||(P=_.colorRampTexture=new o.Texture(x,_.colorRamp,w.RGBA)),P.bind(w.LINEAR,w.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(x,w.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,m.colorModeForRenderPass(),o.CullFaceMode.disabled,((k,j,Z,te)=>({u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}))(0,_),_.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,_.paint,m.transform.zoom)}(l,s))},line:function(l,r,s,h){if(l.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),_=s.paint.get("line-width");if(m.constantOr(1)===0||_.constantOr(1)===0)return;const x=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),w=l.colorModeForRenderPass(),A=l.terrain&&l.terrain.renderingToTexture?1:o.exported.devicePixelRatio,P=s.paint.get("line-dasharray"),k=P.constantOr(1),j=s.layout.get("line-cap"),Z=s.paint.get("line-pattern"),te=Z.constantOr(1),ee=s.paint.get("line-gradient"),J=s.getCrossfadeParameters(),H=te?"linePattern":"line",K=l.context,se=K.gl,ie=(ye=>{const he=[];qt(ye)&&he.push("RENDER_LINE_DASH"),ye.paint.get("line-gradient")&&he.push("RENDER_LINE_GRADIENT");const ve=ye.paint.get("line-trim-offset");ve[0]===0&&ve[1]===0||he.push("RENDER_LINE_TRIM_OFFSET");const fe=ye.paint.get("line-pattern").constantOr(1),Ee=ye.paint.get("line-opacity").constantOr(1)!==1;return!fe&&Ee&&he.push("RENDER_LINE_ALPHA_DISCARD"),he})(s);let xe=ie.includes("RENDER_LINE_ALPHA_DISCARD");l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(xe=!1);for(const ye of h){const he=r.getTile(ye);if(te&&!he.patternsLoaded())continue;const ve=he.getBucket(s);if(!ve)continue;l.prepareDrawTile();const fe=ve.programConfigurations.get(s.id),Ee=l.useProgram(H,fe,ie),Le=Z.constantOr(null);if(Le&&he.imageAtlas){const Qe=he.imageAtlas,Tt=Qe.patternPositions[Le.to.toString()],wt=Qe.patternPositions[Le.from.toString()];Tt&&wt&&fe.setConstantPatternPositions(Tt,wt)}const ht=P.constantOr(null),Pe=j.constantOr(null);if(!te&&ht&&Pe&&he.lineAtlas){const Qe=he.lineAtlas,Tt=Qe.getDash(ht.to,Pe),wt=Qe.getDash(ht.from,Pe);Tt&&wt&&fe.setConstantPatternPositions(Tt,wt)}let[He,rt]=s.paint.get("line-trim-offset");(Pe==="round"||Pe==="square")&&He!==rt&&(He===0&&(He-=1),rt===1&&(rt+=1));const gt=l.terrain?ye.projMatrix:null,Ve=te?yt(l,he,s,J,gt,A):Je(l,he,s,J,gt,ve.lineClipsArray.length,A,[He,rt]);if(ee){const Qe=ve.gradients[s.id];let Tt=Qe.texture;if(s.gradientVersion!==Qe.version){let wt=256;if(s.stepInterpolant){const Ot=r.getSource().maxzoom,Nt=ye.canonical.z===Ot?Math.ceil(1<<l.transform.maxZoom-ye.canonical.z):1;wt=o.clamp(o.nextPowerOfTwo(ve.maxLineLength/o.EXTENT*1024*Nt),256,K.maxTextureSize)}Qe.gradient=o.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:wt,image:Qe.gradient||void 0,clips:ve.lineClipsArray}),Qe.texture?Qe.texture.update(Qe.gradient):Qe.texture=new o.Texture(K,Qe.gradient,se.RGBA),Qe.version=s.gradientVersion,Tt=Qe.texture}K.activeTexture.set(se.TEXTURE1),Tt.bind(s.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}k&&(K.activeTexture.set(se.TEXTURE0),he.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),fe.updatePaintBuffers(J)),te&&(K.activeTexture.set(se.TEXTURE0),he.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),fe.updatePaintBuffers(J)),l.prepareDrawProgram(K,Ee,ye.toUnwrapped());const dt=Qe=>{Ee.draw(K,se.TRIANGLES,x,Qe,w,o.CullFaceMode.disabled,Ve,s.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,s.paint,l.transform.zoom,fe,[ve.layoutVertexBuffer2])};if(xe){const Qe=l.stencilModeForClipping(ye).ref;Qe===0&&l.terrain&&K.clear({stencil:0});const Tt={func:se.EQUAL,mask:255};Ve.u_alpha_discard_threshold=.8,dt(new o.StencilMode(Tt,Qe,255,se.KEEP,se.KEEP,se.INVERT)),Ve.u_alpha_discard_threshold=0,dt(new o.StencilMode(Tt,Qe,255,se.KEEP,se.KEEP,se.KEEP))}else dt(l.stencilModeForClipping(ye))}xe&&(l.resetStencilClippingMasks(),l.terrain&&K.clear({stencil:0}))},fill:function(l,r,s,h){const m=s.paint.get("fill-color"),_=s.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const x=l.colorModeForRenderPass(),w=s.paint.get("fill-pattern"),A=l.opaquePassEnabledForLayer()&&!w.constantOr(1)&&m.constantOr(o.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===A){const P=l.depthModeForSublayer(1,l.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);It(l,r,s,h,P,x,!1)}if(l.renderPass==="translucent"&&s.paint.get("fill-antialias")){const P=l.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);It(l,r,s,h,P,x,!0)}},"fill-extrusion":function(l,r,s,h){const m=s.paint.get("fill-extrusion-opacity");if(m!==0&&l.renderPass==="translucent"){const _=new o.DepthMode(l.context.gl.LEQUAL,o.DepthMode.ReadWrite,l.depthRangeFor3D);if(m!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))Gt(l,r,s,h,_,o.StencilMode.disabled,o.ColorMode.disabled),Gt(l,r,s,h,_,l.stencilModeFor3D(),l.colorModeForRenderPass()),l.resetStencilClippingMasks();else{const x=l.colorModeForRenderPass();Gt(l,r,s,h,_,o.StencilMode.disabled,x)}}},hillshade:function(l,r,s,h){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent")return;const m=l.context,_=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),x=l.colorModeForRenderPass(),w=l.terrain&&l.terrain.renderingToTexture,[A,P]=l.renderPass!=="translucent"||w?[{},h]:l.stencilConfigForOverlap(h);for(const k of P){const j=r.getTile(k);if(j.needsHillshadePrepare&&l.renderPass==="offscreen")Ss(l,j,s,_,o.StencilMode.disabled,x);else if(l.renderPass==="translucent"){const Z=w&&l.terrain?l.terrain.stencilModeForRTTOverlap(k):A[k.overscaledZ];rr(l,k,j,s,_,Z,x)}}m.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,r,s,h,m,_){if(l.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!h.length)return;const x=l.context,w=x.gl,A=r.getSource(),P=l.useProgram("raster"),k=l.colorModeForRenderPass(),j=l.terrain&&l.terrain.renderingToTexture,[Z,te]=A instanceof Me||j?[{},h]:l.stencilConfigForOverlap(h),ee=te[te.length-1].overscaledZ,J=!l.options.moving;for(const H of te){const K=j?o.DepthMode.disabled:l.depthModeForSublayer(H.overscaledZ-ee,s.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,w.LESS),se=H.toUnwrapped(),ie=r.getTile(H);if(j&&(!ie||!ie.hasData()))continue;const xe=j?H.projMatrix:l.transform.calculateProjMatrix(se,J),ye=l.terrain&&j?l.terrain.stencilModeForRTTOverlap(H):Z[H.overscaledZ],he=_?0:s.paint.get("raster-fade-duration");ie.registerFadeDuration(he);const ve=r.findLoadedParent(H,0),fe=Zl(ie,ve,r,l.transform,he);let Ee,Le;l.terrain&&l.terrain.prepareDrawTile();const ht=s.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;x.activeTexture.set(w.TEXTURE0),ie.texture.bind(ht,w.CLAMP_TO_EDGE),x.activeTexture.set(w.TEXTURE1),ve?(ve.texture.bind(ht,w.CLAMP_TO_EDGE),Ee=Math.pow(2,ve.tileID.overscaledZ-ie.tileID.overscaledZ),Le=[ie.tileID.canonical.x*Ee%1,ie.tileID.canonical.y*Ee%1]):ie.texture.bind(ht,w.CLAMP_TO_EDGE);const Pe=Lt(xe,Le||[0,0],Ee||1,fe,s,A instanceof Me?A.perspectiveTransform:[0,0]);if(l.prepareDrawProgram(x,P,se),A instanceof Me)A.boundsBuffer&&A.boundsSegments&&P.draw(x,w.TRIANGLES,K,o.StencilMode.disabled,k,o.CullFaceMode.disabled,Pe,s.id,A.boundsBuffer,l.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:He,tileBoundsIndexBuffer:rt,tileBoundsSegments:gt}=l.getTileBoundsBuffers(ie);P.draw(x,w.TRIANGLES,K,ye,k,o.CullFaceMode.disabled,Pe,s.id,He,rt,gt)}}l.resetStencilClippingMasks()},background:function(l,r,s,h){const m=s.paint.get("background-color"),_=s.paint.get("background-opacity");if(_===0)return;const x=l.context,w=x.gl,A=l.transform,P=A.tileSize,k=s.paint.get("background-pattern");if(l.isPatternMissing(k))return;const j=!k&&m.a===1&&_===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==j)return;const Z=o.StencilMode.disabled,te=l.depthModeForSublayer(0,j==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),ee=l.colorModeForRenderPass(),J=l.useProgram(k?"backgroundPattern":"background");let H,K=h;K||(H=l.getBackgroundTiles(),K=Object.values(H).map(ie=>ie.tileID)),k&&(x.activeTexture.set(w.TEXTURE0),l.imageManager.bind(l.context));const se=s.getCrossfadeParameters();for(const ie of K){const xe=ie.toUnwrapped(),ye=h?ie.projMatrix:l.transform.calculateProjMatrix(xe);l.prepareDrawTile();const he=r?r.getTile(ie):H?H[ie.key]:new o.Tile(ie,P,A.zoom,l),ve=k?hr(ye,_,l,k,{tileID:ie,tileSize:P},se):Ti(ye,_,m);l.prepareDrawProgram(x,J,xe);const{tileBoundsBuffer:fe,tileBoundsIndexBuffer:Ee,tileBoundsSegments:Le}=l.getTileBoundsBuffers(he);J.draw(x,w.TRIANGLES,te,Z,ee,o.CullFaceMode.disabled,ve,s.id,fe,Ee,Le)}},sky:function(l,r,s){const h=l.transform,m=h.projection.name==="mercator"||h.projection.name==="globe"?1:o.smoothstep(7,8,h.zoom),_=s.paint.get("sky-opacity")*m;if(_===0)return;const x=l.context,w=s.paint.get("sky-type"),A=new o.DepthMode(x.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),P=l.frameCounter/1e3%1;w==="atmosphere"?l.renderPass==="offscreen"?s.needsSkyboxCapture(l)&&(function(k,j,Z,te){const ee=k.context,J=ee.gl;let H=j.skyboxFbo;if(!H){H=j.skyboxFbo=ee.createFramebuffer(32,32,!1),j.skyboxGeometry=new Ps(ee),j.skyboxTexture=ee.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,j.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let xe=0;xe<6;++xe)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}ee.bindFramebuffer.set(H.framebuffer),ee.viewport.set([0,0,32,32]);const K=j.getCenter(k,!0),se=k.useProgram("skyboxCapture"),ie=new Float64Array(16);o.identity(ie),o.rotateY(ie,ie,.5*-Math.PI),co(ee,j,se,ie,K,0),o.identity(ie),o.rotateY(ie,ie,.5*Math.PI),co(ee,j,se,ie,K,1),o.identity(ie),o.rotateX(ie,ie,.5*-Math.PI),co(ee,j,se,ie,K,2),o.identity(ie),o.rotateX(ie,ie,.5*Math.PI),co(ee,j,se,ie,K,3),o.identity(ie),co(ee,j,se,ie,K,4),o.identity(ie),o.rotateY(ie,ie,Math.PI),co(ee,j,se,ie,K,5),ee.viewport.set([0,0,k.width,k.height])}(l,s),s.markSkyboxValid(l)):l.renderPass==="sky"&&function(k,j,Z,te,ee){const J=k.context,H=J.gl,K=k.transform,se=k.useProgram("skybox");J.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,j.skyboxTexture);const ie=((xe,ye,he,ve,fe)=>({u_matrix:xe,u_sun_direction:ye,u_cubemap:0,u_opacity:ve,u_temporal_offset:fe}))(K.skyboxMatrix,j.getCenter(k,!1),0,te,ee);k.prepareDrawProgram(J,se),se.draw(J,H.TRIANGLES,Z,o.StencilMode.disabled,k.colorModeForRenderPass(),o.CullFaceMode.backCW,ie,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(l,s,A,_,P):w==="gradient"&&l.renderPass==="sky"&&function(k,j,Z,te,ee){const J=k.context,H=J.gl,K=k.transform,se=k.useProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new Ps(J)),J.activeTexture.set(H.TEXTURE0);let ie=j.colorRampTexture;ie||(ie=j.colorRampTexture=new o.Texture(J,j.colorRamp,H.RGBA)),ie.bind(H.LINEAR,H.CLAMP_TO_EDGE);const xe=((ye,he,ve,fe,Ee)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:he,u_radius:o.degToRad(ve),u_opacity:fe,u_temporal_offset:Ee}))(K.skyboxMatrix,j.getCenter(k,!1),j.paint.get("sky-gradient-radius"),te,ee);k.prepareDrawProgram(J,se),se.draw(J,H.TRIANGLES,Z,o.StencilMode.disabled,k.colorModeForRenderPass(),o.CullFaceMode.backCW,xe,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(l,s,A,_,P)},debug:function(l,r,s){for(let h=0;h<s.length;h++)_i(l,r,s[h])},custom:function(l,r,s){const h=l.context,m=s.implementation;if(l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(l.renderPass==="offscreen"){const _=m.prerender;_&&(l.setCustomLayerDefaults(),h.setColorMode(l.colorModeForRenderPass()),_.call(m,h.gl,l.transform.customLayerMatrix()),h.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),h.setColorMode(l.colorModeForRenderPass()),h.setStencilMode(o.StencilMode.disabled);const _=m.renderingMode==="3d"?new o.DepthMode(l.context.gl.LEQUAL,o.DepthMode.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,o.DepthMode.ReadOnly);h.setDepthMode(_),m.render(h.gl,l.transform.customLayerMatrix()),h.setDirty(),l.setBaseState(),h.bindFramebuffer.set(null)}}};class zs{constructor(r,s){this.context=new ne(r),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new es,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,s){const h=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Wl(this,r));const m=this._terrain;this.transform.elevation=h?m:null,m.update(r,this.transform,s)}_updateFog(r){const s=r.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,m]=s.getFovAdjustedRange(this.transform._fov);if(h>m)return void(this.transform.fogCullDistSq=null);const _=h+.78*(m-h);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,s){if(this.width=r*o.exported.devicePixelRatio,this.height=s*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._layers[h].resize()}setup(){const r=this.context,s=new o.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(s,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const h=new o.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(o.EXTENT,0),h.emplaceBack(0,o.EXTENT),h.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=r.createVertexBuffer(h,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const m=new o.StructArrayLayout2i4;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(m,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const _=new o.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(o.EXTENT,0,o.EXTENT,0),_.emplaceBack(0,o.EXTENT,0,o.EXTENT),_.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(_,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const x=new o.StructArrayLayout3ui6;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(x);const w=new o.StructArrayLayout1ui2;for(const P of[0,1,3,2,0])w.emplaceBack(P);this.debugIndexBuffer=r.createIndexBuffer(w),this.emptyTexture=new o.Texture(r,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=o.create();const A=this.context.gl;this.stencilClearMode=new o.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new ka(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,s=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,s.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Ms(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,s,h){if(!s||this.currentStencilSource===s.id||!r.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let w=!1;for(const A of h)if(this._tileClippingMaskIDs[A.key]===void 0){w=!0;break}if(!w)return}this.currentStencilSource=s.id;const m=this.context,_=m.gl;this.nextStencilID+h.length>256&&this.clearStencil(),m.setColorMode(o.ColorMode.disabled),m.setDepthMode(o.DepthMode.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of h){const A=s.getTile(w),P=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:j,tileBoundsSegments:Z}=this.getTileBoundsBuffers(A);x.draw(m,_.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:_.ALWAYS,mask:0},P,255,_.KEEP,_.KEEP,_.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Ms(w.projMatrix),"$clipping",k,j,Z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,s=this.context.gl;return new o.StencilMode({func:s.NOTEQUAL,mask:255},r,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const s=this.context.gl;return new o.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(r){const s=this.context.gl,h=r.sort((x,w)=>w.overscaledZ-x.overscaledZ),m=h[h.length-1].overscaledZ,_=h[0].overscaledZ-m+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const x={};for(let w=0;w<_;w++)x[w+m]=new o.StencilMode({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=_,[x,h]}return[{[m]:o.StencilMode.disabled},h]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([r.CONSTANT_COLOR,r.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(r,s,h){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new o.DepthMode(h||this.context.gl.LEQUAL,s,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,s){this.style=r,this.options=s,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const h=this.style.order,m=this.style._sourceCaches;for(const A in m){const P=m[A];P.used&&P.prepare(this.context)}const _={},x={},w={};for(const A in m){const P=m[A];_[A]=P.getVisibleCoordinates(),x[A]=_[A].slice().reverse(),w[A]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<h.length;A++)if(this.style._layers[h[A]].is3D()){this.opaquePassCutoff=A;break}if(this.terrain&&(this.terrain.updateTileBinding(w),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),o.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const A of h){const P=this.style._layers[A],k=r._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const j=k?x[k.id]:void 0;(P.type==="custom"||P.isSky()||j&&j.length)&&this.renderLayer(this,k,P,j)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:s.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[h[this.currentLayer]],P=r._getLayerSourceCache(A);if(A.isSky())continue;const k=P?x[P.id]:void 0;this._renderTileClippingMasks(A,P,k),this.renderLayer(this,P,A,k)}if(this.style.fog&&this.transform.projection.supportsFog&&function(A,P){const k=A.context,j=k.gl,Z=A.transform,te=new o.DepthMode(j.LEQUAL,o.DepthMode.ReadOnly,[0,1]),ee=A.useProgram("globeAtmosphere",null,Z.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),J=o.globeToMercatorTransition(Z.zoom),H=P.properties.get("color").toArray01(),K=P.properties.get("high-color").toArray01(),se=P.properties.get("space-color").toArray01PremultipliedAlpha(),ie=o.identity$1([]);o.rotateY$1(ie,ie,-o.degToRad(Z._center.lng)),o.rotateX$1(ie,ie,o.degToRad(Z._center.lat)),o.rotateZ$1(ie,ie,Z.angle),o.rotateX$1(ie,ie,-Z._pitch);const xe=o.fromQuat(new Float32Array(16),ie),ye=o.mapValue(P.properties.get("star-intensity"),0,1,0,.25),he=5e-4,ve=o.mapValue(P.properties.get("horizon-blend"),0,1,he,.25),fe=o.globeUseCustomAntiAliasing(A,k,Z)&&ve===he?Z.worldSize/(2*Math.PI*1.025)-1:Z.globeRadius,Ee=A.frameCounter/1e3%1,Le=o.length(Z.globeCenterInViewSpace),ht=Math.sqrt(Math.pow(Le,2)-Math.pow(fe,2)),Pe=Math.acos(ht/Le),He=((gt,Ve,dt,Qe,Tt,wt,Ot,Nt,Ht,Ei,Rt,ii,Li,Qi)=>({u_frustum_tl:gt,u_frustum_tr:Ve,u_frustum_br:dt,u_frustum_bl:Qe,u_horizon:Tt,u_transition:wt,u_fadeout_range:Ot,u_color:Nt,u_high_color:Ht,u_space_color:Ei,u_star_intensity:Rt,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ii,u_horizon_angle:Li,u_rotation_matrix:Qi}))(Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.frustumCorners.horizon,J,ve,H,K,se,ye,Ee,Pe,xe);A.prepareDrawProgram(k,ee);const rt=A.atmosphereBuffer;rt&&ee.draw(k,j.TRIANGLES,te,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,He,"skybox",rt.vertexBuffer,rt.indexBuffer,rt.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const A=this.style._layers[h[this.currentLayer]],P=r._getLayerSourceCache(A);A.isSky()&&this.renderLayer(this,P,A,P?x[P.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;){const A=this.style._layers[h[this.currentLayer]],P=r._getLayerSourceCache(A);if(A.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(A)){if(A.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const k=P?(A.type==="symbol"?w:x)[P.id]:void 0;this._renderTileClippingMasks(A,P,P?_[P.id]:void 0),this.renderLayer(this,P,A,k),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let A=null;o.values(this.style._layers).forEach(P=>{const k=r._getLayerSourceCache(P);k&&!P.isHidden(this.transform.zoom)&&(!A||A.getSource().maxzoom<k.getSource().maxzoom)&&(A=k)}),A&&this.options.showTileBoundaries&&Da.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const P=A.transform.padding;Cs(A,A.transform.height-(P.top||0),3,fr),Cs(A,P.bottom||0,3,Di),os(A,P.left||0,3,Lr),os(A,A.transform.width-(P.right||0),3,ao);const k=A.transform.centerPoint;(function(j,Z,te,ee){lo(j,Z-1,te-10,2,20,ee),lo(j,Z-10,te-1,20,2,ee)})(A,k.x,A.transform.height-k.y,un)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,s,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||m&&m.length)&&(this.id=h.id,this.gpuTimingStart(h),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(h.type)||Da[h.type](r,s,h,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let h=this.gpuTimers[r.id];h||(h=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),h.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,h.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,s=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(s),r.beginQueryEXT(r.TIME_ELAPSED_EXT,s)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const s={};for(const h in r){const m=r[h],_=this.context.extTimerQuery,x=_.getQueryObjectEXT(m.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(m.query),s[h]=x}return s}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.extTimerQuery;let h=0;for(const m of r)h+=s.getQueryObjectEXT(m,s.QUERY_RESULT_EXT)/1e6,s.deleteQueryEXT(m);return h}translatePosMatrix(r,s,h,m,_){if(!h[0]&&!h[1])return r;const x=_?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(x){const P=Math.sin(x),k=Math.cos(x);h=[h[0]*k-h[1]*P,h[0]*P+h[1]*k]}const w=[_?h[0]:Ao(s,h[0],this.transform.zoom),_?h[1]:Ao(s,h[1],this.transform.zoom),0],A=new Float32Array(16);return o.translate(A,r,w),A}saveTileTexture(r){const s=this._tileTextures[r.size[0]];s?s.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const s=this._tileTextures[r];return s&&s.length>0?s.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const s=this.imageManager.getPattern(r.from.toString()),h=this.imageManager.getPattern(r.to.toString());return!s||!h}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,s=this.style&&this.style.fog,h=[];return this.terrain&&!this.terrain.renderingToTexture&&h.push("TERRAIN"),s&&!r&&s.getOpacity(this.transform.pitch)!==0&&h.push("FOG"),r&&h.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&h.push("OVERDRAW_INSPECTOR"),h}useProgram(r,s,h){this.cache=this.cache||{};const m=h||[],_=this.currentGlobalDefines().concat(m),x=Xl.cacheKey(Gl[r],r,_,s);return this.cache[x]||(this.cache[x]=new Xl(this.context,r,Gl[r],s,yr[r],_)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,s,h){if(this.terrain&&this.terrain.renderingToTexture)return;const m=this.style.fog;if(m){const _=m.getOpacity(this.transform.pitch),x=((w,A,P,k,j,Z,te,ee,J,H,K)=>{const se=w.transform,ie=A.properties.get("color").toArray01();ie[3]=k;const xe=w.frameCounter/1e3%1;return{u_fog_matrix:P?se.calculateFogTileMatrix(P):w.identityMat,u_fog_range:A.getFovAdjustedRange(se._fov),u_fog_color:ie,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:xe,u_frustum_tl:j,u_frustum_tr:Z,u_frustum_br:te,u_frustum_bl:ee,u_globe_pos:J,u_globe_radius:H,u_viewport:K,u_globe_transition:o.globeToMercatorTransition(se.zoom),u_is_globe:+(se.projection.name==="globe")}})(this,m,h,_,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);s.setFogUniformValues(r,x)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,s=r.createTexture();return r.bindTexture(r.TEXTURE_2D,s),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const m of h)s[m.key]=r[m.key]||new o.Tile(m,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}}class uo{constructor(r=0,s=0,h=0,m=0){if(isNaN(r)||r<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=s,this.left=h,this.right=m}interpolate(r,s,h){return s.top!=null&&r.top!=null&&(this.top=o.number(r.top,s.top,h)),s.bottom!=null&&r.bottom!=null&&(this.bottom=o.number(r.bottom,s.bottom,h)),s.left!=null&&r.left!=null&&(this.left=o.number(r.left,s.left,h)),s.right!=null&&r.right!=null&&(this.right=o.number(r.right,s.right,h)),this}getCenter(r,s){const h=o.clamp((this.left+r-this.right)/2,0,r),m=o.clamp((this.top+s-this.bottom)/2,0,s);return new o.pointGeometry(h,m)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new uo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function sa(l,r){const s=o.getColumn(l,3);o.fromQuat(l,r),o.setColumn(l,3,s)}function aa(l,r){const s=o.identity$1([]);return o.rotateZ$1(s,s,-r),o.rotateX$1(s,s,-l),s}function as(l,r){const s=[l[0],l[1],0],h=[r[0],r[1],0];if(o.length(s)>=1e-15){const x=o.normalize([],s);o.scale$2(h,x,o.dot(h,x)),r[0]=h[0],r[1]=h[1]}const m=o.cross([],r,l);if(o.len(m)<1e-15)return null;const _=Math.atan2(-m[1],m[0]);return aa(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),_)}class St{constructor(r,s){this.position=r,this.orientation=s}get position(){return this._position}set position(r){if(r){const s=r instanceof o.MercatorCoordinate?r:new o.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(s.x=o.wrap(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(r,s){if(this.orientation=null,!this.position)return;const h=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(r)):0,m=this.position,_=o.MercatorCoordinate.fromLngLat(r,h),x=[_.x-m.x,_.y-m.y,_.z-m.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=as(x,s)}setPitchBearing(r,s){this.orientation=aa(o.degToRad(r),o.degToRad(-s))}}class Cn{constructor(r,s){this._transform=o.identity([]),this.orientation=s,this.position=r}get mercatorPosition(){const r=this.position;return new o.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=o.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var s;r&&o.setColumn(this._transform,3,[(s=r)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.identity$1([]),r&&sa(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,s){this._orientation=aa(r,s),sa(this._transform,this._orientation)}forward(){const r=o.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,s){const h=new Float64Array(16);return o.invert(h,this.getWorldToCamera(r,s)),h}getWorldToCameraPosition(r,s,h){const m=this.position;o.scale$2(m,m,-r);const _=new Float64Array(16);return o.fromScaling(_,[h,h,h]),o.translate(_,_,m),_[10]*=s,_}getWorldToCamera(r,s){const h=new Float64Array(16),m=new Float64Array(4),_=this.position;return o.conjugate(m,this._orientation),o.scale$2(_,_,-r),o.fromQuat(h,m),o.translate(h,h,_),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(r,s,h,m){const _=new Float64Array(16);return o.perspective(_,r,s,h,m),_}getDistanceToElevation(r){const s=r===0?0:o.mercatorZfromAltitude(r,this.position[1]),h=this.forward();return(s-this.position[2])/h[2]}clone(){return new Cn([...this.position],[...this.orientation])}}function La(l,r){const s=Pn(l.projection,l.zoom,l.width,l.height),h=function(_,x,w,A,P){const k=new o.LngLat(w.lng-180*Or,w.lat),j=new o.LngLat(w.lng+180*Or,w.lat),Z=_.project(k.lng,k.lat),te=_.project(j.lng,j.lat),ee=-Math.atan2(te.y-Z.y,te.x-Z.x),J=o.MercatorCoordinate.fromLngLat(w);J.y=o.clamp(J.y,-.999975,.999975);const H=J.toLngLat(),K=_.project(H.lng,H.lat),se=o.MercatorCoordinate.fromLngLat(H);se.x+=Or;const ie=se.toLngLat(),xe=_.project(ie.lng,ie.lat),ye=Oa(xe.x-K.x,xe.y-K.y,ee),he=o.MercatorCoordinate.fromLngLat(H);he.y+=Or;const ve=he.toLngLat(),fe=_.project(ve.lng,ve.lat),Ee=Oa(fe.x-K.x,fe.y-K.y,ee),Le=Math.abs(ye.x)/Math.abs(Ee.y),ht=o.identity([]);o.rotateZ(ht,ht,-ee*(1-(P?0:A)));const Pe=o.identity([]);return o.scale(Pe,Pe,[1,1-(1-Le)*A,1]),Pe[4]=-Ee.x/Ee.y*A,o.rotateZ(Pe,Pe,ee),o.multiply(Pe,ht,Pe),Pe}(l.projection,0,l.center,s,r),m=Hl(l);return o.scale(h,h,[m,m,1]),h}function Hl(l){const r=l.projection,s=Pn(l.projection,l.zoom,l.width,l.height),h=la(r,l.center),m=la(r,o.LngLat.convert(r.center));return Math.pow(2,h*s+(1-s)*m)}function Pn(l,r,s,h,m=1/0){const _=l.range;if(!_)return 0;const x=Math.min(m,Math.max(s,h)),w=Math.log(x/1024)/Math.LN2;return o.smoothstep(_[0]+w,_[1]+w,r)}const Or=1/4e4;function la(l,r){const s=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),h=new o.LngLat(r.lng-180*Or,s),m=new o.LngLat(r.lng+180*Or,s),_=l.project(h.lng,s),x=l.project(m.lng,s),w=o.MercatorCoordinate.fromLngLat(h),A=o.MercatorCoordinate.fromLngLat(m),P=x.x-_.x,k=x.y-_.y,j=A.x-w.x,Z=A.y-w.y,te=Math.sqrt((j*j+Z*Z)/(P*P+k*k));return Math.log(te)/Math.LN2}function Oa(l,r,s){const h=Math.cos(s),m=Math.sin(s);return{x:l*h-r*m,y:l*m+r*h}}class ca{constructor(r,s,h,m,_,x,w){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=r||0,this._maxZoom=s||22,this._minPitch=h==null?0:h,this._maxPitch=m==null?60:m,this.setProjection(x),this.setMaxBounds(w),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new uo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Cn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new ca(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r){const s=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||s)&&this._updateCameraOnTerrain(),(r||s)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const h=!Q(s,this.getProjection());return h&&this._calcMatrices(),this.mercatorFromTransition=!1,h}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const s=r!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const s=-r*Math.PI/180;var h;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(h=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),function(m,_,x){var w=_[0],A=_[1],P=_[2],k=_[3],j=Math.sin(x),Z=Math.cos(x);m[0]=w*Z+P*j,m[1]=A*Z+k*j,m[2]=w*-j+P*Z,m[3]=A*-j+k*Z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const s=o.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const s=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let m=0,_=0;for(let x=0;x<s.length;x++){const w=new o.pointGeometry(s[x][0]*this.width,h+s[x][1]*(this.height-h)),A=r.pointCoordinate(w);if(!A)continue;const P=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);m+=A[3]*P,_+=P}return _===0?NaN:m/_}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(r),_=this._mercatorZfromZoom(this._maxZoom),x=Math.max(m-h,_);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let h;h=r.z<this._camera.position[2]?[s.x,s.y,s.z]:[r.x,r.y,r.z];const m=o.length(o.sub([],this._camera.position,h));return o.clamp(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let s=!1;if(r.orientation&&!o.exactEquals(r.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(r.orientation)),r.position){const h=[r.position.x,r.position.y,r.position.z];o.exactEquals$1(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,s=new St;return s.position=new o.MercatorCoordinate(r[0],r[1],r[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(r){if(!o.length$1(r))return!1;o.normalize$1(r,r);const s=o.transformQuat([],[0,0,-1],r),h=o.transformQuat([],[0,-1,0],r);if(h[2]<0)return!1;const m=as(s,h);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(r){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;r[2]=o.clamp(r[2],m/h,m/s),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,s,h){this._unmodified=!1,this._edgeInsets.interpolate(r,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const s=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(r){const s=[new o.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const h=this.pointCoordinate(new o.pointGeometry(0,0)),m=this.pointCoordinate(new o.pointGeometry(this.width,0)),_=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),x=this.pointCoordinate(new o.pointGeometry(0,this.height)),w=Math.floor(Math.min(h.x,m.x,_.x,x.x)),A=Math.floor(Math.max(h.x,m.x,_.x,x.x)),P=1;for(let k=w-P;k<=A+P;k++)k!==0&&s.push(new o.UnwrappedTileID(k,r))}return s}coveringTiles(r){let s=this.coveringZoomLevel(r);const h=s,m=this.elevation&&!r.isTerrainDEM,_=this.projection.name==="mercator";if(r.minzoom!==void 0&&s<r.minzoom)return[];r.maxzoom!==void 0&&s>r.maxzoom&&(s=r.maxzoom);const x=this.locationCoordinate(this.center),w=this.center.lat,A=1<<s,P=[A*x.x,A*x.y,0],k=this.projection.name==="globe",j=!k,Z=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,j),te=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=A*o.mercatorZfromAltitude(1,this.center.lat),J=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),H=[A*te.x,A*te.y,J*(j?1:ee)],K=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),se=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?s:0,ie=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,xe=r.isTerrainDEM?-ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,ye=this.projection.isReprojectedInTileSpace?Hl(this):1,he=Ve=>{const Qe=new o.MercatorCoordinate(Ve.x+25e-6,Ve.y,Ve.z),Tt=new o.MercatorCoordinate(Ve.x,Ve.y+25e-6,Ve.z),wt=Ve.toLngLat(),Ot=Qe.toLngLat(),Nt=Tt.toLngLat(),Ht=this.locationCoordinate(wt),Ei=this.locationCoordinate(Ot),Rt=this.locationCoordinate(Nt),ii=Math.hypot(Ei.x-Ht.x,Ei.y-Ht.y),Li=Math.hypot(Rt.x-Ht.x,Rt.y-Ht.y);return Math.sqrt(ii*Li)*ye/25e-6},ve=Ve=>{const dt=ie,Qe=xe;return{aabb:o.tileAABB(this,A,0,0,0,Ve,Qe,dt,this.projection),zoom:0,x:0,y:0,minZ:Qe,maxZ:dt,wrap:Ve,fullyVisible:!1}},fe=[];let Ee=[];const Le=s,ht=r.reparseOverscaled?h:s,Pe=Ve=>Ve*Ve,He=Pe((J-this._centerAltitude)*ee),rt=Ve=>{if(!this._elevation||!Ve.tileID||!_)return;const dt=this._elevation.getMinMaxForTile(Ve.tileID),Qe=Ve.aabb;dt?(Qe.min[2]=dt.min,Qe.max[2]=dt.max,Qe.center[2]=(Qe.min[2]+Qe.max[2])/2):(Ve.shouldSplit=gt(Ve),Ve.shouldSplit||(Qe.min[2]=Qe.max[2]=Qe.center[2]=this._centerAltitude))},gt=Ve=>{if(Ve.zoom<se)return!0;if(Ve.zoom===Le)return!1;if(Ve.shouldSplit!=null)return Ve.shouldSplit;const dt=Ve.aabb.distanceX(H),Qe=Ve.aabb.distanceY(H);let Tt=He,wt=1;if(k){Tt=Pe(Ve.aabb.distanceZ(H));const Nt=Math.pow(2,Ve.zoom),Ht=o.latFromMercatorY((Ve.y+1)/Nt),Ei=o.latFromMercatorY(Ve.y/Nt),Rt=Math.min(Math.max(w,Ht),Ei),ii=o.circumferenceAtLatitude(Rt)/o.circumferenceAtLatitude(w);if(wt=Rt===w?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ii/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Ve.zoom===Le-1&&ii>=.9)return!0}else if(m&&(Tt=Pe(Ve.aabb.distanceZ(H)*ee)),this.projection.isReprojectedInTileSpace&&h<=5){const Nt=Math.pow(2,Ve.zoom),Ht=he(new o.MercatorCoordinate((Ve.x+.5)/Nt,(Ve.y+.5)/Nt));wt=Ht>.85?1:Ht}const Ot=dt*dt+Qe*Qe+Tt;return Ot<Pe((1<<Le-Ve.zoom)*K*wt*((Nt,Ht)=>{if(Ht*Pe(.707)<Nt)return 1;const Ei=Math.sqrt(Ht/Nt);return Ei/(1.4144271570014144+(Math.pow(1.1,Ei-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Tt,He),Ot))};if(this.renderWorldCopies)for(let Ve=1;Ve<=3;Ve++)fe.push(ve(-Ve)),fe.push(ve(Ve));for(fe.push(ve(0));fe.length>0;){const Ve=fe.pop(),dt=Ve.x,Qe=Ve.y;let Tt=Ve.fullyVisible;if(!Tt){const wt=Ve.aabb.intersects(Z);if(wt===0)continue;Tt=wt===2}if(Ve.zoom!==Le&&gt(Ve))for(let wt=0;wt<4;wt++){const Ot=(dt<<1)+wt%2,Nt=(Qe<<1)+(wt>>1),Ht={aabb:_?Ve.aabb.quadrant(wt):o.tileAABB(this,A,Ve.zoom+1,Ot,Nt,Ve.wrap,Ve.minZ,Ve.maxZ,this.projection),zoom:Ve.zoom+1,x:Ot,y:Nt,wrap:Ve.wrap,fullyVisible:Tt,tileID:void 0,shouldSplit:void 0,minZ:Ve.minZ,maxZ:Ve.maxZ};m&&!k&&(Ht.tileID=new o.OverscaledTileID(Ve.zoom+1===Le?ht:Ve.zoom+1,Ve.wrap,Ve.zoom+1,Ot,Nt),rt(Ht)),fe.push(Ht)}else{const wt=Ve.zoom===Le?ht:Ve.zoom;if(r.minzoom&&r.minzoom>wt)continue;const Ot=P[0]-(.5+dt+(Ve.wrap<<Ve.zoom))*(1<<s-Ve.zoom),Nt=P[1]-.5-Qe,Ht=Ve.tileID?Ve.tileID:new o.OverscaledTileID(wt,Ve.wrap,Ve.zoom,dt,Qe);Ee.push({tileID:Ht,distanceSq:Ot*Ot+Nt*Nt})}}if(this.fogCullDistSq){const Ve=this.fogCullDistSq,dt=this.horizonLineFromTop();Ee=Ee.filter(Qe=>{const Tt=[0,0,0,1],wt=[o.EXTENT,o.EXTENT,0,1],Ot=this.calculateFogTileMatrix(Qe.tileID.toUnwrapped());o.transformMat4$1(Tt,Tt,Ot),o.transformMat4$1(wt,wt,Ot);const Nt=o.getAABBPointSquareDist(Tt,wt);if(Nt===0)return!0;let Ht=!1;const Ei=this._elevation;if(Ei&&Nt>Ve&&dt!==0){const Rt=this.calculateProjMatrix(Qe.tileID.toUnwrapped());let ii;r.isTerrainDEM||(ii=Ei.getMinMaxForTile(Qe.tileID)),ii||(ii={min:xe,max:ie});const Li=o.furthestTileCorner(this.rotation),Qi=[Li[0]*o.EXTENT,Li[1]*o.EXTENT,ii.max];o.transformMat4(Qi,Qi,Rt),Ht=(1-Qi[1])*this.height*.5<dt}return Nt<Ve||Ht})}return Ee.sort((Ve,dt)=>Ve.distanceSq-dt.distanceSq).map(Ve=>Ve.tileID)}resize(r,s){this.width=r,this.height=s,this.pixelsToGLUnits=[2/r,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const s=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),h=this.projection.project(r.lng,s);return new o.pointGeometry(h.x*this.worldSize,h.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,s){let h,m;const _=this.centerPoint;if(this.projection.name==="globe"){const w=this.worldSize;h=(s.x-_.x)/w,m=(s.y-_.y)/w}else{const w=this.pointCoordinate(s),A=this.pointCoordinate(_);h=w.x-A.x,m=w.y-A.y}const x=this.locationCoordinate(r);this.setLocation(new o.MercatorCoordinate(x.x-h,x.y-m))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,s){const h=s?o.mercatorZfromAltitude(s,r.lat):void 0,m=this.projection.project(r.lng,r.lat);return new o.MercatorCoordinate(m.x,m.y,h)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,s){const h=s!=null?s:this._centerAltitude,m=[r.x,r.y,0,1],_=[r.x,r.y,1,1];o.transformMat4$1(m,m,this.pixelMatrixInverse),o.transformMat4$1(_,_,this.pixelMatrixInverse);const x=_[3];o.scale$1(m,m,1/m[3]),o.scale$1(_,_,1/x);const w=m[2],A=_[2];return{p0:m,p1:_,t:w===A?0:(h-w)/(A-w)}}screenPointToMercatorRay(r){const s=[r.x,r.y,0,1],h=[r.x,r.y,1,1];return o.transformMat4$1(s,s,this.pixelMatrixInverse),o.transformMat4$1(h,h,this.pixelMatrixInverse),o.scale$1(s,s,1/s[3]),o.scale$1(h,h,1/h[3]),s[2]=o.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,h[2]=o.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,o.scale$1(s,s,1/this.worldSize),o.scale$1(h,h,1/this.worldSize),new o.Ray([s[0],s[1],s[2]],o.normalize([],o.sub([],h,s)))}rayIntersectionCoordinate(r){const{p0:s,p1:h,t:m}=r,_=o.mercatorZfromAltitude(s[2],this._center.lat),x=o.mercatorZfromAltitude(h[2],this._center.lat);return new o.MercatorCoordinate(o.number(s[0],h[0],m)/this.worldSize,o.number(s[1],h[1],m)/this.worldSize,o.number(_,x,m))}pointCoordinate(r,s=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,s)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let s=this.projection.pointCoordinate3D(this,r.x,r.y);if(s)return new o.MercatorCoordinate(s[0],s[1],s[2]);let h=0,m=this.horizonLineFromTop();if(r.y>m)return this.pointCoordinate(r);const _=.02*m,x=r.clone();for(let w=0;w<10&&m-h>_;w++){x.y=o.number(h,m,.66);const A=this.projection.pointCoordinate3D(this,x.x,x.y);A?(m=x.y,s=A):h=x.y}return s?new o.MercatorCoordinate(s[0],s[1],s[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,m=[r.x*this.worldSize,r.y*this.worldSize,h+r.toAltitude(),1];return o.transformMat4$1(m,m,this.pixelMatrix),m[3]>0?new o.pointGeometry(m[0]/m[3],m[1]/m[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,s){const h=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),m=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),_=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),x=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let w=this.pointCoordinate(h,r),A=this.pointCoordinate(m,r);const P=this.pointCoordinate(_,s),k=this.pointCoordinate(x,s),j=(Z,te)=>(te.y-Z.y)/(te.x-Z.x);return w.y>1&&A.y>=0?w=new o.MercatorCoordinate((1-k.y)/j(k,w)+k.x,1):w.y<0&&A.y<=1&&(w=new o.MercatorCoordinate(-k.y/j(k,w)+k.x,0)),A.y>1&&w.y>=0?A=new o.MercatorCoordinate((1-P.y)/j(P,A)+P.x,1):A.y<0&&w.y<=1&&(A=new o.MercatorCoordinate(-P.y/j(P,A)+P.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(w)).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(P))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length)return this._getBounds(0,0);const s=r.visibleDemTiles.reduce((h,m)=>{if(m.dem){const _=m.dem.tree;h.min=Math.min(h.min,_.minimums[0]),h.max=Math.max(h.max,_.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBounds(s.min*r.exaggeration(),s.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return r?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,s){return this.projection.createTileMatrix(this,s,r)}calculateDistanceTileData(r){const s=r.key,h=this._distanceTileDataCache;if(h[s])return h[s];const m=r.canonical,_=1/this.height,x=this.cameraWorldSize/this.zoomScale(m.z),w=(m.x+Math.pow(2,m.z)*r.wrap)*x,A=m.y*x,P=this.point,k=this.angle,j=Math.sin(-k),Z=-Math.cos(-k);return h[s]={bearing:[j,Z],center:[(P.x-w)*_,(P.y-A)*_],scale:x/o.EXTENT*_},h[s]}calculateFogTileMatrix(r){const s=r.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const m=this.projection.createTileMatrix(this,this.cameraWorldSize,r);return o.multiply(m,this.worldToFogMatrix,m),h[s]=new Float32Array(m),h[s]}calculateProjMatrix(r,s=!1){const h=r.key,m=s?this._alignedProjMatrixCache:this._projMatrixCache;if(m[h])return m[h];const _=this.calculatePosMatrix(r,this.worldSize);return o.multiply(_,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:s?this.alignedProjMatrix:this.projMatrix,_),m[h]=new Float32Array(_),m[h]}calculatePixelsToTileUnitsMatrix(r){const s=r.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const m=function(_,x){const{scale:w}=_.tileTransform,A=w*o.EXTENT/(_.tileSize*Math.pow(2,x.zoom-_.tileID.overscaledZ+_.tileID.canonical.z));return P=new Float32Array(4),Z=(k=x.inverseAdjustmentMatrix)[1],te=k[2],ee=k[3],H=(j=[A,A])[1],P[0]=k[0]*(J=j[0]),P[1]=Z*J,P[2]=te*H,P[3]=ee*H,P;var P,k,j,Z,te,ee,J,H}(r,this);return h[s]=m,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=this._camera.forward(),_=o.mercatorZfromAltitude(1,this._center.lat);h[2]/=_,m[2]/=_,o.normalize(m,m);const x=r.raycast(h,m,r.exaggeration());if(x){const w=o.scaleAndAdd([],h,m,x),A=new o.MercatorCoordinate(w[0],w[1],o.mercatorZfromAltitude(w[2],o.latFromMercatorY(w[1]))),P=(A.z+o.length([A.x-h[0],A.y-h[1],A.z-h[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=r.getAtPointOrZero(new o.MercatorCoordinate(...h)),_=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),x=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*m;if(x<_){const w=this.locationCoordinate(this._center,this._centerAltitude),A=[w.x-h[0],w.y-h[1],w.z-h[2]],P=o.length(A);A[2]-=(_-x)/this._pixelsPerMercatorPixel;const k=o.length(A);if(k===0)return;o.scale$2(A,A,P/k*this._pixelsPerMercatorPixel),this._camera.position=[w.x-A[0],w.y-A[1],w.z*this._pixelsPerMercatorPixel-A[2]],this._camera.orientation=as(A,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const Z=this.center;return Z.lat=o.clamp(Z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(Z.lng=o.clamp(Z.lng,this.minLng,this.maxLng)),this.center=Z,void(this._constraining=!1)}const s=this._unmodified,{x:h,y:m}=this.point;let _=0,x=h,w=m;const A=this.width/2,P=this.height/2,k=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(m-P<k&&(w=k+P),m+P>j&&(w=j-P),j-k<this.height&&(_=Math.max(_,this.height/(j-k)),w=(j+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Z=this.worldMinX*this.scale,te=this.worldMaxX*this.scale,ee=this.worldSize/2-(Z+te)/2;x=(h+ee+this.worldSize)%this.worldSize-ee,x-A<Z&&(x=Z+A),x+A>te&&(x=te-A),te-Z<this.width&&(_=Math.max(_,this.width/(te-Z)),x=(te+Z)/2)}x===h&&w===m||(this.center=this.unproject(new o.pointGeometry(x,w))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCameraAltitude(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,s=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const h=Pn(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,h),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?s:1),_=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);_[8]=2*-r.x/this.width,_[9]=2*r.y/this.height;let x=o.mul([],_,m);if(this.projection.isReprojectedInTileSpace){const ye=this.locationCoordinate(this.center),he=o.identity([]);o.translate(he,he,[ye.x*this.worldSize,ye.y*this.worldSize,0]),o.multiply(he,he,La(this)),o.translate(he,he,[-ye.x*this.worldSize,-ye.y*this.worldSize,0]),o.multiply(x,x,he),this.inverseAdjustmentMatrix=function(ve){const fe=La(ve,!0);return bt([],[fe[0],fe[1],fe[4],fe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],x,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=x,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const w=o.invert([],_);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(w,this.horizonLineFromTop(),this.height);const A=new Float32Array(16);o.identity(A),o.scale(A,A,[1,-1,1]),o.rotateX(A,A,this._pitch),o.rotateZ(A,A,this.angle);const P=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),k=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-r.x/this.width,P[9]=2*(r.y+k)/this.height,this.skyboxMatrix=o.multiply(A,P,A);const j=this.point,Z=j.x,te=j.y,ee=this.width%2/2,J=this.height%2/2,H=Math.cos(this.angle),K=Math.sin(this.angle),se=Z-Math.round(Z)+H*ee+K*J,ie=te-Math.round(te)+H*J+K*ee,xe=new Float64Array(x);if(o.translate(xe,xe,[se>.5?se-1:se,ie>.5?ie-1:ie,0]),this.alignedProjMatrix=xe,x=o.create(),o.scale(x,x,[this.width/2,-this.height/2,1]),o.translate(x,x,[1,-1,0]),this.labelPlaneMatrix=x,x=o.create(),o.scale(x,x,[1,-1,1]),o.translate(x,x,[-1,-1,0]),o.scale(x,x,[2/this.width,2/this.height,1]),this.glCoordMatrix=x,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},x=o.invert(new Float64Array(16),this.pixelMatrix),!x)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=x,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const ye=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(ye,ye,m),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=x;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,s=this.cameraPixelsPerMeter,h=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,_=[r,r,s];o.scale$2(_,_,m),o.scale$2(h,h,-1),o.multiply$2(h,h,_);const x=o.create();o.translate(x,x,h),o.scale(x,x,_),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,s,m)}_computeCameraPosition(r){const s=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),m=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-r/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-h[0]*_,m.y/this.worldSize-h[1]*_,r/this.worldSize*this._centerAltitude-h[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=r[2];let m=1;h>0&&(m=Math.min((s-this._camera.position[2])/h,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,r,m),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const r=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:m}=this._camera.getPitchBearing(),_=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),w=Math.max((r[2]-_)/Math.cos(h),x),A=this._zoomFromMercatorZ(w);o.scaleAndAdd(r,r,s,w),this._pitch=o.clamp(h,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(m,-Math.PI,Math.PI),this._setZoom(o.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,s){const h=Math.min(r.x,s.x),m=Math.max(r.x,s.x),_=Math.min(r.y,s.y),x=Math.max(r.y,s.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const w=[new o.pointGeometry(h,_),new o.pointGeometry(m,x),new o.pointGeometry(h,x),new o.pointGeometry(m,_)],A=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const k of w){const j=this.pointRayIntersection(k);if(j.t<0)return!0;const Z=this.rayIntersectionCoordinate(j);if(Z.x<A||Z.y<0||Z.x>P||Z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,s){const h=o.length(o.sub([],this._camera.position,r)),m=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const r=function(s,h){const m=[s[0],s[1],s[2],1];o.transformMat4$1(m,m,h);const _=Math.max(m[3],1e-6);return[m[0]/_,m[1]/_,m[2]/_,_]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,r))}}getCameraToCenterDistance(r){const s=Pn(r,this.zoom,this.width,this.height,1024),h=r.pixelSpaceConversion(this.center.lat,this.worldSize,s);return .5/Math.tan(.5*this._fov)*this.height*h}}function Ra(l,r){let s=!1,h=null;const m=()=>{h=null,s&&(l(),h=setTimeout(m,r),s=!1)};return()=>(s=!0,h||m(),h)}class Ba{constructor(r){this._hashName=r&&encodeURIComponent(r),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ra(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,o.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const s=ua(r);if(this._hashName){const h=this._hashName;let m=!1;const _=o.window.location.hash.slice(1).split("&").map(x=>{const w=x.split("=")[0];return w===h?(m=!0,`${w}=${s}`):x}).filter(x=>x);return m||_.push(`${h}=${s}`),`#${_.join("&")}`}return`#${s}`}_getCurrentHash(){const r=o.window.location.hash.replace("#","");if(this._hashName){let s;return r.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(s[3]||0):r.getBearing();return r.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,r)}}function ua(l,r){const s=l.getCenter(),h=Math.round(100*l.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,m),x=Math.round(s.lng*_)/_,w=Math.round(s.lat*_)/_,A=l.getBearing(),P=l.getPitch();let k=r?`/${x}/${w}/${h}`:`${h}/${w}/${x}`;return(A||P)&&(k+="/"+Math.round(10*A)/10),P&&(k+=`/${Math.round(P)}`),k}const ho={linearity:.3,easing:o.bezier(0,0,.3,1)},jd=o.extend({deceleration:2500,maxSpeed:1400},ho),bh=o.extend({deceleration:20,maxSpeed:1400},ho),wh=o.extend({deceleration:1e3,maxSpeed:360},ho),Uc=o.extend({deceleration:1e3,maxSpeed:90},ho);class jr{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,s=o.exported.now();for(;r.length>0&&s-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)s.zoom+=_.zoomDelta||0,s.bearing+=_.bearingDelta||0,s.pitch+=_.pitchDelta||0,_.panDelta&&s.pan._add(_.panDelta),_.around&&(s.around=_.around),_.pinchAround&&(s.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const _=uc(s.pan.mag(),h,o.extend({},jd,r||{}));m.offset=s.pan.mult(_.amount/s.pan.mag()),m.center=this._map.transform.center,Qr(m,_)}if(s.zoom){const _=uc(s.zoom,h,bh);m.zoom=this._map.transform.zoom+_.amount,Qr(m,_)}if(s.bearing){const _=uc(s.bearing,h,wh);m.bearing=this._map.transform.bearing+o.clamp(_.amount,-179,179),Qr(m,_)}if(s.pitch){const _=uc(s.pitch,h,Uc);m.pitch=this._map.transform.pitch+_.amount,Qr(m,_)}if(m.zoom||m.bearing){const _=s.pinchAround===void 0?s.around:s.pinchAround;m.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function Qr(l,r){(!l.duration||l.duration<r.duration)&&(l.duration=r.duration,l.easing=r.easing)}function uc(l,r,s){const{maxSpeed:h,linearity:m,deceleration:_}=s,x=o.clamp(l*m/(r/1e3),-h,h),w=Math.abs(x)/(_*m);return{easing:s.easing,duration:1e3*w,amount:x*(w/2)}}class Un extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,h,m={}){const _=Ye(s.getCanvasContainer(),h),x=s.unproject(_);super(r,o.extend({point:_,lngLat:x,originalEvent:h},m)),this._defaultPrevented=!1,this.target=s}}class hl extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,h){const m=r==="touchend"?h.changedTouches:h.touches,_=ci(s.getCanvasContainer(),m),x=_.map(A=>s.unproject(A)),w=_.reduce((A,P,k,j)=>A.add(P.div(j.length)),new o.pointGeometry(0,0));super(r,{points:_,point:w,lngLats:x,lngLat:s.unproject(w),originalEvent:h}),this._defaultPrevented=!1}}class Th extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,h){super(r,{originalEvent:h}),this._defaultPrevented=!1}}class Nc{constructor(r,s){this._map=r,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Th(r.type,this._map,r))}mousedown(r,s){return this._mousedownPos=s,this._firePreventable(new Un(r.type,this._map,r))}mouseup(r){this._map.fire(new Un(r.type,this._map,r))}preclick(r){const s=o.extend({},r);s.type="preclick",this._map.fire(new Un(s.type,this._map,s))}click(r,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Un(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Un(r.type,this._map,r))}mouseover(r){this._map.fire(new Un(r.type,this._map,r))}mouseout(r){this._map.fire(new Un(r.type,this._map,r))}touchstart(r){return this._firePreventable(new hl(r.type,this._map,r))}touchmove(r){this._map.fire(new hl(r.type,this._map,r))}touchend(r){this._map.fire(new hl(r.type,this._map,r))}touchcancel(r){this._map.fire(new hl(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kl{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Un(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Un("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Un(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jc{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,s){this.isEnabled()&&r.shiftKey&&r.button===0&&(Ie(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(r,s){if(!this._active)return;const h=s;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=h,this._box||(this._box=Ue("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const _=Math.min(m.x,h.x),x=Math.max(m.x,h.x),w=Math.min(m.y,h.y),A=Math.max(m.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${_}px,${w}px)`,this._box.style.width=x-_+"px",this._box.style.height=A-w+"px")})}mouseupWindow(r,s){if(!this._active||r.button!==0)return;const h=this._startPos,m=s;if(this.reset(),qe(),h.x!==m.x||h.y!==m.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:_=>_.fitScreenCoordinates(h,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),je(),delete this._startPos,delete this._lastPos}_fireEvent(r,s){return this._map.fire(new o.Event(r,{originalEvent:s}))}}function ha(l,r){const s={};for(let h=0;h<l.length;h++)s[l[h].identifier]=r[h];return s}class ks{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){const _=new o.pointGeometry(0,0);for(const x of m)_._add(x);return _.div(m.length)}(s),this.touches=ha(h,s)))}touchmove(r,s,h){if(this.aborted||!this.centroid)return;const m=ha(h,s);for(const _ in this.touches){const x=this.touches[_],w=m[_];(!w||w.dist(x)>30)&&(this.aborted=!0)}}touchend(r,s,h){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Fa{constructor(r){this.singleTap=new ks(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,s,h){this.singleTap.touchstart(r,s,h)}touchmove(r,s,h){this.singleTap.touchmove(r,s,h)}touchend(r,s,h){const m=this.singleTap.touchend(r,s,h);if(m){const _=r.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(m)<30;if(_&&x||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class hc{constructor(){this._zoomIn=new Fa({numTouches:1,numTaps:2}),this._zoomOut=new Fa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,s,h){this._zoomIn.touchstart(r,s,h),this._zoomOut.touchstart(r,s,h)}touchmove(r,s,h){this._zoomIn.touchmove(r,s,h),this._zoomOut.touchmove(r,s,h)}touchend(r,s,h){const m=this._zoomIn.touchend(r,s,h),_=this._zoomOut.touchend(r,s,h);return m?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(m)},{originalEvent:r})}):_?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(_)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const dl={0:1,2:2};class Vc{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,s){return!1}_move(r,s){return{}}mousedown(r,s){if(this._lastPoint)return;const h=Pi(r);this._correctButton(r,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(r,s){const h=this._lastPoint;if(h){if(r.preventDefault(),this._eventButton!=null&&function(m,_){const x=dl[_];return m.buttons===void 0||(m.buttons&x)!==x}(r,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(r){this._lastPoint&&Pi(r)===this._eventButton&&(this._moved&&qe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eh extends Vc{mousedown(r,s){super.mousedown(r,s),this._lastPoint&&(this._active=!0)}_correctButton(r,s){return s===0&&!r.ctrlKey}_move(r,s){return{around:s,panDelta:s.sub(r)}}}class Eu extends Vc{_correctButton(r,s){return s===0&&r.ctrlKey||s===2}_move(r,s){const h=.8*(s.x-r.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(r){r.preventDefault()}}class zn extends Vc{_correctButton(r,s){return s===0&&r.ctrlKey||s===2}_move(r,s){const h=-.5*(s.y-r.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(r){r.preventDefault()}}class Vd{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(r,s,h){return this._calculateTransform(r,s,h)}touchmove(r,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,s,h)}}touchend(r,s,h){this._calculateTransform(r,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,s,h){h.length>0&&(this._active=!0);const m=ha(h,s),_=new o.pointGeometry(0,0),x=new o.pointGeometry(0,0);let w=0;for(const P in m){const k=m[P],j=this._touches[P];j&&(_._add(k),x._add(k.sub(j)),w++,m[P]=k)}if(this._touches=m,w<this._minTouches||!x.mag())return;const A=x.div(w);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(w),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ue("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class fl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,s,h){return{}}touchstart(r,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(r,s,h){const m=this._firstTwoTouches;if(!m)return;r.preventDefault();const[_,x]=m,w=Ua(h,s,_),A=Ua(h,s,x);if(!w||!A)return;const P=this._aroundCenter?null:w.add(A).div(2);return this._move([w,A],P,r)}touchend(r,s,h){if(!this._firstTwoTouches)return;const[m,_]=this._firstTwoTouches,x=Ua(h,s,m),w=Ua(h,s,_);x&&w||(this._active&&qe(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ua(l,r,s){for(let h=0;h<l.length;h++)if(l[h].identifier===s)return r[h]}function Au(l,r){return Math.log(l/r)/Math.LN2}class X extends fl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,s){const h=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Au(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Au(this._distance,h),pinchAround:s}}}function Na(l,r){return 180*l.angleWith(r)/Math.PI}class da extends fl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,s){const h=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Na(this._vector,h),pinchAround:s}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const s=25/(Math.PI*this._minDiameter)*360,h=Na(r,this._startVector);return Math.abs(h)<s}}function Sr(l){return Math.abs(l.y)>Math.abs(l.x)}class Ci extends fl{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Sr(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,s,h){const m=this._lastPoints;if(!m)return;const _=r[0].sub(m[0]),x=r[1].sub(m[1]);return this._map._cooperativeGestures&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(_,x,h.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5})}gestureBeginsVertically(r,s,h){if(this._valid!==void 0)return this._valid;const m=r.mag()>=2,_=s.mag()>=2;if(!m&&!_)return;if(!m||!_)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const x=r.y>0==s.y>0;return Sr(r)&&Sr(s)&&x}}const kt={panStep:100,bearingStep:15,pitchStep:10};class Ah{constructor(){const r=kt;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let s=0,h=0,m=0,_=0,x=0;switch(r.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:r.shiftKey?h=-1:(r.preventDefault(),_=-1);break;case 39:r.shiftKey?h=1:(r.preventDefault(),_=1);break;case 38:r.shiftKey?m=1:(r.preventDefault(),x=-1);break;case 40:r.shiftKey?m=-1:(r.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:w=>{const A=w.getZoom();w.easeTo({duration:300,easeId:"keyboardHandler",easing:Sh,zoom:s?Math.round(A)+s*(r.shiftKey?2:1):A,bearing:w.getBearing()+h*this._bearingStep,pitch:w.getPitch()+m*this._pitchStep,offset:[-_*this._panStep,-x*this._panStep],center:w.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Sh(l){return l*(2-l)}const ko=4.000244140625;class dc{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=r.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const h=o.exported.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%ko==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),r.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=r,this._delta-=s,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Ye(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,s=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>ko?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&P!==0&&(P=1/P);const k=s(),j=Math.pow(2,k),Z=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(Z*P))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,_=this._easing;let x,w=!1;if(this._type==="wheel"&&m&&_){const A=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),P=_(A);x=o.number(m,h,P),A<1?this._frameId||(this._frameId=!0):w=!0}else x=h,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:x-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let s=o.ease;if(this._prevEase){const h=this._prevEase,m=(o.exported.now()-h.start)/h.duration,_=h.easing(m+.01)-h.easing(m),x=.27/Math.sqrt(_*_+1e-4)*.01,w=Math.sqrt(.0729-x*x);s=o.bezier(x,w,.25,1)}return this._prevEase={start:o.exported.now(),duration:r,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ue("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Ih{constructor(r,s){this._clickZoom=r,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Mh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,s){return r.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(r.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ch{constructor(){this._tap=new Fa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,s,h){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(r,s,h))}touchmove(r,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=s[0],_=m.y-this._swipePoint.y;return this._swipePoint=m,r.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(r,s,h)}touchend(r,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(r,s,h)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ph{constructor(r,s,h){this._el=r,this._mousePan=s,this._touchPan=h}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ds{constructor(r,s,h){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zh{constructor(r,s,h,m){this._el=r,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const fc=l=>l.zoom||l.drag||l.pitch||l.rotate;class Gc extends o.Event{}class Su{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,s){const h=o.sub([],s,r);this.radius=o.length(h[2]<0?o.div([],h,this.constants):[h[0],h[1],0])}projectRay(r){o.div(r,r,this.constants),o.normalize(r,r),o.mul$1(r,r,this.constants);const s=o.scale$2([],r,this.radius);if(s[2]>0){const h=o.scale$2([],[0,0,1],o.dot(s,[0,0,1])),m=o.scale$2([],o.normalize([],[s[0],s[1],0]),this.radius),_=o.add([],s,o.scale$2([],o.sub([],o.add([],m,h),s),2));s[0]=_[0],s[1]=_[1]}return s}}function pl(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Ls{constructor(r,s){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new jr(r),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Su,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[m,_,x]of this._listeners)m.addEventListener(_,m===o.window.document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[r,s,h]of this._listeners)r.removeEventListener(s,r===o.window.document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(r){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new Nc(s,r));const m=s.boxZoom=new jc(s,r);this._add("boxZoom",m);const _=new hc,x=new Mh;s.doubleClickZoom=new Ih(x,_),this._add("tapZoom",_),this._add("clickZoom",x);const w=new Ch;this._add("tapDragZoom",w);const A=s.touchPitch=new Ci(s);this._add("touchPitch",A);const P=new Eu(r),k=new zn(r);s.dragRotate=new Ds(r,P,k),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const j=new Eh(r),Z=new Vd(s,r);s.dragPan=new Ph(h,j,Z),this._add("mousePan",j),this._add("touchPan",Z,["touchZoom","touchRotate"]);const te=new da,ee=new X;s.touchZoomRotate=new zh(h,ee,te,w),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Kl(s));const J=s.scrollZoom=new dc(s,this);this._add("scrollZoom",J,["mousePan"]);const H=s.keyboard=new Ah;this._add("keyboard",H);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[K]&&s[K].enable(r[K])}_add(r,s,h){this._handlers.push({handlerName:r,handler:s,allowed:h}),this._handlersById[r]=s}stop(r){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!fc(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,s,h){for(const m in r)if(m!==h&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const s=[];for(const h of r)this._el.contains(h.target)&&s.push(h);return s}handleEvent(r,s){this._updatingCamera=!0;const h=r.type==="renderFrame",m=h?void 0:r,_={needsRenderFrame:!1},x={},w={},A=r.touches?this._getMapTouches(r.touches):void 0,P=A?ci(this._el,A):h?void 0:Ye(this._el,r);for(const{handlerName:Z,handler:te,allowed:ee}of this._handlers){if(!te.isEnabled())continue;let J;this._blockedByActive(w,ee,Z)?te.reset():te[s||r.type]&&(J=te[s||r.type](r,P,A),this.mergeHandlerResult(_,x,J,Z,m),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||te.isActive())&&(w[Z]=te)}const k={};for(const Z in this._previousActiveHandlers)w[Z]||(k[Z]=m);this._previousActiveHandlers=w,(Object.keys(k).length||pl(_))&&(this._changes.push([_,x,k]),this._triggerRenderFrame()),(Object.keys(w).length||pl(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=_;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(r,s,h,m,_){if(!h)return;o.extend(r,h);const x={handlerName:m,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(s.zoom=x),h.panDelta!==void 0&&(s.drag=x),h.pitchDelta!==void 0&&(s.pitch=x),h.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const r={},s={},h={};for(const[m,_,x]of this._changes)m.panDelta&&(r.panDelta=(r.panDelta||new o.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(r.around=m.around),m.aroundCoord!==void 0&&(r.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(r.pinchAround=m.pinchAround),m.noInertia&&(r.noInertia=m.noInertia),o.extend(s,_),o.extend(h,x);this._updateMapTransform(r,s,h),this._changes=[]}_updateMapTransform(r,s,h){const m=this._map,_=m.transform,x=se=>[se.x,se.y,se.z];if((se=>{const ie=this._eventsInProgress.drag;return ie&&!this._handlersById[ie.handlerName].isActive()})()&&!pl(r)){const se=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",se!==_.zoom&&this._map._update(!0)}if(!pl(r))return void this._fireEvents(s,h,!0);let{panDelta:w,zoomDelta:A,bearingDelta:P,pitchDelta:k,around:j,aroundCoord:Z,pinchAround:te}=r;te!==void 0&&(j=te),(se=>s.drag&&!this._eventsInProgress.drag)()&&j&&(this._dragOrigin=x(_.pointCoordinate3D(j)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",m._stop(!0),j=j||m.transform.centerPoint,P&&(_.bearing+=P),k&&(_.pitch+=k),_._updateCameraState();const ee=[0,0,0];if(w)if(_.projection.name==="mercator"){const se=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(j).dir),ie=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(j.sub(w)).dir);ee[0]=ie[0]-se[0],ee[1]=ie[1]-se[1]}else{const se=_.pointCoordinate(j);if(_.projection.name==="globe"){w=w.rotate(-_.angle);const ie=_._pixelsPerMercatorPixel/_.worldSize;ee[0]=-w.x*o.mercatorScale(o.latFromMercatorY(se.y))*ie,ee[1]=-w.y*o.mercatorScale(_.center.lat)*ie}else{const ie=_.pointCoordinate(j.sub(w));se&&ie&&(ee[0]=ie.x-se.x,ee[1]=ie.y-se.y)}}const J=_.zoom,H=[0,0,0];if(A){const se=x(Z||_.pointCoordinate3D(j)),ie={dir:o.normalize([],o.sub([],se,_._camera.position))};if(ie.dir[2]<0){const xe=_.zoomDeltaToMovement(se,A);o.scale$2(H,ie.dir,xe)}}const K=o.add(ee,ee,H);_._translateCameraConstrained(K),A&&Math.abs(_.zoom-J)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(s,h,!0)}_fireEvents(r,s,h){const m=fc(this._eventsInProgress),_=fc(r),x={};for(const k in r){const{originalEvent:j}=r[k];this._eventsInProgress[k]||(x[`${k}start`]=j),this._eventsInProgress[k]=r[k]}!m&&_&&this._fireEvent("movestart",_.originalEvent);for(const k in x)this._fireEvent(k,x[k]);_&&this._fireEvent("move",_.originalEvent);for(const k in r){const{originalEvent:j}=r[k];this._fireEvent(k,j)}const w={};let A;for(const k in this._eventsInProgress){const{handlerName:j,originalEvent:Z}=this._eventsInProgress[k];this._handlersById[j].isActive()||(delete this._eventsInProgress[k],A=s[j]||Z,w[`${k}end`]=A)}for(const k in w)this._fireEvent(k,w[k]);const P=fc(this._eventsInProgress);if(h&&(m||_)&&!P){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;k?(j(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:A})):(this._map.fire(new o.Event("moveend",{originalEvent:A})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,s){this._map.fire(new o.Event(r,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Gc("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Iu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class kh extends o.Evented{constructor(r,s){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=s.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,s){return this.jumpTo({center:r},s)}panBy(r,s,h){return r=o.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,o.extend({offset:r},s),h)}panTo(r,s,h){return this.easeTo(o.extend({center:r},s),h)}getZoom(){return this.transform.zoom}setZoom(r,s){return this.jumpTo({zoom:r},s),this}zoomTo(r,s,h){return this.easeTo(o.extend({zoom:r},s),h)}zoomIn(r,s){return this.zoomTo(this.getZoom()+1,r,s),this}zoomOut(r,s){return this.zoomTo(this.getZoom()-1,r,s),this}getBearing(){return this.transform.bearing}setBearing(r,s){return this.jumpTo({bearing:r},s),this}getPadding(){return this.transform.padding}setPadding(r,s){return this.jumpTo({padding:r},s),this}rotateTo(r,s,h){return this.easeTo(o.extend({bearing:r},s),h)}resetNorth(r,s){return this.rotateTo(0,o.extend({duration:1e3},r),s),this}resetNorthPitch(r,s){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},r),s),this}snapToNorth(r,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,s):this}getPitch(){return this.transform.pitch}setPitch(r,s){return this.jumpTo({pitch:r},s),this}cameraForBounds(r,s){this.transform.projection.name==="globe"&&o.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),r=o.LngLatBounds.convert(r);const h=s&&s.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),h,s)}_extendCameraOptions(r){const s={top:0,bottom:0,right:0,left:0};if(typeof(r=o.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const h=r.padding;r.padding={top:h,bottom:h,right:h,left:h}}return r.padding=o.extend(s,r.padding),r}_cameraForBoxAndBearing(r,s,h,m){const _=this._extendCameraOptions(m),x=this.transform,w=x.padding,A=x.project(o.LngLat.convert(r)),P=x.project(o.LngLat.convert(s)),k=new o.pointGeometry(A.x,P.y),j=new o.pointGeometry(P.x,A.y),Z=-o.degToRad(h),te=A.rotate(Z),ee=P.rotate(Z),J=k.rotate(Z),H=j.rotate(Z),K=new o.pointGeometry(Math.max(te.x,ee.x,J.x,H.x),Math.max(te.y,ee.y,J.y,H.y)),se=new o.pointGeometry(Math.min(te.x,ee.x,J.x,H.x),Math.min(te.y,ee.y,J.y,H.y)),ie=K.sub(se),xe=(x.width-((w.left||0)+(w.right||0)+_.padding.left+_.padding.right))/ie.x,ye=(x.height-((w.top||0)+(w.bottom||0)+_.padding.top+_.padding.bottom))/ie.y;if(ye<0||xe<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const he=Math.min(x.scaleZoom(x.scale*Math.min(xe,ye)),_.maxZoom),ve=typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new o.pointGeometry(_.offset.x,_.offset.y):o.pointGeometry.convert(_.offset),fe=new o.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(h*Math.PI/180),Ee=ve.add(fe).mult(x.scale/x.zoomScale(he));return{center:x.unproject(A.add(P).div(2).sub(Ee)),zoom:he,bearing:h}}_cameraForBox(r,s,h,m,_){const x=this._extendCameraOptions(_);h=h||0,m=m||0,r=o.LngLat.convert(r),s=o.LngLat.convert(s);const w=this.transform.clone();w.padding=x.padding;const A=this.getFreeCameraOptions(),P=new o.LngLat(.5*(r.lng+s.lng),.5*(r.lat+s.lat)),k=.5*(h+m);if(w._camera.position[2]<o.mercatorZfromAltitude(k,P.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");A.lookAtPoint(P),w.setFreeCameraOptions(A);const j=o.MercatorCoordinate.fromLngLat(r),Z=o.MercatorCoordinate.fromLngLat(s),te=w.pointRayIntersection(w.centerPoint,k),ee=[(J=w.rayIntersectionCoordinate(te)).x,J.y,J.z];var J;const H=w.screenPointToMercatorRay(w.centerPoint),K=w.projection.name!=="globe";let se,ie=0;do{const xe=Math.floor(w.zoom),ye=1<<xe,he=Math.min(ye*j.x,ye*Z.x),ve=Math.min(ye*j.y,ye*Z.y),fe=Math.max(ye*j.x,ye*Z.x),Ee=Math.max(ye*j.y,ye*Z.y),Le=new o.Aabb([he,ve,h],[fe,Ee,m]),ht=o.Frustum.fromInvProjectionMatrix(w.invProjMatrix,w.worldSize,xe,K);if(Le.intersects(ht)!==2){se&&(w._camera.position=o.scaleAndAdd([],w._camera.position,H.dir,-se),w._updateStateFromCamera());break}const Pe=o.sub([],w._camera.position,ee);se=.5*o.length(Pe),w._camera.position=o.scaleAndAdd([],w._camera.position,H.dir,se);try{w._updateStateFromCamera()}catch{return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ie<10);return{center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}}fitBounds(r,s,h){return this.transform.projection.name==="globe"&&o.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(r,s),s,h)}_raycastElevationBox(r,s){const h=this.transform.elevation;if(!h)return;const m=new o.pointGeometry(r.x,s.y),_=new o.pointGeometry(s.x,r.y),x=h.pointCoordinate(r);if(!x)return;const w=h.pointCoordinate(s);if(!w)return;const A=h.pointCoordinate(m);if(!A)return;const P=h.pointCoordinate(_);if(!P)return;const k=new o.MercatorCoordinate(x[0],x[1]).toLngLat(),j=new o.MercatorCoordinate(w[0],w[1]).toLngLat(),Z=new o.MercatorCoordinate(A[0],A[1]).toLngLat(),te=new o.MercatorCoordinate(P[0],P[1]).toLngLat(),ee=Math.min(k.lng,Math.min(j.lng,Math.min(Z.lng,te.lng))),J=Math.min(k.lat,Math.min(j.lat,Math.min(Z.lat,te.lat))),H=Math.max(k.lng,Math.max(j.lng,Math.max(Z.lng,te.lng))),K=Math.max(k.lat,Math.max(j.lat,Math.max(Z.lat,te.lat))),se=Math.min(x[3],Math.min(w[3],Math.min(A[3],P[3]))),ie=Math.max(x[3],Math.max(w[3],Math.max(A[3],P[3])));return{minLngLat:new o.LngLat(ee,J),maxLngLat:new o.LngLat(H,K),minAltitude:se,maxAltitude:ie}}fitScreenCoordinates(r,s,h,m,_){let x,w,A,P;this.transform.projection.name==="globe"&&o.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const k=o.pointGeometry.convert(r),j=o.pointGeometry.convert(s),Z=this._raycastElevationBox(k,j);if(Z)x=Z.minLngLat,w=Z.maxLngLat,A=Z.minAltitude,P=Z.maxAltitude;else{if(this.transform.anyCornerOffEdge(k,j))return this;x=this.transform.pointLocation(k),w=this.transform.pointLocation(j)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(r)),this.transform.pointLocation(o.pointGeometry.convert(s)),h,m):this._cameraForBox(x,w,A,P,m),m,_)}_fitInternal(r,s,h){return r?(delete(s=o.extend(r,s)).padding,s.linear?this.easeTo(s,h):this.flyTo(s,h)):this}jumpTo(r,s){this.stop();const h=r.preloadOnly?this.transform.clone():this.transform;let m=!1,_=!1,x=!1;return"zoom"in r&&h.zoom!==+r.zoom&&(m=!0,h.zoom=+r.zoom),r.center!==void 0&&(h.center=o.LngLat.convert(r.center)),"bearing"in r&&h.bearing!==+r.bearing&&(_=!0,h.bearing=+r.bearing),"pitch"in r&&h.pitch!==+r.pitch&&(x=!0,h.pitch=+r.pitch),r.padding==null||h.isPaddingEqual(r.padding)||(h.padding=r.padding),r.preloadOnly?(this._preloadTiles(h),this):(this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),m&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),_&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),x&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Iu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return o.warnOnce(Iu),this;this.stop();const m=h.zoom,_=h.pitch,x=h.bearing;h.setFreeCameraOptions(r);const w=m!==h.zoom,A=_!==h.pitch,P=x!==h.bearing;return this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),w&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),P&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),A&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)),this}easeTo(r,s){this._stop(!1,r.easeId),((r=o.extend({offset:[0,0],duration:500,easing:o.ease},r)).animate===!1||!r.essential&&o.exported.prefersReducedMotion)&&(r.duration=0);const h=this.transform,m=this.getZoom(),_=this.getBearing(),x=this.getPitch(),w=this.getPadding(),A="zoom"in r?+r.zoom:m,P="bearing"in r?this._normalizeBearing(r.bearing,_):_,k="pitch"in r?+r.pitch:x,j="padding"in r?r.padding:h.padding,Z=o.pointGeometry.convert(r.offset);let te,ee,J;if(h.projection.name==="globe"){const Ee=o.MercatorCoordinate.fromLngLat(h.center),Le=Z.rotate(-h.angle);Ee.x+=Le.x/h.worldSize,Ee.y+=Le.y/h.worldSize;const ht=Ee.toLngLat(),Pe=o.LngLat.convert(r.center||ht);this._normalizeCenter(Pe),te=h.centerPoint.add(Le),ee=new o.pointGeometry(Ee.x,Ee.y).mult(h.worldSize),J=new o.pointGeometry(o.mercatorXfromLng(Pe.lng),o.mercatorYfromLat(Pe.lat)).mult(h.worldSize).sub(ee)}else{te=h.centerPoint.add(Z);const Ee=h.pointLocation(te),Le=o.LngLat.convert(r.center||Ee);this._normalizeCenter(Le),ee=h.project(Ee),J=h.project(Le).sub(ee)}const H=h.zoomScale(A-m);let K,se;r.around&&(K=o.LngLat.convert(r.around),se=h.locationPoint(K));const ie=this._zooming||A!==m,xe=this._rotating||_!==P,ye=this._pitching||k!==x,he=!h.isPaddingEqual(j),ve=Ee=>Le=>{if(ie&&(Ee.zoom=o.number(m,A,Le)),xe&&(Ee.bearing=o.number(_,P,Le)),ye&&(Ee.pitch=o.number(x,k,Le)),he&&(Ee.interpolatePadding(w,j,Le),te=Ee.centerPoint.add(Z)),K)Ee.setLocationAtPoint(K,se);else{const ht=Ee.zoomScale(Ee.zoom-m),Pe=A>m?Math.min(2,H):Math.max(.5,H),He=Math.pow(Pe,1-Le),rt=Ee.unproject(ee.add(J.mult(Le*He)).mult(ht));Ee.setLocationAtPoint(Ee.renderWorldCopies?rt.wrap():rt,te)}return r.preloadOnly||this._fireMoveEvents(s),Ee};if(r.preloadOnly){const Ee=this._emulate(ve,r.duration,h);return this._preloadTiles(Ee),this}const fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=xe,this._pitching=ye,this._padding=he,this._easeId=r.easeId,this._prepareEase(s,r.noMoveStart,fe),this._ease(ve(h),Ee=>{h.recenterOnTerrain(),this._afterEase(s,Ee)},r),this}_prepareEase(r,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||h.moving||this.fire(new o.Event("movestart",r)),this._zooming&&!h.zooming&&this.fire(new o.Event("zoomstart",r)),this._rotating&&!h.rotating&&this.fire(new o.Event("rotatestart",r)),this._pitching&&!h.pitching&&this.fire(new o.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.Event("move",r)),this._zooming&&this.fire(new o.Event("zoom",r)),this._rotating&&this.fire(new o.Event("rotate",r)),this._pitching&&this.fire(new o.Event("pitch",r))}_afterEase(r,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,m=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new o.Event("zoomend",r)),m&&this.fire(new o.Event("rotateend",r)),_&&this.fire(new o.Event("pitchend",r)),this.fire(new o.Event("moveend",r))}flyTo(r,s){if(!r.essential&&o.exported.prefersReducedMotion){const Tt=o.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Tt,s)}this.stop(),r=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},r);const h=this.transform,m=this.getZoom(),_=this.getBearing(),x=this.getPitch(),w=this.getPadding(),A="zoom"in r?o.clamp(+r.zoom,h.minZoom,h.maxZoom):m,P="bearing"in r?this._normalizeBearing(r.bearing,_):_,k="pitch"in r?+r.pitch:x,j="padding"in r?r.padding:h.padding,Z=h.zoomScale(A-m),te=o.pointGeometry.convert(r.offset);let ee=h.centerPoint.add(te);const J=h.pointLocation(ee),H=o.LngLat.convert(r.center||J);this._normalizeCenter(H);const K=h.project(J),se=h.project(H).sub(K);let ie=r.curve;const xe=Math.max(h.width,h.height),ye=xe/Z,he=se.mag();if("minZoom"in r){const Tt=o.clamp(Math.min(r.minZoom,m,A),h.minZoom,h.maxZoom),wt=xe/h.zoomScale(Tt-m);ie=Math.sqrt(wt/he*2)}const ve=ie*ie;function fe(Tt){const wt=(ye*ye-xe*xe+(Tt?-1:1)*ve*ve*he*he)/(2*(Tt?ye:xe)*ve*he);return Math.log(Math.sqrt(wt*wt+1)-wt)}function Ee(Tt){return(Math.exp(Tt)-Math.exp(-Tt))/2}function Le(Tt){return(Math.exp(Tt)+Math.exp(-Tt))/2}const ht=fe(0);let Pe=function(Tt){return Le(ht)/Le(ht+ie*Tt)},He=function(Tt){return xe*((Le(ht)*(Ee(wt=ht+ie*Tt)/Le(wt))-Ee(ht))/ve)/he;var wt},rt=(fe(1)-ht)/ie;if(Math.abs(he)<1e-6||!isFinite(rt)){if(Math.abs(xe-ye)<1e-6)return this.easeTo(r,s);const Tt=ye<xe?-1:1;rt=Math.abs(Math.log(ye/xe))/ie,He=function(){return 0},Pe=function(wt){return Math.exp(Tt*ie*wt)}}r.duration="duration"in r?+r.duration:1e3*rt/("screenSpeed"in r?+r.screenSpeed/ie:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const gt=_!==P,Ve=k!==x,dt=!h.isPaddingEqual(j),Qe=Tt=>wt=>{const Ot=wt*rt,Nt=1/Pe(Ot);Tt.zoom=wt===1?A:m+Tt.scaleZoom(Nt),gt&&(Tt.bearing=o.number(_,P,wt)),Ve&&(Tt.pitch=o.number(x,k,wt)),dt&&(Tt.interpolatePadding(w,j,wt),ee=Tt.centerPoint.add(te));const Ht=wt===1?H:Tt.unproject(K.add(se.mult(He(Ot))).mult(Nt));return Tt.setLocationAtPoint(Tt.renderWorldCopies?Ht.wrap():Ht,ee),Tt._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(s),Tt};if(r.preloadOnly){const Tt=this._emulate(Qe,r.duration,h);return this._preloadTiles(Tt),this}return this._zooming=!0,this._rotating=gt,this._pitching=Ve,this._padding=dt,this._prepareEase(s,!1),this._ease(Qe(h),()=>this._afterEase(s),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!r){const h=this.handlers;h&&h.stop(!1)}return this}_ease(r,s,h){h.animate===!1||h.duration===0?(r(1),s()):(this._easeStart=o.exported.now(),this._easeOptions=h,this._onEaseFrame=r,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,s){r=o.wrap(r,-180,180);const h=Math.abs(r-s);return Math.abs(r-360-s)<h&&(r-=360),Math.abs(r+360-s)<h&&(r+=360),r}_normalizeCenter(r){const s=this.transform;if(!s.renderWorldCopies||s.maxBounds)return;const h=r.lng-s.center.lng;r.lng+=h>180?-360:h<-180?360:0}_emulate(r,s,h){const m=Math.ceil(15*s/1e3),_=[],x=r(h.clone());for(let w=0;w<=m;w++){const A=x(w/m);_.push(A.clone())}return _}}class Mu{constructor(r={}){this.options=r,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const s=this.options&&this.options.compact;return this._map=r,this._container=Ue("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ue("button","mapboxgl-ctrl-attrib-button",this._container),Ue("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ue("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,s){const h=this._map._getUIString(`AttributionControl.${s}`);r.setAttribute("aria-label",h),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(r){const h=s.reduce((m,_,x)=>(_.value&&(m+=`${_.key}=${_.value}${x<s.length-1?"&":""}`),m),"?");r.href=`${o.config.FEEDBACK_URL}/${h}#${ua(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._sourceCaches;for(const m in s){const _=s[m];if(_.used){const x=_.getSource();x.attribution&&r.indexOf(x.attribution)<0&&r.push(x.attribution)}}r.sort((m,_)=>m.length-_.length),r=r.filter((m,_)=>{for(let x=_+1;x<r.length;x++)if(r[x].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const h=r.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,r.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Cu{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=Ue("div","mapboxgl-ctrl");const s=Ue("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const s in r){const h=r[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const s=r[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Pu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const s=++this._id;return this._queue.push({callback:r,id:s,cancelled:!1}),s}remove(r){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const m of h)if(m.id===r)return void(m.cancelled=!0)}run(r=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function fa(l,r,s){if(l=new o.LngLat(l.lng,l.lat),r){const h=new o.LngLat(l.lng-360,l.lat),m=new o.LngLat(l.lng+360,l.lat),_=360*Math.ceil(Math.abs(l.lng-s.center.lng)/360),x=s.locationPoint(l).distSqr(r),w=r.x<0||r.y<0||r.x>s.width||r.y>s.height;s.locationPoint(h).distSqr(r)<x&&(w||Math.abs(h.lng-s.center.lng)<_)?l=h:s.locationPoint(m).distSqr(r)<x&&(w||Math.abs(m.lng-s.center.lng)<_)&&(l=m)}for(;Math.abs(l.lng-s.center.lng)>180;){const h=s.locationPoint(l);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;l.lng>s.center.lng?l.lng-=360:l.lng+=360}return l}const pc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class $c extends o.Evented{constructor(r,s){if(super(),(r instanceof o.window.HTMLElement||s)&&(r=o.extend({element:r},s)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),r&&r.element)this._element=r.element,this._offset=o.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ue("div");const m=41,_=27,x=We("svg",{display:"block",height:m*this._scale+"px",width:_*this._scale+"px",viewBox:`0 0 ${_} ${m}`},this._element),w=We("radialGradient",{id:"shadowGradient"},We("defs",{},x));We("stop",{offset:"10%","stop-opacity":.4},w),We("stop",{offset:"100%","stop-opacity":.05},w),We("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},x),We("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},x),We("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},x),We("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},x),this._offset=o.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const h=this._element.classList;for(const m in pc)h.remove(`mapboxgl-marker-anchor-${m}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const s=r.code,h=r.charCode||r.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(r){const s=r.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map;if(!r)return!1;const s=r.unproject(this._pos),h=r.getFreeCameraOptions();if(!h.position)return!1;const m=h.position.toLngLat();return m.distanceTo(s)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const s=this._pos;if(!s||s.x<0||s.x>r.transform.width||s.y<0||s.y>r.transform.height)return void this._clearFadeTimer();const h=r.unproject(s);let m;r._showingGlobe()&&o.isLngLatBehindGlobe(r.transform,this._lngLat)?m=0:(m=1-r._queryFogOpacity(h),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(m*=.2)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${pc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const r=this._pos,s=this._map,h=this.getPitchAlignment();if(!s||!r||h!=="map")return"";if(!s._showingGlobe()){const A=s.getPitch();return A?`rotateX(${A}deg)`:""}const m=o.radToDeg(o.globeTiltAtLngLat(s.transform,this._lngLat)),_=r.sub(o.globeCenterToScreenPoint(s.transform)),x=Math.abs(_.x)+Math.abs(_.y);if(x===0)return"";const w=m/x;return`rotateX(${-_.y*w}deg) rotateY(${_.x*w}deg)`}_calculateZTransform(){const r=this._pos,s=this._map;if(!s||!r)return"";let h=0;const m=this.getRotationAlignment();if(m==="map")if(s._showingGlobe()){const _=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),x=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);h=o.radToDeg(Math.atan2(x.y,x.x))-90}else h=-s.getBearing();else if(m==="horizon"){const _=o.smoothstep(4,6,s.getZoom()),x=o.globeCenterToScreenPoint(s.transform);x.y+=_*s.transform.height;const w=r.sub(x),A=o.radToDeg(Math.atan2(w.y,w.x));h=(A>90?A-270:A+90)*(1-_)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(r){o.window.cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=fa(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),r===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.pointGeometry.convert(r),this._update(),this}_onMove(r){const s=this._map;if(s){if(!this._isDragging){const h=this._clickTolerance||s._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(r){const s=this._map;s&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos),this._pointerdownPos=r.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const s=this._map;return s&&(r?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class Do{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const s=o.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,s,h){this._start=this.getValue(s),this._end=r,this._startTime=s,this._endTime=s+h}}const Dh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Lh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function mc(l){l.parentNode&&l.parentNode.removeChild(l)}const Oh={showCompass:!0,showZoom:!0,visualizePitch:!1};class zu{constructor(r,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Eu({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,h&&(this.mousePitch=new zn({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(r,s){this.mouseRotate.mousedown(r,s),this.mousePitch&&this.mousePitch.mousedown(r,s),Ie()}move(r,s){const h=this.map,m=this.mouseRotate.mousemoveWindow(r,s),_=m&&m.bearingDelta;if(_&&h.setBearing(h.getBearing()+_),this.mousePitch){const x=this.mousePitch.mousemoveWindow(r,s),w=x&&x.pitchDelta;w&&h.setPitch(h.getPitch()+w)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){je(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Ye(this.element,r)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Ye(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ci(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=ci(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ku={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},qc={maxWidth:100,unit:"metric"};function Du(l,r,s){const h=Zc(r),m=h/r,_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[s];this._map._requestDomTask(()=>{this._container.style.width=l*m+"px",this._container.innerHTML=`${h}&nbsp;${_}`})}function Zc(l){const r=Math.pow(10,`${Math.floor(l)}`.length-1);let s=l/r;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:s>=1?1:function(h){const m=Math.pow(10,Math.ceil(-Math.log(h)/Math.LN10));return Math.round(h*m)/m}(s),r*s}const Lu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},_c=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ml(l=new o.pointGeometry(0,0),r="bottom"){if(typeof l=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(r){case"top":return new o.pointGeometry(0,l);case"top-left":return new o.pointGeometry(s,s);case"top-right":return new o.pointGeometry(-s,s);case"bottom":return new o.pointGeometry(0,-l);case"bottom-left":return new o.pointGeometry(s,-s);case"bottom-right":return new o.pointGeometry(-s,-s);case"left":return new o.pointGeometry(l,0);case"right":return new o.pointGeometry(-l,0)}return new o.pointGeometry(0,0)}return l instanceof o.pointGeometry||Array.isArray(l)?o.pointGeometry.convert(l):o.pointGeometry.convert(l[r]||[0,0])}const gc={version:o.version,supported:me,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends kh{constructor(l){if((l=o.extend({},Lh,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(l.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ca(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=l.collectResourceTiming,this._optimizeForTerrain=l.optimizeForTerrain,this._language=l.language==="auto"?o.window.navigator.language:l.language,this._worldview=l.worldview,this._renderTaskQueue=new Pu,this._domRenderTaskQueue=new Pu,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Dh,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Do(0),this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,typeof l.container=="string"){if(this._container=o.window.document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ls(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,l.style&&this.setStyle(l.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this._hash=l.hash&&new Ba(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,o.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),l.attributionControl&&this.addControl(new Mu({customAttribution:l.customAttribution})),this._logoControl=new Cu,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(l,r){if(r===void 0&&(r=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=l.onAdd(this);this._controls.push(l);const h=this._controlPositions[r];return r.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(l);return r>-1&&this._controls.splice(r,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),this.fire(new o.Event("resize",l)),r&&this.fire(new o.Event("moveend",l)),this}getBounds(){return this.transform.projection.name==="globe"&&o.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(o.LngLatBounds.convert(l)),this._update()}setMinZoom(l){if((l=l==null?-2:l)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l==null?22:l)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l==null?0:l)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l==null?85:l)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this._update()}getLanguage(){return this._language}setLanguage(l){if(this._language=l==="auto"?o.window.navigator.language:l,this.style)for(const r in this.style._sourceCaches){const s=this.style._sourceCaches[r]._source;s._setLanguage&&s._setLanguage(this._language)}for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){if(this._worldview=l,this.style)for(const r in this.style._sourceCaches){const s=this.style._sourceCaches[r]._source;s._setWorldview&&s._setWorldview(l)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,r=l.projection.name;let s;r==="globe"&&l.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(l.setMercatorFromTransition(),s=!0):r==="mercator"&&l.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(l.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(l,r){return this._updateProjection(l||r||{name:"mercator"})}_updateProjection(l){let r;if(r=l.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const s in this.style._sourceCaches)this.style._sourceCaches[s].clearTiles();this._update(!0)}return this}project(l){return this.transform.locationPoint3D(o.LngLat.convert(l))}unproject(l){return this.transform.pointLocation3D(o.pointGeometry.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(l,r,s){if(l==="mouseenter"||l==="mouseover"){let h=!1;const m=x=>{const w=r.filter(P=>this.getLayer(P)),A=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];A.length?h||(h=!0,s.call(this,new Un(l,this,x.originalEvent,{features:A}))):h=!1},_=()=>{h=!1};return{layers:new Set(r),listener:s,delegates:{mousemove:m,mouseout:_}}}if(l==="mouseleave"||l==="mouseout"){let h=!1;const m=x=>{const w=r.filter(A=>this.getLayer(A));(w.length?this.queryRenderedFeatures(x.point,{layers:w}):[]).length?h=!0:h&&(h=!1,s.call(this,new Un(l,this,x.originalEvent)))},_=x=>{h&&(h=!1,s.call(this,new Un(l,this,x.originalEvent)))};return{layers:new Set(r),listener:s,delegates:{mousemove:m,mouseout:_}}}{const h=m=>{const _=r.filter(w=>this.getLayer(w)),x=_.length?this.queryRenderedFeatures(m.point,{layers:_}):[];x.length&&(m.features=x,s.call(this,m),delete m.features)};return{layers:new Set(r),listener:s,delegates:{[l]:h}}}}on(l,r,s){if(s===void 0)return super.on(l,r);Array.isArray(r)||(r=[r]);const h=this._createDelegatedListener(l,r,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(h);for(const m in h.delegates)this.on(m,h.delegates[m]);return this}once(l,r,s){if(s===void 0)return super.once(l,r);Array.isArray(r)||(r=[r]);const h=this._createDelegatedListener(l,r,s);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(l,r,s){if(s===void 0)return super.off(l,r);r=new Set(Array.isArray(r)?r:[r]);const h=(_,x)=>{if(_.size!==x.size)return!1;for(const w of _)if(!x.has(w))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[l]:void 0;return m&&(_=>{for(let x=0;x<_.length;x++){const w=_[x];if(w.listener===s&&h(w.layers,r)){for(const A in w.delegates)this.off(A,w.delegates[A]);return _.splice(x,1),this}}})(m),this}queryRenderedFeatures(l,r){return this.style?(r!==void 0||l===void 0||l instanceof o.pointGeometry||Array.isArray(l)||(r=l,l=void 0),this.style.queryRenderedFeatures(l=l||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(l,r){return this.style.querySourceFeatures(l,r)}queryTerrainElevation(l,r){const s=this.transform.elevation;return s?(r=o.extend({},{exaggerated:!0},r),s.getAtPoint(o.MercatorCoordinate.fromLngLat(l),null,r.exaggerated)):null}setStyle(l,r){return(r=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&l?(this._diffStyle(l,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(l,r))}_getUIString(l){const r=this._locale[l];if(r==null)throw new Error(`Missing UI string '${l}'`);return r}_updateStyle(l,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l&&(this.style=new Bn(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof l=="string"?this.style.loadURL(l):this.style.loadJSON(l)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Bn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,r){if(typeof l=="string"){const s=this._requestManager.normalizeStyleURL(l),h=this._requestManager.transformRequest(s,o.ResourceType.Style);o.getJSON(h,(m,_)=>{m?this.fire(new o.ErrorEvent(m)):_&&this._updateDiff(_,r)})}else typeof l=="object"&&this._updateDiff(l,r)}_updateDiff(l,r){try{this.style.setState(l)&&this._update(!0)}catch(s){o.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(l,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(l,r){return this._lazyInitEmptyStyle(),this.style.addSource(l,r),this._update(!0)}isSourceLoaded(l){return!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){const l=this.style&&this.style._sourceCaches;for(const r in l){const s=l[r]._tiles;for(const h in s){const m=s[h];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(l,r,s){this._lazyInitEmptyStyle(),this.style.addSourceType(l,r,s)}removeSource(l){return this.style.removeSource(l),this._updateTerrain(),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,r,{pixelRatio:s=1,sdf:h=!1,stretchX:m,stretchY:_,content:x}={}){if(this._lazyInitEmptyStyle(),r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap){const{width:w,height:A,data:P}=o.exported.getImageData(r);this.style.addImage(l,{data:new o.RGBAImage({width:w,height:A},P),pixelRatio:s,stretchX:m,stretchY:_,content:x,sdf:h,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:w,height:A}=r,P=r;this.style.addImage(l,{data:new o.RGBAImage({width:w,height:A},new Uint8Array(P.data)),pixelRatio:s,stretchX:m,stretchY:_,content:x,sdf:h,version:0,userImage:P}),P.onAdd&&P.onAdd(this,l)}}updateImage(l,r){const s=this.style.getImage(l);if(!s)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap?o.exported.getImageData(r):r,{width:m,height:_}=h;m!==void 0&&_!==void 0?m===s.data.width&&_===s.data.height?(s.data.replace(h.data,!(r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap)),this.style.updateImage(l,s)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${m}, ${_})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,r){o.getImage(this._requestManager.transformRequest(l,o.ResourceType.Image),(s,h)=>{r(s,h instanceof o.window.HTMLImageElement?o.exported.getImageData(h):h)})}listImages(){return this.style.listImages()}addLayer(l,r){return this._lazyInitEmptyStyle(),this.style.addLayer(l,r),this._update(!0)}moveLayer(l,r){return this.style.moveLayer(l,r),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,r,s){return this.style.setLayerZoomRange(l,r,s),this._update(!0)}setFilter(l,r,s={}){return this.style.setFilter(l,r,s),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,r,s,h={}){return this.style.setPaintProperty(l,r,s,h),this._update(!0)}getPaintProperty(l,r){return this.style.getPaintProperty(l,r)}setLayoutProperty(l,r,s,h={}){return this.style.setLayoutProperty(l,r,s,h),this._update(!0)}getLayoutProperty(l,r){return this.style.getLayoutProperty(l,r)}setLight(l,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(l),this.transform):0}setFeatureState(l,r){return this.style.setFeatureState(l,r),this._update()}removeFeatureState(l,r){return this.style.removeFeatureState(l,r),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let s,h,m,_=this._container;for(;_&&(!h||!m);){const x=o.window.getComputedStyle(_).transform;x&&x!=="none"&&(s=x.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),_=_.parentElement}this._containerWidth=h?Math.abs(l/h):l,this._containerHeight=m?Math.abs(r/m):r}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ue("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=Ue("div","mapboxgl-canvas-container",l);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=Ue("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=Ue("div","mapboxgl-control-container",l),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{h[m]=Ue("div",`mapboxgl-ctrl-${m}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,r){const s=o.exported.devicePixelRatio||1;this._canvas.width=s*Math.ceil(l),this._canvas.height=s*Math.ceil(r),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${r}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const r=this._markers.indexOf(l);r!==-1&&this._markers.splice(r,1)}_setupPainter(){const l=o.extend({},me.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",l)||this._canvas.getContext("experimental-webgl",l);r?(o.storeAuthState(r,!0),this.painter=new zs(r,this.transform),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(r)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let r;const s=this.painter.context.extTimerQuery,h=o.exported.now();if(this.listens("gpu-timing-frame")&&(r=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();let m=!1;const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,P=this.transform.pitch,k=o.exported.now();this.style.zoomHistory.update(A,k);const j=new o.EvaluationParameters(A,{now:k,fadeDuration:_,pitch:P,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Z=j.crossFadingFactor();Z===1&&Z===this._crossFadingFactor||(m=!0,this._crossFadingFactor=Z),this.style.update(j)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(h),this.style._updateSources(this.transform),this._forceMarkerUpdate()):x=this._updateAverageElevation(h),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const A=o.exported.now()-h;s.endQueryEXT(s.TIME_ELAPSED_EXT,r),setTimeout(()=>{const P=s.getQueryObjectEXT(r,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(r),this.fire(new o.Event("gpu-timing-frame",{cpuTime:A,gpuTime:P})),o.window.performance.mark("frame-gpu",{startTime:h,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(A);this.fire(new o.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(A);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const w=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(w||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(x=this._updateAverageElevation(h,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||w||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const l of this._markers)l._update()}_updateAverageElevation(l,r=!1){const s=h=>(this.transform.averageElevation=h,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);if((r||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const h=this.transform.averageElevation;let m=this.transform.sampleAverageElevation(),_=!1;this.transform.elevation&&(_=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=l;const x=Math.abs(h-m);if(x>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(m),s(m);this._averageElevation.easeTo(m,l,300)}else if(x>1e-4)return this._averageElevation.jumpTo(m),s(m)}return!!this._averageElevation.isEasing(l)&&s(this._averageElevation.getValue(l))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===o.AUTH_ERR_MSG||l.status===401)){const r=this.painter.context.gl;o.storeAuthState(r,!1),this._logoControl instanceof Cu&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function m(_){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,_,0);const x=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,x),x}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(m(l),r.canvasCopies.map(m),r.timeStamps)}_canvasPixelComparison(l,r,s){let h=s[1]-s[0];const m=l.length/4;for(let _=0;_<r.length;_++){const x=r[_];let w=0;for(let A=0;A<x.length;A+=4)x[A]===l[A]&&x[A+1]===l[A+1]&&x[A+2]===l[A+2]&&x[A+3]===l[A+3]&&(w+=1);h+=(s[_+2]-s[_+1])*(1-w/m)}return h}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),mc(this._canvasContainer),mc(this._controlContainer),mc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=o.exported.frame(r=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(r)}))}_preloadTiles(l){const r=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(r,(s,h)=>s._preloadTiles(l,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}_setCacheLimits(l,r){o.setCacheLimits(l,r)}get version(){return o.version}},NavigationControl:class{constructor(l){this.options=o.extend({},Oh,l),this._container=Ue("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),Ue("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),Ue("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:r}):s.resetNorth({},{originalEvent:r}))}),this._compassIcon=Ue("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const r=l.getZoom(),s=r===l.getMaxZoom(),h=r===l.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zu(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,r){const s=Ue("button",l,this._container);return s.type="button",s.addEventListener("click",r),s}_setButtonTitle(l,r){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${r}`);l.setAttribute("aria-label",s),l.firstElementChild&&l.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.Evented{constructor(l){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},ku,l),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ra(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=Ue("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){this._supportsGeolocation!==void 0?l(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(r=>{this._supportsGeolocation=r.state!=="denied",l(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,l(this._supportsGeolocation))}_isOutOfMapMaxBounds(l){const r=this._map.getMaxBounds(),s=l.coords;return!!r&&(s.longitude<r.getWest()||s.longitude>r.getEast()||s.latitude<r.getSouth()||s.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",l)),this._finish()}}_updateCamera(l){const r=new o.LngLat(l.coords.longitude,l.coords.latitude),s=l.coords.accuracy,h=this._map.getBearing(),m=o.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(s),m,{geolocateSource:!0})}_updateMarker(l){if(l){const r=new o.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,r=o.mercatorZfromAltitude(1,l._center.lat)*l.worldSize,s=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Ue("button","mapboxgl-ctrl-geolocate",this._container),Ue("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ue("div","mapboxgl-user-location"),this._dotElement.appendChild(Ue("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ue("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new $c({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ue("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $c({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Mu,ScaleControl:class{constructor(l){this.options=o.extend({},qc,l),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Du.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,r=this._map,s=r._containerHeight/2,h=r._containerWidth/2-l/2,m=r.unproject([h,s]),_=r.unproject([h+l,s]),x=m.distanceTo(_);if(this.options.unit==="imperial"){const w=3.2808*x;w>5280?this._setScale(l,w/5280,"mile"):this._setScale(l,w,"foot")}else this.options.unit==="nautical"?this._setScale(l,x/1852,"nautical-mile"):x>=1e3?this._setScale(l,x/1e3,"kilometer"):this._setScale(l,x,"meter")}_setScale(l,r,s){const h=Zc(r),m=h/r;this._map._requestDomTask(()=>{this._container.style.width=l*m+"px",this._container.innerHTML=s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:s}).format(h):`${h}&nbsp;nm`})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=Ue("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof o.window.HTMLElement?this._container=l.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ue("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=Ue("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ue("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(l){super(),this.options=o.extend(Object.create(Lu),l),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=o.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(o.window.document.createTextNode(l))}setHTML(l){const r=o.window.document.createDocumentFragment(),s=o.window.document.createElement("body");let h;for(s.innerHTML=l;h=s.firstChild,h;)r.appendChild(h);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=Ue("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(l),this.options.closeButton){const s=this._closeButton=Ue("button","mapboxgl-popup-close-button",r);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let r;return this._classList.delete(l)?r=!1:(this._classList.add(l),r=!0),this._updateClassList(),r}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const r=this._map,s=this._container,h=this._pos;if(!r||!s||!h)return"bottom";const m=s.offsetWidth,_=s.offsetHeight,x=h.x<m/2,w=h.x>r.transform.width-m/2;if(h.y+l<_)return x?"top-left":w?"top-right":"top";if(h.y>r.transform.height-_){if(x)return"bottom-left";if(w)return"bottom-right"}return x?"left":w?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),l.className=r.join(" ")}_update(l){const r=this._map,s=this._content;if(!r||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=Ue("div","mapboxgl-popup",r.getContainer()),this._tip=Ue("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=fa(this._lngLat,this._pos,r.transform)),!this._trackPointer||l){const m=this._pos=this._trackPointer&&l?l:r.project(this._lngLat),_=ml(this.options.offset),x=this._anchor=this._getAnchor(_.y),w=ml(this.options.offset,x),A=m.add(w).round();r._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${pc[x]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&r._showingGlobe()){const m=o.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(_c);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:$c,Style:Bn,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:St,Evented:o.Evented,config:o.config,prewarm:function(){ji().acquire(Ut)},clearPrewarmedResources:function(){const l=oi;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Ut),oi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(l){o.config.ACCESS_TOKEN=l},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(l){o.config.API_URL=l},get workerCount(){return Wt.workerCount},set workerCount(l){Wt.workerCount=l},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){o.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){o.clearTileCache(l)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return gc});var q=B;return q})})(d0);const ky=d0.exports;window.Alpine=h0;h0.start();ky.accessToken="pk.eyJ1IjoiYWxpcWJhbCIsImEiOiJjbDhncWNkdXkxbndsM3BxOWt2cGdleTg1In0.pBai260ADR-rPqGodqrxBQ";var uw={container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-24,42],zoom:1,projection:"globe"};let hw="1";function p0(){const v=new ky.Map(uw),I=new ky.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0});v.addControl(I),v.on("style.load",()=>{v.setFog({}),v.resize(),I.trigger()}),I.trigger(),I.on("geolocate",E);function E(L){this.long=L.coords.longitude,this.lat=L.coords.latitude}}function dw(){location.reload()}window.addEventListener("setMap",p0);document.getElementById("btn-close-modalDl").addEventListener("click",dw);document.getElementById("btn-submit-dlpre").addEventListener("click",()=>{document.getElementById("myFile"),alert(globalThis.long,hw),window.livewire.emit("setLonglat",globalThis.long,globalThis.lat)});window.addEventListener("runmaps",p0);
